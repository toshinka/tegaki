 âœ… config.js (Phase 2å®Œå…¨ç‰ˆ) loaded
    - BRUSH_DEFAULTSè¿½åŠ å®Œäº†
 âœ… system/event-bus.js Phase 2: å„ªå…ˆåº¦æ©Ÿèƒ½è¿½åŠ ç‰ˆ loaded
 âœ… data-models.js (ãƒã‚¹ã‚¯ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆä¸å¯è¦–ç‰ˆ) loaded
 âœ… batch-api.js (Phase 6: Historyçµ±åˆç‰ˆ) loaded
 âœ… popup-manager.js (quick-accessé™¤å¤–å¯¾å¿œç‰ˆ) loaded
 âœ… camera-system.js (v2.0: ãƒªã‚µã‚¤ã‚ºä¿®æ­£ç‰ˆ) loaded
 âœ… layer-transform.js (Phase 4å®Œäº†: Vãƒ¢ãƒ¼ãƒ‰åè»¢æ©Ÿèƒ½å®Œå…¨ç‰ˆ) loaded
 âœ… layer-system.js (v2.0.1: åè»¢æ©Ÿèƒ½ä¿®å¾©ç‰ˆ) loaded
 âœ… drawing-clipboard.js Phase4æ”¹ä¿®ç‰ˆ+ç¢ºå®šã‚¤ãƒ™ãƒ³ãƒˆ loaded
    - âœ… CTRL+V behavior: overwrite active layer
    - âœ… Commit events: paste:commit, operation:commit
    - âœ… Thumbnail auto-update on paste
 âœ… history.js (Phase 3: Redo nullå‚ç…§ä¿®æ­£ç‰ˆ) loaded
 âœ… animation-system.js (Phase 1æ”¹ä¿®ç‰ˆãƒ»ãƒ•ãƒ¬ãƒ¼ãƒ åçµ±ä¸€: xFå½¢å¼) loaded
 âœ… pressure-handler.js (Phase 3: è·é›¢ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿è¿½åŠ ç‰ˆ) loaded
    - applyDistanceFilter() è¿½åŠ 
    - çŸ­è·é›¢: alpha=0.9 (å³åº§åæ˜ )
    - é•·è·é›¢: alpha=0.3 (ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°å¼·)
 âœ… curve-interpolator.js (Phase 3) loaded
    - Catmull-Rom ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³è£œé–“
    - é©å¿œçš„ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å¯¾å¿œ
    - tiltX/Y/twist ãƒ‡ãƒ¼ã‚¿è£œé–“å¯¾å¿œ
 âœ… system/drawing/stroke-renderer.js loaded (ã‚°ãƒ­ãƒ¼ãƒãƒ«ç™»éŒ²ä¿®æ­£ç‰ˆ)
 âœ… system/drawing/thumbnail-system.js Phase 1å®Œå…¨ç‰ˆ loaded
 âœ… brush-settings.js (APIçµ±ä¸€ç‰ˆ) loaded
    - âœ… getOpacity() / setOpacity() è¿½åŠ 
    - âœ… brush:opacity-changed ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­è¿½åŠ 
 âœ… drawing-engine.js (Phase 2å®Œå…¨ä¿®æ­£ç‰ˆ - å®‰å…¨ãªäº’æ›å®Ÿè£…) loaded
 âœ… quick-export-ui.js (ç„¡åŠ¹åŒ–ç‰ˆ) loaded
 âœ… export-manager.js (CUTâ†’FRAMEå®Œå…¨ä¿®æ­£ç‰ˆ) loaded
 âœ… png-exporter.js (å˜ä¸€ãƒ•ãƒ¬ãƒ¼ãƒ å°‚ç”¨ãƒ»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾å¿œ) loaded
 âœ… apng-exporter.js (CUTâ†’FRAMEå®Œå…¨ä¿®æ­£ç‰ˆ) loaded
 âœ… gif-exporter.js (CUTâ†’FRAMEå®Œå…¨ä¿®æ­£ç‰ˆ) loaded
 âœ… webp-exporter.js (é™æ­¢ç”»ãƒ»å‹•ç”»è‡ªå‹•åˆ¤å®šå¯¾å¿œç‰ˆ) loaded
 âœ… mp4-exporter.js (Phase 8å®Œæˆç‰ˆ) loaded
 âœ… pdf-exporter.js (CUTâ†’FRAMEå®Œå…¨å¯¾å¿œç‰ˆ) loaded
 âœ… dom-builder.js (IDé‡è¤‡è§£æ¶ˆç‰ˆ) loaded
    - #pen-settings â†’ #legacy-pen-settings ã«å¤‰æ›´
    - pen-size-slider â†’ legacy-pen-size-slider ã«å¤‰æ›´
dom-builder.js:497    - quick-access-popup.jsã¨ã®IDç«¶åˆã‚’å®Œå…¨è§£æ¶ˆ
slider-utils.js:197 âœ… ui/slider-utils.js loaded
slider-utils.js:198    - è²¬å‹™: ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼UIã®çµ±ä¸€å®Ÿè£…
slider-utils.js:199    - DRYåŸå‰‡: settings-popup.js ã¨ ui-panels.js ã§å…±æœ‰
slider-utils.js:200    - API: createSlider() / createSimpleSlider()
keyboard-handler.js:318 âœ… keyboard-handler.js (P/Eã‚µã‚¤ãƒ‰ãƒãƒ¼åŒæœŸç‰ˆ) loaded
resize-popup.js:452 âœ… resize-popup.js (Phase 4å®Œäº†: ãƒ­ã‚¸ãƒƒã‚¯å‰Šæ¸›ç‰ˆ) loaded
status-display-renderer.js:138 âœ… status-display-renderer.js (Phase 1æ”¹ä¿®ç‰ˆ) loaded
timeline-ui.js:981 âœ… timeline-ui.js (Phase 4å®Œäº†: ãƒ¬ã‚¤ãƒ¤ãƒ¼å¤‰å½¢é€£æºç‰ˆ) loaded
album-popup.js:473 âœ… album-popup.js (FRAMEæ”¹ä¿®ç‰ˆ) loaded
settings-popup.js:583 âœ… settings-popup.js (å³å¿œæ€§å®Œå…¨ä¿®æ­£ç‰ˆ) loaded
settings-popup.js:584    - CSS transitionå®Œå…¨é™¤å»ï¼ˆ!importantä»˜ãï¼‰
settings-popup.js:585    - DOMæ›´æ–°ã‚’åŒæœŸçš„ã«å³åº§å®Ÿè¡Œ
settings-popup.js:586    - quick-access/resize-popupã¨å®Œå…¨åŒç­‰ã®å‹•ä½œ
quick-access-popup.js:538 âœ… quick-access-popup.js (èƒŒæ™¯ãƒ‰ãƒ©ãƒƒã‚° + é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ç‰ˆ) loaded
quick-access-popup.js:539    - èƒŒæ™¯ãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹•å¯èƒ½ï¼ˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼/ãƒœã‚¿ãƒ³ä»¥å¤–ï¼‰
quick-access-popup.js:540    - å³ä¸ŠÃ—ãƒœã‚¿ãƒ³ã§é–‰ã˜ã‚‹
quick-access-popup.js:541    - ç”»é¢å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ãªã„ï¼ˆå¸¸æ™‚é–‹ãã£ã±ãªã—å¯èƒ½ï¼‰
export-popup.js:423 âœ… export-popup.js (frameInfoä¿®æ­£ç‰ˆï¼‹PDFæœ‰åŠ¹åŒ–) loaded
ui-panels.js:408 âœ… ui-panels.js (ã‚µã‚¤ãƒ‰ãƒãƒ¼åŒæœŸãƒ»è‰²èª¿æ•´ç‰ˆ) loaded
core-runtime.js:713 âœ… core-runtime.js (Phase 1-3å®Œå…¨ç‰ˆ: ThumbnailSystemçµ±åˆ) loaded
core-engine.js:724 âœ… core-engine.js (Phase2å®Œå…¨ä¿®æ­£ç‰ˆ) loaded
core-initializer.js:347 âœ… core-initializer.js (å®Œå…¨ä¿®æ­£ç‰ˆãƒ»SettingsManagerï¼‹ExportPopupå¯¾å¿œ) loaded
drawing-clipboard.js:19 DrawingClipboard: Initializing...
drawing-clipboard.js:26 âœ… DrawingClipboard initialized (Phase4æ”¹ä¿®ç‰ˆ + ç¢ºå®šã‚¤ãƒ™ãƒ³ãƒˆ)
thumbnail-system.js:43 âœ… ThumbnailSystem initialized
core-initializer.js:63 âœ… SettingsManager initialized
popup-manager.js:16 âœ… PopupManager initialized
popup-manager.js:42 ğŸ“‹ Popup "settings" registered (priority: 1)
popup-manager.js:42 ğŸ“‹ Popup "quickAccess" registered (priority: 2)
popup-manager.js:42 ğŸ“‹ Popup "album" registered (priority: 3)
popup-manager.js:42 ğŸ“‹ Popup "resize" registered (priority: 4)
popup-manager.js:102 ğŸ”§ Initializing all popups...
popup-manager.js:87 âœ… Popup "settings" initialized successfully
popup-manager.js:87 âœ… Popup "quickAccess" initialized successfully
popup-manager.js:87 âœ… Popup "album" initialized successfully
popup-manager.js:87 âœ… Popup "resize" initialized successfully
popup-manager.js:118 ğŸ“Š Popup initialization: 4 ready, 0 deferred
popup-manager.js:42 ğŸ“‹ Popup "export" registered (priority: 5)
popup-manager.js:87 âœ… Popup "export" initialized successfully
core-initializer.js:245 âœ… ExportPopup registered and initialized
// ===== Graphics ã®æç”»å†…å®¹ã‚’è©³ç´°ç¢ºèª =====

const layerMgr = window.CoreRuntime.internal.layerManager;
const activeLayer = layerMgr.getActiveLayer();
const lastChild = activeLayer.children[activeLayer.children.length - 1];

console.log('=== Graphics æç”»å†…å®¹ ===');
console.log('lastChild:', lastChild);
console.log('lastChild.constructor.name:', lastChild.constructor.name);

// PixiJS v8ã® Graphics ã®å†…éƒ¨æ§‹é€ ç¢ºèª
if (lastChild.geometry) {
    console.log('geometry:', lastChild.geometry);
    console.log('geometry.graphicsData:', lastChild.geometry.graphicsData);
    console.log('geometry.batches:', lastChild.geometry.batches);
}

// ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ç¢ºèª
try {
    const bounds = lastChild.getBounds();
    console.log('bounds:', {
        x: bounds.x,
        y: bounds.y,
        width: bounds.width,
        height: bounds.height
    });
} catch (e) {
    console.log('getBounds error:', e);
}

// æ‰‹å‹•ã§ãƒ†ã‚¹ãƒˆæç”»
console.log('=== æ‰‹å‹•ãƒ†ã‚¹ãƒˆæç”» ===');

const testGraphics = new PIXI.Graphics();
testGraphics.circle(100, 100, 50);
testGraphics.fill({ color: 0xFF0000, alpha: 1.0 });

activeLayer.addChild(testGraphics);
console.log('âœ“ èµ¤ã„å††ã‚’ (100, 100) ã«è¿½åŠ ');
console.log('  â†’ ç”»é¢ã«èµ¤ã„å††ãŒè¦‹ãˆã¾ã™ã‹ï¼Ÿ');

// ã‚‚ã†ä¸€ã¤ã€ç·šã‚’æç”»
const testLine = new PIXI.Graphics();
testLine.moveTo(0, 0);
testLine.lineTo(200, 200);
testLine.stroke({ width: 5, color: 0x00FF00, alpha: 1.0 });

activeLayer.addChild(testLine);
console.log('âœ“ ç·‘ã®ç·šã‚’ (0,0) â†’ (200,200) ã«è¿½åŠ ');
console.log('  â†’ ç”»é¢ã«ç·‘ã®ç·šãŒè¦‹ãˆã¾ã™ã‹ï¼Ÿ');

// æ—¢å­˜ã®æç”»ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ã®ãƒ‡ãƒ¼ã‚¿ç¢ºèª
console.log('=== ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®pathsãƒ‡ãƒ¼ã‚¿ ===');
console.log('activeLayer.layerData.paths:', activeLayer.layerData?.paths);
console.log('paths.length:', activeLayer.layerData?.paths?.length);

if (activeLayer.layerData?.paths?.length > 0) {
    const lastPath = activeLayer.layerData.paths[activeLayer.layerData.paths.length - 1];
    console.log('last path:', lastPath);
    console.log('last path.graphics:', lastPath.graphics);
    console.log('last path.points:', lastPath.points?.slice(0, 3)); // æœ€åˆã®3ç‚¹
}
VM80:7 === Graphics æç”»å†…å®¹ ===
VM80:8 lastChild: orÂ {_events: i, _eventsCount: 0, uid: 21, _updateFlags: 0, renderGroup: null,Â â€¦}
VM80:9 lastChild.constructor.name: or
VM80:21 bounds: {x: 0, y: 0, width: 0, height: 0}
VM80:32 === æ‰‹å‹•ãƒ†ã‚¹ãƒˆæç”» ===
VM80:39 âœ“ èµ¤ã„å††ã‚’ (100, 100) ã«è¿½åŠ 
VM80:40   â†’ ç”»é¢ã«èµ¤ã„å††ãŒè¦‹ãˆã¾ã™ã‹ï¼Ÿ
VM80:49 âœ“ ç·‘ã®ç·šã‚’ (0,0) â†’ (200,200) ã«è¿½åŠ 
VM80:50   â†’ ç”»é¢ã«ç·‘ã®ç·šãŒè¦‹ãˆã¾ã™ã‹ï¼Ÿ
VM80:53 === ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®pathsãƒ‡ãƒ¼ã‚¿ ===
VM80:54 activeLayer.layerData.paths: [{â€¦}]
VM80:55 paths.length: 1
VM80:59 last path: {id: 'path_1761709381209_1p5s15cpi', points: Array(1), color: 8388608, size: 10, opacity: 85,Â â€¦}
VM80:60 last path.graphics: orÂ {_events: i, _eventsCount: 0, uid: 21, _updateFlags: 0, renderGroup: null,Â â€¦}
VM80:61 last path.points: [{â€¦}]
undefined
// ===== å³åº§ä¿®æ­£: StrokeRenderer ã‚’ v8 å¯¾å¿œç‰ˆã«ç½®ãæ›ãˆ =====

window.StrokeRenderer = class StrokeRenderer {
    constructor(app, layerSystem, cameraSystem) {
        this.app = app;
        this.layerSystem = layerSystem;
        this.cameraSystem = cameraSystem;
        this.resolution = window.devicePixelRatio || 1;
        this.minPhysicalWidth = 1 / this.resolution;
        this.currentTool = 'pen';
    }
    
    setTool(tool) {
        this.currentTool = tool;
    }
    
    calculateWidth(pressure, brushSize) {
        const minRatio = Math.max(0.3, this.minPhysicalWidth);
        const ratio = Math.max(minRatio, pressure || 0.5);
        return Math.max(this.minPhysicalWidth, brushSize * ratio);
    }
    
    renderPreview(points, settings) {
        const graphics = new PIXI.Graphics();
        if (points.length === 0) return graphics;
        
        if (this.currentTool === 'eraser') {
            graphics.blendMode = 'erase';
        }
        
        // å˜ç‹¬ç‚¹
        if (points.length === 1) {
            const p = points[0];
            const width = this.calculateWidth(p.pressure, settings.size);
            graphics.circle(p.x, p.y, width / 2);
            graphics.fill({
                color: this.currentTool === 'eraser' ? 0xFFFFFF : settings.color,
                alpha: settings.alpha || 1.0
            });
            return graphics;
        }
        
        // PixiJS v8: å„ç·šåˆ†ã”ã¨ã« stroke() ã‚’å‘¼ã¶
        for (let i = 0; i < points.length - 1; i++) {
            const p1 = points[i];
            const p2 = points[i + 1];
            const w1 = this.calculateWidth(p1.pressure, settings.size);
            const w2 = this.calculateWidth(p2.pressure, settings.size);
            const avgWidth = (w1 + w2) / 2;
            
            graphics.moveTo(p1.x, p1.y);
            graphics.lineTo(p2.x, p2.y);
            graphics.stroke({
                width: avgWidth,
                color: this.currentTool === 'eraser' ? 0xFFFFFF : settings.color,
                alpha: settings.alpha || 1.0,
                cap: 'round',
                join: 'round'
            });
        }
        
        return graphics;
    }
    
    renderStroke(layer, strokeData, settings) {
        if (!layer || !strokeData || !strokeData.points || strokeData.points.length === 0) {
            return null;
        }
        
        const graphics = new PIXI.Graphics();
        
        if (this.currentTool === 'eraser') {
            graphics.blendMode = 'erase';
        }
        
        // å˜ç‹¬ç‚¹
        if (strokeData.isSingleDot || strokeData.points.length === 1) {
            const p = strokeData.points[0];
            const width = this.calculateWidth(p.pressure || 0.5, settings.size);
            
            graphics.circle(p.x, p.y, width / 2);
            graphics.fill({
                color: this.currentTool === 'eraser' ? 0xFFFFFF : settings.color,
                alpha: settings.opacity || 1.0
            });
        } else {
            // PixiJS v8: å„ç·šåˆ†ã”ã¨ã« stroke() ã‚’å‘¼ã¶ï¼ˆé‡è¦ï¼ï¼‰
            for (let i = 0; i < strokeData.points.length - 1; i++) {
                const p1 = strokeData.points[i];
                const p2 = strokeData.points[i + 1];
                const w1 = this.calculateWidth(p1.pressure || 0.5, settings.size);
                const w2 = this.calculateWidth(p2.pressure || 0.5, settings.size);
                const avgWidth = (w1 + w2) / 2;
                
                graphics.moveTo(p1.x, p1.y);
                graphics.lineTo(p2.x, p2.y);
                graphics.stroke({
                    width: avgWidth,
                    color: settings.color,
                    alpha: settings.opacity || 1.0,
                    cap: 'round',
                    join: 'round'
                });
            }
        }
        
        const pathData = {
            id: 'path_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
            points: strokeData.points,
            color: settings.color,
            size: settings.size,
            opacity: settings.opacity || 1.0,
            tool: this.currentTool,
            isComplete: true,
            graphics: graphics
        };
        
        return pathData;
    }
    
    updateResolution() {
        this.resolution = window.devicePixelRatio || 1;
        this.minPhysicalWidth = 1 / this.resolution;
    }
};

// DrawingEngineã«å†æ³¨å…¥
const engine = window.CoreRuntime.internal.drawingEngine;
engine.strokeRenderer = new window.StrokeRenderer(
    engine.app,
    engine.layerSystem,
    engine.cameraSystem
);

console.log('âœ… StrokeRenderer fixed for PixiJS v8');
console.log('ã‚­ãƒ£ãƒ³ãƒã‚¹ã§ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦æç”»ã—ã¦ãã ã•ã„ï¼');
VM83:135 âœ… StrokeRenderer fixed for PixiJS v8
VM83:136 ã‚­ãƒ£ãƒ³ãƒã‚¹ã§ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦æç”»ã—ã¦ãã ã•ã„ï¼
undefined
