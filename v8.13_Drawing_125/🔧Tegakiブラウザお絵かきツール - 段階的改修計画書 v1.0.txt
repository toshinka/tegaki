# Tegakiãƒ–ãƒ©ã‚¦ã‚¶ãŠçµµã‹ããƒ„ãƒ¼ãƒ« - æ®µéšçš„æ”¹ä¿®è¨ˆç”»æ›¸ v1.0

---
ğŸ“–ç´¢å¼•ä½œæˆã§åˆ¤æ˜ã—ãŸæ–°äº‹å®Ÿ
1. PointerHandler ã® Phase 2 è£œæ­£å®Ÿè£…ã‚’ç™ºè¦‹

pointerType='mouse' ã§ã‚‚ç­†åœ§/å‚¾ããŒã‚ã‚Œã°è‡ªå‹•çš„ã« 'pen' æ‰±ã„
Windowsç­‰ã§ã®èª¤èªå•é¡Œã«æ—¢ã«å¯¾å¿œæ¸ˆã¿
æ”¹ä¿®è¨ˆç”»ã¸ã®å½±éŸ¿: ç‰¹ã«ãªã—ï¼ˆæ—¢å­˜å®Ÿè£…ãŒæ­£ã—ã„ï¼‰

2. PressureHandler ã® Phase 3/4 æ‹¡å¼µã‚’ç¢ºèª

è·é›¢ãƒ™ãƒ¼ã‚¹é©å¿œãƒ•ã‚£ãƒ«ã‚¿å®Ÿè£…æ¸ˆã¿
window.PressureHandler ã¨ã—ã¦ã‚°ãƒ­ãƒ¼ãƒãƒ«å…¬é–‹æ¸ˆã¿
æ”¹ä¿®è¨ˆç”»ã¸ã®å½±éŸ¿: ç‰¹ã«ãªã—ï¼ˆæ—¢å­˜å®Ÿè£…ãŒå…ˆé€²çš„ï¼‰

3. åº§æ¨™å¤‰æ›ã®å®Œç’§ãªåˆ†é›¢ã‚’ç¢ºèª

coordinate-system.js ãŒå”¯ä¸€ã®å®Ÿä½“
drawing-engine.js ã§å¤‰æ›å®Œçµ
stroke-recorder.js ã¯å¤‰æ›ãªã—ï¼ˆæ­£ã—ã„è¨­è¨ˆï¼‰
æ”¹ä¿®è¨ˆç”»ã¸ã®å½±éŸ¿: Phase 1-2ã§ç¢ºèªä¸è¦ã€è¨­è¨ˆã¯å®Œç’§

4. ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ã®å•é¡Œç‚¹ã‚’æ˜ç¢ºåŒ–

thumbnail-update-manager.js ã¯ emit() ã™ã‚‹ã ã‘
å®Ÿä½“ã¯ layer-panel-renderer.js ã«æ®‹å­˜
layer-system.js ãŒç›´æ¥å‘¼ã³å‡ºã™ç®‡æ‰€ã‚‚ã‚ã‚‹
æ”¹ä¿®è¨ˆç”»ã¸ã®å½±éŸ¿: Phase 3ã®é‡è¦æ€§ãŒæ›´ã«é«˜ã¾ã£ãŸ

5. Vã‚­ãƒ¼ãƒ¢ãƒ¼ãƒ‰ç®¡ç†ã®å†—é•·æ€§ã‚’ç¢ºèª

3ç®‡æ‰€ã§çŠ¶æ…‹ä¿æŒï¼ˆkeyboard-handler, layer-transform, layer-systemï¼‰
æ©Ÿèƒ½çš„ã«ã¯å•é¡Œãªã„ãŒã€Phase 2ã§æ•´ç†å¯èƒ½
æ”¹ä¿®è¨ˆç”»ã¸ã®å½±éŸ¿: Phase 2ã§Vã‚­ãƒ¼ãƒã‚§ãƒƒã‚¯ä¸€å…ƒåŒ–ã®é‡è¦æ€§ç¢ºèª

ğŸ”§æ”¹ä¿®è¨ˆç”»æ›¸ã®å¤‰æ›´ç‚¹
ç´¢å¼•ä½œæˆã«ã‚ˆã‚Šã€æ”¹ä¿®è¨ˆç”»æ›¸ã®å¤‰æ›´ã¯ä¸è¦ã¨åˆ¤æ–­ã—ã¾ã—ãŸã€‚ç†ç”±:

Phase 1: BS/DEL ã‚­ãƒ¼ãƒ»ã‚µãƒ ãƒã‚¤ãƒ«ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”å•é¡Œã¯æ—¢ã«æ­£ç¢ºã«ç‰¹å®šæ¸ˆã¿
Phase 2: Vã‚­ãƒ¼é–¢é€£ã®å•é¡Œã‚‚æ­£ç¢ºã«æŠŠæ¡æ¸ˆã¿
Phase 3: ã‚µãƒ ãƒã‚¤ãƒ«çµ±åˆã®å¿…è¦æ€§ãŒæ›´ã«æ˜ç¢ºåŒ–ã•ã‚ŒãŸã ã‘
Phase 4/5: ä»»æ„é …ç›®ã¨ã—ã¦é©åˆ‡ã«ä½ç½®ä»˜ã‘æ¸ˆã¿

ãŸã ã—ã€Phaseå„ªå…ˆåº¦ã‚’å¾®èª¿æ•´ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¾ã™:
ğŸ”„æ¨å¥¨ã™ã‚‹å®Ÿæ–½é †åºï¼ˆå¤‰æ›´ãªã—ï¼‰

Phase 1ï¼ˆå³å®Ÿæ–½ï¼‰ - BS/DELãƒ»ã‚µãƒ ãƒã‚¤ãƒ«ä¿®æ­£
Phase 2ï¼ˆé«˜å„ªå…ˆï¼‰ - ãƒ¬ã‚¤ãƒ¤ãƒ¼åè»¢æ©Ÿèƒ½å¾©æ—§
Phase 3ï¼ˆé«˜å„ªå…ˆã«æ ¼ä¸Šã’ï¼‰ - ã‚µãƒ ãƒã‚¤ãƒ«ä¸€å…ƒåŒ– â† âš ï¸ ã‚ˆã‚Šé‡è¦ã¨åˆ¤æ˜
Phase 4ï¼ˆä½å„ªå…ˆï¼‰ - ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ï¼ˆä»»æ„ï¼‰
Phase 5ï¼ˆç¶™ç¶šï¼‰ - ãƒ˜ãƒƒãƒ€ãƒ¼è¨˜è¿°

---



## ğŸ” èª¿æŸ»çµæœã‚µãƒãƒªãƒ¼

### ã€ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œç‚¹ã€‘

#### 1. BS/DELã‚­ãƒ¼ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼æ¶ˆå»æ©Ÿèƒ½
**çŠ¶æ…‹**: å®Ÿè£…æ¸ˆã¿ã ãŒç™ºç«ã—ãªã„å¯èƒ½æ€§
**å ´æ‰€**: `keyboard-handler.js`
**åŸå› **: 
- `LAYER_DELETE_DRAWINGS`ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®šç¾©æ¸ˆã¿
- ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ãƒ•ãƒ­ãƒ¼ã¯å®Ÿè£…æ¸ˆã¿
- `deleteActiveLayerDrawings()`ãƒ¡ã‚½ãƒƒãƒ‰å­˜åœ¨
- ç™ºç«ç¢ºèªãŒå¿…è¦

#### 2. ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚µãƒ ãƒã‚¤ãƒ«ã®ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”å•é¡Œ  
**çŠ¶æ…‹**: ç¢ºèªã•ã‚ŒãŸä¸å…·åˆ
**å ´æ‰€**: `layer-panel-renderer.js`
**åŸå› **:
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã¿å‹•çš„ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”è¨ˆç®— (L490-501)
- éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯å›ºå®šã‚µã‚¤ã‚ºåŒ–ã®å¯èƒ½æ€§
- èƒŒæ™¯ã‚µãƒ ãƒã‚¤ãƒ«ã¯64x44pxå›ºå®šã ãŒè¡¨ç¤ºå´©ã‚Œå ±å‘Šã‚ã‚Š

#### 3. ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒ åè»¢æ©Ÿèƒ½
**çŠ¶æ…‹**: å®Ÿè£…ã¯å®Œå…¨ã ãŒç™ºç«çµŒè·¯ã«å•é¡Œ
**å ´æ‰€**: `layer-transform.js`, `ui-panels.js`, `keyboard-handler.js`
**åŸå› åˆ†æ**:
- **layer-transform.js**: flipLayer()å®Ÿè£…å®Œå…¨ (L239-261)
- **keyboard-handler.js**: Vã‚­ãƒ¼åˆ¤å®šã‚ã‚Š (L145-155)  
- **ui-panels.js**: CoreRuntime APIçµŒç”±å®Ÿè£… (L157-169)
- **å•é¡Œ**: ã‚¤ãƒ™ãƒ³ãƒˆä¼æ’­ã®ä¸å®Œå…¨æ€§

#### 4. èƒŒæ™¯ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºå•é¡Œ
**çŠ¶æ…‹**: æ£’çŠ¶è¡¨ç¤ºã®å ±å‘Š
**å ´æ‰€**: `layer-panel-renderer.js`
**åŸå› **:
- `_createBackgroundThumbnail()` (L361-396)ã§64x44pxå›ºå®šè¨­å®š
- CSSã®gridé…ç½®å•é¡Œã®å¯èƒ½æ€§
- ä»–ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã®å¹²æ¸‰ç–‘ã„

### ã€äºŒé‡å®Ÿè£…ã®æ¤œå‡ºã€‘

#### A. ãƒ¬ã‚¤ãƒ¤ãƒ¼åè»¢å‡¦ç†ã®ä¸‰é‡å®Ÿè£…
1. **layer-transform.js** - flipLayer() (L239-261)
2. **layer-system.js** - flipActiveLayer() (L340-364) â€»layer-transformçµŒç”±
3. **ui-panels.js** - setupFlipButtons() (L157-169) â€»APIçµŒç”±

**è©•ä¾¡**: layer-system.jsãŒtransformã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹å½¢ã¯æ­£å¸¸ã€‚ui-panels.jsãŒCoreRuntimeçµŒç”±ã§å‘¼ã³å‡ºã™ã®ã‚‚æ­£å¸¸ã€‚å•é¡Œãªã—ã€‚

#### B. ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼ã®åˆ†æ•£
1. **thumbnail-update-manager.js** - ä¸€å…ƒç®¡ç†ã‚’æ„å›³
2. **layer-panel-renderer.js** - `_updateSingleThumbnail()` (L479-537)
3. **layer-system.js** - `requestThumbnailUpdate()` (L938-946)

**è©•ä¾¡**: thumbnail-update-manager.jsãŒæ©Ÿèƒ½ã—ã¦ã„ãªã„ã€‚å®Ÿéš›ã®æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ãŒlayer-panel-renderer.jsã«æ®‹å­˜ã€‚

#### C. Vã‚­ãƒ¼ãƒ¢ãƒ¼ãƒ‰ç®¡ç†ã®é‡è¤‡
1. **keyboard-handler.js** - vKeyPressedãƒˆã‚°ãƒ« (L8, L40-52)
2. **layer-transform.js** - isVKeyPressed (L13)
3. **layer-system.js** - vKeyPressed getter (L332-334)

**è©•ä¾¡**: keyboard-handlerãŒçœŸã®ã‚½ãƒ¼ã‚¹ã€ä»–ã¯ãƒ—ãƒ­ã‚­ã‚·ã€‚çµ±ä¸€æ€§ã¯ã‚ã‚‹ãŒå†—é•·ã€‚

---

## ğŸ“‹ æ®µéšçš„æ”¹ä¿®è¨ˆç”»

### Phase 1: åŸºç›¤è¨ºæ–­ãƒ»å³ä¿®æ­£å¯èƒ½é …ç›®
**ç›®çš„**: æ—¢å­˜å®Ÿè£…ã®ç™ºç«ç¢ºèªã¨æ˜ç™½ãªãƒã‚°ä¿®æ­£

#### å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- `keyboard-handler.js` (èª­ã¿è¾¼ã¿æ¸ˆã¿)
- `layer-panel-renderer.js` (èª­ã¿è¾¼ã¿æ¸ˆã¿)
- `config.js` (èª­ã¿è¾¼ã¿æ¸ˆã¿)

#### ä½œæ¥­å†…å®¹
1. **BS/DELã‚­ãƒ¼ç™ºç«ç¢ºèª**
   - `keyboard-handler.js` L86-98ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œç¢ºèª
   - `LAYER_DELETE_DRAWINGS`å®šç¾©ç¢ºèª (config.js L145-148)
   - ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ç™»éŒ²ç¢ºèª (keyboard-handler.js L223)

2. **èƒŒæ™¯ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºä¿®æ­£**
   - `_createBackgroundThumbnail()` (L361-396)ã®CSSè¦‹ç›´ã—
   - gridé…ç½®ã®ç«¶åˆãƒã‚§ãƒƒã‚¯
   - å›ºå®šã‚µã‚¤ã‚º64x44pxã®å®Ÿä½“ç¢ºèª

3. **ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”è¨ˆç®—ã®çµ±ä¸€**
   - `createThumbnail()` (L398-438)ã®ãƒ­ã‚¸ãƒƒã‚¯æ¤œè¨¼
   - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–/éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã§åŒã˜è¨ˆç®—ã‚’é©ç”¨

#### å‚ç…§ãƒ¡ã‚½ãƒƒãƒ‰
- `keyboard-handler.js`: handleKeyDown(), handleAction(), deleteActiveLayerDrawings()
- `layer-panel-renderer.js`: _createBackgroundThumbnail(), createThumbnail()
- `config.js`: TEGAKI_KEYMAP.actions.LAYER_DELETE_DRAWINGS

---

### Phase 2: ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒ åè»¢æ©Ÿèƒ½ã®å®Œå…¨å¾©æ—§
**ç›®çš„**: åè»¢ãƒœã‚¿ãƒ³ãƒ»ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆä¸¡æ–¹ã®ç™ºç«ä¿è¨¼

#### å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«  
- `layer-transform.js` (èª­ã¿è¾¼ã¿æ¸ˆã¿)
- `layer-system.js` (èª­ã¿è¾¼ã¿æ¸ˆã¿)  
- `ui-panels.js` (èª­ã¿è¾¼ã¿æ¸ˆã¿)
- `keyboard-handler.js` (å‚ç…§)

#### ä½œæ¥­å†…å®¹
1. **ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼è¿½è·¡**
   ```
   [Hã‚­ãƒ¼æŠ¼ä¸‹] 
   â†’ keyboard-handler.js: handleKeyDown() (L33)
   â†’ config.js: getAction() â†’ LAYER_FLIP_HORIZONTAL
   â†’ keyboard-handler.js: handleAction() (L145-155)
   â†’ eventBus.emit('layer:flip-by-key', {direction: 'horizontal'})
   â†’ layer-transform.js: _setupEventListeners() (L44-49)
   â†’ onFlipRequest(direction) (L46)
   â†’ layer-system.js: flipActiveLayer() (L340-364)
   â†’ layer-transform.js: flipLayer() (L239-261)
   ```

2. **ãƒœã‚¿ãƒ³ãƒ•ãƒ­ãƒ¼è¿½è·¡**
   ```
   [åè»¢ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯]
   â†’ ui-panels.js: setupFlipButtons() (L157-169)
   â†’ CoreRuntime.api.layer.flipActiveLayer('horizontal')
   â†’ layer-system.js: flipActiveLayer() (L340-364)
   â†’ layer-transform.js: flipLayer() (L239-261)
   ```

3. **Vã‚­ãƒ¼ãƒ¢ãƒ¼ãƒ‰åˆ¤å®šå¼·åŒ–**
   - keyboard-handler.js L47ã§Vã‚­ãƒ¼toggleç¢ºèª
   - layer-transform.js L45ã§Vã‚­ãƒ¼åˆ¤å®šè¿½åŠ ç¢ºèª
   - layer-system.js L348ã§Vã‚­ãƒ¼ã‚¬ãƒ¼ãƒ‰è¿½åŠ ç¢ºèª

#### æ¤œè¨¼ãƒã‚¤ãƒ³ãƒˆ
- Vã‚­ãƒ¼ãŒfalseã®æ™‚ã¯åè»¢å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ— (layer-system.js L348)
- ãƒœã‚¿ãƒ³disabledçŠ¶æ…‹ã¨Vã‚­ãƒ¼çŠ¶æ…‹ã®åŒæœŸ (layer-transform.js L75-87)

#### å‚ç…§ãƒ¡ã‚½ãƒƒãƒ‰
- `layer-transform.js`: flipLayer(), _setupEventListeners(), _updateFlipButtonsAvailability()
- `layer-system.js`: flipActiveLayer()
- `ui-panels.js`: setupFlipButtons()

---

### Phase 3: ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ã‚·ã‚¹ãƒ†ãƒ ã®ä¸€å…ƒåŒ–
**ç›®çš„**: thumbnail-update-manager.jsã¸ã®å®Œå…¨ç§»è¡Œ

#### å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- `thumbnail-update-manager.js` (èª­ã¿è¾¼ã¿æ¸ˆã¿)
- `layer-panel-renderer.js` (æ”¹ä¿®å¯¾è±¡)
- `layer-system.js` (æ”¹ä¿®å¯¾è±¡)

#### ä½œæ¥­å†…å®¹
1. **thumbnail-update-manager.jsã®å½¹å‰²ç¢ºèª**
   - ã™ã¹ã¦ã®æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼ã‚’ãƒªã‚¹ãƒ³ (L29-125)
   - ãƒ‡ãƒã‚¦ãƒ³ã‚¹ç®¡ç† (L128-154)
   - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å³æ™‚æ›´æ–° (L134-139)

2. **layer-panel-renderer.jsã‹ã‚‰ç›´æ¥æ›´æ–°å‘¼ã³å‡ºã—ã‚’å‰Šé™¤**
   - `_updateSingleThumbnail()` (L479-537)ã®å‘¼ã³å‡ºã—å…ƒç¢ºèª
   - eventBusçµŒç”±ã«åˆ‡ã‚Šæ›¿ãˆ

3. **layer-system.jsã®requestThumbnailUpdate()ç°¡ç•¥åŒ–**
   - L938-946ã‚’eventBus.emitã®ã¿ã«

#### çµ±ä¸€å¾Œã®ãƒ•ãƒ­ãƒ¼
```
[æç”»å®Œäº†]
â†’ layer-system.js: addPathToActiveLayer()
â†’ eventBus.emit('layer:stroke-added')
â†’ thumbnail-update-manager.js: _requestUpdateWithActiveCheck()
â†’ eventBus.emit('thumbnail:layer-updated')
â†’ layer-panel-renderer.js: _updateSingleThumbnail()
```

#### å‚ç…§ãƒ¡ã‚½ãƒƒãƒ‰
- `thumbnail-update-manager.js`: _requestUpdateWithActiveCheck(), requestUpdate()
- `layer-panel-renderer.js`: _setupEventListeners() (L19), _updateSingleThumbnail()

---

### Phase 4: ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²æ¤œè¨
**ç›®çš„**: popup-manager.js, quick-export-ui.jsã¨åŒæ§˜ã®SRPé©ç”¨

#### ç¾çŠ¶åˆ†æ
- **layer-transform.js**: 628è¡Œ (åº§æ¨™å¤‰æ›ãƒ»UIãƒ»ãƒ‰ãƒ©ãƒƒã‚°ãƒ»ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å…¨éƒ¨å…¥ã‚Š)
- **popup-manager.js**: 195è¡Œ (ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ç®¡ç†ã®ã¿)
- **quick-export-ui.js**: 123è¡Œ (ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹UIå°‚é–€)

#### ææ¡ˆæ§‹é€ 
```
/system/
  â”œ layer-transform/
  â”‚   â”œ transform-core.js      (åº§æ¨™å¤‰æ›ãƒ»è¡Œåˆ—æ¼”ç®—ã®ã¿)
  â”‚   â”œ transform-ui.js        (ãƒ‘ãƒãƒ«UIãƒ»ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼)
  â”‚   â”œ transform-drag.js      (ãƒ‰ãƒ©ãƒƒã‚°å‡¦ç†)
  â”‚   â”” transform-manager.js   (çµ±åˆãƒ»APIæä¾›)
```

#### ä½œæ¥­å†…å®¹
1. **transform-core.jsæŠ½å‡º**
   - applyTransform() (L100-132)
   - flipLayer() (L239-261)
   - moveLayer(), scaleLayer(), rotateLayer() (L263-343)
   - confirmTransform() (L345-401)
   - applyTransformToPaths() (L403-459)

2. **transform-ui.jsæŠ½å‡º**
   - _setupTransformPanel() (L636-689)
   - _setupSlider() (L691-765)
   - _showValueInput() (L767-827)
   - updateTransformPanelValues() (L870-888)

3. **transform-drag.jsæŠ½å‡º**
   - _setupDragEvents() (L461-490)
   - _handleDrag() (L521-541)
   - _setupWheelEvents() (L543-593)

4. **transform-manager.js**
   - ä¸Šè¨˜3ãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµ±åˆ
   - æ—¢å­˜ã®LayerTransformã‚¯ãƒ©ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ç¶­æŒ
   - å¾Œæ–¹äº’æ›æ€§ä¿è¨¼

#### åˆ¤æ–­åŸºæº–
- ãƒ•ã‚¡ã‚¤ãƒ«è¡Œæ•°ãŒ500è¡Œè¶…ã®å ´åˆã¯åˆ†å‰²æ¨å¥¨
- åˆ†å‰²å¾Œã‚‚window.TegakiLayerTransformã¨ã—ã¦å˜ä¸€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæä¾›
- ä»–ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã®å‚ç…§ã¯å¤‰æ›´ä¸è¦

---

### Phase 5: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã¸ã®ä¾å­˜é–¢ä¿‚è¨˜è¿°
**ç›®çš„**: ä»–Claudeã‹ã‚‰ã®å¯èª­æ€§å‘ä¸Š

#### ææ¡ˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
```javascript
/**
 * @file layer-system.js
 * @description ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†ãƒ»æ“ä½œã®ä¸­æ ¸ã‚·ã‚¹ãƒ†ãƒ 
 * 
 * ã€è¦ªãƒ•ã‚¡ã‚¤ãƒ« (ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¾å­˜)ã€‘
 * - event-bus.js (ã‚¤ãƒ™ãƒ³ãƒˆé€šä¿¡)
 * - data-models.js (LayerModelå®šç¾©)
 * - layer-transform.js (å¤‰å½¢å‡¦ç†å§”è­²)
 * - thumbnail-update-manager.js (ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼)
 * 
 * ã€å­ãƒ•ã‚¡ã‚¤ãƒ« (ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¾å­˜)ã€‘
 * - layer-panel-renderer.js (UIæç”»)
 * - ui-panels.js (ãƒœã‚¿ãƒ³æ“ä½œ)
 * - keyboard-handler.js (ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ)
 * 
 * ã€ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰ã€‘
 * - createLayer(): ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆ
 * - setActiveLayer(): ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
 * - flipActiveLayer(): åè»¢å‡¦ç† (layer-transformçµŒç”±)
 * - addPathToActiveLayer(): æç”»è¿½åŠ 
 * 
 * ã€ãƒ•ãƒ­ãƒ¼ä½ç½®ã€‘
 * CoreRuntime â†’ LayerSystem â†’ LayerTransform â†’ PIXI Container
 */
```

#### å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
å…¨ãƒ•ã‚¡ã‚¤ãƒ« (å„ªå…ˆåº¦é †)
1. layer-system.js, layer-transform.js
2. keyboard-handler.js, layer-panel-renderer.js
3. thumbnail-update-manager.js
4. drawing-engine.js, stroke-recorder.js

---

## ğŸš¨ æ”¹ä¿®æ™‚ã®æ³¨æ„äº‹é …

### DRY/SOLIDåŸå‰‡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] åŒã˜å‡¦ç†ã‚’2ç®‡æ‰€ä»¥ä¸Šã«æ›¸ã„ã¦ã„ãªã„ã‹
- [ ] 1ãƒ•ã‚¡ã‚¤ãƒ«1è²¬å‹™ã«ãªã£ã¦ã„ã‚‹ã‹
- [ ] ã‚¤ãƒ™ãƒ³ãƒˆçµŒç”±ã®ç–çµåˆã‚’ç¶­æŒã—ã¦ã„ã‚‹ã‹
- [ ] ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã®é‡è¤‡å®šç¾©ã¯ãªã„ã‹

### ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°å‰Šæ¸›
- å®Ÿè£…å®Œäº†å¾Œã¯éå‰°ãªconsole.logã‚’å‰Šé™¤
- æ®‹ã™å ´åˆã¯`TEGAKI_CONFIG.debug`ã§ã‚¬ãƒ¼ãƒ‰

### åº§æ¨™å¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å³å®ˆ
```
PointerEvent.clientX/Y
  â†’ screenClientToCanvas()
  â†’ canvasToWorld()
  â†’ worldToLocal()
  â†’ stroke-recorder (ãã®ã¾ã¾è¨˜éŒ²)
```

### ç¦æ­¢äº‹é …ã®å†ç¢ºèª
- Canvas2Dä½¿ç”¨ç¦æ­¢ (WebGPU/PixiJSã®ã¿)
- localStorageä½¿ç”¨ç¦æ­¢ (éå¯¾å¿œç’°å¢ƒ)
- PIXI v8 toLocal()ã®ä½¿ç”¨ç¦æ­¢ (åº§æ¨™ãƒã‚°)

---

## ğŸ“Š æ”¹ä¿®å„ªå…ˆåº¦

1. **Phase 1 (å³å®Ÿæ–½)** - æ˜ç™½ãªãƒã‚°ä¿®æ­£
2. **Phase 2 (é«˜å„ªå…ˆ)** - åè»¢æ©Ÿèƒ½å¾©æ—§ (ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ç›´çµ)
3. **Phase 3 (ä¸­å„ªå…ˆ)** - ã‚µãƒ ãƒã‚¤ãƒ«çµ±ä¸€ (ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¥å…¨æ€§)
4. **Phase 4 (ä½å„ªå…ˆ)** - ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰² (ä»»æ„ã€å¯èª­æ€§å‘ä¸Š)
5. **Phase 5 (ç¶™ç¶š)** - ãƒ˜ãƒƒãƒ€ãƒ¼è¨˜è¿° (ä»–Claudeæ”¯æ´)

---

## ğŸ”„ æ”¹ä¿®å¾Œã®æ¤œè¨¼é …ç›®

### æ©Ÿèƒ½æ¤œè¨¼
- [ ] BS/DELã‚­ãƒ¼ã§ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å†…å®¹æ¶ˆå»
- [ ] Vã‚­ãƒ¼ + Hã§ãƒ¬ã‚¤ãƒ¤ãƒ¼æ°´å¹³åè»¢
- [ ] Vã‚­ãƒ¼ + Shift + Hã§ãƒ¬ã‚¤ãƒ¤ãƒ¼å‚ç›´åè»¢  
- [ ] ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒ ãƒ‘ãƒãƒ«ã®åè»¢ãƒœã‚¿ãƒ³å‹•ä½œ
- [ ] èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚µãƒ ãƒã‚¤ãƒ«ã®æ­£å¸¸è¡¨ç¤º (64x44px)
- [ ] å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚µãƒ ãƒã‚¤ãƒ«ã®ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”çµ±ä¸€

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¤œè¨¼
- [ ] console.logã§ã®äºŒé‡å®Ÿè£…è­¦å‘Šãªã—
- [ ] thumbnail-update-manager.jsçµŒç”±ã®æ›´æ–°ãƒ•ãƒ­ãƒ¼ç¢ºèª
- [ ] ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¹ã®ãƒªã‚¹ãƒŠãƒ¼é‡è¤‡ãªã—
- [ ] ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã®çµ±ä¸€ (window.layerManagerç­‰)

---

## ğŸ“ è£œè¶³: æ—¢å­˜ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®è©•ä¾¡

### è‰¯å¥½ãªç‚¹
- EventBusã«ã‚ˆã‚‹ç–çµåˆè¨­è¨ˆ
- CoreRuntimeã®APIçµ±ä¸€
- WebGPU/SDFã®å…ˆé€²çš„ãªæç”»å®Ÿè£…
- åº§æ¨™ç³»ã®æ˜ç¢ºãªåˆ†é›¢ (coordinate-system.js)

### æ”¹å–„å¿…è¦ãªç‚¹
- thumbnail-update-manager.jsãŒæ©Ÿèƒ½ã—ã¦ã„ãªã„
- ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ã®æ•£åœ¨
- ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒ ã®è‚¥å¤§åŒ– (628è¡Œ)
- ãƒ•ã‚¡ã‚¤ãƒ«é–“ä¾å­˜é–¢ä¿‚ã®æš—é»™æ€§

### ç·è©•
å…¨ä½“çš„ã«é«˜å“è³ªãªè¨­è¨ˆã€‚Phase 3ã¾ã§ã®æ”¹ä¿®ã§å¤§å¹…ã«æ”¹å–„å¯èƒ½ã€‚Phase 4/5ã¯ä»»æ„ã€‚

---

**ä½œæˆæ—¥**: 2025-11-08  
**å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v8.13_Drawing_124  
**è¨ˆç”»ç­–å®š**: Claude Sonnet 4.5