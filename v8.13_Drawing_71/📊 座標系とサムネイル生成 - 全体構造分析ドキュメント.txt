ğŸ“Š åº§æ¨™ç³»ã¨ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ - å…¨ä½“æ§‹é€ åˆ†æãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
ğŸ—ºï¸ åº§æ¨™ç³»ã®5å±¤æ§‹é€ 
åº§æ¨™ç³»å®šç¾©ç”¨é€”å¤‰æ›ãƒ¡ã‚½ãƒƒãƒ‰Screenåº§æ¨™clientX/Y (DOMã‚¤ãƒ™ãƒ³ãƒˆ)ãƒã‚¦ã‚¹ãƒ»ã‚¿ãƒƒãƒå…¥åŠ›screenClientToCanvas()Canvasåº§æ¨™DPIè£œæ­£å¾Œã®Pixelãƒ”ã‚¯ã‚»ãƒ«åº§æ¨™ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼åŸºæº–canvasToWorld()Worldåº§æ¨™worldContaineråŸºæº–ã®åº§æ¨™ã‚«ãƒ¡ãƒ©ãƒ»ã‚ºãƒ¼ãƒ é©ç”¨å¾ŒworldToLocal()Localåº§æ¨™ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠåŸºæº–ã®åº§æ¨™ãƒ¬ã‚¤ãƒ¤ãƒ¼å†…ã®æç”»ãƒã‚¤ãƒ³ãƒˆ-Textureåº§æ¨™RenderTextureå†…ã®ãƒ”ã‚¯ã‚»ãƒ«åº§æ¨™ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆæ™‚å°‚ç”¨å‡¦ç†

ğŸ”„ åº§æ¨™å¤‰æ›ãƒ•ãƒ­ãƒ¼å›³
PointerEvent (clientX, clientY)
  â†“ screenClientToCanvas()  [DPIè£œæ­£]
Canvasåº§æ¨™ (canvasX, canvasY)
  â†“ canvasToWorld()  [worldContaineré€†è¡Œåˆ—]
Worldåº§æ¨™ (worldX, worldY)
  â†“ worldToLocal()  [è¦ªãƒã‚§ãƒ¼ãƒ³é¡æŸ»ãƒ»æ‰‹å‹•é€†ç®—]
Localåº§æ¨™ (localX, localY)
  â†’ stroke-recorder.js ã«è¨˜éŒ²

ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«è²¬å‹™ãƒãƒƒãƒ—
ğŸ¯ åº§æ¨™ç³»ç®¡ç†

coordinate-system.js: å…¨åº§æ¨™å¤‰æ›ã®çµ±ä¸€API

worldToLocal(): Phase 2.5å®Œå…¨ä¿®æ­£ç‰ˆï¼ˆpivotâ†’positionâ†’rotateâ†’scaleé †åºï¼‰
localToWorld(): å¯¾å¿œã™ã‚‹é †å¤‰æ›
ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿæ§‹



ğŸ–¼ï¸ ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ

thumbnail-system.js: ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆã®ä¸­æ ¸

generateLayerThumbnail(): ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚µãƒ ãƒã‚¤ãƒ«
generateFrameThumbnail(): ãƒ•ãƒ¬ãƒ¼ãƒ ã‚µãƒ ãƒã‚¤ãƒ«
_renderLayerThumbnail(): âŒ å•é¡Œç®‡æ‰€ï¼ˆå¾Œè¿°ï¼‰



ğŸ­ ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†

layer-system.js: ãƒ¬ã‚¤ãƒ¤ãƒ¼æ“ä½œãƒ»Transformç®¡ç†

updateThumbnail(): ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ï¼ˆç‹¬è‡ªå®Ÿè£…ï¼‰
flipActiveLayer(): åè»¢æ©Ÿèƒ½



âš™ï¸ Transformåˆ¶å¾¡

layer-transform.js: Transformé©ç”¨ãƒ»GSAPçµ±åˆ

applyTransform(): GSAP killTweensOf() + delayedCall()
flipLayer(): åè»¢å‡¦ç†
_emitTransformUpdated(): ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ï¼ˆthrottleä»˜ãï¼‰



ğŸ–¼ï¸ UIå±¤

layer-panel-renderer.js: ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«UI

updateLayerThumbnail(): ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼
_generateAndDisplayThumbnail(): ThumbnailSystemã‹ã‚‰å–å¾—â†’è¡¨ç¤º


timeline-thumbnail-utils.js: ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚µãƒ ãƒã‚¤ãƒ«

generateThumbnail(): ThumbnailSystemã‹ã‚‰å–å¾—
Phase 3: layer:transform-updated è³¼èª­




ğŸ”¥ å•é¡Œã®æ ¹æœ¬åŸå› 
âŒ å•é¡Œ1: layer-system.jsã®ç‹¬è‡ªã‚µãƒ ãƒã‚¤ãƒ«å®Ÿè£…
javascript// layer-system.js:1143-1200
updateThumbnail(layerIndex) {
    // âŒ ThumbnailSystemã‚’ä½¿ã‚ãšç‹¬è‡ªå®Ÿè£…
    const renderTexture = PIXI.RenderTexture.create({...});
    
    // âŒ ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’tempContainerã«ç§»å‹•ï¼ˆç ´å£Šçš„ï¼‰
    tempContainer.addChild(layer);
    
    // âŒ TransformçŠ¶æ…‹ã‚’ä¸€æ™‚ãƒªã‚»ãƒƒãƒˆ
    layer.position.set(0, 0);
    layer.scale.set(1, 1);
    layer.rotation = 0;
    
    //ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    this.app.renderer.render({...});
    
    // âŒ å…ƒã«æˆ»ã™å‡¦ç†ãŒä¸å®Œå…¨
    layer.position.set(originalState.pos.x, originalState.pos.y);
    this.currentFrameContainer.addChildAt(layer, layerIndex);
}
```

**å•é¡Œç‚¹:**
1. `layer-system.js` ãŒ**ThumbnailSystemã‚’ç„¡è¦–**ã—ã¦ç‹¬è‡ªå®Ÿè£…
2. ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¦ªã‹ã‚‰åˆ‡ã‚Šé›¢ã™â†’**åº§æ¨™ç³»ç ´å£Š**
3. Transformä¸€æ™‚ãƒªã‚»ãƒƒãƒˆâ†’**å…ƒã«æˆ»ã™éš›ã«ã‚ºãƒ¬**ç™ºç”Ÿ

#### âŒ å•é¡Œ2: ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼æ–­çµ¶
```
layer-transform.js
  â†’ gsap.delayedCall(0.016) ã§ layer:transform-updated ç™ºç«
  
timeline-thumbnail-utils.js
  â†’ layer:transform-updated è³¼èª­ âœ…
  
layer-panel-renderer.js
  â†’ layer:transform-updated è³¼èª­ âœ…
  
layer-system.js  
  â†’ âŒ è³¼èª­ãªã—ï¼ç‹¬è‡ªã®updateThumbnail()ã‚’ä½¿ç”¨
âŒ å•é¡Œ3: ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆã®äºŒé‡å®Ÿè£…
ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…æ–¹å¼thumbnail-system.js_renderLayerThumbnail()âŒ ã‚¯ãƒ­ãƒ¼ãƒ³æ–¹å¼ï¼ˆPhase 4ã§è¿½åŠ ãƒ»å¤±æ•—ï¼‰layer-system.jsupdateThumbnail()âŒ ä¸€æ™‚ç§»å‹•æ–¹å¼ï¼ˆå…ƒã‹ã‚‰ã‚ã‚‹ãƒ»ç ´å£Šçš„ï¼‰layer-panel-renderer.js_generateAndDisplayThumbnail()âœ… ThumbnailSystemå‘¼ã³å‡ºã—ï¼ˆæ­£ã—ã„ï¼‰

ğŸ“‹ ãƒ¡ã‚½ãƒƒãƒ‰ãƒ»ã‚·ãƒ³ãƒœãƒ«è¾å…¸
CoordinateSystem
ãƒ¡ã‚½ãƒƒãƒ‰å¼•æ•°æˆ»ã‚Šå€¤ç”¨é€”screenClientToCanvas(clientX, clientY)Screenåº§æ¨™{canvasX, canvasY}DPIè£œæ­£canvasToWorld(canvasX, canvasY)Canvasåº§æ¨™{worldX, worldY}Worldå¤‰æ›worldToLocal(worldX, worldY, container)Worldåº§æ¨™+Container{localX, localY}Localå¤‰æ›localToWorld(localX, localY, container)Localåº§æ¨™+Container{worldX, worldY}é€†å¤‰æ›
ThumbnailSystem
ãƒ¡ã‚½ãƒƒãƒ‰å¼•æ•°æˆ»ã‚Šå€¤ç”¨é€”generateLayerThumbnail(layer, w, h)Layer+ã‚µã‚¤ã‚ºPromise<Canvas>ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚µãƒ ãƒã‚¤ãƒ«generateFrameThumbnail(frame, w, h)Frame+ã‚µã‚¤ã‚ºPromise<Canvas>ãƒ•ãƒ¬ãƒ¼ãƒ ã‚µãƒ ãƒã‚¤ãƒ«_invalidateLayerCacheByLayerId(layerId)LayerIDvoidã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢canvasToDataURL(canvas)CanvasstringDataURLå¤‰æ›
LayerTransform
ãƒ¡ã‚½ãƒƒãƒ‰å¼•æ•°æˆ»ã‚Šå€¤ç”¨é€”applyTransform(layer, transform, cx, cy)Layer+TransformvoidTransformé©ç”¨+GSAPåŒæœŸflipLayer(layer, direction)Layer+æ–¹å‘voidåè»¢_emitTransformUpdated(layerId, layer)ID+Layervoidã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ï¼ˆthrottleï¼‰
EventBusä¸»è¦ã‚¤ãƒ™ãƒ³ãƒˆ
ã‚¤ãƒ™ãƒ³ãƒˆåç™ºç«å…ƒãƒ‡ãƒ¼ã‚¿ç”¨é€”layer:transform-updatedlayer-transform.js{layerIndex, layerId, transform}Transformæ›´æ–°é€šçŸ¥thumbnail:layer-updatedè¤‡æ•°{layerIndex, layerId, immediate}ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ãƒªã‚¯ã‚¨ã‚¹ãƒˆkeyboard:vkey-pressedkeyboard-handler.js-Vãƒ¢ãƒ¼ãƒ‰é–‹å§‹keyboard:vkey-releasedkeyboard-handler.js-Vãƒ¢ãƒ¼ãƒ‰çµ‚äº†

ğŸ¯ è§£æ±ºæ–¹é‡ï¼ˆæ”¹ä¿®å‰ã®ç¢ºèªå®Œäº†ï¼‰
âœ… å¿…é ˆä¿®æ­£

layer-system.jsã®updateThumbnail()ã‚’å‰Šé™¤

ThumbnailSystemã«å®Œå…¨çµ±ä¸€


thumbnail-system.jsã®_renderLayerThumbnail()ã‚’ä¿®æ­£

ã‚¯ãƒ­ãƒ¼ãƒ³æ–¹å¼â†’éç ´å£Šãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ–¹å¼


layer-system.jsã«ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­è¿½åŠ 

layer:transform-updated â†’ ThumbnailSystemå‘¼ã³å‡ºã—



âš ï¸ æ¤œè¨äº‹é …

PICAå°å…¥ã¯ä¸è¦: å•é¡Œã¯ç”»è³ªã§ã¯ãªãåº§æ¨™ç³»ç ´å£Š
GSAPçµ±åˆã¯å®Œäº†: Phase 5ã§å®Ÿè£…æ¸ˆã¿ãƒ»æ­£å¸¸å‹•ä½œä¸­