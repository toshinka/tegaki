================================================================================
ã‚µãƒ ãƒã‚¤ãƒ«å•é¡Œä¿®æ­£è¨ˆç”» v8.13_Drawing_60
è¨ºæ–­æ—¥æ™‚: 2025-10-29
================================================================================

ã€è¨ºæ–­çµæœã‚µãƒãƒªã€‘

âœ… æ­£å¸¸å‹•ä½œ:
- ThumbnailSystem åˆæœŸåŒ–å®Œäº†
- data-layer-index å±æ€§æ­£ã—ãè¨­å®š
- EventBus ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ç¢ºèª (layer:transform-updated, thumbnail:layer-updated)
- Vã‚­ãƒ¼æŠ¼ä¸‹/è§£æ”¾ã‚¤ãƒ™ãƒ³ãƒˆæ­£å¸¸
- ãƒšãƒ³æç”»æ™‚ã®ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«

âš ï¸ ç¢ºèªã•ã‚ŒãŸå•é¡Œ:
1. layer:transform-updated ãŒå¤§é‡ç™ºç« (Vã‚­ãƒ¼ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã«12å›é€£ç¶š)
2. thumbnail:layer-updated ãŒ layer:transform-updated ã«é€£å‹•ã—ã¦ã„ãªã„
3. Vã‚­ãƒ¼ãƒ¢ãƒ¼ãƒ‰ä¸­ã®ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ãŒè¦–è¦šçš„ã«åæ˜ ã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§
4. åº§æ¨™ç³»ã®ã‚ºãƒ¬ (Expected: 172, 67.5 vs Actual: 126.5, 72)
5. ãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã®æç”»/åˆ¤å®šå•é¡Œï¼ˆæœªæ¤œè¨¼ï¼‰

ã€æ ¹æœ¬åŸå› åˆ†æã€‘

å•é¡ŒA: Vã‚­ãƒ¼ãƒ¢ãƒ¼ãƒ‰ä¸­ã®ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°
- layer:transform-updated ã¯ç™ºç«ã—ã¦ã„ã‚‹
- ã—ã‹ã— thumbnail-system.js ãŒ layer:transform-updated ã‚’è³¼èª­ã—ã¦ã‚‚ã€
  thumbnail:layer-updated ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«ã—ã¦ã„ãªã„
- layer-panel-renderer.js ã¯ thumbnail:layer-updated ã‚’è³¼èª­ã—ã¦ã„ã‚‹ãŒã€
  ã‚¤ãƒ™ãƒ³ãƒˆãŒæ¥ãªã„ãŸã‚æ›´æ–°ã•ã‚Œãªã„

å•é¡ŒB: ã‚¤ãƒ™ãƒ³ãƒˆéå¤šã«ã‚ˆã‚‹æ›´æ–°é…å»¶
- layer-transform.js ã®å„ãƒ¡ã‚½ãƒƒãƒ‰ (moveLayer, scaleLayer, rotateLayerç­‰) ãŒ
  å€‹åˆ¥ã« layer:transform-updated ã‚’ç™ºç«
- ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã«æ¯ãƒ•ãƒ¬ãƒ¼ãƒ ç™ºç«ã™ã‚‹ãŸã‚ã€ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ãŒè¿½ã„ã¤ã‹ãªã„

å•é¡ŒC: timeline-thumbnail-utils.js ã®ã‚¤ãƒ™ãƒ³ãƒˆæœªè³¼èª­
- layer:transform-updated ã‚’è³¼èª­ã—ã¦ã„ãªã„
- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚µãƒ ãƒã‚¤ãƒ«ãŒæ›´æ–°ã•ã‚Œãªã„

å•é¡ŒD: åº§æ¨™ç³»ã®ã‚ºãƒ¬
- worldContainer ã® position ãŒæƒ³å®šã¨ç•°ãªã‚‹
- ã‚«ãƒ¡ãƒ©ã®ãƒ‘ãƒ³/ã‚ºãƒ¼ãƒ çŠ¶æ…‹ãŒåº§æ¨™å¤‰æ›ã«å½±éŸ¿

================================================================================
Phase 1: ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼ä¿®æ­£ï¼ˆæœ€å„ªå…ˆï¼‰
================================================================================

ã€ç›®çš„ã€‘
layer:transform-updated â†’ thumbnail:layer-updated ã®é€£æºã‚’ç¢ºç«‹

ã€æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«ã€‘

1. system/drawing/thumbnail-system.js
   ä½ç½®: _setupEventListeners() ãƒ¡ã‚½ãƒƒãƒ‰å†…
   
   ä¿®æ­£å†…å®¹:
   ```
   // æ—¢å­˜
   this.eventBus.on('layer:transform-updated', ({ layerId }) => {
       this._invalidateLayerCacheByLayerId(layerId);
   });
   
   // è¿½åŠ : ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç™ºç«
   this.eventBus.on('layer:transform-updated', ({ layerId }) => {
       this._invalidateLayerCacheByLayerId(layerId);
       
       // layerId ã‹ã‚‰ layerIndex ã‚’å–å¾—
       const layerMgr = window.CoreRuntime?.internal?.layerManager;
       if (layerMgr) {
           const layers = layerMgr.getLayers();
           const layerIndex = layers.findIndex(l => l.layerData?.id === layerId);
           
           if (layerIndex >= 0) {
               this.eventBus.emit('thumbnail:layer-updated', {
                   component: 'thumbnail-system',
                   action: 'transform-invalidated',
                   data: {
                       layerIndex: layerIndex,
                       layerId: layerId
                   }
               });
           }
       }
   });
   ```

2. ui/layer-panel-renderer.js
   ä½ç½®: _setupEventListeners() ãƒ¡ã‚½ãƒƒãƒ‰å†…
   
   ç¢ºèªäº‹é …:
   - thumbnail:layer-updated è³¼èª­ãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ã‚‹ã‹
   - requestAnimationFrame ã§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ¸ˆã¿
   - thumbnailUpdateScheduled ãƒ•ãƒ©ã‚°ã§å¤šé‡å®Ÿè¡Œé˜²æ­¢æ¸ˆã¿
   
   ä¿®æ­£ä¸è¦ï¼ˆæ—¢ã«æ­£ã—ã„å®Ÿè£…ï¼‰

3. ui/timeline-thumbnail-utils.js
   ä½ç½®: _setupCameraTransformListener() ãƒ¡ã‚½ãƒƒãƒ‰å†…
   
   ä¿®æ­£å†…å®¹:
   ```
   // è¿½åŠ : layer:transform-updated è³¼èª­
   this.eventBus.on('layer:transform-updated', ({ layerId }) => {
       // å…¨ãƒ•ãƒ¬ãƒ¼ãƒ ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯å…¨ãƒ•ãƒ¬ãƒ¼ãƒ ã«å½±éŸ¿ï¼‰
       this._invalidateCache();
       
       // éåŒæœŸã§å†ç”Ÿæˆ
       if (this.animationSystem && 
           typeof this.animationSystem.regenerateAllThumbnails === 'function') {
           setTimeout(() => {
               this.animationSystem.regenerateAllThumbnails();
           }, 100);
       }
   });
   ```

ã€æ¤œè¨¼æ–¹æ³•ã€‘
1. Vã‚­ãƒ¼ â†’ ãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹•
2. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ thumbnail:layer-updated ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ç¢ºèª
3. ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«ã®ã‚µãƒ ãƒã‚¤ãƒ«ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

================================================================================
Phase 2: ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«é »åº¦ã®æœ€é©åŒ–
================================================================================

ã€ç›®çš„ã€‘
Vã‚­ãƒ¼ãƒ¢ãƒ¼ãƒ‰ä¸­ã®éå‰°ãªã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã‚’æŠ‘åˆ¶ã—ã€æ›´æ–°ã‚’é–“å¼•ã

ã€æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«ã€‘

1. system/layer-transform.js
   ä½ç½®: _emitTransformUpdated() ãƒ¡ã‚½ãƒƒãƒ‰
   
   ä¿®æ­£å†…å®¹:
   ```
   // æ—¢å­˜ã® _emitTransformUpdated ã‚’ throttle å¯¾å¿œã«å¤‰æ›´
   _emitTransformUpdated(layerId) {
       // throttle: æœ€å¾Œã®å‘¼ã³å‡ºã—ã‹ã‚‰ 100ms ä»¥å†…ã¯ç™ºç«ã—ãªã„
       const now = performance.now();
       if (this._lastEmitTime && (now - this._lastEmitTime) < 100) {
           // throttle ä¸­: ã‚¿ã‚¤ãƒãƒ¼ã§é…å»¶ç™ºç«
           if (this._emitTimer) {
               clearTimeout(this._emitTimer);
           }
           this._emitTimer = setTimeout(() => {
               if (this.eventBus) {
                   this.eventBus.emit('layer:transform-updated', { layerId });
               }
               this._lastEmitTime = performance.now();
           }, 100);
           return;
       }
       
       // å³åº§ç™ºç«
       if (this.eventBus) {
           this.eventBus.emit('layer:transform-updated', { layerId });
       }
       this._lastEmitTime = now;
   }
   
   // constructor ã«è¿½åŠ 
   constructor(config, coordAPI) {
       // ... æ—¢å­˜ã‚³ãƒ¼ãƒ‰ ...
       this._lastEmitTime = 0;
       this._emitTimer = null;
   }
   ```

2. system/drawing/thumbnail-system.js
   ä½ç½®: _setupEventListeners() å†…ã® layer:transform-updated è³¼èª­
   
   ä¿®æ­£å†…å®¹:
   ```
   // throttle è¿½åŠ ï¼ˆäºŒé‡ throttle é˜²æ­¢ï¼‰
   let thumbnailUpdateTimer = null;
   
   this.eventBus.on('layer:transform-updated', ({ layerId }) => {
       this._invalidateLayerCacheByLayerId(layerId);
       
       // 100ms ä»¥å†…ã®é€£ç¶šå‘¼ã³å‡ºã—ã¯æœ€å¾Œã®1å›ã®ã¿å®Ÿè¡Œ
       if (thumbnailUpdateTimer) {
           clearTimeout(thumbnailUpdateTimer);
       }
       
       thumbnailUpdateTimer = setTimeout(() => {
           const layerMgr = window.CoreRuntime?.internal?.layerManager;
           if (layerMgr) {
               const layers = layerMgr.getLayers();
               const layerIndex = layers.findIndex(l => l.layerData?.id === layerId);
               
               if (layerIndex >= 0) {
                   this.eventBus.emit('thumbnail:layer-updated', {
                       component: 'thumbnail-system',
                       action: 'transform-invalidated',
                       data: {
                           layerIndex: layerIndex,
                           layerId: layerId
                       }
                   });
               }
           }
           thumbnailUpdateTimer = null;
       }, 100);
   });
   ```

ã€æ¤œè¨¼æ–¹æ³•ã€‘
1. Vã‚­ãƒ¼ â†’ ãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹•
2. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ layer:transform-updated ã®ç™ºç«å›æ•°ç¢ºèªï¼ˆ100msé–“éš”ã«åˆ¶é™ï¼‰
3. ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ãŒæ»‘ã‚‰ã‹ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª

================================================================================
Phase 3: Vã‚­ãƒ¼ç¢ºå®šæ™‚ã®å¼·åˆ¶æ›´æ–°
================================================================================

ã€ç›®çš„ã€‘
Enter/Esc ã‚­ãƒ¼ã§ã®Vã‚­ãƒ¼ç¢ºå®šæ™‚ã«ã€ç¢ºå®Ÿã«ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°

ã€æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«ã€‘

1. system/layer-system.js
   ä½ç½®: onTransformComplete() ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆlayer-transform ã‹ã‚‰ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
   
   ç¢ºèªäº‹é …:
   - æ—¢ã« thumbnail:layer-updated ã‚’ç™ºç«ã—ã¦ã„ã‚‹
   - animationSystem.generateFrameThumbnail() ã‚‚å‘¼ã³å‡ºã—æ¸ˆã¿
   
   ä¿®æ­£ä¸è¦ï¼ˆæ—¢ã«æ­£ã—ã„å®Ÿè£…ï¼‰

2. system/layer-transform.js
   ä½ç½®: confirmTransform() ãƒ¡ã‚½ãƒƒãƒ‰
   
   è¿½åŠ å†…å®¹:
   ```
   confirmTransform(layer) {
       // ... æ—¢å­˜ã®å¤‰å½¢ç¢ºå®šãƒ­ã‚¸ãƒƒã‚¯ ...
       
       if (!success) return false;
       
       // è¿½åŠ : ç¢ºå®šæ™‚ã®å¼·åˆ¶ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°
       if (this.eventBus) {
           const layerMgr = window.CoreRuntime?.internal?.layerManager;
           if (layerMgr) {
               const layerIndex = layerMgr.getLayerIndex(layer);
               
               // å³åº§ã«ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ã‚’è¦æ±‚ï¼ˆthrottle ãƒã‚¤ãƒ‘ã‚¹ï¼‰
               this.eventBus.emit('thumbnail:layer-updated', {
                   component: 'layer-transform',
                   action: 'transform-confirmed',
                   data: {
                       layerIndex: layerIndex,
                       layerId: layer.layerData?.id,
                       immediate: true
                   }
               });
           }
       }
       
       // ... æ—¢å­˜ã®å¾Œå‡¦ç† ...
   }
   ```

ã€æ¤œè¨¼æ–¹æ³•ã€‘
1. Vã‚­ãƒ¼ â†’ å¤‰å½¢ â†’ Enter
2. ã‚µãƒ ãƒã‚¤ãƒ«ãŒå³åº§ã«æ›´æ–°ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

================================================================================
Phase 4: åº§æ¨™ç³»ã‚ºãƒ¬ã®ä¿®æ­£ï¼ˆä½å„ªå…ˆåº¦ï¼‰
================================================================================

ã€è¨ºæ–­çµæœã€‘
- Expected Canvas Center: 172, 67.5
- Actual Local: 126.5, 72
- ã‚ºãƒ¬é‡: (-45.5, +4.5)

ã€åŸå› æ¨å®šã€‘
- worldContainer ã® position ãŒ (228, 232) ã«ã‚ºãƒ¬ã¦ã„ã‚‹
- ã‚«ãƒ¡ãƒ©ã®ãƒ‘ãƒ³æ“ä½œãŒ worldContainer ã‚’ç§»å‹•ã•ã›ã¦ã„ã‚‹
- åº§æ¨™å¤‰æ›æ™‚ã« worldContainer.position ãŒæ­£ã—ãè€ƒæ…®ã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§

ã€æ”¹ä¿®å¯¾è±¡å¤–ã®ç†ç”±ã€‘
- ç¾çŠ¶ã®è¨ºæ–­ã§ã¯æç”»è‡ªä½“ã¯æ­£å¸¸å‹•ä½œã—ã¦ã„ã‚‹
- ã‚µãƒ ãƒã‚¤ãƒ«å•é¡Œã¨ã¯ç›´æ¥é–¢ä¿‚ãªã—
- ã‚«ãƒ¡ãƒ©ã‚·ã‚¹ãƒ†ãƒ ã®è¨­è¨ˆå¤‰æ›´ãŒå¿…è¦ï¼ˆå½±éŸ¿ç¯„å›²å¤§ï¼‰

ã€å‚™è€ƒã€‘
ã‚‚ã—æç”»ä½ç½®ã®ã‚ºãƒ¬ãŒå®Ÿéš›ã«å•é¡Œã¨ãªã‚‹å ´åˆã¯ã€åˆ¥ Phase ã§å¯¾å¿œ

================================================================================
Phase 5: ãƒ‡ãƒãƒƒã‚°ã‚³ãƒãƒ³ãƒ‰æ‹¡å¼µ
================================================================================

ã€ç›®çš„ã€‘
ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°çŠ¶æ³ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–

ã€æ–°è¦è¿½åŠ ã€‘

1. ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ãƒãƒƒã‚°ã‚³ãƒãƒ³ãƒ‰ï¼ˆconsole ç›´æ¥å®Ÿè¡Œå¯èƒ½ï¼‰
   
   ```javascript
   window.TegakiDebug = window.TegakiDebug || {};
   
   // ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ç›£è¦–
   window.TegakiDebug.monitorThumbnails = function() {
       console.log('=== Thumbnail Update Monitor Started ===');
       
       let updateCount = 0;
       let lastUpdate = 0;
       
       window.TegakiEventBus.on('thumbnail:layer-updated', (data) => {
           updateCount++;
           const now = performance.now();
           const delta = lastUpdate ? (now - lastUpdate).toFixed(0) : '-';
           lastUpdate = now;
           
           console.log(`ğŸ“¸ Thumbnail Update #${updateCount} (Î”${delta}ms)`, data);
       });
       
       window.TegakiEventBus.on('layer:transform-updated', (data) => {
           console.log(`ğŸ”„ Transform Updated`, data);
       });
   };
   
   // ã‚­ãƒ£ãƒƒã‚·ãƒ¥çŠ¶æ…‹ç›£è¦–
   window.TegakiDebug.inspectThumbnailCache = function() {
       const info = window.ThumbnailSystem?.getDebugInfo();
       console.log('=== Thumbnail Cache Status ===');
       console.log(info);
       
       // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã®ä¸€è¦§
       if (window.ThumbnailSystem?.layerThumbnailCache) {
           console.log('Layer Cache Keys:');
           for (const key of window.ThumbnailSystem.layerThumbnailCache.keys()) {
               console.log(`  - ${key}`);
           }
       }
   };
   
   // å¼·åˆ¶å…¨ã‚µãƒ ãƒã‚¤ãƒ«å†ç”Ÿæˆ
   window.TegakiDebug.regenerateAllThumbnails = async function() {
       console.log('=== Regenerating All Thumbnails ===');
       
       // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
       if (window.ThumbnailSystem) {
           window.ThumbnailSystem.clearAllCache();
       }
       
       // ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«æ›´æ–°
       const layerPanel = window.CoreRuntime?.internal?.layerPanelRenderer;
       if (layerPanel) {
           await layerPanel.updateAllThumbnails();
       }
       
       // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æ›´æ–°
       const animSys = window.CoreRuntime?.internal?.animationSystem;
       if (animSys?.regenerateAllThumbnails) {
           await animSys.regenerateAllThumbnails();
       }
       
       console.log('âœ… All thumbnails regenerated');
   };
   ```

2. é…ç½®å ´æ‰€
   - system/drawing/thumbnail-system.js ã®æœ«å°¾ã«è¿½åŠ 
   - ã¾ãŸã¯ç‹¬ç«‹ãƒ•ã‚¡ã‚¤ãƒ« debug/thumbnail-debug.js ã‚’ä½œæˆ

ã€æ¤œè¨¼æ–¹æ³•ã€‘
1. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ window.TegakiDebug.monitorThumbnails() å®Ÿè¡Œ
2. Vã‚­ãƒ¼æ“ä½œã—ãªãŒã‚‰æ›´æ–°é »åº¦ã‚’ç¢ºèª
3. window.TegakiDebug.inspectThumbnailCache() ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥çŠ¶æ…‹ç¢ºèª

================================================================================
ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ï¼ˆPhaseé †ï¼‰
================================================================================

Phase 1 (æœ€å„ªå…ˆ):
  âœï¸ system/drawing/thumbnail-system.js
     - _setupEventListeners() å†…ã€layer:transform-updated è³¼èª­ã‚’ä¿®æ­£
     - thumbnail:layer-updated ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã‚’è¿½åŠ 
  
  âœï¸ ui/timeline-thumbnail-utils.js
     - _setupCameraTransformListener() å†…
     - layer:transform-updated è³¼èª­ã‚’è¿½åŠ 

Phase 2 (é«˜å„ªå…ˆ):
  âœï¸ system/layer-transform.js
     - _emitTransformUpdated() ãƒ¡ã‚½ãƒƒãƒ‰ã« throttle å®Ÿè£…
     - constructor ã« _lastEmitTime, _emitTimer ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¿½åŠ 
  
  âœï¸ system/drawing/thumbnail-system.js
     - layer:transform-updated è³¼èª­å†…ã« throttle è¿½åŠ 

Phase 3 (ä¸­å„ªå…ˆ):
  âœï¸ system/layer-transform.js
     - confirmTransform() ãƒ¡ã‚½ãƒƒãƒ‰å†…
     - thumbnail:layer-updated å³åº§ç™ºç«ã‚’è¿½åŠ 

Phase 4 (ä½å„ªå…ˆãƒ»ä¿ç•™):
  - åº§æ¨™ç³»ä¿®æ­£ã¯ç¾æ™‚ç‚¹ã§ã¯å¯¾å¿œä¸è¦

Phase 5 (æ¨å¥¨):
  âœï¸ system/drawing/thumbnail-system.js ã¾ãŸã¯ debug/thumbnail-debug.js
     - ãƒ‡ãƒãƒƒã‚°ã‚³ãƒãƒ³ãƒ‰è¿½åŠ 

================================================================================
å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
================================================================================

Phase 1:
  [ ] thumbnail-system.js: layer:transform-updated è³¼èª­å†…ã§ thumbnail:layer-updated ç™ºç«
  [ ] timeline-thumbnail-utils.js: layer:transform-updated è³¼èª­è¿½åŠ 
  [ ] æ¤œè¨¼: Vã‚­ãƒ¼ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã«ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ç¢ºèª

Phase 2:
  [ ] layer-transform.js: _emitTransformUpdated ã« throttle å®Ÿè£…
  [ ] layer-transform.js: constructor ã« _lastEmitTime, _emitTimer è¿½åŠ 
  [ ] thumbnail-system.js: layer:transform-updated è³¼èª­ã« throttle è¿½åŠ 
  [ ] æ¤œè¨¼: ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«å›æ•°ãŒ 100ms é–“éš”ã«åˆ¶é™ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

Phase 3:
  [ ] layer-transform.js: confirmTransform() ã« thumbnail:layer-updated ç™ºç«è¿½åŠ 
  [ ] æ¤œè¨¼: Enter ã‚­ãƒ¼ç¢ºå®šæ™‚ã«ã‚µãƒ ãƒã‚¤ãƒ«å³åº§æ›´æ–°ç¢ºèª

Phase 5:
  [ ] ãƒ‡ãƒãƒƒã‚°ã‚³ãƒãƒ³ãƒ‰è¿½åŠ 
  [ ] æ¤œè¨¼: window.TegakiDebug.monitorThumbnails() å®Ÿè¡Œç¢ºèª

================================================================================
æ¤œè¨¼é …ç›®ï¼ˆå…¨Phaseå®Œäº†å¾Œï¼‰
================================================================================

åŸºæœ¬å‹•ä½œ:
  [ ] ãƒšãƒ³æç”» â†’ ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ï¼ˆæ—¢å­˜å‹•ä½œï¼‰
  [ ] Vã‚­ãƒ¼ â†’ ãƒ‰ãƒ©ãƒƒã‚°ç§»å‹• â†’ ã‚µãƒ ãƒã‚¤ãƒ«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
  [ ] Vã‚­ãƒ¼ â†’ ãƒ›ã‚¤ãƒ¼ãƒ«å›è»¢/æ‹¡å¤§ â†’ ã‚µãƒ ãƒã‚¤ãƒ«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
  [ ] Vã‚­ãƒ¼ â†’ Hã‚­ãƒ¼åè»¢ â†’ ã‚µãƒ ãƒã‚¤ãƒ«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
  [ ] Vã‚­ãƒ¼ â†’ Enterç¢ºå®š â†’ ã‚µãƒ ãƒã‚¤ãƒ«å³åº§æ›´æ–°
  [ ] Vã‚­ãƒ¼ â†’ Escå–æ¶ˆ â†’ ã‚µãƒ ãƒã‚¤ãƒ«å…ƒã«æˆ»ã‚‹

ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹:
  [ ] Vã‚­ãƒ¼ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ãŒéå‰°ã§ãªã„ï¼ˆ100msé–“éš”ï¼‰
  [ ] ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ãŒæ»‘ã‚‰ã‹ï¼ˆã‚«ã‚¯ã¤ã‹ãªã„ï¼‰
  [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæ­£å¸¸å‹•ä½œï¼ˆåŒä¸€çŠ¶æ…‹ã§å†ç”Ÿæˆã—ãªã„ï¼‰

ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³:
  [ ] ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚µãƒ ãƒã‚¤ãƒ«ãŒãƒ¬ã‚¤ãƒ¤ãƒ¼å¤‰å½¢ã«è¿½å¾“
  [ ] ãƒ•ãƒ¬ãƒ¼ãƒ åˆ‡æ›¿æ™‚ã«ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤º

éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼:
  [ ] éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚µãƒ ãƒã‚¤ãƒ«ã‚‚æ›´æ–°ï¼ˆå…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼æ›´æ–°ï¼‰

================================================================================
å‚™è€ƒãƒ»æ³¨æ„äº‹é …
================================================================================

1. ãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã®æç”»/åˆ¤å®šå•é¡Œã«ã¤ã„ã¦
   - ç¾çŠ¶ã®è¨ºæ–­ã§ã¯æœªæ¤œè¨¼
   - åº§æ¨™ç³»ã‚ºãƒ¬ãŒåŸå› ã®å¯èƒ½æ€§
   - Phase 4ï¼ˆåº§æ¨™ç³»ä¿®æ­£ï¼‰ãŒå¿…è¦ãªå ´åˆã¯ã€åˆ¥é€”èª¿æŸ»ãŒå¿…è¦

2. Vã‚­ãƒ¼ãƒ¢ãƒ¼ãƒ‰ä¸­ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–è¨­å®š
   - thumbnail-system.js ã« disableCacheDuringVMode: true ãŒè¨­å®šæ¸ˆã¿
   - ã“ã‚Œã«ã‚ˆã‚ŠVãƒ¢ãƒ¼ãƒ‰ä¸­ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ãƒã‚¤ãƒ‘ã‚¹
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã«æ³¨æ„

3. ã‚¤ãƒ™ãƒ³ãƒˆãƒšã‚¤ãƒ­ãƒ¼ãƒ‰å½¢å¼
   - component/action/data å½¢å¼ã‚’ç¶­æŒ
   - æ—¢å­˜ã‚¤ãƒ™ãƒ³ãƒˆã¨ã®äº’æ›æ€§ç¢ºä¿

4. throttle å®Ÿè£…ã®æ³¨æ„
   - requestAnimationFrame ã§ã¯ãªã setTimeout ã‚’ä½¿ç”¨
   - ç†ç”±: RAF ã¯æç”»ãƒ•ãƒ¬ãƒ¼ãƒ ã«åŒæœŸã™ã‚‹ãŒã€ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã¯éåŒæœŸã§è‰¯ã„

================================================================================
å‚è€ƒ: ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼å›³ï¼ˆä¿®æ­£å¾Œï¼‰
================================================================================

[Vã‚­ãƒ¼ãƒ‰ãƒ©ãƒƒã‚°]
  â†“
[layer-transform.js: _handleDrag()]
  â†“
[layer-transform.js: updateTransform()]
  â†“
[layer-transform.js: _emitTransformUpdated()] â† throttle 100ms
  â†“
[EventBus: 'layer:transform-updated']
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚                     â”‚
[thumbnail-system.js] [timeline-thumbnail-  â”‚
                       utils.js]            â”‚
â”‚                     â”‚                     â”‚
invalidateCache()     _invalidateCache()   â”‚
  â†“                     â†“                   â”‚
emit('thumbnail:      regenerateAll-       â”‚
  layer-updated')     Thumbnails()         â”‚
  â†“                                         â”‚
[layer-panel-renderer.js]                  â”‚
  â†“                                         â”‚
updateLayerThumbnail()                     â”‚
  â†“                                         â”‚
[ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºæ›´æ–°]                         â”‚

================================================================================
EOF
================================================================================