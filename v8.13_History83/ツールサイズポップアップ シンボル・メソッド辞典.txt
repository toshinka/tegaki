# ãƒ„ãƒ¼ãƒ«ã‚µã‚¤ã‚ºãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— ã‚·ãƒ³ãƒœãƒ«ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰è¾å…¸

## ğŸ“¦ é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 

```
config.js                        # è¨­å®šã®èµ·ç‚¹
system/
  â”œâ”€â”€ tool-size-manager.js      # ã‚¹ãƒ­ãƒƒãƒˆç®¡ç†
  â”œâ”€â”€ state-manager.js           # çŠ¶æ…‹ç®¡ç†ï¼ˆå”¯ä¸€ã®ãƒ‡ãƒ¼ã‚¿ä¿æŒï¼‰
  â””â”€â”€ event-bus.js               # ã‚¤ãƒ™ãƒ³ãƒˆé€šä¿¡
ui/
  â”œâ”€â”€ tool-size-popup.js         # UIã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ
  â”œâ”€â”€ ui-panels.js               # ã‚¢ã‚¤ã‚³ãƒ³ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
  â””â”€â”€ dom-builder.js             # DOMç”Ÿæˆï¼ˆcreate/createElementï¼‰
core-initializer.js              # åˆæœŸåŒ–ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
```

---

## ğŸ”§ config.js

### ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
- `window.TEGAKI_CONFIG` - å…¨è¨­å®šã®ãƒ«ãƒ¼ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
  - `.pen` - ãƒšãƒ³è¨­å®š
    - `.size` - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚µã‚¤ã‚º (10)
    - `.opacity` - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä¸é€æ˜åº¦ (0.85)
  - `.toolSize` - **[è¦è¿½åŠ ]** ãƒ„ãƒ¼ãƒ«ã‚µã‚¤ã‚ºã‚¹ãƒ­ãƒƒãƒˆè¨­å®š

### è¦è¿½åŠ è¨­å®š
```javascript
toolSize: {
  slots: 6,
  penMin: 0.1,
  penMax: 300,
  thumbnailMin: 1,
  thumbnailMax: 25,
  penSlots: [
    [1, 0.85],
    [3, 0.85],
    [5, 0.85],
    [10, 0.85],
    [30, 0.85],
    [80, 0.85]
  ],
  eraserSlots: [
    [1, 1.0],
    [3, 1.0],
    [5, 1.0],
    [10, 1.0],
    [30, 1.0],
    [80, 1.0]
  ]
}
```

---

## ğŸ—‚ï¸ system/state-manager.js

### ã‚¯ãƒ©ã‚¹
- `StateManager` - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®å”¯ä¸€ã®ä¿æŒè€…

### ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
- `window.StateManager` - ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³

### ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
- `.state` - å…¨çŠ¶æ…‹ã®ãƒ«ãƒ¼ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
  - `.tool.currentTool` - ç¾åœ¨ã®ãƒ„ãƒ¼ãƒ« ('pen' | 'eraser')
  - `.tool.penSize` - ãƒšãƒ³ã‚µã‚¤ã‚º
  - `.tool.penOpacity` - ãƒšãƒ³ä¸é€æ˜åº¦
  - `.tool.eraserSize` - æ¶ˆã—ã‚´ãƒ ã‚µã‚¤ã‚º
  - `.tool.eraserOpacity` - æ¶ˆã—ã‚´ãƒ ä¸é€æ˜åº¦

### ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆãƒ„ãƒ¼ãƒ«é–¢é€£ï¼‰
- `getCurrentTool(): string` - ç¾åœ¨ã®ãƒ„ãƒ¼ãƒ«ã‚’å–å¾—
- `setCurrentTool(tool)` - ãƒ„ãƒ¼ãƒ«åˆ‡ã‚Šæ›¿ãˆã€`tool:change`ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«
- `getPenSize(): number` - ãƒšãƒ³ã‚µã‚¤ã‚ºå–å¾—
- `setPenSize(size)` - ãƒšãƒ³ã‚µã‚¤ã‚ºè¨­å®šã€`toolSize:change`ç™ºç«
- `getPenOpacity(): number` - ãƒšãƒ³ä¸é€æ˜åº¦å–å¾—
- `setPenOpacity(opacity)` - ãƒšãƒ³ä¸é€æ˜åº¦è¨­å®šã€`toolOpacity:change`ç™ºç«
- `getEraserSize(): number` - æ¶ˆã—ã‚´ãƒ ã‚µã‚¤ã‚ºå–å¾—
- `setEraserSize(size)` - æ¶ˆã—ã‚´ãƒ ã‚µã‚¤ã‚ºè¨­å®šã€`eraserSize:change`ç™ºç«
- `getEraserOpacity(): number` - æ¶ˆã—ã‚´ãƒ ä¸é€æ˜åº¦å–å¾—
- `setEraserOpacity(opacity)` - æ¶ˆã—ã‚´ãƒ ä¸é€æ˜åº¦è¨­å®šã€`eraserOpacity:change`ç™ºç«

### ç™ºç«ã‚¤ãƒ™ãƒ³ãƒˆ
- `tool:change` - ãƒ„ãƒ¼ãƒ«åˆ‡ã‚Šæ›¿ãˆæ™‚ `{ tool: 'pen'|'eraser' }`
- `toolSize:change` - ãƒšãƒ³ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ `{ tool: 'pen', size }`
- `toolOpacity:change` - ãƒšãƒ³ä¸é€æ˜åº¦å¤‰æ›´æ™‚ `{ tool: 'pen', opacity }`
- `eraserSize:change` - æ¶ˆã—ã‚´ãƒ ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ `{ tool: 'eraser', size }`
- `eraserOpacity:change` - æ¶ˆã—ã‚´ãƒ ä¸é€æ˜åº¦å¤‰æ›´æ™‚ `{ tool: 'eraser', opacity }`

---

## ğŸ›ï¸ system/tool-size-manager.js

### ã‚¯ãƒ©ã‚¹
- `ToolSizeManager` - ã‚¹ãƒ­ãƒƒãƒˆå°‚ç”¨ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

### ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
- `window.ToolSizeManager` - ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³

### ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
- `.config` - `window.TEGAKI_CONFIG.toolSize`ã¸ã®å‚ç…§
- `.penSlots[]` - ãƒšãƒ³ã‚¹ãƒ­ãƒƒãƒˆé…åˆ— `[{ size, opacity }, ...]`
- `.eraserSlots[]` - æ¶ˆã—ã‚´ãƒ ã‚¹ãƒ­ãƒƒãƒˆé…åˆ—
- `.activePenSlot: number` - ãƒšãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ãƒ­ãƒƒãƒˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ3ï¼‰
- `.activeEraserSlot: number` - æ¶ˆã—ã‚´ãƒ ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ãƒ­ãƒƒãƒˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ0ï¼‰

### ãƒ¡ã‚½ãƒƒãƒ‰
- `getCurrentSlots(): Array<{size, opacity}>` - ç¾åœ¨ãƒ„ãƒ¼ãƒ«ã®ã‚¹ãƒ­ãƒƒãƒˆé…åˆ—å–å¾—
- `getActiveSlotIndex(): number` - ç¾åœ¨ãƒ„ãƒ¼ãƒ«ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å–å¾—
- `setActiveSlot(index)` - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ãƒ­ãƒƒãƒˆå¤‰æ›´â†’StateManageræ›´æ–°â†’`slotChanged`ç™ºç«
- `updateActiveSlotValue(size, opacity)` - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ãƒ­ãƒƒãƒˆã®å€¤æ›´æ–°â†’`slotValueChanged`ç™ºç«
- `getSlotValue(index): {size, opacity}` - æŒ‡å®šã‚¹ãƒ­ãƒƒãƒˆå€¤å–å¾—
- `_restoreToolSlotValues(tool)` - ãƒ„ãƒ¼ãƒ«åˆ‡ã‚Šæ›¿ãˆæ™‚ã«ã‚¹ãƒ­ãƒƒãƒˆå€¤ã‚’StateManagerã¸åæ˜ ï¼ˆå†…éƒ¨ï¼‰
- `_initializeSlots(slotsConfig)` - ã‚¹ãƒ­ãƒƒãƒˆåˆæœŸåŒ–ï¼ˆå†…éƒ¨ï¼‰

### ãƒªã‚¹ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
- `tool:change` - ãƒ„ãƒ¼ãƒ«åˆ‡ã‚Šæ›¿ãˆæ™‚ã€å¯¾å¿œã‚¹ãƒ­ãƒƒãƒˆå€¤ã‚’StateManagerã¸å¾©å…ƒ

### ç™ºç«ã‚¤ãƒ™ãƒ³ãƒˆ
- `slotChanged` - `{ tool, index }` ã‚¹ãƒ­ãƒƒãƒˆé¸æŠæ™‚
- `slotValueChanged` - `{ tool, index, size, opacity }` ã‚¹ãƒ­ãƒƒãƒˆå€¤å¤‰æ›´æ™‚

---

## ğŸ¨ ui/tool-size-popup.js

### ã‚¯ãƒ©ã‚¹
- `ToolSizePopup` - ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—UIç®¡ç†

### ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
- `window.ToolSizePopup` - ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³

### ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
- `.popup: HTMLElement` - ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—DOM
- `.slotButtons[]` - ã‚¹ãƒ­ãƒƒãƒˆãƒœã‚¿ãƒ³é…åˆ—
- `.sizeValueDisplay: HTMLElement` - ã‚µã‚¤ã‚ºå€¤è¡¨ç¤º
- `.opacityValueDisplay: HTMLElement` - ä¸é€æ˜åº¦å€¤è¡¨ç¤º
- `.sizeSlider: HTMLInputElement` - ã‚µã‚¤ã‚ºã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
- `.opacitySlider: HTMLInputElement` - ä¸é€æ˜åº¦ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
- `.isOpen: boolean` - è¡¨ç¤ºçŠ¶æ…‹ãƒ•ãƒ©ã‚°
- `.initialized: boolean` - åˆæœŸåŒ–æ¸ˆã¿ãƒ•ãƒ©ã‚°

### ãƒ¡ã‚½ãƒƒãƒ‰
- `initialize()` - DOMç”Ÿæˆã¨åˆæœŸè¨­å®šï¼ˆDOMBuilderä¾å­˜ï¼‰
- `open()` - ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
- `close()` - ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—éè¡¨ç¤º
- `toggle()` - è¡¨ç¤º/éè¡¨ç¤ºåˆ‡æ›¿
- `show()` - open()ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹
- `hide()` - close()ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹

### DOMç”Ÿæˆï¼ˆå†…éƒ¨ãƒ¡ã‚½ãƒƒãƒ‰ï¼‰
- `_createPopup()` - ãƒ«ãƒ¼ãƒˆDOMç”Ÿæˆ
- `_createSlotButtons()` - ã‚¹ãƒ­ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠç”Ÿæˆ
- `_createSlotButton(index)` - å€‹åˆ¥ã‚¹ãƒ­ãƒƒãƒˆãƒœã‚¿ãƒ³ç”Ÿæˆ
  - å­è¦ç´ : `.thumbnailCircle`, `.sizeLabel`, `.opacityLabel`
- `_createSizeSection()` - ã‚µã‚¤ã‚ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ç”Ÿæˆ
- `_createOpacitySection()` - ä¸é€æ˜åº¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç”Ÿæˆ
- `_createSliderRow(type)` - ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼è¡Œç”Ÿæˆï¼ˆÂ±ãƒœã‚¿ãƒ³ä»˜ãï¼‰
- `_createAdjustButton(text, delta, type)` - Â±èª¿æ•´ãƒœã‚¿ãƒ³ç”Ÿæˆ

### ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ï¼ˆå†…éƒ¨ãƒ¡ã‚½ãƒƒãƒ‰ï¼‰
- `_handleSlotClick(index)` - ã‚¹ãƒ­ãƒƒãƒˆã‚¯ãƒªãƒƒã‚¯â†’`ToolSizeManager.setActiveSlot()`
- `_handleSliderChange(type)` - ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å¤‰æ›´â†’StateManageræ›´æ–°
- `_adjustValue(type, delta)` - Â±ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯â†’StateManageræ›´æ–°
- `_enableDirectInput(element, type)` - æ•°å€¤ã‚¯ãƒªãƒƒã‚¯â†’inputè¦ç´ ç”Ÿæˆâ†’ç¢ºå®šå‡¦ç†

### UIæ›´æ–°ï¼ˆå†…éƒ¨ãƒ¡ã‚½ãƒƒãƒ‰ï¼‰
- `_updateFromState()` - StateManagerã‹ã‚‰å€¤å–å¾—â†’UIåæ˜ 
- `_updateSlotDisplay()` - å…¨ã‚¹ãƒ­ãƒƒãƒˆã®ã‚µãƒ ãƒã‚¤ãƒ«ã¨ãƒ©ãƒ™ãƒ«æ›´æ–°
- `_updateSlotHighlight()` - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ãƒ­ãƒƒãƒˆã®ãƒã‚¤ãƒ©ã‚¤ãƒˆæ›´æ–°
- `_updateActiveSlotFromState()` - StateManagerâ†’ToolSizeManagerã¸åæ˜ 

### ãƒªã‚¹ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
- `tool:change` - ãƒ„ãƒ¼ãƒ«åˆ‡ã‚Šæ›¿ãˆæ™‚ã€UIæ›´æ–°
- `slotChanged` - ã‚¹ãƒ­ãƒƒãƒˆé¸æŠæ™‚ã€ãƒã‚¤ãƒ©ã‚¤ãƒˆæ›´æ–°
- `slotValueChanged` - ã‚¹ãƒ­ãƒƒãƒˆå€¤å¤‰æ›´æ™‚ã€è¡¨ç¤ºæ›´æ–°
- `document.click` - ç”»é¢å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹

---

## ğŸ–¥ï¸ ui/ui-panels.js

### ã‚¯ãƒ©ã‚¹
- `window.TegakiUI.UIController` - UIçµ±åˆåˆ¶å¾¡

### ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
- `.toolSizePopup` - ToolSizePopupã¸ã®å‚ç…§ï¼ˆé…å»¶åˆæœŸåŒ–ï¼‰

### ãƒ¡ã‚½ãƒƒãƒ‰
- `getToolSizePopup()` - ToolSizePopupå–å¾—ã¨åˆæœŸåŒ–ç¢ºèª
- `handleToolClick(button)` - ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
  - `'pen-tool'` â†’ `setTool('pen')` + ToolSizePopupè¡¨ç¤º
  - `'eraser-tool'` â†’ `setTool('eraser')` + ToolSizePopupè¡¨ç¤º
- `closeAllPopups(exceptPopup)` - å…¨ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹ï¼ˆæŒ‡å®šé™¤å¤–å¯ï¼‰

### ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ï¼ˆhandleToolClickå†…ï¼‰
```javascript
toolMap = {
  'pen-tool': () => {
    CoreRuntime.api.setTool('pen');
    toolSizePopup.open();
    this.updateToolUI('pen');
  },
  'eraser-tool': () => {
    CoreRuntime.api.setTool('eraser');
    toolSizePopup.open();
    this.updateToolUI('eraser');
  }
}
```

---

## ğŸ—ï¸ ui/dom-builder.js

### é–¢æ•°
- `DOMBuilder.createElement(tag, options)` - æ±ç”¨DOMç”Ÿæˆ
  - `options.id` - IDå±æ€§
  - `options.className` - classå±æ€§
  - `options.innerHTML` - innerHTML
  - `options.textContent` - textContent
  - `options.title` - titleå±æ€§
  - `options.style` - ã‚¹ã‚¿ã‚¤ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
  - `options.attributes` - å±æ€§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

### ã‚¨ã‚¤ãƒªã‚¢ã‚¹
- `DOMBuilder.create()` - `createElement()`ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼ˆäº’æ›æ€§ç”¨ï¼‰

---

## ğŸš€ core-initializer.js

### é–¢æ•°
- `initialize()` - ãƒ¡ã‚¤ãƒ³åˆæœŸåŒ–
- `DrawingApp.initializeToolSizePopupDelayed()` - ToolSizePopupé…å»¶åˆæœŸåŒ–
  - æœ€å¤§20å›ãƒªãƒˆãƒ©ã‚¤ã€50msã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«
  - ä¾å­˜ç¢ºèª: `window.ToolSizePopup`, `window.DOMBuilder.create`

---

## ğŸ“¡ system/event-bus.js

### ã‚¯ãƒ©ã‚¹
- `EventBus` - ã‚¤ãƒ™ãƒ³ãƒˆé€šä¿¡ã‚·ã‚¹ãƒ†ãƒ 

### ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
- `window.TegakiEventBus` - ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³
- `window.EventBus` - ã‚¨ã‚¤ãƒªã‚¢ã‚¹

### ãƒ¡ã‚½ãƒƒãƒ‰
- `on(event, callback, priority?)` - ãƒªã‚¹ãƒŠãƒ¼ç™»éŒ²ï¼ˆå„ªå…ˆåº¦æŒ‡å®šå¯ï¼‰
- `off(event, callback)` - ãƒªã‚¹ãƒŠãƒ¼è§£é™¤
- `emit(event, data)` - ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ï¼ˆå„ªå…ˆåº¦é †å®Ÿè¡Œï¼‰
- `once(event, callback, priority?)` - ä¸€åº¦ã ã‘å®Ÿè¡Œ

### æ—¢å­˜ã‚¤ãƒ™ãƒ³ãƒˆå®šæ•°
```javascript
EVENTS = {
  LAYER_CREATED: 'layer:created',
  OPERATION_COMMIT: 'operation:commit',
  HISTORY_CHANGED: 'history:changed',
  // ...
}
```

---

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³

```
ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã€‘
  â†“
ui-panels.js (handleToolClick)
  â”œâ†’ CoreRuntime.api.setTool('pen')
  â”‚   â””â†’ StateManager.setCurrentTool('pen')
  â”‚       â””â†’ EventBus.emit('tool:change', {tool: 'pen'})
  â”‚           â””â†’ ToolSizeManager._restoreToolSlotValues('pen')
  â”‚               â””â†’ StateManager.setPenSize/Opacity(slotå€¤)
  â””â†’ ToolSizePopup.open()

ã€ã‚¹ãƒ­ãƒƒãƒˆã‚¯ãƒªãƒƒã‚¯ã€‘
  â†“
ToolSizePopup._handleSlotClick(index)
  â””â†’ ToolSizeManager.setActiveSlot(index)
      â”œâ†’ StateManager.setPenSize/Opacity(slotå€¤)
      â”‚   â””â†’ EventBus.emit('toolSize:change')
      â””â†’ EventBus.emit('slotChanged', {tool, index})

ã€ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å¤‰æ›´ã€‘
  â†“
ToolSizePopup._handleSliderChange('size')
  â”œâ†’ StateManager.setPenSize(value)
  â”‚   â””â†’ EventBus.emit('toolSize:change')
  â””â†’ ToolSizeManager.updateActiveSlotValue(size, opacity)
      â””â†’ EventBus.emit('slotValueChanged')
```

---

## ğŸ” ç¾çŠ¶ã®å•é¡Œç‚¹

### 1. config.jsã«è¨­å®šãŒå­˜åœ¨ã—ãªã„
- `window.TEGAKI_CONFIG.toolSize`ãŒæœªå®šç¾©
- ToolSizeManageråˆæœŸåŒ–æ™‚ã«ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿå¯èƒ½

### 2. ToolSizePopupãŒè¡¨ç¤ºã•ã‚Œãªã„
**åŸå› å€™è£œ:**
- DOMBuilder.createãŒæœªå®šç¾©ï¼ˆcreateElementã®ã¿å­˜åœ¨ï¼‰
- åˆæœŸåŒ–ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®å•é¡Œï¼ˆä¾å­˜é–¢ä¿‚ãŒæƒã†å‰ã«å‘¼ã³å‡ºã—ï¼‰
- ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®z-indexã‚„positionã®ç«¶åˆ
- EventBusãƒªã‚¹ãƒŠãƒ¼ã®ç™»éŒ²å¤±æ•—

### 3. ã‚¹ãƒ­ãƒƒãƒˆè¡¨ç¤ºã®è¨ˆç®—å¼æœªå®Ÿè£…
- ã‚µãƒ ãƒã‚¤ãƒ«â—ã®ã‚µã‚¤ã‚ºè¨ˆç®—
  - æœ€å°1pxã€æœ€å¤§25pxï¼ˆèª¿æ•´å¿…è¦ï¼‰
  - ã‚µã‚¤ã‚ºã«å¿œã˜ãŸç·šå½¢ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°

### 4. ãƒ„ãƒ¼ãƒ«åˆ‡ã‚Šæ›¿ãˆæ™‚ã®çŠ¶æ…‹å¾©å…ƒ
- ãƒšãƒ³â†”æ¶ˆã—ã‚´ãƒ åˆ‡æ›¿æ™‚ã€å„ã‚¹ãƒ­ãƒƒãƒˆã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’ä¿æŒ
- StateManagerã¨ToolSizeManagerã®åŒæœŸãŒå¿…è¦

---

## ğŸ“‹ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: è¨­å®šã¨ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
- [ ] config.jsã«`toolSize`è¨­å®šè¿½åŠ 
- [ ] ToolSizeManager: `_restoreToolSlotValues()`å‹•ä½œç¢ºèª
- [ ] StateManager: æ—¢å­˜APIç¢ºèªï¼ˆsetPenSizeç­‰ï¼‰

### Phase 2: UIå®Ÿè£…
- [ ] DOMBuilder.create()ã‚¨ã‚¤ãƒªã‚¢ã‚¹ç¢ºèª
- [ ] ToolSizePopup.initialize()æˆåŠŸç¢ºèª
- [ ] ã‚¹ãƒ­ãƒƒãƒˆãƒœã‚¿ãƒ³DOMç”Ÿæˆç¢ºèª
- [ ] ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼DOMç”Ÿæˆç¢ºèª
- [ ] CSSã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨ç¢ºèª

### Phase 3: ã‚¤ãƒ™ãƒ³ãƒˆé€£æº
- [ ] ui-panels.js: ãƒšãƒ³/æ¶ˆã—ã‚´ãƒ ã‚¢ã‚¤ã‚³ãƒ³ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
- [ ] tool:change â†’ ToolSizeManageråå¿œç¢ºèª
- [ ] slotChanged â†’ UIæ›´æ–°ç¢ºèª
- [ ] slotValueChanged â†’ ã‚¹ãƒ­ãƒƒãƒˆè¡¨ç¤ºæ›´æ–°ç¢ºèª

### Phase 4: çµ±åˆãƒ†ã‚¹ãƒˆ
- [ ] ãƒšãƒ³ã‚¢ã‚¤ã‚³ãƒ³ã‚¯ãƒªãƒƒã‚¯â†’ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
- [ ] ã‚¹ãƒ­ãƒƒãƒˆã‚¯ãƒªãƒƒã‚¯â†’ã‚µã‚¤ã‚ºå¤‰æ›´ç¢ºèª
- [ ] ãƒ„ãƒ¼ãƒ«åˆ‡ã‚Šæ›¿ãˆâ†’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ãƒ­ãƒƒãƒˆä¿æŒç¢ºèª
- [ ] ç”»é¢å¤–ã‚¯ãƒªãƒƒã‚¯â†’ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—é–‰ã˜ã‚‹ç¢ºèª

---

## ğŸ¯ æ¬¡ã®Claudeã¸ã®æŒ‡ç¤ºãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

```
ã“ã®è¾å…¸ã‚’å‚ç…§ã—ã¦ä»¥ä¸‹ã‚’å®Ÿè¡Œ:

1. config.jsã«toolSizeè¨­å®šã‚’è¿½åŠ ï¼ˆè¾å…¸ã®è¨­å®šä¾‹ã‚’ä½¿ç”¨ï¼‰
2. DOMBuilder.createãŒcreateElementã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‹ç¢ºèªã—ã€ãªã‘ã‚Œã°è¿½åŠ 
3. ToolSizePopup._createPopup()ã§preview.webpã¨åŒã˜ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ç”Ÿæˆ
   - ã‚¹ãƒ­ãƒƒãƒˆ6å€‹ã‚’æ¨ªä¸¦ã³
   - å„ã‚¹ãƒ­ãƒƒãƒˆã«â—ã‚µãƒ ãƒã‚¤ãƒ«ã€ã‚µã‚¤ã‚ºå€¤ã€ä¸é€æ˜åº¦è¡¨ç¤º
   - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ãƒ­ãƒƒãƒˆã¯ãƒ”ãƒ³ã‚¯èƒŒæ™¯
4. ã‚¹ãƒ­ãƒƒãƒˆã‚¯ãƒªãƒƒã‚¯â†’setActiveSlot()â†’StateManageræ›´æ–°ã‚’ç¢ºèª
5. ãƒ„ãƒ¼ãƒ«åˆ‡ã‚Šæ›¿ãˆæ™‚ã€å„ãƒ„ãƒ¼ãƒ«ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ãƒ­ãƒƒãƒˆã‚’å¾©å…ƒ

ã€å‚è€ƒãƒ•ã‚¡ã‚¤ãƒ«ã€‘
- è¨­å®š: config.js
- ã‚¹ãƒ­ãƒƒãƒˆç®¡ç†: system/tool-size-manager.js
- UI: ui/tool-size-popup.js
- ã‚¢ã‚¤ã‚³ãƒ³å‡¦ç†: ui/ui-panels.js
- DOMç”Ÿæˆ: ui/dom-builder.js
```