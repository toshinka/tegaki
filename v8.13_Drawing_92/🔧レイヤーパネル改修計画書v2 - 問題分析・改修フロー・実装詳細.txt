================================================================================
ãƒ–ãƒ©ã‚¦ã‚¶ãŠçµµã‹ããƒ„ãƒ¼ãƒ« v8.13 - ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«æ”¹ä¿®è¨ˆç”»æ›¸v2
å•é¡Œåˆ†æãƒ»æ”¹ä¿®ãƒ•ãƒ­ãƒ¼ãƒ»å®Ÿè£…è©³ç´°
================================================================================

ã€é‡å¤§å•é¡Œã€‘
layer-panel-renderer.jsãŒğŸ“·ï¸ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«å®Ÿè£…äºˆå®šå›³.pngã®UIã‚’ç”Ÿæˆã—ã¦ã„ãªã„

ã€æ ¹æœ¬åŸå› ã€‘
1. createLayerElement()ãŒã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã§è¦ç´ ã‚’ç”Ÿæˆ
2. main.cssã®ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå®šç¾©ã‚’ç„¡è¦–
3. ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«ã®æ§‹é€ ãŒäºˆå®šå›³ã¨å®Œå…¨ã«ç•°ãªã‚‹

ã€å½±éŸ¿ç¯„å›²ã€‘
Phase 2,4,5,6,7,8 ã™ã¹ã¦ã®UIå®Ÿè£…ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹


================================================================================
â–  å•é¡Œè©³ç´°åˆ†æ
================================================================================

ã€ç¾çŠ¶ã®ã‚³ãƒ¼ãƒ‰ï¼ˆlayer-panel-renderer.js L88-L95ï¼‰ã€‘
```javascript
layerDiv.style.backgroundColor = layerColor;
layerDiv.style.display = 'flex';  // â† ã‚°ãƒªãƒƒãƒ‰ç„¡è¦–
layerDiv.style.alignItems = 'center';
layerDiv.style.padding = '4px 8px';
layerDiv.style.gap = '8px';
layerDiv.style.minHeight = '72px';
```

ã€main.cssã®å®šç¾©ï¼ˆå®Ÿéš›ã¯ä½¿ã‚ã‚Œã¦ã„ãªã„ï¼‰ã€‘
```css
.layer-item {
    grid-template-columns: 18px 1fr 64px 14px;
    grid-template-rows: 1fr 1fr;
}
```

ã€äºˆå®šå›³ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹é€ ã€‘
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘ â—€ 100% â–¶  ãƒ¬ã‚¤ãƒ¤ãƒ¼1  [IMG] âœ•â”‚  â† ä¸Šæ®µ
â”‚               (å·¦å¯„ã›)          â”‚  â† ä¸‹æ®µ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
grid-template-columns: 18px 1fr 64px 14px
grid-template-rows: 1fr 1fr

ğŸ‘: grid-column:1, grid-row:1/3
â—€100%â–¶: grid-column:2, grid-row:1
ãƒ¬ã‚¤ãƒ¤ãƒ¼1: grid-column:2, grid-row:2 (å·¦å¯„ã›)
[IMG]: grid-column:3, grid-row:1/3
âœ•: grid-column:4, grid-row:1/3
```


================================================================================
â–  æ”¹ä¿®å¯¾è±¡Phaseåˆ¥è©³ç´°
================================================================================

ã€Phase 2: ãƒã‚§ãƒƒã‚«ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‘
çŠ¶æ…‹: âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆlayer-system.js, camera-system.jsï¼‰
ç¢ºèªé …ç›®:
â–¡ èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼éè¡¨ç¤ºã§ãƒã‚§ãƒƒã‚«ãƒ¼è¡¨ç¤º
â–¡ ãƒã‚§ãƒƒã‚«ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è‰²: #f0e0d6 ã¨ #ffffee
å•é¡Œ: ãƒªã‚µã‚¤ã‚ºå¯¾å¿œãŒä¸å®Œå…¨

ã€Phase 4: ãƒ¬ã‚¤ãƒ¤ãƒ¼åé€£ç•ªã€‘
çŠ¶æ…‹: âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆlayer-system.js createLayer()ï¼‰
ç¢ºèªé …ç›®:
â–¡ æ–°è¦ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆæ™‚ã€Œãƒ¬ã‚¤ãƒ¤ãƒ¼1ã€ã€Œãƒ¬ã‚¤ãƒ¤ãƒ¼2ã€...
â–¡ ãƒ¬ã‚¤ãƒ¤ãƒ¼å‰Šé™¤å¾Œã‚‚é€£ç•ªç¶™ç¶š
å•é¡Œ: ãªã—

ã€Phase 5: èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ä»•æ§˜ã€‘
çŠ¶æ…‹: âŒ UIæœªå®Ÿè£…ï¼ˆãƒ­ã‚¸ãƒƒã‚¯ã¯å®Ÿè£…æ¸ˆã¿ï¼‰
å•é¡Œ:
- ãƒã‚±ãƒ„ã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œãªã„ï¼ˆã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã§æ½°ã•ã‚Œã¦ã„ã‚‹ï¼‰
- é€æ˜åº¦è¡¨ç¤ºå‰Šé™¤ãŒåŠ¹ã„ã¦ã„ãªã„
- å‰Šé™¤ãƒœã‚¿ãƒ³éè¡¨ç¤ºãŒåŠ¹ã„ã¦ã„ãªã„

ã€Phase 6: ãƒ¬ã‚¤ãƒ¤ãƒ¼é€æ˜åº¦UIã€‘
çŠ¶æ…‹: âŒ UIæœªå®Ÿè£…ï¼ˆãƒ­ã‚¸ãƒƒã‚¯ã¯å®Ÿè£…æ¸ˆã¿ï¼‰
å•é¡Œ:
- ã€Œâ—€ 100% â–¶ã€ãŒæ­£ã—ãé…ç½®ã•ã‚Œãªã„
- ãƒ‰ãƒ©ãƒƒã‚°æ©Ÿèƒ½ã¯å®Ÿè£…æ¸ˆã¿ã ãŒã€UIãŒå´©ã‚Œã¦ã„ã‚‹

ã€Phase 7: ãƒ‰ãƒ©ãƒƒã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ”¹å–„ã€‘
çŠ¶æ…‹: â–³ éƒ¨åˆ†å®Ÿè£…
å•é¡Œ:
- Sortable.jsã®è¨­å®šã¯å®Ÿè£…æ¸ˆã¿
- CSSã‚¹ã‚¿ã‚¤ãƒ«ã‚‚å®Ÿè£…æ¸ˆã¿
- ãŸã ã—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«ã®æ§‹é€ å•é¡Œã«ã‚ˆã‚Šå‹•ä½œãŒä¸å®‰å®š

ã€Phase 8: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–/æº–ã‚¢ã‚¯ãƒ†ã‚£ãƒ–UIã€‘
çŠ¶æ…‹: âŒ æœªå®Ÿè£…
å•é¡Œ:
- state-manager.jsã«å®Ÿè£…æ¸ˆã¿
- layer-panel-renderer.jsã«_updatePanelActiveState()å®Ÿè£…æ¸ˆã¿
- ãŸã ã—ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ãŒæ©Ÿèƒ½ã—ã¦ã„ãªã„å¯èƒ½æ€§


================================================================================
â–  æ”¹ä¿®ãƒ•ãƒ­ãƒ¼ - Phaseåˆ¥å®Ÿè£…ã‚¬ã‚¤ãƒ‰
================================================================================

ã€Phase 5&6: ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«UIå®Œå…¨å†æ§‹ç¯‰ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â–  æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«:
ui/layer-panel-renderer.js

â–  å‡¦ç†ãƒ•ãƒ­ãƒ¼:
CoreInitializer.initialize()
  â†’ DrawingApp.initialize()
  â†’ initializeLayerPanel()
    â†’ new LayerPanelRenderer()
      â†’ _setupEventListeners()
      â†’ render()
        â†’ createLayerElement() â† ã“ã“ã‚’å®Œå…¨ä¿®æ­£

â–  ä¿®æ­£ç®‡æ‰€: createLayerElement()ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆL66-L285ï¼‰

ã€ä¿®æ­£æ–¹é‡ã€‘
1. ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å…¨å‰Šé™¤
2. CSSã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã®å®Ÿè£…ã«å¤‰æ›´
3. ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’æ­£ã—ãé©ç”¨

ã€å®Ÿè£…è©³ç´°ã€‘

â–  åŸºæœ¬æ§‹é€ ï¼ˆL66-L75ï¼‰
```javascript
createLayerElement(layer, index, isActive, animationSystem) {
    const layerDiv = document.createElement('div');
    layerDiv.className = 'layer-item';
    if (isActive) layerDiv.classList.add('active');
    
    const isBackground = layer.layerData?.isBackground;
    if (isBackground) layerDiv.classList.add('background-layer');
    
    layerDiv.dataset.layerIndex = index;
    
    // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã¯å…¨å‰Šé™¤
```

â–  è¡¨ç¤º/éè¡¨ç¤ºã‚¢ã‚¤ã‚³ãƒ³ï¼ˆL77-L107ï¼‰
```javascript
const visibilityIcon = document.createElement('div');
visibilityIcon.className = 'layer-visibility';
// grid-column: 1, grid-row: 1/3 ã¯CSSã§å®šç¾©æ¸ˆã¿
// ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ä¸è¦
```

â–  Phase 5: èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ - ãƒã‚±ãƒ„ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆL109-L135ï¼‰
```javascript
if (isBackground) {
    const bucketIcon = document.createElement('div');
    bucketIcon.className = 'layer-background-color-button';
    // grid-column: 2, grid-row: 1 ã¯CSSã§å®šç¾©æ¸ˆã¿
    
    bucketIcon.innerHTML = `<svg>...</svg>`;
    
    bucketIcon.addEventListener('click', (e) => {
        e.stopPropagation();
        this.eventBus.emit('ui:background-color-change-requested', {
            layerIndex: index,
            layerId: layer.layerData?.id
        });
    });
    
    layerDiv.appendChild(bucketIcon);
}
```

â–  Phase 6: ä¸€èˆ¬ãƒ¬ã‚¤ãƒ¤ãƒ¼ - é€æ˜åº¦UIï¼ˆL137-L205ï¼‰
```javascript
else {
    const opacityContainer = document.createElement('div');
    opacityContainer.className = 'layer-opacity-control';
    // grid-column: 2, grid-row: 1 ã¯CSSã§å®šç¾©æ¸ˆã¿
    
    const decreaseBtn = document.createElement('button');
    decreaseBtn.textContent = 'â—€';
    decreaseBtn.className = 'layer-opacity-decrease';
    decreaseBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        this._adjustLayerOpacity(index, -0.1);
    });
    
    const opacityValue = document.createElement('span');
    opacityValue.className = 'layer-opacity-value';
    const currentOpacity = layer.alpha !== undefined ? layer.alpha : 1.0;
    opacityValue.textContent = `${Math.round(currentOpacity * 100)}%`;
    this._setupOpacityDrag(opacityValue, index);
    
    const increaseBtn = document.createElement('button');
    increaseBtn.textContent = 'â–¶';
    increaseBtn.className = 'layer-opacity-increase';
    increaseBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        this._adjustLayerOpacity(index, 0.1);
    });
    
    opacityContainer.appendChild(decreaseBtn);
    opacityContainer.appendChild(opacityValue);
    opacityContainer.appendChild(increaseBtn);
    layerDiv.appendChild(opacityContainer);
}
```

â–  ãƒ¬ã‚¤ãƒ¤ãƒ¼åï¼ˆL207-L217ï¼‰
```javascript
const nameSpan = document.createElement('span');
nameSpan.className = 'layer-name';
nameSpan.textContent = layer.layerData?.name || `ãƒ¬ã‚¤ãƒ¤ãƒ¼${index}`;
// grid-column: 2, grid-row: 2 ã¯CSSã§å®šç¾©æ¸ˆã¿
// text-align: left ã¯CSSã§å®šç¾©æ¸ˆã¿
layerDiv.appendChild(nameSpan);
```

â–  ã‚µãƒ ãƒã‚¤ãƒ«ï¼ˆL219-L237ï¼‰
```javascript
const thumbnail = this.createThumbnail(layer, index);
// grid-column: 3, grid-row: 1/3 ã¯CSSã§å®šç¾©æ¸ˆã¿
layerDiv.appendChild(thumbnail);
```

â–  å‰Šé™¤ãƒœã‚¿ãƒ³ï¼ˆL239-L267ï¼‰
```javascript
if (!isBackground) {
    const deleteBtn = document.createElement('button');
    deleteBtn.className = 'layer-delete-button';
    // grid-column: 4, grid-row: 1/3 ã¯CSSã§å®šç¾©æ¸ˆã¿
    
    deleteBtn.innerHTML = `<svg>...</svg>`;
    deleteBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        this.layerSystem.deleteLayer(index);
    });
    
    layerDiv.appendChild(deleteBtn);
}
```

â–  ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¯ãƒªãƒƒã‚¯ï¼ˆL269-L285ï¼‰
```javascript
layerDiv.addEventListener('click', (e) => {
    if (window.stateManager) {
        window.stateManager.setLastActivePanel('layer');
    }
    
    this.eventBus.emit('ui:layer-selected', {
        layerIndex: index,
        layerId: layer.layerData?.id
    });
});

return layerDiv;
```

ã€å‚è€ƒãƒ¡ã‚½ãƒƒãƒ‰ã€‘
- createThumbnail() (L287-L317)
- _setupOpacityDrag() (L319-L364) â† å®Ÿè£…æ¸ˆã¿
- _adjustLayerOpacity() (L366-L371) â† å®Ÿè£…æ¸ˆã¿
- _setLayerOpacity() (L373-L386) â† å®Ÿè£…æ¸ˆã¿


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€Phase 7: ãƒ‰ãƒ©ãƒƒã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ”¹å–„ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â–  æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«:
ui/layer-panel-renderer.js

â–  å‡¦ç†ãƒ•ãƒ­ãƒ¼:
render()
  â†’ createLayerElement() (å„ãƒ¬ã‚¤ãƒ¤ãƒ¼è¦ç´ ä½œæˆ)
  â†’ initializeSortable() â† ã“ã“ã‚’ç¢ºèªãƒ»ä¿®æ­£

â–  ä¿®æ­£ç®‡æ‰€: initializeSortable()ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆL388-L445ï¼‰

ã€ç¾çŠ¶ã®å•é¡Œã€‘
- filterã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é™¤å¤–ã—ã¦ã„ã‚‹ãŒã€æ­£ã—ãå‹•ä½œã—ã¦ã„ãªã„
- ã‚«ãƒ¼ã‚½ãƒ«è¡¨ç¤ºãŒä¸å®‰å®š

ã€ä¿®æ­£æ–¹é‡ã€‘
1. filteré–¢æ•°ã‚’ä¿®æ­£ï¼ˆbackground-layerã‚¯ãƒ©ã‚¹åˆ¤å®šï¼‰
2. onMoveé–¢æ•°ã§èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸ã®ç§»å‹•ã‚’ç¢ºå®Ÿã«ãƒ–ãƒ­ãƒƒã‚¯
3. Phase 5ã§background-layerã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ ã—ã¦ã„ã‚‹ãŸã‚ã€ãã‚Œã‚’åˆ©ç”¨

ã€å®Ÿè£…è©³ç´°ã€‘

```javascript
initializeSortable() {
    if (!window.Sortable) return;
    
    try {
        if (this.sortable) {
            this.sortable.destroy();
        }
        
        this.sortable = window.Sortable.create(this.container, {
            animation: 150,
            ghostClass: 'sortable-ghost',
            dragClass: 'sortable-drag',
            chosenClass: 'sortable-chosen',
            forceFallback: true,
            fallbackOnBody: true,
            swapThreshold: 0.65,
            
            // èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ‰ãƒ©ãƒƒã‚°ã‚’ç¦æ­¢
            filter: '.background-layer',
            
            // èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸ã®ç§»å‹•ã‚’ç¦æ­¢
            onMove: (evt) => {
                if (evt.related?.classList.contains('background-layer')) {
                    return false;
                }
            },
            
            onChoose: (evt) => {
                evt.item.style.opacity = '0.5';
            },
            
            onStart: (evt) => {
                evt.item.style.cursor = 'grabbing';
            },
            
            onEnd: (evt) => {
                evt.item.style.opacity = '';
                evt.item.style.cursor = '';
                
                if (this.layerSystem?.reorderLayers) {
                    const layers = this.layerSystem.getLayers();
                    const oldIndex = layers.length - 1 - evt.oldIndex;
                    const newIndex = layers.length - 1 - evt.newIndex;
                    this.layerSystem.reorderLayers(oldIndex, newIndex);
                }
            }
        });
    } catch (error) {
        if (this.debugEnabled) {
            console.warn('Sortable initialization failed:', error);
        }
    }
}
```

ã€å‚è€ƒCSSï¼ˆmain.cssï¼‰ã€‘
- .sortable-ghost (L1025-L1028)
- .sortable-drag (L1030-L1037)
- .sortable-chosen (L1039-L1042)
- .layer-item.background-layer (L1065-L1075) â† é‡è¦


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€Phase 8: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–/æº–ã‚¢ã‚¯ãƒ†ã‚£ãƒ–UIã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â–  æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«:
1. ui/layer-panel-renderer.js
2. ui/timeline-ui.jsï¼ˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å´ã‚‚å¯¾å¿œãŒå¿…è¦ï¼‰

â–  å‡¦ç†ãƒ•ãƒ­ãƒ¼:
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯
  â†’ createLayerElement()ã®click listener
    â†’ window.stateManager.setLastActivePanel('layer')
      â†’ state-manager.js: setLastActivePanel()
        â†’ EventBus.emit('ui:active-panel-changed', { activePanel: 'layer' })
          â†’ layer-panel-renderer.js: _updatePanelActiveState(true)
            â†’ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®borderColorã‚’å¤‰æ›´

ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ã‚¯ãƒªãƒƒã‚¯
  â†’ timeline-ui.js: frameItem.click listener
    â†’ window.stateManager.setLastActivePanel('timeline')
      â†’ EventBus.emit('ui:active-panel-changed', { activePanel: 'timeline' })
        â†’ layer-panel-renderer.js: _updatePanelActiveState(false)
          â†’ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®borderColorã‚’#aa5a56ã«å¤‰æ›´

â–  ä¿®æ­£ç®‡æ‰€1: layer-panel-renderer.js

ã€_setupEventListeners()ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆL24-L29ï¼‰ã€‘
```javascript
_setupEventListeners() {
    if (!this.eventBus) return;
    
    // ... æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆ ...
    
    // Phase 8: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ‘ãƒãƒ«åˆ‡ã‚Šæ›¿ãˆ
    this.eventBus.on('ui:active-panel-changed', ({ activePanel }) => {
        this._updatePanelActiveState(activePanel === 'layer');
    });
}
```

ã€_updatePanelActiveState()ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆL388-L397ï¼‰ã€‘
```javascript
_updatePanelActiveState(isActive) {
    const activeLayer = this.container.querySelector('.layer-item.active');
    if (!activeLayer) return;
    
    if (isActive) {
        activeLayer.style.borderColor = 'var(--futaba-accent, #ff8c42)';
    } else {
        activeLayer.style.borderColor = '#aa5a56';
    }
}
```

ã€createLayerElement()ã®click listenerï¼ˆL269-L285ï¼‰ã€‘
```javascript
layerDiv.addEventListener('click', (e) => {
    // Phase 8: ãƒ¬ã‚¤ãƒ¤ãƒ¼é¸æŠæ™‚ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ‘ãƒãƒ«ã‚’è¨­å®š
    if (window.stateManager) {
        window.stateManager.setLastActivePanel('layer');
    }
    
    this.eventBus.emit('ui:layer-selected', {
        layerIndex: index,
        layerId: layer.layerData?.id
    });
});
```

â–  ä¿®æ­£ç®‡æ‰€2: system/state-manager.js

ã€setLastActivePanel()ãƒ¡ã‚½ãƒƒãƒ‰ã€‘
state-manager.jsã«ã¯æ—¢ã«å®Ÿè£…æ¸ˆã¿ï¼ˆL53-L68ï¼‰
ç¢ºèªã®ã¿å¿…è¦

â–  ä¿®æ­£ç®‡æ‰€3: ui/timeline-ui.jsï¼ˆå‚è€ƒå®Ÿè£…ï¼‰

timeline-ui.jsã«ã‚‚åŒæ§˜ã®å‡¦ç†ã‚’è¿½åŠ ï¼š
```javascript
frameItem.addEventListener('click', () => {
    // Phase 8: ãƒ•ãƒ¬ãƒ¼ãƒ é¸æŠæ™‚ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ‘ãƒãƒ«ã‚’è¨­å®š
    if (window.stateManager) {
        window.stateManager.setLastActivePanel('timeline');
    }
    
    // ... æ—¢å­˜ã®å‡¦ç† ...
});
```

ã€å‚è€ƒCSSï¼ˆmain.cssï¼‰ã€‘
- .layer-item.active (L270-L276) â† æ©™è‰²ãƒœãƒ¼ãƒ€ãƒ¼
- --futaba-accent: #ff8c42 (L10)
- --futaba-light-maroon: #aa5a56 (L11) â† æº–ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è‰²


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€Phase 2: ãƒã‚§ãƒƒã‚«ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒªã‚µã‚¤ã‚ºå¯¾å¿œã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â–  æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«:
system/layer-system.js

â–  å‡¦ç†ãƒ•ãƒ­ãƒ¼:
camera-system.js: resizeCanvas()
  â†’ EventBus.emit('camera:resized', { width, height })
    â†’ layer-system.js: _setupResizeListener()ã§è³¼èª­
      â†’ _resizeCheckerPattern(width, height)
        â†’ checkerPatternã‚’å†ç”Ÿæˆ

â–  ä¿®æ­£ç®‡æ‰€: _resizeCheckerPattern()ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆL92-L117ï¼‰

ã€ç¾çŠ¶ã®å•é¡Œã€‘
- ãƒã‚§ãƒƒã‚«ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå¤§ãã‚ã«ç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ãŒã€ãƒªã‚µã‚¤ã‚ºæ™‚ã®å†é…ç½®ãŒä¸å®Œå…¨

ã€ä¿®æ­£æ–¹é‡ã€‘
1. ãƒªã‚µã‚¤ã‚ºæ™‚ã«checkerPatternã‚’å®Œå…¨ã«ç ´æ£„ãƒ»å†ç”Ÿæˆ
2. è¦ªã‚³ãƒ³ãƒ†ãƒŠï¼ˆcanvasContainerï¼‰ã¸ã®å†é…ç½®ã‚’ç¢ºå®Ÿã«è¡Œã†
3. z-indexã‚’æœ€èƒŒé¢ã«è¨­å®š

ã€å®Ÿè£…è©³ç´°ã€‘

```javascript
_resizeCheckerPattern(newWidth, newHeight) {
    if (!this.checkerPattern) return;
    
    // ç¾åœ¨ã®è¡¨ç¤ºçŠ¶æ…‹ã‚’ä¿å­˜
    const wasVisible = this.checkerPattern.visible;
    const parent = this.checkerPattern.parent;
    
    // æ—¢å­˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç ´æ£„
    if (parent) {
        parent.removeChild(this.checkerPattern);
    }
    this.checkerPattern.destroy({ children: true });
    
    // æ–°ã—ã„ã‚µã‚¤ã‚ºã§å†ç”Ÿæˆï¼ˆ4å€ã‚µã‚¤ã‚ºã§ä½™è£•ã‚’æŒãŸã›ã‚‹ï¼‰
    const patternSize = Math.max(newWidth, newHeight) * 4;
    this.checkerPattern = this._createCheckerPatternBackground(patternSize, patternSize);
    this.checkerPattern.visible = wasVisible;
    
    // è¦ªã‚³ãƒ³ãƒ†ãƒŠã«å†é…ç½®ï¼ˆæœ€èƒŒé¢ï¼‰
    if (parent) {
        parent.addChildAt(this.checkerPattern, 0);
    }
    
    // èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒéè¡¨ç¤ºã®å ´åˆã¯ãƒã‚§ãƒƒã‚«ãƒ¼ã‚’è¡¨ç¤º
    const layers = this.getLayers();
    const bgLayer = layers.find(l => l.layerData?.isBackground);
    if (bgLayer && !bgLayer.layerData.visible) {
        this.checkerPattern.visible = true;
    }
}
```

ã€å‚è€ƒãƒ¡ã‚½ãƒƒãƒ‰ã€‘
- _createCheckerPatternBackground() (L72-L90)
- _setupResizeListener() (L57-L66)
- attachCheckerPatternToWorld() (L119-L124)


================================================================================
â–  CSSå®šç¾©ç¢ºèª - æ­£ã—ã„ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
================================================================================

ã€main.css L1044-L1115ã€‘

```css
/* Phase 5 & 6: ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
.layer-item {
    grid-template-columns: 18px 1fr 64px 14px;
    grid-template-rows: 1fr 1fr;
}

.layer-visibility {
    grid-column: 1;
    grid-row: 1 / 3;
}

.layer-opacity-control,
.layer-background-color-button {
    grid-column: 2;
    grid-row: 1;
}

.layer-name {
    grid-column: 2;
    grid-row: 2;
    text-align: left !important;
}

.layer-thumbnail {
    grid-column: 3;
    grid-row: 1 / 3;
}

.layer-delete-button {
    grid-column: 4;
    grid-row: 1 / 3;
}

/* èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º */
.layer-item.background-layer .layer-delete-button {
    display: none;
}

/* èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼å›ºå®šåŒ– */
.layer-item.background-layer {
    cursor: default !important;
}

.layer-item.background-layer:hover {
    border-color: var(--futaba-cream) !important;
    background: rgba(240, 224, 214, 0.5) !important;
    transform: none !important;
    box-shadow: none !important;
}
```


================================================================================
â–  æ”¹ä¿®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ - Phaseåˆ¥ç¢ºèªé …ç›®
================================================================================

ã€Phase 2: ãƒã‚§ãƒƒã‚«ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‘
â–¡ èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼éè¡¨ç¤ºæ™‚ã«ãƒã‚§ãƒƒã‚«ãƒ¼è¡¨ç¤º
â–¡ ãƒã‚§ãƒƒã‚«ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è‰²: #f0e0d6 / #ffffee
â–¡ ã‚­ãƒ£ãƒ³ãƒã‚¹ãƒªã‚µã‚¤ã‚ºã§ãƒã‚§ãƒƒã‚«ãƒ¼ã‚‚å†ç”Ÿæˆ
â–¡ æ‹¡å¤§ç¸®å°ã§ãƒã‚§ãƒƒã‚«ãƒ¼ãŒæ­ªã¾ãªã„ï¼ˆå›ºå®š16pxã‚µã‚¤ã‚ºï¼‰

ã€Phase 4: ãƒ¬ã‚¤ãƒ¤ãƒ¼åé€£ç•ªã€‘
â–¡ èµ·å‹•æ™‚: ã€ŒèƒŒæ™¯ã€ã€Œãƒ¬ã‚¤ãƒ¤ãƒ¼1ã€
â–¡ ãƒ¬ã‚¤ãƒ¤ãƒ¼è¿½åŠ : ã€Œãƒ¬ã‚¤ãƒ¤ãƒ¼2ã€ã€Œãƒ¬ã‚¤ãƒ¤ãƒ¼3ã€...
â–¡ ãƒ¬ã‚¤ãƒ¤ãƒ¼å‰Šé™¤å¾Œã‚‚é€£ç•ªç¶™ç¶š

ã€Phase 5: èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ä»•æ§˜ã€‘
â–¡ èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ãƒã‚±ãƒ„ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤ºï¼ˆç›®ã‚¢ã‚¤ã‚³ãƒ³ã®å³ï¼‰
â–¡ ãƒã‚±ãƒ„ã‚¢ã‚¤ã‚³ãƒ³ã‚¯ãƒªãƒƒã‚¯ â†’ ç¾åœ¨ã®ãƒšãƒ³ã‚«ãƒ©ãƒ¼ã§å¡—ã‚Šã¤ã¶ã—
â–¡ èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®é€æ˜åº¦è¡¨ç¤ºãªã—
â–¡ èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‰Šé™¤ãƒœã‚¿ãƒ³ãªã—
â–¡ èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ‰ãƒ©ãƒƒã‚°ç§»å‹•ç„¡åŠ¹
â–¡ èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ›ãƒãƒ¼æ¼”å‡ºç„¡åŠ¹

ã€Phase 6: ãƒ¬ã‚¤ãƒ¤ãƒ¼é€æ˜åº¦UIã€‘
â–¡ ä¸€èˆ¬ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã€Œâ—€ 100% â–¶ã€è¡¨ç¤ºï¼ˆä¸Šæ®µï¼‰
â–¡ ãƒ¬ã‚¤ãƒ¤ãƒ¼åã¯ä¸‹æ®µå·¦å¯„ã›
â–¡ â—€ãƒœã‚¿ãƒ³ã§-10%
â–¡ â–¶ãƒœã‚¿ãƒ³ã§+10%
â–¡ ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆè¡¨ç¤ºã®ä¸Šã§ãƒ‰ãƒ©ãƒƒã‚°ã§é€æ˜åº¦å¤‰æ›´
â–¡ 0%ï½100%ã®ç¯„å›²åˆ¶é™

ã€Phase 7: ãƒ‰ãƒ©ãƒƒã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ”¹å–„ã€‘
â–¡ ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ãƒ©ãƒƒã‚°ã§ã‚«ãƒ¼ã‚½ãƒ«ã«è¿½å¾“
â–¡ ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ã‚´ãƒ¼ã‚¹ãƒˆè¡¨ç¤ºãŒæ˜ç¢º
â–¡ èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ãƒ‰ãƒ©ãƒƒã‚°ä¸å¯
â–¡ èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸ã®æŒ¿å…¥ä¸å¯
â–¡ ãƒ‰ãƒ­ãƒƒãƒ—å¾Œã®éšå±¤å¤‰æ›´ãŒæ­£å¸¸

ã€Phase 8: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–/æº–ã‚¢ã‚¯ãƒ†ã‚£ãƒ–UIã€‘
â–¡ ãƒ¬ã‚¤ãƒ¤ãƒ¼é¸æŠ â†’ ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«æ©™è‰²ï¼ˆ#ff8c42ï¼‰
â–¡ ãã®å¾Œã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³é¸æŠ â†’ ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«æº–ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è‰²ï¼ˆ#aa5a56ï¼‰
â–¡ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³é¸æŠ â†’ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æ©™è‰²
â–¡ ãã®å¾Œãƒ¬ã‚¤ãƒ¤ãƒ¼é¸æŠ â†’ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æº–ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è‰²
â–¡ ã‚³ãƒ”ãƒ¼/ãƒšãƒ¼ã‚¹ãƒˆæ™‚ã«å¯¾è±¡ãŒæ˜ç¢º


================================================================================
â–  ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰ãƒ»ã‚·ãƒ³ãƒœãƒ«è¾å…¸
================================================================================

ã€layer-panel-renderer.jsã€‘
- constructor(container, layerSystem, eventBus)
  åˆæœŸåŒ–ã€ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
  
- _setupEventListeners()
  EventBusè³¼èª­è¨­å®šï¼ˆlayer:created, opacity-changedç­‰ï¼‰
  
- requestUpdate()
  16msé…å»¶ã§å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°è¦æ±‚
  
- render(layers, activeIndex, animationSystem)
  å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«å†æç”»ï¼ˆé€†é †ã§è¡¨ç¤ºï¼‰
  
- createLayerElement(layer, index, isActive, animationSystem)
  â˜…â˜…â˜… ãƒ¡ã‚¤ãƒ³ã®ä¿®æ­£å¯¾è±¡ â˜…â˜…â˜…
  å€‹åˆ¥ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«ã®ç”Ÿæˆ
  
- createThumbnail(layer, index)
  ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒç”Ÿæˆ
  
- _setupOpacityDrag(element, layerIndex)
  é€æ˜åº¦ãƒ‰ãƒ©ãƒƒã‚°å‡¦ç†
  
- _adjustLayerOpacity(layerIndex, delta)
  é€æ˜åº¦èª¿æ•´ï¼ˆÂ±0.1ï¼‰
  
- _setLayerOpacity(layerIndex, opacity)
  é€æ˜åº¦è¨­å®š + LayerSystemé€£æº
  
- _updatePanelActiveState(isActive)
  ã‚¢ã‚¯ãƒ†ã‚£ãƒ–/æº–ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è‰²åˆ‡ã‚Šæ›¿ãˆ
  
- initializeSortable()
  Sortable.jsåˆæœŸåŒ–ï¼ˆãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ï¼‰

ã€layer-system.jsã€‘
- createLayer(name, isBackground)
  æ–°è¦ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆï¼ˆé€£ç•ªè‡ªå‹•ä»˜ä¸ï¼‰
  
- changeBackgroundLayerColor(layerIndex, layerId)
  èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼è‰²å¤‰æ›´
  
- setLayerOpacity(layerIndex, opacity)
  ãƒ¬ã‚¤ãƒ¤ãƒ¼é€æ˜åº¦è¨­å®š
  
- toggleLayerVisibility(layerIndex)
  ãƒ¬ã‚¤ãƒ¤ãƒ¼è¡¨ç¤º/éè¡¨ç¤º + ãƒã‚§ãƒƒã‚«ãƒ¼é€£å‹•
  
- _createCheckerPatternBackground(width, height)
  ãƒã‚§ãƒƒã‚«ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆï¼ˆ16pxã‚°ãƒªãƒƒãƒ‰ï¼‰
  
- _resizeCheckerPattern(newWidth, newHeight)
  ãƒã‚§ãƒƒã‚«ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒªã‚µã‚¤ã‚º
  
- attachCheckerPatternToWorld(canvasContainer)
  ãƒã‚§ãƒƒã‚«ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é…ç½®

ã€state-manager.jsã€‘
- setLastActivePanel(panel)
  ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ‘ãƒãƒ«è¨­å®šï¼ˆ'layer' | 'timeline'ï¼‰
  
- getLastActivePanel()
  ç¾åœ¨ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ‘ãƒãƒ«å–å¾—

ã€main.cssã€‘
- .layer-item (L181-L203)
  ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ«
  
- .layer-item ã‚°ãƒªãƒƒãƒ‰å®šç¾© (L1044-L1093)
  ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨­å®š
  
- .layer-item.active (L270-L276)
  ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ©™è‰²ãƒœãƒ¼ãƒ€ãƒ¼
  
- .layer-item.background-layer (L1065-L1075)
  èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ‰ãƒ©ãƒƒã‚°ç„¡åŠ¹åŒ–
  
- .sortable-ghost/drag/chosen (L1025-L1042)
  Sortable.jsãƒ‰ãƒ©ãƒƒã‚°ã‚¹ã‚¿ã‚¤ãƒ«


================================================================================
â–  æ”¹ä¿®æ™‚ã®æ³¨æ„äº‹é …
================================================================================

ã€é‡è¦åŸå‰‡ã€‘
1. ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä½¿ã‚ãªã„
   â†’ CSSã‚¯ãƒ©ã‚¹ã®ã¿ã§åˆ¶å¾¡

2. ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å°Šé‡
   â†’ display: flex ã‚’æŒ‡å®šã—ãªã„
   â†’ grid-column/grid-row ã¯CSSã«ä»»ã›ã‚‹

3. ã‚¤ãƒ™ãƒ³ãƒˆä¼æ’­ã‚’åˆ¶å¾¡
   â†’ e.stopPropagation()ã‚’é©åˆ‡ã«é…ç½®
   â†’ ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®å„ªå…ˆé †ä½ã‚’æ˜ç¢ºåŒ–

4. èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¤å®šã®çµ±ä¸€
   â†’ layer.layerData?.isBackground ã§åˆ¤å®š
   â†’ CSSã‚¯ãƒ©ã‚¹ .background-layer ã‚’ä»˜ä¸

5. EventBusã‚¤ãƒ™ãƒ³ãƒˆã®ç¢ºå®Ÿãªç™ºç«
   â†’ ã‚¤ãƒ™ãƒ³ãƒˆåã®çµ±ä¸€ï¼ˆui:background-color-change-requestedç­‰ï¼‰
   â†’ ãƒ‡ãƒ¼ã‚¿å½¢å¼ã®çµ±ä¸€ï¼ˆ{layerIndex, layerId}ï¼‰


================================================================================
â–  ãƒ‡ãƒãƒƒã‚°æ–¹æ³•ãƒ»ç¢ºèªæ‰‹é †
================================================================================

ã€Phase 5&6: UIãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç¢ºèªã€‘
1. é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«ã®è¦ç´ ã‚’æ¤œæŸ»
2. .layer-itemã®displayãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç¢ºèª
   â†’ "grid" ã§ã‚ã‚‹ã“ã¨ï¼ˆ"flex"ã§ã¯ãªã„ï¼‰
3. å­è¦ç´ ã®grid-column/grid-rowã‚’ç¢ºèª
   â†’ CSSã®å®šç¾©ã¨ä¸€è‡´ã™ã‚‹ã“ã¨
4. ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ãŒãªã„ã“ã¨ã‚’ç¢ºèª

ã€Phase 7: ãƒ‰ãƒ©ãƒƒã‚°å‹•ä½œç¢ºèªã€‘
1. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§Sortableã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç¢ºèª
   â†’ window.layerPanelRenderer?.sortable
2. èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã§ããªã„ã“ã¨ã‚’ç¢ºèª
3. ä¸€èˆ¬ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ‰ãƒ©ãƒƒã‚°ãŒã‚¹ãƒ ãƒ¼ã‚ºã‹ç¢ºèª
4. ãƒ‰ãƒ­ãƒƒãƒ—å¾Œã«reorderLayers()ãŒå‘¼ã°ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
   â†’ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã§è¿½è·¡

ã€Phase 8: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ç¢ºèªã€‘
1. window.stateManager.getLastActivePanel()ã§ç¢ºèª
2. ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¯ãƒªãƒƒã‚¯å¾Œ â†’ 'layer'
3. ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚¯ãƒªãƒƒã‚¯å¾Œ â†’ 'timeline'
4. EventBusã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã‚’ç¢ºèª
   â†’ window.TegakiEventBus.emit()ã®ãƒ­ã‚°


================================================================================
â–  æ”¹ä¿®å¾Œã®æœŸå¾…å‹•ä½œ
================================================================================

ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«ã®å¤–è¦³ã€‘
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘ â—€ 100% â–¶  ãƒ¬ã‚¤ãƒ¤ãƒ¼1  [IMG] âœ•    â”‚ â† æ©™è‰²ãƒœãƒ¼ãƒ€ãƒ¼ï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘ ğŸª£         èƒŒæ™¯       [IMG]      â”‚ â† è–„èŒ¶è‰²èƒŒæ™¯ï¼ˆ#f0e0d6ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ã€æ“ä½œãƒ•ãƒ­ãƒ¼ä¾‹1: èƒŒæ™¯è‰²å¤‰æ›´ã€‘
1. ğŸª£ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. EventBus.emit('ui:background-color-change-requested')
3. layer-system.js: changeBackgroundLayerColor()
4. ç¾åœ¨ã®ãƒšãƒ³ã‚«ãƒ©ãƒ¼ã§èƒŒæ™¯ã‚’å¡—ã‚Šã¤ã¶ã—
5. ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°

ã€æ“ä½œãƒ•ãƒ­ãƒ¼ä¾‹2: ãƒ¬ã‚¤ãƒ¤ãƒ¼é€æ˜åº¦å¤‰æ›´ã€‘
1. ã€Œâ—€ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. _adjustLayerOpacity(index, -0.1)
3. layer-system.js: setLayerOpacity()
4. layer.alpha = 0.9ã«å¤‰æ›´
5. è¡¨ç¤ºãŒã€Œ90%ã€ã«æ›´æ–°

ã€æ“ä½œãƒ•ãƒ­ãƒ¼ä¾‹3: ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ãƒ©ãƒƒã‚°ã€‘
1. ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã‚’ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹
2. Sortable.onStart â†’ cursor: grabbing
3. ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®ä¸Šã«ç§»å‹•
4. Sortable.onEnd â†’ reorderLayers(1, 2)
5. ãƒ¬ã‚¤ãƒ¤ãƒ¼é †åºãŒå…¥ã‚Œæ›¿ã‚ã‚‹

ã€æ“ä½œãƒ•ãƒ­ãƒ¼ä¾‹4: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åˆ‡ã‚Šæ›¿ãˆã€‘
1. ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã‚’ã‚¯ãƒªãƒƒã‚¯
2. stateManager.setLastActivePanel('layer')
3. EventBus.emit('ui:active-panel-changed', {activePanel: 'layer'})
4. ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«ã®ãƒœãƒ¼ãƒ€ãƒ¼ãŒæ©™è‰²ï¼ˆ#ff8c42ï¼‰
5. ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ã‚¯ãƒªãƒƒã‚¯
6. stateManager.setLastActivePanel('timeline')
7. EventBus.emit('ui:active-panel-changed', {activePanel: 'timeline'})
8. ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«ã®ãƒœãƒ¼ãƒ€ãƒ¼ãŒæº–ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è‰²ï¼ˆ#aa5a56ï¼‰


================================================================================
â–  ã‚ˆãã‚ã‚‹å®Ÿè£…ãƒŸã‚¹ãƒ»æ³¨æ„ç‚¹
================================================================================

ã€ãƒŸã‚¹1: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã§CSSã‚’ä¸Šæ›¸ãã€‘
âŒ layerDiv.style.display = 'flex';
âœ… layerDiv.className = 'layer-item'; ï¼ˆCSSã§ display: grid å®šç¾©ï¼‰

ã€ãƒŸã‚¹2: grid-columnã‚’JSã§æŒ‡å®šã€‘
âŒ element.style.gridColumn = '2';
âœ… element.className = 'layer-opacity-control'; ï¼ˆCSSã§å®šç¾©ï¼‰

ã€ãƒŸã‚¹3: ã‚¤ãƒ™ãƒ³ãƒˆä¼æ’­ã®åˆ¶å¾¡å¿˜ã‚Œã€‘
âŒ deleteBtn.addEventListener('click', () => { ... });
âœ… deleteBtn.addEventListener('click', (e) => { 
    e.stopPropagation(); 
    ... 
});

ã€ãƒŸã‚¹4: èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¤å®šã®ä¸çµ±ä¸€ã€‘
âŒ if (layer.layerData?.name === 'èƒŒæ™¯')
âœ… if (layer.layerData?.isBackground)

ã€ãƒŸã‚¹5: EventBusã‚¤ãƒ™ãƒ³ãƒˆåã®ä¸ä¸€è‡´ã€‘
âŒ this.eventBus.emit('background-color-change', ...)
âœ… this.eventBus.emit('ui:background-color-change-requested', ...)

ã€ãƒŸã‚¹6: Sortable filterã®èª¤è¨­å®šã€‘
âŒ filter: (evt) => { return evt.target... }
âœ… filter: '.background-layer'


================================================================================
â–  æ®µéšçš„ãƒ†ã‚¹ãƒˆè¨ˆç”»
================================================================================

ã€ã‚¹ãƒ†ãƒƒãƒ—1: Phase 5&6 UIæ§‹é€ ç¢ºèªã€‘
1. layer-panel-renderer.jsã‚’ä¿®æ­£
2. ãƒ–ãƒ©ã‚¦ã‚¶ãƒªãƒ­ãƒ¼ãƒ‰
3. é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§.layer-itemã‚’æ¤œæŸ»
4. display: grid ã‚’ç¢ºèª
5. ã‚°ãƒªãƒƒãƒ‰é…ç½®ã‚’è¦–è¦šçš„ã«ç¢ºèª

ã€ã‚¹ãƒ†ãƒƒãƒ—2: Phase 5 èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼æ©Ÿèƒ½ç¢ºèªã€‘
1. ğŸª£ã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
2. ãƒšãƒ³ãƒ„ãƒ¼ãƒ«ã§è‰²ã‚’å¤‰æ›´
3. ğŸª£ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
4. èƒŒæ™¯è‰²ãŒå¤‰æ›´ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
5. ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ã‚’ç¢ºèª

ã€ã‚¹ãƒ†ãƒƒãƒ—3: Phase 6 é€æ˜åº¦UIç¢ºèªã€‘
1. ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã§ã€Œâ—€ 100% â–¶ã€è¡¨ç¤ºç¢ºèª
2. â—€ãƒœã‚¿ãƒ³ã§é€æ˜åº¦æ¸›å°‘ç¢ºèª
3. â–¶ãƒœã‚¿ãƒ³ã§é€æ˜åº¦å¢—åŠ ç¢ºèª
4. ãƒ‰ãƒ©ãƒƒã‚°ã§é€æ˜åº¦å¤‰æ›´ç¢ºèª
5. 0%/100%ã§ç¯„å›²åˆ¶é™ç¢ºèª

ã€ã‚¹ãƒ†ãƒƒãƒ—4: Phase 7 ãƒ‰ãƒ©ãƒƒã‚°ç¢ºèªã€‘
1. ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã‚’ãƒ‰ãƒ©ãƒƒã‚°
2. ã‚«ãƒ¼ã‚½ãƒ«ãŒgrabbingè¡¨ç¤ºç¢ºèª
3. ã‚´ãƒ¼ã‚¹ãƒˆè¡¨ç¤ºç¢ºèª
4. ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã¨ãƒ‰ãƒ­ãƒƒãƒ—ã§å…¥ã‚Œæ›¿ãˆç¢ºèª
5. èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒãƒ‰ãƒ©ãƒƒã‚°ã§ããªã„ã“ã¨ã‚’ç¢ºèª

ã€ã‚¹ãƒ†ãƒƒãƒ—5: Phase 8 ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ç¢ºèªã€‘
1. ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ãƒœãƒ¼ãƒ€ãƒ¼ãŒæ©™è‰²ï¼ˆ#ff8c42ï¼‰ç¢ºèª
3. ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«ã®ãƒœãƒ¼ãƒ€ãƒ¼ãŒ#aa5a56ç¢ºèª
5. window.stateManager.getLastActivePanel()ã§'timeline'ç¢ºèª

ã€ã‚¹ãƒ†ãƒƒãƒ—6: Phase 2 ãƒã‚§ãƒƒã‚«ãƒ¼ç¢ºèªã€‘
1. èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ğŸ‘ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼ˆéè¡¨ç¤ºï¼‰
2. ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³è¡¨ç¤ºç¢ºèª
3. è‰²ãŒ#f0e0d6ã¨#ffffeeã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
4. ãƒªã‚µã‚¤ã‚ºãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã§ã‚­ãƒ£ãƒ³ãƒã‚¹ãƒªã‚µã‚¤ã‚º
5. ãƒã‚§ãƒƒã‚«ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå†ç”Ÿæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª


================================================================================
â–  ç·Šæ€¥åº¦ãƒ»å„ªå…ˆåº¦ãƒãƒˆãƒªã‚¯ã‚¹
================================================================================

ã€ç·Šæ€¥åº¦Sï¼ˆå³å¯¾å¿œå¿…é ˆï¼‰ã€‘
- Phase 5&6: layer-panel-renderer.js createLayerElement()ä¿®æ­£
  ç†ç”±: å…¨UIãŒæ©Ÿèƒ½ã—ã¦ã„ãªã„æ ¹æœ¬åŸå› 

ã€ç·Šæ€¥åº¦Aï¼ˆé‡è¦ï¼‰ã€‘
- Phase 7: initializeSortable()ä¿®æ­£
  ç†ç”±: ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ãŒä¸å®‰å®š

ã€ç·Šæ€¥åº¦Bï¼ˆæ”¹å–„ï¼‰ã€‘
- Phase 8: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹UI
  ç†ç”±: å‹•ä½œã«ã¯å½±éŸ¿ã—ãªã„ãŒã€UXãŒå‘ä¸Š

ã€ç·Šæ€¥åº¦Cï¼ˆæ‹¡å¼µï¼‰ã€‘
- Phase 2: ãƒã‚§ãƒƒã‚«ãƒ¼ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ
  ç†ç”±: åŸºæœ¬æ©Ÿèƒ½ã¯å‹•ä½œã—ã¦ã„ã‚‹


================================================================================
â–  ãƒ•ã‚¡ã‚¤ãƒ«ä¾å­˜é–¢ä¿‚å›³
================================================================================

```
index.html
  â†“
core-initializer.js
  â†“
  â”œâ”€ core-engine.js (CoreEngine)
  â”‚   â”œâ”€ camera-system.js (CameraSystem)
  â”‚   â”‚   â””â”€ EventBus.emit('camera:resized')
  â”‚   â”œâ”€ layer-system.js (LayerSystem)
  â”‚   â”‚   â”œâ”€ _createCheckerPatternBackground()
  â”‚   â”‚   â”œâ”€ changeBackgroundLayerColor()
  â”‚   â”‚   â”œâ”€ setLayerOpacity()
  â”‚   â”‚   â””â”€ EventBus.on('camera:resized')
  â”‚   â””â”€ drawing-engine.js
  â”‚
  â”œâ”€ initializeLayerPanel()
  â”‚   â””â”€ layer-panel-renderer.js (LayerPanelRenderer)
  â”‚       â”œâ”€ createLayerElement() â˜…ä¿®æ­£å¯¾è±¡â˜…
  â”‚       â”œâ”€ initializeSortable() â˜…ä¿®æ­£å¯¾è±¡â˜…
  â”‚       â””â”€ _updatePanelActiveState() â˜…ç¢ºèªå¯¾è±¡â˜…
  â”‚
  â”œâ”€ state-manager.js (StateManager)
  â”‚   â””â”€ setLastActivePanel() â˜…ç¢ºèªå¯¾è±¡â˜…
  â”‚
  â””â”€ main.css
      â”œâ”€ .layer-item ã‚°ãƒªãƒƒãƒ‰å®šç¾©
      â”œâ”€ .background-layer ã‚¹ã‚¿ã‚¤ãƒ«
      â””â”€ .sortable-* ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ã‚¿ã‚¤ãƒ«
```


================================================================================
â–  æ”¹ä¿®å®Œäº†å¾Œã®æˆæœç‰©ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
================================================================================

ã€æå‡ºãƒ•ã‚¡ã‚¤ãƒ«ã€‘
â–¡ ui/layer-panel-renderer.js ï¼ˆå®Œå…¨ç‰ˆï¼‰
  - createLayerElement()å®Œå…¨æ›¸ãæ›ãˆ
  - initializeSortable()ä¿®æ­£
  - _updatePanelActiveState()ç¢ºèª

â–¡ system/layer-system.js ï¼ˆPhase 2å¯¾å¿œç‰ˆï¼‰
  - _resizeCheckerPattern()æ”¹å–„

â–¡ ui/timeline-ui.js ï¼ˆPhase 8å¯¾å¿œç‰ˆï¼‰
  - setLastActivePanel('timeline')è¿½åŠ 

ã€å‹•ä½œç¢ºèªé …ç›®ã€‘
â–¡ ğŸ“·ï¸ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«å®Ÿè£…äºˆå®šå›³.pngã¨åŒã˜UIè¡¨ç¤º
â–¡ èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒã‚±ãƒ„ã‚¢ã‚¤ã‚³ãƒ³æ©Ÿèƒ½
â–¡ ä¸€èˆ¬ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®é€æ˜åº¦UIã€Œâ—€ 100% â–¶ã€
â–¡ ãƒ¬ã‚¤ãƒ¤ãƒ¼åå·¦å¯„ã›è¡¨ç¤º
â–¡ ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã‚¹ãƒ ãƒ¼ã‚ºå‹•ä½œ
â–¡ èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ãƒ©ãƒƒã‚°ç¦æ­¢
â–¡ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–/æº–ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è‰²åˆ‡ã‚Šæ›¿ãˆ
â–¡ ãƒã‚§ãƒƒã‚«ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ

ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€‘
â–¡ æ”¹ä¿®å®Œäº†å ±å‘Šï¼ˆPhaseåˆ¥ï¼‰
â–¡ ãƒ†ã‚¹ãƒˆçµæœãƒ¬ãƒãƒ¼ãƒˆ
â–¡ æ—¢çŸ¥ã®å•é¡Œãƒ»åˆ¶é™äº‹é …


================================================================================
END - æ”¹ä¿®ã‚’é–‹å§‹ã—ã¦ãã ã•ã„
================================================================================