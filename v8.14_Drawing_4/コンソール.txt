config.js:519 âœ… config.js v8.14.1 Phase 1 loaded
config.js:520    âœ… PerfectFreehandè¨­å®šè¿½åŠ 
config.js:521    âœ“ ãƒãƒªã‚´ãƒ³ç”Ÿæˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å®šç¾©
 âœ… data-models.js (backgroundColorè¿½åŠ ç‰ˆ) loaded
 âœ… batch-api.js (Phase 6: Historyçµ±åˆç‰ˆ) loaded
 âœ… popup-manager.js (quick-accessé™¤å¤–å¯¾å¿œç‰ˆ) loaded
 âœ… state-manager.js (Phase 8å®Œå…¨å®Ÿè£…ç‰ˆ) loaded
 âœ… settings-manager.js Phase 2 loaded
    ğŸ”§ exportResolution è¨­å®šé …ç›®è¿½åŠ 
 âœ… layer-transform.js Phase 6 loaded
    ğŸ”§ flipLayer(): confirmTransform()å‰Šé™¤ - åè»¢æ™‚ã®ç”»åƒæ¶ˆå¤±ã‚’è§£æ±º
 âœ… system/checker-utils.js çµ±ä¸€å®Ÿè£…ç‰ˆ loaded
 âœ… layer-system.js Phase 7å®Œæˆç‰ˆ loaded
    ğŸš¨ addPathToActiveLayer(): Historyç™»éŒ²ã‚’å‰Šé™¤
    ğŸš¨ brush-core.js ã«Historyç™»éŒ²ã‚’çµ±ä¸€
    âœ… DRYåŸå‰‡ã«åŸºã¥ãè²¬å‹™åˆ†æ‹…ã®æ˜ç¢ºåŒ–
 âœ… drawing-clipboard.js Phase 1 loaded
    ğŸ”§ cutActiveLayer(): æç”»ã®ã¿å‰Šé™¤ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼ä¿æŒï¼‰
    ğŸ¨ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—: ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚³ãƒ”ãƒ¼ã€åˆ‡ã‚Šå–ã‚Š
 âœ… history.js (Phase 3: Redo nullå‚ç…§ä¿®æ­£ç‰ˆ) loaded
 âœ… system/drawing/webgpu/webgpu-capabilities.js loaded
 âœ… webgpu-compute-sdf.js (Phase 1é–‰é ˜åŸŸæ¤œå‡ºä¿®æ­£ç‰ˆ) loaded
 âœ… webgpu-mask-layer.js (Phase 2 GPUå®Œå…¨ç‰ˆ) loaded
    âœ“ GPU Compute Shaderã§ãƒãƒªã‚´ãƒ³ãƒ©ã‚¹ã‚¿ãƒ©ã‚¤ã‚º
    âœ“ ãƒã‚¹ã‚¯åŠ ç®—/æ¸›ç®—
    âœ“ CPUç‰ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯¾å¿œ
 âœ… system/drawing/msdf/msdf-brush-shader.js loaded
 âœ… pointer-handler.js (Phase 2: ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯è¿½åŠ ç‰ˆ) loaded
    âœ“ pointerType="mouse" with pressure/tilt â†’ auto-corrects to "pen"
 âœ… pressure-handler.js (Phase 4: ã‚°ãƒ­ãƒ¼ãƒãƒ«å…¬é–‹ç‰ˆ) loaded
    âœ“ è·é›¢ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿å¯¾å¿œ
    âœ“ window.PressureHandler ã¨ã—ã¦å…¬é–‹
 âœ… stroke-recorder.js (Phase 1) loaded
    âœ“ PerfectFreehandçµ±åˆ
    âœ“ ãƒãƒªã‚´ãƒ³ç”Ÿæˆå¯¾å¿œ
    âœ“ å¾Œæ–¹äº’æ›æ€§ç¶­æŒ
 âœ… [PolygonGenerator] PerfectFreehand initialized
 âœ… polygon-generator.js Phase 1å®Œå…¨ä¿®æ­£ç‰ˆ loaded
    âœ“ PerfectFreehandæ­£ã—ã„å‚ç…§
    âœ“ ãƒªãƒ‹ã‚¢è¨­å®šæœ€é©åŒ–
    âœ“ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‰Šé™¤
 âœ… stroke-recorder.js (Phase 1) loaded
    âœ“ PerfectFreehandçµ±åˆ
    âœ“ ãƒãƒªã‚´ãƒ³ç”Ÿæˆå¯¾å¿œ
    âœ“ å¾Œæ–¹äº’æ›æ€§ç¶­æŒ
 âœ… sdf-brush-shader.js (Phase 1-FIX: ãƒšãƒ³å°‚ç”¨) loaded
    âœ“ æ¶ˆã—ã‚´ãƒ ãƒ¢ãƒ¼ãƒ‰å‰Šé™¤
    âœ“ ãƒšãƒ³æç”»ã«ç‰¹åŒ–
 âœ… stroke-renderer.js (Phase 3 çµ±åˆç‰ˆ) loaded
    âœ… ãƒšãƒ³/æ¶ˆã—ã‚´ãƒ ãƒã‚¹ã‚¯çµ±åˆ
    âœ… blendModeå®Œå…¨æ’é™¤
    âŒ Legacyæç”»å‰Šé™¤
 âœ… thumbnail-system.js (v1.1: çµ±ä¸€ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”å¯¾å¿œ) loaded
brush-settings.js:222 âœ… brush-settings.js (Phase 3-D Clean) loaded
brush-core.js:383 âœ… brush-core.js Phase 7-FIX loaded
brush-core.js:384    ğŸš¨ pathsDataé…åˆ—ä¸ä½¿ç”¨ã€graphicså‚ç…§ã®ã¿ã§ç®¡ç†
brush-core.js:385    ğŸš¨ undoæ™‚ã®è¤‡æ•°å‰Šé™¤å•é¡Œã‚’è§£æ±º
brush-core.js:386    âœ… 1ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ = 1 History entry
fill-tool.js:334 âœ… fill-tool.js (Phase 1å®Œå…¨ä¿®æ­£ç‰ˆ) loaded
drawing-engine.js:244 âœ… drawing-engine.js (Phase 4 - Fillå¯¾å¿œç‰ˆ) loaded
drawing-engine.js:245    âœ“ fill ãƒ¢ãƒ¼ãƒ‰æ™‚ã« canvas:pointerdown ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ
drawing-engine.js:246    âœ“ localX/localY ã‚’å«ã‚€ã‚¤ãƒ™ãƒ³ãƒˆãƒšã‚¤ãƒ­ãƒ¼ãƒ‰
quick-export-ui.js:292 âœ… quick-export-ui.js (ç„¡åŠ¹åŒ–ç‰ˆ) loaded
export-manager.js:531 âœ… export-manager.js v8.33.0 loaded
export-manager.js:532    ğŸ”§ PNGâ†’APNGç¶­æŒ / WEBPâ†’WebMè‡ªå‹•åˆ‡æ›¿å¯¾å¿œ
png-exporter.js:255 âœ… png-exporter.js v8.29.0 loaded
png-exporter.js:256    ğŸ”§ generatePreview()ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ 
png-exporter.js:257    ğŸ”§ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–
png-exporter.js:258    ğŸ”§ Blobç”Ÿæˆã®ç¢ºå®Ÿæ€§å‘ä¸Š
webp-exporter.js:249 âœ… webp-exporter.js v8.33.0 loaded (é™æ­¢ç”»WEBPå°‚ç”¨)
webp-exporter.js:250    âš ï¸ è¤‡æ•°ãƒ•ãƒ¬ãƒ¼ãƒ æ™‚ã¯WebMæ¨å¥¨ï¼ˆã‚¢ãƒ«ãƒ•ã‚¡å€¤ç¶­æŒãƒ»è»½é‡ï¼‰
psd-exporter.js:170 âœ… psd-exporter.js v8.18.0 loaded (Phase 5: ãƒœã‚¿ãƒ³é…ç½®ç”¨)
psd-exporter.js:171    âš ï¸ å®Ÿè£…ã¯å°†æ¥ãƒ•ã‚§ãƒ¼ã‚ºã§è¿½åŠ äºˆå®š
psd-exporter.js:172    âœ“ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§é–‹ç™ºä¸­ã‚’é€šçŸ¥
apng-exporter.js:281 âœ… apng-exporter.js v8.31.0 loaded
mp4-exporter.js:30 âœ… mp4-exporter.js (Phase 8å®Œæˆç‰ˆ) loaded
dom-builder.js:527 âœ… dom-builder.js v8.19.0 loaded
dom-builder.js:528    ğŸ”§ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³: PNG/WEBP/PSDï¼ˆGIF/PDFå‰Šé™¤ï¼‰
dom-builder.js:529    âœ“ Systemæƒ…å ±è¡¨ç¤ºï¼ˆWebGPU/GPUæ¤œå‡ºï¼‰
slider-utils.js:234 âœ… slider-utils.js v8.13.10 loaded
slider-utils.js:235    ğŸ”§ PointerEventå®Œå…¨å¯¾å¿œï¼ˆã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒšãƒ³å¼•ã£ã‹ã‹ã‚Šè§£æ¶ˆï¼‰
slider-utils.js:236    ğŸ”§ æ…£æ€§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å®Ÿè£…ï¼ˆvelocityè¨ˆç®—ï¼‰
slider-utils.js:237    ğŸ”§ requestAnimationFrameæœ€é©åŒ–
keyboard-handler.js:486 âœ… keyboard-handler.js Phase 6å®Œæˆç‰ˆ loaded
keyboard-handler.js:487    âœ… BS/DEL: æç”»å‰Šé™¤ãŒæ­£å¸¸å‹•ä½œ
keyboard-handler.js:488    âœ… Undo/Redo: childrenå‚ç…§ä¿æŒã§å®Œå…¨å¾©å…ƒ
keyboard-handler.js:489    ğŸ”§ åè»¢å‡¦ç†: ç”»åƒæ¶ˆå¤±å•é¡Œè§£æ±º
layer-panel-renderer.js:663 âœ… layer-panel-renderer.js (Phase 5+6å¯¾å¿œç‰ˆ) loaded
layer-panel-renderer.js:664    âœ“ layer:panel-update-requested ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¿½åŠ 
layer-panel-renderer.js:665    âœ“ LayerSystemã‹ã‚‰ã®ç›´æ¥å‘¼ã³å‡ºã—å®Œå…¨æ’é™¤
status-display-renderer.js:317 âœ… ui/status-display-renderer.js å®Œå…¨æ”¹ä¿®ç‰ˆ loaded
timeline-thumbnail-utils.js:258 âœ… ui/timeline-thumbnail-utils.js (Phase 3å®Œå…¨ç‰ˆ) loaded
timeline-thumbnail-utils.js:259    âœ“ Phase 1: layer:transform-updated è³¼èª­è¿½åŠ 
timeline-thumbnail-utils.js:260    âœ“ Phase 3: throttleæœ€é©åŒ–ï¼ˆ100msï¼‰
timeline-thumbnail-utils.js:261    âœ“ Phase 3: immediate ãƒ•ãƒ©ã‚°å¯¾å¿œ
timeline-thumbnail-utils.js:262    âœ“ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚µãƒ ãƒã‚¤ãƒ«ãŒãƒ¬ã‚¤ãƒ¤ãƒ¼å¤‰å½¢ã«å³åº§è¿½å¾“
timeline-ui.js:981 âœ… timeline-ui.js (Phase 4å®Œäº†: ãƒ¬ã‚¤ãƒ¤ãƒ¼å¤‰å½¢é€£æºç‰ˆ) loaded
album-popup.js:473 âœ… album-popup.js (FRAMEæ”¹ä¿®ç‰ˆ) loaded
settings-popup.js:649 âœ… settings-popup.js Phase 1 loaded
settings-popup.js:650    ğŸ”§ ui:open-settings ãƒªã‚¹ãƒŠãƒ¼è¿½åŠ ï¼ˆCtrl+, å¯¾å¿œï¼‰
quick-access-popup.js:740 âœ… quick-access-popup.js v8.13.17 loaded
export-popup.js:557 âœ… export-popup.js v8.29.0 loaded
export-popup.js:558    ğŸ”§ PNGâ†’APNGç¶­æŒ / WEBPâ†’WebMè‡ªå‹•åˆ‡æ›¿UIå¯¾å¿œ
ui-panels.js:420 âœ… ui-panels.js v8.13.15 loaded
ui-panels.js:421    ğŸ¨ ã‚µã‚¤ãƒ‰ãƒãƒ¼è»½é‡ãƒ‡ã‚¶ã‚¤ãƒ³: ã‚ªãƒ¬ãƒ³ã‚¸æ ã®ã¿
ui-panels.js:422    ğŸ¯ SVGè‰²çµ±ä¸€: å¸¸ã«var(--futaba-maroon)
core-runtime.js:570 âœ… core-runtime.js (Phase 4 - Fillå¯¾å¿œç‰ˆ) loaded
core-runtime.js:571    âœ“ api.tool.setFill() è¿½åŠ 
core-runtime.js:572    âœ“ api.tool.set("fill") ã‚µãƒãƒ¼ãƒˆ
core-engine.js:706 âœ… core-engine.js v8.32.0 loaded
core-initializer.js:437 âœ… core-initializer.js (Phase 2æ”¹ä¿®ç‰ˆ - ExportManageråˆæœŸåŒ–ä¸€å…ƒåŒ–) loaded
popup-manager.js:16 âœ… PopupManager initialized
popup-manager.js:42 ğŸ“‹ Popup "settings" registered (priority: 1)
popup-manager.js:42 ğŸ“‹ Popup "quickAccess" registered (priority: 2)
popup-manager.js:42 ğŸ“‹ Popup "album" registered (priority: 3)
popup-manager.js:42 ğŸ“‹ Popup "resize" registered (priority: 4)
popup-manager.js:102 ğŸ”§ Initializing all popups...
popup-manager.js:87 âœ… Popup "settings" initialized successfully
popup-manager.js:87 âœ… Popup "quickAccess" initialized successfully
popup-manager.js:87 âœ… Popup "album" initialized successfully
popup-manager.js:87 âœ… Popup "resize" initialized successfully
popup-manager.js:118 ğŸ“Š Popup initialization: 4 ready, 0 deferred
index.html:117 âœ… Application initialized (Phase 4-B: MSDFå®Œå…¨çµ±åˆç‰ˆ)
popup-manager.js:42 ğŸ“‹ Popup "export" registered (priority: 5)
popup-manager.js:87 âœ… Popup "export" initialized successfully
/**
 * ================================================================================
 * PerfectFreehand + WebGPUMask ãƒ‡ãƒãƒƒã‚°ã‚³ãƒãƒ³ãƒ‰é›† (å®Œå…¨ä¿®æ­£ç‰ˆ)
 * ================================================================================
 */

// ========================================
// Phase 1: PerfectFreehandçµ±åˆçŠ¶æ³ç¢ºèª
// ========================================
window.debugPhase1 = function() {
    console.log('%c=== Phase 1: PerfectFreehandçµ±åˆçŠ¶æ³ ===', 'color: #00ff00; font-weight: bold; font-size: 14px;');
    
    // 1. PerfectFreehandæœ¬ä½“
    console.log('\nğŸ“¦ 1. PerfectFreehandæœ¬ä½“');
    console.log('  - PerfectFreehand:', typeof PerfectFreehand);
    console.log('  - PerfectFreehand.default:', typeof PerfectFreehand?.default);
    console.log('  - PerfectFreehand.getStroke:', typeof PerfectFreehand?.getStroke);
    console.log('  - PerfectFreehand.default.getStroke:', typeof PerfectFreehand?.default?.getStroke);
    
    // 2. PolygonGenerator
    console.log('\nğŸ”· 2. PolygonGenerator');
    console.log('  - window.PolygonGenerator:', typeof window.PolygonGenerator);
    console.log('  - PolygonGenerator.perfectFreehand:', window.PolygonGenerator?.perfectFreehand ? 'âœ… åˆæœŸåŒ–æ¸ˆã¿' : 'âŒ æœªåˆæœŸåŒ–');
    console.log('  - PolygonGenerator.generate:', typeof window.PolygonGenerator?.generate);
    
    // 3. StrokeRecorder
    console.log('\nğŸ“ 3. StrokeRecorder');
    console.log('  - window.strokeRecorder:', typeof window.strokeRecorder);
    console.log('  - window.StrokeRecorder:', typeof window.StrokeRecorder);
    
    if (window.strokeRecorder) {
        console.log('  - strokeRecorder.polygonGenerator:', window.strokeRecorder.polygonGenerator ? 'âœ… æ¥ç¶šæ¸ˆã¿' : 'âŒ æœªæ¥ç¶š');
        console.log('  - strokeRecorder.isRecording:', window.strokeRecorder.isRecording);
    }
    
    // 4. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    console.log('\nğŸ§ª 4. ãƒãƒªã‚´ãƒ³ç”Ÿæˆãƒ†ã‚¹ãƒˆ');
    if (window.PolygonGenerator) {
        try {
            const testPoints = [
                {x: 10, y: 10, pressure: 0.5},
                {x: 20, y: 15, pressure: 0.7},
                {x: 30, y: 20, pressure: 0.6},
                {x: 40, y: 25, pressure: 0.8}
            ];
            
            const polygon = window.PolygonGenerator.generate(testPoints);
            
            if (polygon && polygon.length > 0) {
                console.log(`  âœ… ãƒãƒªã‚´ãƒ³ç”ŸæˆæˆåŠŸ: ${polygon.length}ç‚¹`);
                console.log('  - æœ€åˆã®3ç‚¹:', polygon.slice(0, 3));
            } else {
                console.log('  âŒ ãƒãƒªã‚´ãƒ³ç”Ÿæˆå¤±æ•—: ç©ºé…åˆ—');
            }
        } catch (error) {
            console.log('  âŒ ãƒãƒªã‚´ãƒ³ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error.message);
        }
    } else {
        console.log('  âŒ PolygonGenerator not found');
    }
    
    // 5. Configç¢ºèª
    console.log('\nâš™ï¸ 5. PerfectFreehandè¨­å®š');
    const config = window.TEGAKI_CONFIG?.perfectFreehand;
    if (config) {
        console.log('  - enabled:', config.enabled);
        console.log('  - size:', config.size);
        console.log('  - thinning:', config.thinning);
        console.log('  - smoothing:', config.smoothing);
        console.log('  - streamline:', config.streamline);
    } else {
        console.log('  âŒ Config not found');
    }
};


// ========================================
// Phase 2: WebGPUMaskLayerçŠ¶æ³ç¢ºèª
// ========================================
window.debugPhase2 = function() {
    console.log('\n%c=== Phase 2: WebGPUMaskLayerçµ±åˆçŠ¶æ³ ===', 'color: #00ffff; font-weight: bold; font-size: 14px;');
    
    // 1. WebGPUMaskLayeræœ¬ä½“
    console.log('\nğŸ­ 1. WebGPUMaskLayeræœ¬ä½“');
    console.log('  - window.WebGPUMaskLayer:', typeof window.WebGPUMaskLayer);
    
    // 2. StrokeRendererçµ±åˆ
    console.log('\nğŸ–Œï¸ 2. StrokeRendererçµ±åˆ');
    console.log('  - window.strokeRenderer:', typeof window.strokeRenderer);
    
    if (window.strokeRenderer) {
        console.log('  - strokeRenderer.webgpuMaskLayer:', window.strokeRenderer.webgpuMaskLayer ? 'âœ… åˆæœŸåŒ–æ¸ˆã¿' : 'âŒ æœªåˆæœŸåŒ–');
        console.log('  - strokeRenderer.webgpuEnabled:', window.strokeRenderer.webgpuEnabled);
        console.log('  - strokeRenderer.currentTool:', window.strokeRenderer.currentTool);
        
        const maskLayer = window.strokeRenderer.webgpuMaskLayer;
        if (maskLayer) {
            console.log('  - maskLayer.isInitialized():', maskLayer.isInitialized ? maskLayer.isInitialized() : 'N/A');
            console.log('  - maskLayer.width:', maskLayer.width);
            console.log('  - maskLayer.height:', maskLayer.height);
            console.log('  - maskLayer.maskBuffer:', maskLayer.maskBuffer ? `Float32Array(${maskLayer.maskBuffer.length})` : 'null');
        }
    }
    
    // 3. WebGPUåŸºç›¤
    console.log('\nâš¡ 3. WebGPUåŸºç›¤');
    console.log('  - window.WebGPUDrawingLayer:', typeof window.WebGPUDrawingLayer);
    
    if (window.strokeRenderer?.webgpuLayer) {
        const layer = window.strokeRenderer.webgpuLayer;
        console.log('  - webgpuLayer.isInitialized():', layer.isInitialized ? layer.isInitialized() : 'N/A');
        console.log('  - webgpuLayer.device:', layer.device ? 'âœ… GPUDeviceå–å¾—æ¸ˆã¿' : 'âŒ æœªå–å¾—');
    }
    
    // 4. Configç¢ºèª
    console.log('\nâš™ï¸ 4. WebGPU Maskè¨­å®š');
    const config = window.TEGAKI_CONFIG?.webgpu?.mask;
    if (config) {
        console.log('  - enabled:', config.enabled);
        console.log('  - format:', config.format);
        console.log('  - clearValue:', config.clearValue);
    } else {
        console.log('  âš ï¸ Config not found (maskè¨­å®šæœªè¿½åŠ )');
    }
};


// ========================================
// Phase 3: æç”»ãƒ¢ãƒ¼ãƒ‰ç¢ºèª
// ========================================
window.debugPhase3 = function() {
    console.log('\n%c=== Phase 3: æç”»ãƒ¢ãƒ¼ãƒ‰ç¢ºèª ===', 'color: #ff00ff; font-weight: bold; font-size: 14px;');
    
    // 1. BrushSettings
    console.log('\nğŸ¨ 1. BrushSettings');
    console.log('  - window.brushSettings:', typeof window.brushSettings);
    
    if (window.brushSettings) {
        const settings = window.brushSettings.getSettings ? window.brushSettings.getSettings() : null;
        if (settings) {
            console.log('  - ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰:', settings.mode);
            console.log('  - ãƒ–ãƒ©ã‚·ã‚µã‚¤ã‚º:', settings.size);
            console.log('  - ä¸é€æ˜åº¦:', settings.opacity);
            console.log('  - è‰²:', `0x${settings.color.toString(16).padStart(6, '0')}`);
        }
    }
    
    // 2. ãƒ„ãƒ¼ãƒ«çŠ¶æ…‹
    console.log('\nğŸ› ï¸ 2. ãƒ„ãƒ¼ãƒ«çŠ¶æ…‹');
    console.log('  - strokeRenderer.currentTool:', window.strokeRenderer?.currentTool);
    console.log('  - brushSettings.mode:', window.brushSettings?.getSettings?.()?.mode);
    
    // 3. ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹
    console.log('\nğŸ“š 3. ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹');
    if (window.layerManager) {
        const activeLayer = window.layerManager.getActiveLayer ? window.layerManager.getActiveLayer() : null;
        if (activeLayer) {
            console.log('  - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼:', activeLayer.layerData?.name);
            console.log('  - ãƒ¬ã‚¤ãƒ¤ãƒ¼ID:', activeLayer.layerData?.id);
            console.log('  - pathsDataæ•°:', activeLayer.layerData?.pathsData?.length || 0);
        } else {
            console.log('  âŒ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ãªã—');
        }
    }
};


// ========================================
// çµ±åˆãƒ†ã‚¹ãƒˆ: ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯æç”»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
// ========================================
window.debugIntegrationTest = function() {
    console.log('\n%c=== çµ±åˆãƒ†ã‚¹ãƒˆ: ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯æç”»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ===', 'color: #ffff00; font-weight: bold; font-size: 14px;');
    
    if (!window.strokeRecorder || !window.PolygonGenerator) {
        console.log('âŒ strokeRecorder ã¾ãŸã¯ PolygonGenerator ãŒæœªåˆæœŸåŒ–');
        return;
    }
    
    console.log('\nğŸ§ª ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯è¨˜éŒ²ãƒ†ã‚¹ãƒˆ');
    
    try {
        // 1. ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯é–‹å§‹
        window.strokeRecorder.startStroke(50, 50, 0.5);
        console.log('  âœ… startStroke(50, 50, 0.5)');
        
        // 2. ãƒã‚¤ãƒ³ãƒˆè¿½åŠ 
        window.strokeRecorder.addPoint(60, 55, 0.6);
        window.strokeRecorder.addPoint(70, 60, 0.7);
        window.strokeRecorder.addPoint(80, 65, 0.8);
        console.log('  âœ… addPoint() x3');
        
        // 3. ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯çµ‚äº†
        const result = window.strokeRecorder.endStroke();
        console.log('  âœ… endStroke()');
        
        // 4. çµæœç¢ºèª
        console.log('\nğŸ“Š çµæœ:');
        console.log('  - points:', result.points?.length, 'ç‚¹');
        console.log('  - polygon:', result.polygon?.length, 'ç‚¹');
        console.log('  - isSingleDot:', result.isSingleDot);
        
        if (result.polygon && result.polygon.length > 0) {
            console.log('  - polygonä¾‹:', result.polygon.slice(0, 3));
            console.log('  âœ… ãƒãƒªã‚´ãƒ³ç”ŸæˆæˆåŠŸ');
        } else {
            console.log('  âŒ ãƒãƒªã‚´ãƒ³ç”Ÿæˆå¤±æ•—');
        }
        
        // 5. ãƒã‚¹ã‚¯æ›´æ–°ãƒ†ã‚¹ãƒˆ
        if (window.strokeRenderer?.webgpuMaskLayer) {
            const maskLayer = window.strokeRenderer.webgpuMaskLayer;
            if (maskLayer.isInitialized && maskLayer.isInitialized()) {
                console.log('\nğŸ­ ãƒã‚¹ã‚¯æ›´æ–°ãƒ†ã‚¹ãƒˆ');
                
                // ãƒšãƒ³ãƒ¢ãƒ¼ãƒ‰
                maskLayer.addPolygonToMask(result.polygon, 'add');
                console.log('  âœ… ãƒã‚¹ã‚¯åŠ ç®— (ãƒšãƒ³)');
                
                // ãƒã‚¹ã‚¯å€¤ç¢ºèª
                const maskValue = maskLayer.getMaskValue ? maskLayer.getMaskValue(65, 57) : 'N/A';
                console.log('  - ãƒã‚¹ã‚¯å€¤ (65, 57):', maskValue);
                
            } else {
                console.log('\nâš ï¸ ãƒã‚¹ã‚¯ãƒ¬ã‚¤ãƒ¤ãƒ¼æœªåˆæœŸåŒ–');
            }
        }
        
    } catch (error) {
        console.log('âŒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error.message);
        console.error(error);
    }
};


// ========================================
// ãƒã‚¹ã‚¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒãƒƒã‚°ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼
// ========================================
window.debugMaskVisualizer = function() {
    console.log('\n%c=== ãƒã‚¹ã‚¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒãƒƒã‚°ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ ===', 'color: #ff8800; font-weight: bold; font-size: 14px;');
    
    const maskLayer = window.strokeRenderer?.webgpuMaskLayer;
    
    if (!maskLayer || !maskLayer.isInitialized || !maskLayer.isInitialized()) {
        console.log('âŒ ãƒã‚¹ã‚¯ãƒ¬ã‚¤ãƒ¤ãƒ¼æœªåˆæœŸåŒ–');
        return;
    }
    
    if (!maskLayer.maskBuffer) {
        console.log('âŒ maskBuffer not available');
        return;
    }
    
    console.log('\nğŸ” ãƒã‚¹ã‚¯ãƒãƒƒãƒ•ã‚¡çµ±è¨ˆ:');
    
    const buffer = maskLayer.maskBuffer;
    const width = maskLayer.width;
    const height = maskLayer.height;
    
    // çµ±è¨ˆè¨ˆç®—
    let min = Infinity;
    let max = -Infinity;
    let sum = 0;
    let nonZeroCount = 0;
    
    for (let i = 0; i < buffer.length; i++) {
        const value = buffer[i];
        min = Math.min(min, value);
        max = Math.max(max, value);
        sum += value;
        if (value > 0) nonZeroCount++;
    }
    
    const avg = sum / buffer.length;
    const coverage = (nonZeroCount / buffer.length * 100).toFixed(2);
    
    console.log(`  - ã‚µã‚¤ã‚º: ${width} x ${height}`);
    console.log(`  - æœ€å°å€¤: ${min.toFixed(4)}`);
    console.log(`  - æœ€å¤§å€¤: ${max.toFixed(4)}`);
    console.log(`  - å¹³å‡å€¤: ${avg.toFixed(4)}`);
    console.log(`  - éã‚¼ãƒ­ãƒ”ã‚¯ã‚»ãƒ«: ${nonZeroCount} / ${buffer.length}`);
    console.log(`  - ã‚«ãƒãƒ¼ç‡: ${coverage}%`);
    
    // ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚° (ä¸­å¿ƒä»˜è¿‘)
    console.log('\nğŸ“ ä¸­å¿ƒä»˜è¿‘ã®ãƒã‚¹ã‚¯å€¤ã‚µãƒ³ãƒ—ãƒ«:');
    const cx = Math.floor(width / 2);
    const cy = Math.floor(height / 2);
    
    for (let dy = -2; dy <= 2; dy++) {
        const row = [];
        for (let dx = -2; dx <= 2; dx++) {
            const x = cx + dx;
            const y = cy + dy;
            const value = maskLayer.getMaskValue ? maskLayer.getMaskValue(x, y) : buffer[y * width + x];
            row.push(value.toFixed(2));
        }
        console.log(`  y=${cy + dy}: [${row.join(', ')}]`);
    }
};


// ========================================
// ä¿®æ­£ã‚³ãƒãƒ³ãƒ‰: StrokeRecorderåˆæœŸåŒ–
// ========================================
window.fixStrokeRecorder = function() {
    console.log('%c=== StrokeRecorderä¿®æ­£ ===', 'color: #00ff00; font-weight: bold;');
    
    if (!window.strokeRecorder) {
        console.log('âŒ strokeRecorder not found');
        return;
    }
    
    if (typeof window.strokeRecorder.initialize === 'function') {
        window.strokeRecorder.initialize();
        console.log('âœ… strokeRecorder.initialize() å®Ÿè¡Œå®Œäº†');
        
        // ç¢ºèª
        if (window.strokeRecorder.polygonGenerator) {
            console.log('âœ… PolygonGeneratoræ¥ç¶šç¢ºèª');
        } else {
            console.log('âŒ PolygonGeneratoræ¥ç¶šå¤±æ•—');
        }
    } else {
        console.log('âŒ initialize()ãƒ¡ã‚½ãƒƒãƒ‰ãŒå­˜åœ¨ã—ã¾ã›ã‚“');
    }
};


// ========================================
// ä¿®æ­£ã‚³ãƒãƒ³ãƒ‰: WebGPUMaskLayeråˆæœŸåŒ–
// ========================================
window.fixWebGPUMask = async function() {
    console.log('%c=== WebGPUMaskLayerä¿®æ­£ ===', 'color: #00ffff; font-weight: bold;');
    
    if (!window.strokeRenderer) {
        console.log('âŒ strokeRenderer not found');
        return;
    }
    
    if (!window.WebGPUMaskLayer) {
        console.log('âŒ WebGPUMaskLayer not loaded');
        console.log('â†’ index.htmlã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¦ãã ã•ã„:');
        console.log('   <script src="system/drawing/webgpu/webgpu-mask-layer.js"></script>');
        return;
    }
    
    // WebGPUãƒ¬ã‚¤ãƒ¤ãƒ¼ç¢ºèª
    if (!window.strokeRenderer.webgpuLayer) {
        console.log('âŒ WebGPUDrawingLayeræœªåˆæœŸåŒ–');
        return;
    }
    
    // ãƒã‚¹ã‚¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆ
    try {
        const config = window.TEGAKI_CONFIG?.canvas || {};
        const width = config.width || 400;
        const height = config.height || 400;
        
        console.log(`ğŸ“ ãƒã‚¹ã‚¯ã‚µã‚¤ã‚º: ${width}x${height}`);
        
        const maskLayer = new window.WebGPUMaskLayer(window.strokeRenderer.webgpuLayer);
        const success = await maskLayer.initialize(width, height);
        
        if (success) {
            window.strokeRenderer.webgpuMaskLayer = maskLayer;
            console.log('âœ… WebGPUMaskLayeråˆæœŸåŒ–æˆåŠŸ');
            console.log('âœ… strokeRenderer.webgpuMaskLayerã«è¨­å®šå®Œäº†');
        } else {
            console.log('âŒ åˆæœŸåŒ–å¤±æ•—');
        }
    } catch (error) {
        console.log('âŒ ã‚¨ãƒ©ãƒ¼:', error.message);
        console.error(error);
    }
};


// ========================================
// å…¨è‡ªå‹•ä¿®æ­£
// ========================================
window.fixAll = async function() {
    console.log('%c=== å…¨è‡ªå‹•ä¿®æ­£å®Ÿè¡Œ ===', 'color: #ffff00; font-weight: bold; font-size: 16px;');
    
    // 1. StrokeRecorderåˆæœŸåŒ–
    console.log('\n1ï¸âƒ£ StrokeRecorderåˆæœŸåŒ–...');
    window.fixStrokeRecorder();
    
    // 2. WebGPUMaskLayeråˆæœŸåŒ–
    console.log('\n2ï¸âƒ£ WebGPUMaskLayeråˆæœŸåŒ–...');
    await window.fixWebGPUMask();
    
    // 3. ç¢ºèª
    console.log('\n3ï¸âƒ£ ç¢ºèª...');
    window.debugPhase1();
    window.debugPhase2();
    
    console.log('\nâœ… å…¨è‡ªå‹•ä¿®æ­£å®Œäº†');
    console.log('å‹•ä½œç¢ºèª: window.debugIntegrationTest()');
};


// ========================================
// åˆå›å®Ÿè¡Œ
// ========================================
console.log('%c=== è‡ªå‹•è¨ºæ–­å®Ÿè¡Œ ===', 'color: #ffffff; font-weight: bold; font-size: 14px;');
window.debugPhase1();
window.debugPhase2();
window.debugPhase3();
window.debugIntegrationTest();
window.debugMaskVisualizer();


// ========================================
// åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰
// ========================================
console.log('\n%c=== åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰ ===', 'color: #ffffff; font-weight: bold; font-size: 14px;');
console.log('\nğŸ“Š è¨ºæ–­ã‚³ãƒãƒ³ãƒ‰:');
console.log('  window.debugPhase1()         - Phase 1ç¢ºèª');
console.log('  window.debugPhase2()         - Phase 2ç¢ºèª');
console.log('  window.debugPhase3()         - æç”»ãƒ¢ãƒ¼ãƒ‰ç¢ºèª');
console.log('  window.debugIntegrationTest() - çµ±åˆãƒ†ã‚¹ãƒˆ');
console.log('  window.debugMaskVisualizer()  - ãƒã‚¹ã‚¯å¯è¦–åŒ–');
console.log('\nğŸ”§ ä¿®æ­£ã‚³ãƒãƒ³ãƒ‰:');
console.log('  window.fixStrokeRecorder()   - StrokeRecorderåˆæœŸåŒ–');
console.log('  window.fixWebGPUMask()       - WebGPUMaskLayeråˆæœŸåŒ–');
console.log('  window.fixAll()              - å…¨è‡ªå‹•ä¿®æ­£ âš¡');
console.log('\nğŸ’¡ æ¨å¥¨: ã¾ãšã¯ window.fixAll() ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„');
VM443:404 === è‡ªå‹•è¨ºæ–­å®Ÿè¡Œ ===
VM443:11 === Phase 1: PerfectFreehandçµ±åˆçŠ¶æ³ ===
VM443:14 
ğŸ“¦ 1. PerfectFreehandæœ¬ä½“
VM443:15   - PerfectFreehand: function
VM443:16   - PerfectFreehand.default: undefined
VM443:17   - PerfectFreehand.getStroke: undefined
VM443:18   - PerfectFreehand.default.getStroke: undefined
VM443:21 
ğŸ”· 2. PolygonGenerator
VM443:22   - window.PolygonGenerator: object
VM443:23   - PolygonGenerator.perfectFreehand: âœ… åˆæœŸåŒ–æ¸ˆã¿
VM443:24   - PolygonGenerator.generate: function
VM443:27 
ğŸ“ 3. StrokeRecorder
VM443:28   - window.strokeRecorder: object
VM443:29   - window.StrokeRecorder: function
VM443:32   - strokeRecorder.polygonGenerator: âŒ æœªæ¥ç¶š
VM443:33   - strokeRecorder.isRecording: false
VM443:37 
ğŸ§ª 4. ãƒãƒªã‚´ãƒ³ç”Ÿæˆãƒ†ã‚¹ãƒˆ
VM443:50   âœ… ãƒãƒªã‚´ãƒ³ç”ŸæˆæˆåŠŸ: 48ç‚¹
VM443:51   - æœ€åˆã®3ç‚¹: (3)Â [Array(2), Array(2), Array(2)]
VM443:63 
âš™ï¸ 5. PerfectFreehandè¨­å®š
VM443:66   - enabled: true
VM443:67   - size: 16
VM443:68   - thinning: 0.5
VM443:69   - smoothing: 0.5
VM443:70   - streamline: 0.5
VM443:81 
=== Phase 2: WebGPUMaskLayerçµ±åˆçŠ¶æ³ ===
VM443:84 
ğŸ­ 1. WebGPUMaskLayeræœ¬ä½“
VM443:85   - window.WebGPUMaskLayer: function
VM443:88 
ğŸ–Œï¸ 2. StrokeRendererçµ±åˆ
VM443:89   - window.strokeRenderer: object
VM443:92   - strokeRenderer.webgpuMaskLayer: âŒ æœªåˆæœŸåŒ–
VM443:93   - strokeRenderer.webgpuEnabled: false
VM443:94   - strokeRenderer.currentTool: pen
VM443:106 
âš¡ 3. WebGPUåŸºç›¤
VM443:107   - window.WebGPUDrawingLayer: function
VM443:116 
âš™ï¸ 4. WebGPU Maskè¨­å®š
VM443:123   âš ï¸ Config not found (maskè¨­å®šæœªè¿½åŠ )
VM443:132 
=== Phase 3: æç”»ãƒ¢ãƒ¼ãƒ‰ç¢ºèª ===
VM443:135 
ğŸ¨ 1. BrushSettings
VM443:136   - window.brushSettings: object
VM443:141   - ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰: pen
VM443:142   - ãƒ–ãƒ©ã‚·ã‚µã‚¤ã‚º: 10
VM443:143   - ä¸é€æ˜åº¦: 1
VM443:144   - è‰²: 0x800000
VM443:149 
ğŸ› ï¸ 2. ãƒ„ãƒ¼ãƒ«çŠ¶æ…‹
VM443:150   - strokeRenderer.currentTool: pen
VM443:151   - brushSettings.mode: pen
VM443:154 
ğŸ“š 3. ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹
VM443:158   - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼: ãƒ¬ã‚¤ãƒ¤ãƒ¼1
VM443:159   - ãƒ¬ã‚¤ãƒ¤ãƒ¼ID: layer_1762986646770_djawf6pb8
VM443:160   - pathsDataæ•°: 0
VM443:172 
=== çµ±åˆãƒ†ã‚¹ãƒˆ: ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯æç”»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ===
VM443:179 
ğŸ§ª ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯è¨˜éŒ²ãƒ†ã‚¹ãƒˆ
VM443:184   âœ… startStroke(50, 50, 0.5)
VM443:190   âœ… addPoint() x3
VM443:194   âœ… endStroke()
VM443:197 
ğŸ“Š çµæœ:
VM443:198   - points: 4 ç‚¹
VM443:199   - polygon: 0 ç‚¹
VM443:200   - isSingleDot: false
VM443:206   âŒ ãƒãƒªã‚´ãƒ³ç”Ÿæˆå¤±æ•—
VM443:239 
=== ãƒã‚¹ã‚¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒãƒƒã‚°ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ ===
VM443:244 âŒ ãƒã‚¹ã‚¯ãƒ¬ã‚¤ãƒ¤ãƒ¼æœªåˆæœŸåŒ–
VM443:415 
=== åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰ ===
VM443:416 
ğŸ“Š è¨ºæ–­ã‚³ãƒãƒ³ãƒ‰:
VM443:417   window.debugPhase1()         - Phase 1ç¢ºèª
VM443:418   window.debugPhase2()         - Phase 2ç¢ºèª
VM443:419   window.debugPhase3()         - æç”»ãƒ¢ãƒ¼ãƒ‰ç¢ºèª
VM443:420   window.debugIntegrationTest() - çµ±åˆãƒ†ã‚¹ãƒˆ
VM443:421   window.debugMaskVisualizer()  - ãƒã‚¹ã‚¯å¯è¦–åŒ–
VM443:422 
ğŸ”§ ä¿®æ­£ã‚³ãƒãƒ³ãƒ‰:
VM443:423   window.fixStrokeRecorder()   - StrokeRecorderåˆæœŸåŒ–
VM443:424   window.fixWebGPUMask()       - WebGPUMaskLayeråˆæœŸåŒ–
VM443:425   window.fixAll()              - å…¨è‡ªå‹•ä¿®æ­£ âš¡
VM443:426 
ğŸ’¡ æ¨å¥¨: ã¾ãšã¯ window.fixAll() ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
undefined
// å…¨è‡ªå‹•ä¿®æ­£ï¼ˆæ¨å¥¨ï¼‰
window.fixAll();
VM443:381 === å…¨è‡ªå‹•ä¿®æ­£å®Ÿè¡Œ ===
VM443:384 
1ï¸âƒ£ StrokeRecorderåˆæœŸåŒ–...
VM443:305 === StrokeRecorderä¿®æ­£ ===
polygon-generator.js:43 âœ… [PolygonGenerator] PerfectFreehand initialized
stroke-recorder.js:56 âœ… [StrokeRecorder] Initialized with PolygonGenerator
VM443:314 âœ… strokeRecorder.initialize() å®Ÿè¡Œå®Œäº†
VM443:318 âœ… PolygonGeneratoræ¥ç¶šç¢ºèª
VM443:388 
2ï¸âƒ£ WebGPUMaskLayeråˆæœŸåŒ–...
VM443:332 === WebGPUMaskLayerä¿®æ­£ ===
VM443:348 âŒ WebGPUDrawingLayeræœªåˆæœŸåŒ–
VM443:392 
3ï¸âƒ£ ç¢ºèª...
VM443:11 === Phase 1: PerfectFreehandçµ±åˆçŠ¶æ³ ===
VM443:14 
ğŸ“¦ 1. PerfectFreehandæœ¬ä½“
VM443:15   - PerfectFreehand: function
VM443:16   - PerfectFreehand.default: undefined
VM443:17   - PerfectFreehand.getStroke: undefined
VM443:18   - PerfectFreehand.default.getStroke: undefined
VM443:21 
ğŸ”· 2. PolygonGenerator
VM443:22   - window.PolygonGenerator: object
VM443:23   - PolygonGenerator.perfectFreehand: âœ… åˆæœŸåŒ–æ¸ˆã¿
VM443:24   - PolygonGenerator.generate: function
VM443:27 
ğŸ“ 3. StrokeRecorder
VM443:28   - window.strokeRecorder: object
VM443:29   - window.StrokeRecorder: function
VM443:32   - strokeRecorder.polygonGenerator: âœ… æ¥ç¶šæ¸ˆã¿
VM443:33   - strokeRecorder.isRecording: false
VM443:37 
ğŸ§ª 4. ãƒãƒªã‚´ãƒ³ç”Ÿæˆãƒ†ã‚¹ãƒˆ
VM443:50   âœ… ãƒãƒªã‚´ãƒ³ç”ŸæˆæˆåŠŸ: 48ç‚¹
VM443:51   - æœ€åˆã®3ç‚¹: (3)Â [Array(2), Array(2), Array(2)]
VM443:63 
âš™ï¸ 5. PerfectFreehandè¨­å®š
VM443:66   - enabled: true
VM443:67   - size: 16
VM443:68   - thinning: 0.5
VM443:69   - smoothing: 0.5
VM443:70   - streamline: 0.5
VM443:81 
=== Phase 2: WebGPUMaskLayerçµ±åˆçŠ¶æ³ ===
VM443:84 
ğŸ­ 1. WebGPUMaskLayeræœ¬ä½“
VM443:85   - window.WebGPUMaskLayer: function
VM443:88 
ğŸ–Œï¸ 2. StrokeRendererçµ±åˆ
VM443:89   - window.strokeRenderer: object
VM443:92   - strokeRenderer.webgpuMaskLayer: âŒ æœªåˆæœŸåŒ–
VM443:93   - strokeRenderer.webgpuEnabled: false
VM443:94   - strokeRenderer.currentTool: pen
VM443:106 
âš¡ 3. WebGPUåŸºç›¤
VM443:107   - window.WebGPUDrawingLayer: function
VM443:116 
âš™ï¸ 4. WebGPU Maskè¨­å®š
VM443:123   âš ï¸ Config not found (maskè¨­å®šæœªè¿½åŠ )
VM443:396 
âœ… å…¨è‡ªå‹•ä¿®æ­£å®Œäº†
VM443:397 å‹•ä½œç¢ºèª: window.debugIntegrationTest()
PromiseÂ {<fulfilled>: undefined}
// StrokeRecorderã®ã¿ä¿®æ­£
window.fixStrokeRecorder();

// WebGPUMaskLayerã®ã¿ä¿®æ­£
window.fixWebGPUMask();

// å†è¨ºæ–­
window.debugPhase1();
window.debugPhase2();
window.debugIntegrationTest();
VM443:305 === StrokeRecorderä¿®æ­£ ===
polygon-generator.js:43 âœ… [PolygonGenerator] PerfectFreehand initialized
stroke-recorder.js:56 âœ… [StrokeRecorder] Initialized with PolygonGenerator
VM443:314 âœ… strokeRecorder.initialize() å®Ÿè¡Œå®Œäº†
VM443:318 âœ… PolygonGeneratoræ¥ç¶šç¢ºèª
VM443:332 === WebGPUMaskLayerä¿®æ­£ ===
VM443:348 âŒ WebGPUDrawingLayeræœªåˆæœŸåŒ–
VM443:11 === Phase 1: PerfectFreehandçµ±åˆçŠ¶æ³ ===
VM443:14 
ğŸ“¦ 1. PerfectFreehandæœ¬ä½“
VM443:15   - PerfectFreehand: function
VM443:16   - PerfectFreehand.default: undefined
VM443:17   - PerfectFreehand.getStroke: undefined
VM443:18   - PerfectFreehand.default.getStroke: undefined
VM443:21 
ğŸ”· 2. PolygonGenerator
VM443:22   - window.PolygonGenerator: object
VM443:23   - PolygonGenerator.perfectFreehand: âœ… åˆæœŸåŒ–æ¸ˆã¿
VM443:24   - PolygonGenerator.generate: function
VM443:27 
ğŸ“ 3. StrokeRecorder
VM443:28   - window.strokeRecorder: object
VM443:29   - window.StrokeRecorder: function
VM443:32   - strokeRecorder.polygonGenerator: âœ… æ¥ç¶šæ¸ˆã¿
VM443:33   - strokeRecorder.isRecording: false
VM443:37 
ğŸ§ª 4. ãƒãƒªã‚´ãƒ³ç”Ÿæˆãƒ†ã‚¹ãƒˆ
VM443:50   âœ… ãƒãƒªã‚´ãƒ³ç”ŸæˆæˆåŠŸ: 48ç‚¹
VM443:51   - æœ€åˆã®3ç‚¹: (3)Â [Array(2), Array(2), Array(2)]
VM443:63 
âš™ï¸ 5. PerfectFreehandè¨­å®š
VM443:66   - enabled: true
VM443:67   - size: 16
VM443:68   - thinning: 0.5
VM443:69   - smoothing: 0.5
VM443:70   - streamline: 0.5
VM443:81 
=== Phase 2: WebGPUMaskLayerçµ±åˆçŠ¶æ³ ===
VM443:84 
ğŸ­ 1. WebGPUMaskLayeræœ¬ä½“
VM443:85   - window.WebGPUMaskLayer: function
VM443:88 
ğŸ–Œï¸ 2. StrokeRendererçµ±åˆ
VM443:89   - window.strokeRenderer: object
VM443:92   - strokeRenderer.webgpuMaskLayer: âŒ æœªåˆæœŸåŒ–
VM443:93   - strokeRenderer.webgpuEnabled: false
VM443:94   - strokeRenderer.currentTool: pen
VM443:106 
âš¡ 3. WebGPUåŸºç›¤
VM443:107   - window.WebGPUDrawingLayer: function
VM443:116 
âš™ï¸ 4. WebGPU Maskè¨­å®š
VM443:123   âš ï¸ Config not found (maskè¨­å®šæœªè¿½åŠ )
VM443:172 
=== çµ±åˆãƒ†ã‚¹ãƒˆ: ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯æç”»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ===
VM443:179 
ğŸ§ª ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯è¨˜éŒ²ãƒ†ã‚¹ãƒˆ
VM443:184   âœ… startStroke(50, 50, 0.5)
VM443:190   âœ… addPoint() x3
VM443:194   âœ… endStroke()
VM443:197 
ğŸ“Š çµæœ:
VM443:198   - points: 4 ç‚¹
VM443:199   - polygon: 48 ç‚¹
VM443:200   - isSingleDot: false
VM443:203   - polygonä¾‹: (3)Â [Array(2), Array(2), Array(2)]
VM443:204   âœ… ãƒãƒªã‚´ãƒ³ç”ŸæˆæˆåŠŸ
undefined
/**
 * ================================================================================
 * WebGPUåˆæœŸåŒ–ãƒ‡ãƒãƒƒã‚°ã‚³ãƒãƒ³ãƒ‰
 * ================================================================================
 */

// ========================================
// WebGPUçŠ¶æ…‹è©³ç´°ç¢ºèª
// ========================================
window.debugWebGPUStatus = function() {
    console.log('%c=== WebGPUåˆæœŸåŒ–çŠ¶æ…‹ ===', 'color: #00ffff; font-weight: bold; font-size: 14px;');
    
    // 1. ãƒ–ãƒ©ã‚¦ã‚¶WebGPUã‚µãƒãƒ¼ãƒˆ
    console.log('\nğŸŒ 1. ãƒ–ãƒ©ã‚¦ã‚¶WebGPUã‚µãƒãƒ¼ãƒˆ');
    console.log('  - navigator.gpu:', typeof navigator.gpu);
    console.log('  - WebGPUå¯¾å¿œ:', navigator.gpu ? 'âœ… å¯¾å¿œ' : 'âŒ éå¯¾å¿œ');
    
    // 2. WebGPUDrawingLayer
    console.log('\nâš¡ 2. WebGPUDrawingLayer');
    console.log('  - window.WebGPUDrawingLayer:', typeof window.WebGPUDrawingLayer);
    
    // 3. StrokeRendererã®WebGPUãƒ¬ã‚¤ãƒ¤ãƒ¼
    console.log('\nğŸ–Œï¸ 3. StrokeRenderer WebGPUãƒ¬ã‚¤ãƒ¤ãƒ¼');
    if (window.strokeRenderer) {
        console.log('  - strokeRenderer.webgpuLayer:', window.strokeRenderer.webgpuLayer || 'null');
        
        if (window.strokeRenderer.webgpuLayer) {
            const layer = window.strokeRenderer.webgpuLayer;
            console.log('  - webgpuLayer.device:', layer.device || 'null');
            console.log('  - webgpuLayer.queue:', layer.queue || 'null');
            
            if (typeof layer.isInitialized === 'function') {
                console.log('  - isInitialized():', layer.isInitialized());
            }
        }
    }
    
    // 4. CoreEngineç¢ºèª
    console.log('\nğŸ® 4. CoreEngine');
    console.log('  - window.coreEngine:', typeof window.coreEngine);
    
    if (window.coreEngine) {
        console.log('  - coreEngine.webgpuLayer:', window.coreEngine.webgpuLayer || 'null');
    }
    
    // 5. Configç¢ºèª
    console.log('\nâš™ï¸ 5. WebGPU Config');
    const config = window.TEGAKI_CONFIG?.webgpu;
    if (config) {
        console.log('  - enabled:', config.enabled);
        console.log('  - sdf.enabled:', config.sdf?.enabled);
        console.log('  - msdf.enabled:', config.msdf?.enabled);
        console.log('  - mask.enabled:', config.mask?.enabled);
    } else {
        console.log('  âŒ Config not found');
    }
};


// ========================================
// WebGPUæ‰‹å‹•åˆæœŸåŒ–
// ========================================
window.initWebGPU = async function() {
    console.log('%c=== WebGPUæ‰‹å‹•åˆæœŸåŒ– ===', 'color: #00ff00; font-weight: bold;');
    
    // 1. WebGPUå¯¾å¿œç¢ºèª
    if (!navigator.gpu) {
        console.log('âŒ ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯WebGPUã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“');
        console.log('â†’ Google Chrome Canary / Edge Canary ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„');
        console.log('â†’ chrome://flags ã§ "WebGPU" ã‚’æœ‰åŠ¹åŒ–ã—ã¦ãã ã•ã„');
        return false;
    }
    
    console.log('âœ… WebGPUå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶');
    
    // 2. WebGPUDrawingLayerå­˜åœ¨ç¢ºèª
    if (!window.WebGPUDrawingLayer) {
        console.log('âŒ WebGPUDrawingLayer not loaded');
        return false;
    }
    
    // 3. StrokeRendererç¢ºèª
    if (!window.strokeRenderer) {
        console.log('âŒ strokeRenderer not found');
        return false;
    }
    
    // 4. WebGPUDrawingLayeråˆæœŸåŒ–
    try {
        console.log('\nğŸ“¦ WebGPUDrawingLayeråˆæœŸåŒ–ä¸­...');
        
        const webgpuLayer = new window.WebGPUDrawingLayer();
        const success = await webgpuLayer.initialize();
        
        if (success) {
            console.log('âœ… WebGPUDrawingLayeråˆæœŸåŒ–æˆåŠŸ');
            
            // StrokeRendererã«è¨­å®š
            await window.strokeRenderer.setWebGPULayer(webgpuLayer);
            console.log('âœ… StrokeRendererã«è¨­å®šå®Œäº†');
            
            // ç¢ºèª
            console.log('\nğŸ” åˆæœŸåŒ–å¾Œã®çŠ¶æ…‹:');
            console.log('  - webgpuLayer.device:', webgpuLayer.device ? 'âœ… å–å¾—æ¸ˆã¿' : 'âŒ æœªå–å¾—');
            console.log('  - strokeRenderer.webgpuEnabled:', window.strokeRenderer.webgpuEnabled);
            console.log('  - strokeRenderer.webgpuMaskLayer:', window.strokeRenderer.webgpuMaskLayer || 'null');
            
            return true;
        } else {
            console.log('âŒ åˆæœŸåŒ–å¤±æ•—');
            return false;
        }
    } catch (error) {
        console.log('âŒ ã‚¨ãƒ©ãƒ¼:', error.message);
        console.error(error);
        return false;
    }
};


// ========================================
// å®Œå…¨åˆæœŸåŒ–ï¼ˆWebGPU + Maskçµ±åˆï¼‰
// ========================================
window.initFullWebGPU = async function() {
    console.log('%c=== å®Œå…¨åˆæœŸåŒ–: WebGPU + Mask ===', 'color: #ffff00; font-weight: bold; font-size: 16px;');
    
    // 1. StrokeRecorderåˆæœŸåŒ–
    console.log('\n1ï¸âƒ£ StrokeRecorderåˆæœŸåŒ–...');
    window.fixStrokeRecorder();
    
    // 2. WebGPUåˆæœŸåŒ–
    console.log('\n2ï¸âƒ£ WebGPUåˆæœŸåŒ–...');
    const webgpuSuccess = await window.initWebGPU();
    
    if (!webgpuSuccess) {
        console.log('\nâŒ WebGPUåˆæœŸåŒ–å¤±æ•— - ãƒã‚¹ã‚¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã‚¹ã‚­ãƒƒãƒ—');
        return false;
    }
    
    // 3. WebGPUMaskLayeråˆæœŸåŒ–
    console.log('\n3ï¸âƒ£ WebGPUMaskLayeråˆæœŸåŒ–...');
    await window.fixWebGPUMask();
    
    // 4. æœ€çµ‚ç¢ºèª
    console.log('\n4ï¸âƒ£ æœ€çµ‚ç¢ºèª...');
    window.debugPhase1();
    window.debugPhase2();
    window.debugIntegrationTest();
    
    console.log('\nâœ… å®Œå…¨åˆæœŸåŒ–å®Œäº†');
    console.log('æç”»ãƒ†ã‚¹ãƒˆ: ãƒšãƒ³ã§æç”»ã—ã¦ã¿ã¦ãã ã•ã„');
    
    return true;
};


// ========================================
// CoreEngineçµŒç”±ã§WebGPUå–å¾—ï¼ˆæ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ åˆ©ç”¨ï¼‰
// ========================================
window.initWebGPUFromCore = async function() {
    console.log('%c=== CoreEngineçµŒç”±WebGPUåˆæœŸåŒ– ===', 'color: #ff00ff; font-weight: bold;');
    
    if (!window.coreEngine) {
        console.log('âŒ coreEngine not found');
        return false;
    }
    
    if (!window.coreEngine.webgpuLayer) {
        console.log('âŒ coreEngine.webgpuLayer not initialized');
        console.log('â†’ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•æ™‚ã«WebGPUãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
        return false;
    }
    
    try {
        // CoreEngineã®WebGPUãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½¿ç”¨
        const webgpuLayer = window.coreEngine.webgpuLayer;
        
        console.log('âœ… CoreEngineã‹ã‚‰WebGPUãƒ¬ã‚¤ãƒ¤ãƒ¼å–å¾—');
        console.log('  - device:', webgpuLayer.device ? 'âœ…' : 'âŒ');
        console.log('  - queue:', webgpuLayer.queue ? 'âœ…' : 'âŒ');
        
        // StrokeRendererã«è¨­å®š
        await window.strokeRenderer.setWebGPULayer(webgpuLayer);
        console.log('âœ… StrokeRendererã«è¨­å®šå®Œäº†');
        
        // WebGPUMaskLayeråˆæœŸåŒ–
        await window.fixWebGPUMask();
        
        console.log('\nâœ… åˆæœŸåŒ–å®Œäº†');
        return true;
        
    } catch (error) {
        console.log('âŒ ã‚¨ãƒ©ãƒ¼:', error.message);
        console.error(error);
        return false;
    }
};


// ========================================
// è‡ªå‹•å®Ÿè¡Œ
// ========================================
console.log('%c=== WebGPUçŠ¶æ…‹ç¢ºèª ===', 'color: #ffffff; font-weight: bold;');
window.debugWebGPUStatus();

console.log('\n%c=== åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰ ===', 'color: #ffffff; font-weight: bold;');
console.log('\nğŸ” è¨ºæ–­:');
console.log('  window.debugWebGPUStatus()    - WebGPUçŠ¶æ…‹ç¢ºèª');
console.log('\nğŸ”§ åˆæœŸåŒ–:');
console.log('  window.initWebGPU()           - WebGPUæ‰‹å‹•åˆæœŸåŒ–');
console.log('  window.initWebGPUFromCore()   - CoreEngineçµŒç”±åˆæœŸåŒ– (æ¨å¥¨)');
console.log('  window.initFullWebGPU()       - å®Œå…¨åˆæœŸåŒ– (WebGPU + Mask)');
console.log('\nğŸ’¡ æ¨å¥¨æ‰‹é †:');
console.log('  1. window.initWebGPUFromCore()  â† ã¾ãšã“ã‚Œã‚’è©¦ã™');
console.log('  2. å¤±æ•—ã—ãŸå ´åˆ: window.initWebGPU()');
VM454:203 === WebGPUçŠ¶æ…‹ç¢ºèª ===
VM454:11 === WebGPUåˆæœŸåŒ–çŠ¶æ…‹ ===
VM454:14 
ğŸŒ 1. ãƒ–ãƒ©ã‚¦ã‚¶WebGPUã‚µãƒãƒ¼ãƒˆ
VM454:15   - navigator.gpu: object
VM454:16   - WebGPUå¯¾å¿œ: âœ… å¯¾å¿œ
VM454:19 
âš¡ 2. WebGPUDrawingLayer
VM454:20   - window.WebGPUDrawingLayer: function
VM454:23 
ğŸ–Œï¸ 3. StrokeRenderer WebGPUãƒ¬ã‚¤ãƒ¤ãƒ¼
VM454:25   - strokeRenderer.webgpuLayer: null
VM454:39 
ğŸ® 4. CoreEngine
VM454:40   - window.coreEngine: object
VM454:43   - coreEngine.webgpuLayer: null
VM454:47 
âš™ï¸ 5. WebGPU Config
VM454:50   - enabled: true
VM454:51   - sdf.enabled: true
VM454:52   - msdf.enabled: true
VM454:53   - mask.enabled: undefined
VM454:206 
=== åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰ ===
VM454:207 
ğŸ” è¨ºæ–­:
VM454:208   window.debugWebGPUStatus()    - WebGPUçŠ¶æ…‹ç¢ºèª
VM454:209 
ğŸ”§ åˆæœŸåŒ–:
VM454:210   window.initWebGPU()           - WebGPUæ‰‹å‹•åˆæœŸåŒ–
VM454:211   window.initWebGPUFromCore()   - CoreEngineçµŒç”±åˆæœŸåŒ– (æ¨å¥¨)
VM454:212   window.initFullWebGPU()       - å®Œå…¨åˆæœŸåŒ– (WebGPU + Mask)
VM454:213 
ğŸ’¡ æ¨å¥¨æ‰‹é †:
VM454:214   1. window.initWebGPUFromCore()  â† ã¾ãšã“ã‚Œã‚’è©¦ã™
VM454:215   2. å¤±æ•—ã—ãŸå ´åˆ: window.initWebGPU()
undefined
window.debugWebGPUStatus();
VM454:11 === WebGPUåˆæœŸåŒ–çŠ¶æ…‹ ===
VM454:14 
ğŸŒ 1. ãƒ–ãƒ©ã‚¦ã‚¶WebGPUã‚µãƒãƒ¼ãƒˆ
VM454:15   - navigator.gpu: object
VM454:16   - WebGPUå¯¾å¿œ: âœ… å¯¾å¿œ
VM454:19 
âš¡ 2. WebGPUDrawingLayer
VM454:20   - window.WebGPUDrawingLayer: function
VM454:23 
ğŸ–Œï¸ 3. StrokeRenderer WebGPUãƒ¬ã‚¤ãƒ¤ãƒ¼
VM454:25   - strokeRenderer.webgpuLayer: null
VM454:39 
ğŸ® 4. CoreEngine
VM454:40   - window.coreEngine: object
VM454:43   - coreEngine.webgpuLayer: null
VM454:47 
âš™ï¸ 5. WebGPU Config
VM454:50   - enabled: true
VM454:51   - sdf.enabled: true
VM454:52   - msdf.enabled: true
VM454:53   - mask.enabled: undefined
undefined
window.initWebGPUFromCore();
VM454:161 === CoreEngineçµŒç”±WebGPUåˆæœŸåŒ– ===
VM454:169 âŒ coreEngine.webgpuLayer not initialized
VM454:170 â†’ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•æ™‚ã«WebGPUãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“
PromiseÂ {<fulfilled>: false}
window.initWebGPU();
VM454:64 === WebGPUæ‰‹å‹•åˆæœŸåŒ– ===
VM454:74 âœ… WebGPUå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶
VM454:90 
ğŸ“¦ WebGPUDrawingLayeråˆæœŸåŒ–ä¸­...
webgpu-drawing-layer.js:42 The powerPreference option is currently ignored when calling requestAdapter() on Windows. See https://crbug.com/369219127
initialize @ webgpu-drawing-layer.js:42
window.initWebGPU @ VM454:93
ï¼ˆåŒ¿åï¼‰ @ VM466:1
PromiseÂ {<pending>}
webgpu-drawing-layer.js:86 [WebGPU] Init failed: TypeError: this.device.createShaderModule is not a function
    at WebGPUComputeMSDF.initialize (webgpu-compute-msdf.js:25:45)
    at async WebGPUDrawingLayer.initialize (webgpu-drawing-layer.js:78:21)
    at async window.initWebGPU (<anonymous>:93:25)
initialize @ webgpu-drawing-layer.js:86
await in initialize
window.initWebGPU @ VM454:93
ï¼ˆåŒ¿åï¼‰ @ VM466:1
VM454:110 âŒ åˆæœŸåŒ–å¤±æ•—
window.initFullWebGPU();
VM454:125 === å®Œå…¨åˆæœŸåŒ–: WebGPU + Mask ===
VM454:128 
1ï¸âƒ£ StrokeRecorderåˆæœŸåŒ–...
VM443:305 === StrokeRecorderä¿®æ­£ ===
polygon-generator.js:43 âœ… [PolygonGenerator] PerfectFreehand initialized
stroke-recorder.js:56 âœ… [StrokeRecorder] Initialized with PolygonGenerator
VM443:314 âœ… strokeRecorder.initialize() å®Ÿè¡Œå®Œäº†
VM443:318 âœ… PolygonGeneratoræ¥ç¶šç¢ºèª
VM454:132 
2ï¸âƒ£ WebGPUåˆæœŸåŒ–...
VM454:64 === WebGPUæ‰‹å‹•åˆæœŸåŒ– ===
VM454:74 âœ… WebGPUå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶
VM454:90 
ğŸ“¦ WebGPUDrawingLayeråˆæœŸåŒ–ä¸­...
webgpu-drawing-layer.js:42 The powerPreference option is currently ignored when calling requestAdapter() on Windows. See https://crbug.com/369219127
initialize @ webgpu-drawing-layer.js:42
window.initWebGPU @ VM454:93
window.initFullWebGPU @ VM454:133
ï¼ˆåŒ¿åï¼‰ @ VM470:1
PromiseÂ {<pending>}
webgpu-drawing-layer.js:86 [WebGPU] Init failed: TypeError: this.device.createShaderModule is not a function
    at WebGPUComputeMSDF.initialize (webgpu-compute-msdf.js:25:45)
    at async WebGPUDrawingLayer.initialize (webgpu-drawing-layer.js:78:21)
    at async window.initWebGPU (<anonymous>:93:25)
    at async window.initFullWebGPU (<anonymous>:133:27)
initialize @ webgpu-drawing-layer.js:86
await in initialize
window.initWebGPU @ VM454:93
window.initFullWebGPU @ VM454:133
ï¼ˆåŒ¿åï¼‰ @ VM470:1
VM454:110 âŒ åˆæœŸåŒ–å¤±æ•—
VM454:136 
âŒ WebGPUåˆæœŸåŒ–å¤±æ•— - ãƒã‚¹ã‚¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã‚¹ã‚­ãƒƒãƒ—


ç¾åœ¨ã®çŠ¶æ³ã¾ã¨ã‚
é …ç›®çŠ¶æ…‹å¯¾å¿œPerfectFreehandâœ… å®Œå…¨å‹•ä½œå®Œäº†
PolygonGeneratorâœ… 48ç‚¹ç”Ÿæˆå®Œäº†
StrokeRecorderâœ… æ¥ç¶šæ¸ˆã¿å®Œäº†
WebGPUDrawingLayerâŒ æœªåˆæœŸåŒ–initWebGPUFromCore()
WebGPUMaskLayerâŒ å¾…æ©Ÿä¸­WebGPUåˆæœŸåŒ–å¾Œã«è‡ªå‹•å®Ÿè¡Œ
