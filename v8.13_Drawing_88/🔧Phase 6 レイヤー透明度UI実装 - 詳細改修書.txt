================================================================================
Phase 6: ãƒ¬ã‚¤ãƒ¤ãƒ¼é€æ˜åº¦UIå®Ÿè£… - è©³ç´°æ”¹ä¿®æ›¸
================================================================================

ã€æ¦‚è¦ã€‘
ä¸€èˆ¬ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆéèƒŒæ™¯ï¼‰ã«é€æ˜åº¦èª¿æ•´æ©Ÿèƒ½ã‚’å®Ÿè£…
ç¾çŠ¶ã®å•é¡Œç‚¹5ä»¶ã‚’åŒæ™‚ã«ä¿®æ­£

ã€ä¿®æ­£å¯¾è±¡ã®å•é¡Œã€‘
1. ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«æ ã«æ–‡å­—ãŒåã¾ã£ã¦ã„ãªã„ï¼ˆä¸Šä¸‹ä½™ç™½ï¼‰
2. å‰Šé™¤ãƒœã‚¿ãƒ³ãŒã‚µãƒ ãƒã‚¤ãƒ«ã¨é‡è¤‡å›é¿ã—ã¦ã„ã‚‹
3. å‰Šé™¤ãƒœã‚¿ãƒ³ã®è‰²ãŒä»•æ§˜ã¨ç•°ãªã‚‹
4. ã‚µãƒ ãƒã‚¤ãƒ«ãƒªã‚µã‚¤ã‚ºæ™‚ã«å¤ã„ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒè¦‹ãˆã‚‹
5. ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã‚«ãƒ¡ãƒ©ãƒ•ãƒ¬ãƒ¼ãƒ å¤–ã«è¡¨ç¤ºã•ã‚Œã‚‹
6. ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæ‹¡å¤§ç¸®å°ã®å½±éŸ¿ã‚’å—ã‘ã¦ã„ã‚‹


================================================================================
â–  ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ä¿¯ç°å›³
================================================================================

ã€æç”»ãƒ•ãƒ­ãƒ¼ã€‘
User Interaction
  â†’ layer-panel-renderer.js (UIæç”»ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆ)
  â†’ EventBus.emit('ui:layer-opacity-change-requested')
  â†’ layer-system.js (ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†ãƒ»çŠ¶æ…‹æ›´æ–°)
  â†’ PIXI Container.alpha æ›´æ–°
  â†’ EventBus.emit('layer:opacity-changed')
  â†’ thumbnail-system.js (ã‚µãƒ ãƒã‚¤ãƒ«å†ç”Ÿæˆ)
  â†’ layer-panel-renderer.js (UIå†æç”»)

ã€é–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€‘
- layer-panel-renderer.js : UIãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå—ä»˜
- layer-system.js : ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹ç®¡ç†ã€PIXIã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ“ä½œ
- thumbnail-system.js : ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒç”Ÿæˆ
- camera-system.js : ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³é…ç½®ãƒ»ã‚«ãƒ¡ãƒ©ãƒ•ãƒ¬ãƒ¼ãƒ ç®¡ç†
- data-models.js : LayerModelå®šç¾©
- main.css : ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©


================================================================================
â–  ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥æ”¹ä¿®å†…å®¹
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ui/layer-panel-renderer.js                                    â”‚
â”‚    å½¹å‰²: ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«UIæç”»ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€æ”¹ä¿®ç®‡æ‰€A: createLayerElement() - é€æ˜åº¦UIè¿½åŠ ã€‘
ä½ç½®: æ—¢å­˜ã® visibility, name, thumbnail, delete è¦ç´ ä½œæˆå¾Œ
å‡¦ç†: éèƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã¿é€æ˜åº¦ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«è¿½åŠ 

å®Ÿè£…:
```
if (!layer.layerData?.isBackground) {
    const opacityContainer = document.createElement('div');
    opacityContainer.className = 'layer-opacity-control';
    
    // â—€ ãƒœã‚¿ãƒ³
    const decreaseBtn = document.createElement('button');
    decreaseBtn.textContent = 'â—€';
    decreaseBtn.className = 'layer-opacity-btn layer-opacity-decrease';
    decreaseBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        this._adjustLayerOpacity(index, -0.1);
    });
    
    // é€æ˜åº¦è¡¨ç¤ºï¼ˆãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ï¼‰
    const opacityValue = document.createElement('span');
    opacityValue.className = 'layer-opacity-value';
    const opacity = layer.alpha !== undefined ? layer.alpha : 1.0;
    opacityValue.textContent = `${Math.round(opacity * 100)}%`;
    this._setupOpacityDrag(opacityValue, index);
    
    // â–¶ ãƒœã‚¿ãƒ³
    const increaseBtn = document.createElement('button');
    increaseBtn.textContent = 'â–¶';
    increaseBtn.className = 'layer-opacity-btn layer-opacity-increase';
    increaseBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        this._adjustLayerOpacity(index, 0.1);
    });
    
    opacityContainer.appendChild(decreaseBtn);
    opacityContainer.appendChild(opacityValue);
    opacityContainer.appendChild(increaseBtn);
    layerDiv.appendChild(opacityContainer);
}
```

ã€æ”¹ä¿®ç®‡æ‰€B: _setupOpacityDrag() - æ–°è¦ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ ã€‘
ä½ç½®: ã‚¯ãƒ©ã‚¹å†…ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦è¿½åŠ 
å‡¦ç†: é€æ˜åº¦å€¤ã®ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œ

å®Ÿè£…:
```
_setupOpacityDrag(element, layerIndex) {
    let isDragging = false;
    let startX = 0;
    let startOpacity = 0;
    
    element.addEventListener('pointerdown', (e) => {
        isDragging = true;
        startX = e.clientX;
        const layer = this.layerSystem.getLayers()[layerIndex];
        startOpacity = layer.alpha !== undefined ? layer.alpha : 1.0;
        element.setPointerCapture(e.pointerId);
        e.stopPropagation();
    });
    
    element.addEventListener('pointermove', (e) => {
        if (!isDragging) return;
        const dx = e.clientX - startX;
        const delta = dx / 100;
        const newOpacity = Math.max(0, Math.min(1, startOpacity + delta));
        this._setLayerOpacity(layerIndex, newOpacity);
    });
    
    element.addEventListener('pointerup', (e) => {
        if (!isDragging) return;
        isDragging = false;
        element.releasePointerCapture(e.pointerId);
    });
}
```

ã€æ”¹ä¿®ç®‡æ‰€C: _adjustLayerOpacity() - æ–°è¦ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ ã€‘
ä½ç½®: ã‚¯ãƒ©ã‚¹å†…ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦è¿½åŠ 
å‡¦ç†: ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ã®Â±10%èª¿æ•´

å®Ÿè£…:
```
_adjustLayerOpacity(layerIndex, delta) {
    const layer = this.layerSystem.getLayers()[layerIndex];
    const currentOpacity = layer.alpha !== undefined ? layer.alpha : 1.0;
    const newOpacity = Math.max(0, Math.min(1, currentOpacity + delta));
    this._setLayerOpacity(layerIndex, newOpacity);
}
```

ã€æ”¹ä¿®ç®‡æ‰€D: _setLayerOpacity() - æ–°è¦ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ ã€‘
ä½ç½®: ã‚¯ãƒ©ã‚¹å†…ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦è¿½åŠ 
å‡¦ç†: é€æ˜åº¦å¤‰æ›´ã®layer-system.jså‘¼ã³å‡ºã— + UIæ›´æ–°

å®Ÿè£…:
```
_setLayerOpacity(layerIndex, opacity) {
    if (this.layerSystem?.setLayerOpacity) {
        this.layerSystem.setLayerOpacity(layerIndex, opacity);
    }
    
    // UIå³æ™‚æ›´æ–°
    const layers = this.layerSystem.getLayers();
    const reverseIndex = layers.length - 1 - layerIndex;
    const layerDiv = this.container.querySelectorAll('.layer-item')[reverseIndex];
    const opacityValue = layerDiv?.querySelector('.layer-opacity-value');
    if (opacityValue) {
        opacityValue.textContent = `${Math.round(opacity * 100)}%`;
    }
}
```

ã€æ”¹ä¿®ç®‡æ‰€E: å‰Šé™¤ãƒœã‚¿ãƒ³ã¨ã‚µãƒ ãƒã‚¤ãƒ«ã®é‡è¤‡è¨±å¯ã€‘
ä½ç½®: createLayerElement() å†…ã®å‰Šé™¤ãƒœã‚¿ãƒ³ãƒ»ã‚µãƒ ãƒã‚¤ãƒ«é…ç½®
å‡¦ç†: z-indexã§å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’å‰é¢ã«ã€ã‚µãƒ ãƒã‚¤ãƒ«ã¯å¾Œæ–¹ã¸

ä¿®æ­£æ–¹é‡:
- ã‚µãƒ ãƒã‚¤ãƒ«ã‚’å‰Šé™¤ãƒœã‚¿ãƒ³ã®ä¸‹ã«é…ç½®ï¼ˆposition: absoluteä½¿ç”¨ï¼‰
- å‰Šé™¤ãƒœã‚¿ãƒ³ã¯ãƒ›ãƒãƒ¼æ™‚ã®ã¿è¡¨ç¤ºï¼ˆopacityåˆ¶å¾¡ï¼‰


å‚ç…§ãƒ¡ã‚½ãƒƒãƒ‰:
- layerSystem.getLayers() : å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼å–å¾—
- layerSystem.setLayerOpacity(index, opacity) : é€æ˜åº¦è¨­å®š


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. system/layer-system.js                                        â”‚
â”‚    å½¹å‰²: ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹ç®¡ç†ã€PIXIã‚³ãƒ³ãƒ†ãƒŠæ“ä½œ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€æ”¹ä¿®ç®‡æ‰€A: setLayerOpacity() - æ–°è¦ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ ã€‘
ä½ç½®: ã‚¯ãƒ©ã‚¹å†…ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦è¿½åŠ ï¼ˆcreateLayer()ã®å¾Œï¼‰
å‡¦ç†: PIXIã‚³ãƒ³ãƒ†ãƒŠã®alphaãƒ—ãƒ­ãƒ‘ãƒ†ã‚£æ›´æ–° + ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°è¦æ±‚

å®Ÿè£…:
```
setLayerOpacity(layerIndex, opacity) {
    const layers = this.getLayers();
    if (layerIndex < 0 || layerIndex >= layers.length) return;
    
    const layer = layers[layerIndex];
    if (layer.layerData?.isBackground) return;
    
    opacity = Math.max(0, Math.min(1, opacity));
    
    // PIXIã‚³ãƒ³ãƒ†ãƒŠã®alphaæ›´æ–°
    layer.alpha = opacity;
    
    // layerDataã«ã‚‚ä¿å­˜
    if (layer.layerData) {
        layer.layerData.opacity = opacity;
    }
    
    // ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°è¦æ±‚
    this.requestThumbnailUpdate(layerIndex);
    
    // EventBusé€šçŸ¥
    if (this.eventBus) {
        this.eventBus.emit('layer:opacity-changed', {
            layerIndex,
            layerId: layer.layerData?.id,
            opacity
        });
    }
}
```

ã€æ”¹ä¿®ç®‡æ‰€B: createLayer() - opacityåˆæœŸå€¤è¨­å®šã€‘
ä½ç½®: LayerModelç”Ÿæˆæ™‚
å‡¦ç†: layerData.opacity = 1.0 ã‚’æ˜ç¤ºçš„ã«è¨­å®š

è¿½åŠ :
```
layerData.opacity = options.opacity !== undefined ? options.opacity : 1.0;
```

å‚ç…§ãƒ¡ã‚½ãƒƒãƒ‰:
- getLayers() : å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼é…åˆ—å–å¾—
- requestThumbnailUpdate(index) : ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°è¦æ±‚


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. system/data-models.js                                         â”‚
â”‚    å½¹å‰²: ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å®šç¾©                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€æ”¹ä¿®ç®‡æ‰€: LayerModel - opacity ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¿½åŠ ã€‘
ä½ç½®: constructorå†…
å‡¦ç†: opacityãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ1.0ï¼‰

å®Ÿè£…:
```
class LayerModel {
    constructor(options = {}) {
        // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ ...
        this.opacity = options.opacity !== undefined ? options.opacity : 1.0;
    }
}
```


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. styles/main.css                                               â”‚
â”‚    å½¹å‰²: ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€æ”¹ä¿®ç®‡æ‰€A: .layer-item - ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°èª¿æ•´ã€‘
å•é¡Œ: æ–‡å­—ãŒæ ã«åã¾ã£ã¦ã„ãªã„
ä¿®æ­£: padding ã‚’èª¿æ•´ã—ã¦ä½™ç™½ã‚’ç¢ºä¿

ä¿®æ­£å‰:
```
.layer-item {
    padding: 8px;
}
```

ä¿®æ­£å¾Œ:
```
.layer-item {
    padding: 6px 8px;
    line-height: 1.2;
}
```

ã€æ”¹ä¿®ç®‡æ‰€B: .layer-opacity-control - æ–°è¦è¿½åŠ ã€‘
å‡¦ç†: é€æ˜åº¦ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

å®Ÿè£…:
```
.layer-opacity-control {
    display: flex;
    align-items: center;
    gap: 4px;
    grid-column: 2;
    grid-row: 1;
}
```

ã€æ”¹ä¿®ç®‡æ‰€C: .layer-opacity-btn - æ–°è¦è¿½åŠ ã€‘
å‡¦ç†: â—€â–¶ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«

å®Ÿè£…:
```
.layer-opacity-btn {
    background: transparent;
    border: none;
    color: var(--futaba-dark-maroon);
    cursor: pointer;
    font-size: 12px;
    padding: 2px 4px;
}

.layer-opacity-btn:hover {
    color: var(--futaba-accent);
}
```

ã€æ”¹ä¿®ç®‡æ‰€D: .layer-opacity-value - æ–°è¦è¿½åŠ ã€‘
å‡¦ç†: é€æ˜åº¦å€¤è¡¨ç¤ºã®ã‚¹ã‚¿ã‚¤ãƒ«

å®Ÿè£…:
```
.layer-opacity-value {
    font-size: 11px;
    color: var(--futaba-dark-maroon);
    cursor: ew-resize;
    user-select: none;
    min-width: 35px;
    text-align: center;
}
```

ã€æ”¹ä¿®ç®‡æ‰€E: .layer-delete-button - è‰²ä¿®æ­£ã€‘
å•é¡Œ: å‰Šé™¤ãƒœã‚¿ãƒ³ã®è‰²ãŒä»•æ§˜ï¼ˆğŸ“·ï¸å‰Šé™¤ãƒœã‚¿ãƒ³ã®é…è‰².pngï¼‰ã¨ç•°ãªã‚‹
ä¿®æ­£: èƒŒæ™¯è‰²ã¨ãƒ›ãƒãƒ¼è‰²ã‚’ä¿®æ­£

ä¿®æ­£å‰:
```
.layer-delete-button {
    background-color: rgba(255, 0, 0, 0.7);
}

.layer-delete-button:hover {
    background-color: rgba(255, 0, 0, 0.9);
}
```

ä¿®æ­£å¾Œï¼ˆç”»åƒã‹ã‚‰èª­ã¿å–ã£ãŸè‰²ã«åˆã‚ã›ã‚‹ï¼‰:
```
.layer-delete-button {
    background-color: rgba(176, 92, 92, 0.8);
    opacity: 0;
    transition: opacity 0.2s;
}

.layer-item:hover .layer-delete-button {
    opacity: 1;
}

.layer-delete-button:hover {
    background-color: rgba(176, 92, 92, 1);
}
```

ã€æ”¹ä¿®ç®‡æ‰€F: .layer-thumbnail - ã‚µãƒ ãƒã‚¤ãƒ«ã¨å‰Šé™¤ãƒœã‚¿ãƒ³é‡è¤‡è¨±å¯ã€‘
å‡¦ç†: position: relative ã§ã‚µãƒ ãƒã‚¤ãƒ«ã‚’å¾Œæ–¹é…ç½®

è¿½åŠ :
```
.layer-thumbnail {
    position: relative;
    z-index: 1;
}

.layer-delete-button {
    position: absolute;
    z-index: 2;
    top: 4px;
    right: 4px;
}
```


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. system/thumbnail-system.js                                    â”‚
â”‚    å½¹å‰²: ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒç”Ÿæˆ                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€æ”¹ä¿®ç®‡æ‰€A: generateThumbnail() - ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³èƒŒæ™¯çµ±ä¸€ã€‘
å•é¡Œ: ã‚µãƒ ãƒã‚¤ãƒ«ãƒªã‚µã‚¤ã‚ºæ™‚ã«å¤ã„ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒè¦‹ãˆã‚‹
åŸå› : 2ã¤ã®ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè£…ãŒæ··åœ¨
ä¿®æ­£: layer-system.jsã®ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨

ä¿®æ­£æ–¹é‡:
```
generateThumbnail(layer, width, height) {
    // ... æ—¢å­˜ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚³ãƒ¼ãƒ‰ ...
    
    // ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯layer-systemã®å®Ÿè£…ã‚’å‚ç…§
    if (this.layerSystem?.checkerPattern) {
        const checkerTexture = this.renderer.generateTexture(
            this.layerSystem.checkerPattern
        );
        // checkerTextureã‚’èƒŒæ™¯ã¨ã—ã¦ä½¿ç”¨
    }
    
    // ... æ—¢å­˜ã®ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆã‚³ãƒ¼ãƒ‰ ...
}
```

å‚ç…§:
- layerSystem.checkerPattern : çµ±ä¸€ã•ã‚ŒãŸãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. system/camera-system.js                                       â”‚
â”‚    å½¹å‰²: ã‚«ãƒ¡ãƒ©ãƒ•ãƒ¬ãƒ¼ãƒ ç®¡ç†ã€ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³é…ç½®                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€æ”¹ä¿®ç®‡æ‰€A: ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚«ãƒ¡ãƒ©ãƒ•ãƒ¬ãƒ¼ãƒ å¤–éè¡¨ç¤ºã€‘
å•é¡Œ: ã‚«ãƒ¡ãƒ©ãƒ•ãƒ¬ãƒ¼ãƒ å¤–ã«ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
åŸå› : ãƒã‚¹ã‚¯å‡¦ç†ãŒé©ç”¨ã•ã‚Œã¦ã„ãªã„
ä¿®æ­£: ã‚«ãƒ¡ãƒ©ãƒ•ãƒ¬ãƒ¼ãƒ ã¨åŒã‚µã‚¤ã‚ºã®ãƒã‚¹ã‚¯ã‚’é©ç”¨

å®Ÿè£…ä½ç½®: setupWorldContainer() ã¾ãŸã¯ init() å†…

å®Ÿè£…:
```
// ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³åˆæœŸåŒ–æ™‚
if (this.layerSystem?.checkerPattern) {
    const checker = this.layerSystem.checkerPattern;
    
    // ã‚«ãƒ¡ãƒ©ãƒ•ãƒ¬ãƒ¼ãƒ ã¨åŒã‚µã‚¤ã‚ºã®ãƒã‚¹ã‚¯ç”Ÿæˆ
    const mask = new PIXI.Graphics();
    mask.rect(0, 0, this.config.canvas.width, this.config.canvas.height);
    mask.fill({ color: 0xFFFFFF });
    
    checker.mask = mask;
    this.worldContainer.addChild(mask);
}
```

ã€æ”¹ä¿®ç®‡æ‰€B: ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ‹¡å¤§ç¸®å°ç„¡åŠ¹åŒ–ã€‘
å•é¡Œ: ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæ‹¡å¤§ç¸®å°ã®å½±éŸ¿ã‚’å—ã‘ã‚‹
åŸå› : worldContainerã®å­è¦ç´ ã¨ã—ã¦é…ç½®ã•ã‚Œã¦ã„ã‚‹
ä¿®æ­£: ã‚«ãƒ¡ãƒ©å¤‰æ›ã®é€†è¡Œåˆ—ã‚’é©ç”¨

å®Ÿè£…ä½ç½®: update() ã¾ãŸã¯ onZoom() å†…

å®Ÿè£…:
```
updateCheckerPatternScale() {
    if (!this.layerSystem?.checkerPattern) return;
    
    const checker = this.layerSystem.checkerPattern;
    const currentZoom = this.worldContainer.scale.x;
    
    // ã‚«ãƒ¡ãƒ©ã‚ºãƒ¼ãƒ ã®é€†ã‚’é©ç”¨
    checker.scale.set(1 / currentZoom, 1 / currentZoom);
    
    // ä½ç½®ã‚‚èª¿æ•´ï¼ˆå·¦ä¸ŠåŸç‚¹ã‚’ç¶­æŒï¼‰
    const cameraPos = this.worldContainer.position;
    checker.position.set(
        -cameraPos.x / currentZoom,
        -cameraPos.y / currentZoom
    );
}
```

å‚ç…§ãƒ¡ã‚½ãƒƒãƒ‰:
- worldContainer : PIXIã‚³ãƒ³ãƒ†ãƒŠ
- worldContainer.scale : ã‚«ãƒ¡ãƒ©ã‚ºãƒ¼ãƒ 
- worldContainer.position : ã‚«ãƒ¡ãƒ©ä½ç½®


================================================================================
â–  ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼
================================================================================

ã€é€æ˜åº¦å¤‰æ›´ãƒ•ãƒ­ãƒ¼ã€‘
1. User: â—€/â–¶ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ or é€æ˜åº¦å€¤ãƒ‰ãƒ©ãƒƒã‚°
2. layer-panel-renderer.js: _adjustLayerOpacity() ã¾ãŸã¯ _setupOpacityDrag()
3. layer-panel-renderer.js: _setLayerOpacity()
4. layer-system.js: setLayerOpacity()
5. PIXI.Container.alpha æ›´æ–°
6. EventBus.emit('layer:opacity-changed')
7. thumbnail-system.js: ã‚µãƒ ãƒã‚¤ãƒ«å†ç”Ÿæˆ
8. layer-panel-renderer.js: UIå†æç”»ï¼ˆé€æ˜åº¦è¡¨ç¤ºæ›´æ–°ï¼‰

ã€EventBusã€‘
ä½¿ç”¨ã‚¤ãƒ™ãƒ³ãƒˆ:
- 'layer:opacity-changed' : é€æ˜åº¦å¤‰æ›´å®Œäº†é€šçŸ¥
  payload: { layerIndex, layerId, opacity }


================================================================================
â–  ãƒ†ã‚¹ãƒˆé …ç›®
================================================================================

ã€é€æ˜åº¦UIæ©Ÿèƒ½ã€‘
â–¡ éèƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã€Œâ—€ 100% â–¶ã€è¡¨ç¤º
â–¡ èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã¯é€æ˜åº¦UIéè¡¨ç¤º
â–¡ â—€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ â†’ -10%
â–¡ â–¶ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ â†’ +10%
â–¡ é€æ˜åº¦å€¤ãƒ‰ãƒ©ãƒƒã‚° â†’ æ»‘ã‚‰ã‹ã«å¤‰åŒ–
â–¡ 0%ï½100%ç¯„å›²åˆ¶é™
â–¡ é€æ˜åº¦å¤‰æ›´ãŒãƒ¬ã‚¤ãƒ¤ãƒ¼ã«å³åº§ã«åæ˜ 

ã€UIä¿®æ­£ã€‘
â–¡ ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«æ ã«æ–‡å­—ãŒç¶ºéº—ã«åã¾ã‚‹
â–¡ å‰Šé™¤ãƒœã‚¿ãƒ³ãŒã‚µãƒ ãƒã‚¤ãƒ«ã¨é‡ãªã£ã¦ã‚‚å•é¡Œãªã—
â–¡ å‰Šé™¤ãƒœã‚¿ãƒ³ã®è‰²ãŒä»•æ§˜é€šã‚Šï¼ˆrgba(176, 92, 92)ï¼‰
â–¡ ã‚µãƒ ãƒã‚¤ãƒ«ãƒªã‚µã‚¤ã‚ºæ™‚ã«ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒä¸€è²«

ã€ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‘
â–¡ ã‚«ãƒ¡ãƒ©ãƒ•ãƒ¬ãƒ¼ãƒ å†…ã®ã¿è¡¨ç¤º
â–¡ æ‹¡å¤§ç¸®å°ã®å½±éŸ¿ã‚’å—ã‘ãªã„
â–¡ å·¦ä¸ŠåŸç‚¹ã§å±•é–‹
â–¡ èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼éè¡¨ç¤ºæ™‚ã®ã¿è¡¨ç¤º


================================================================================
â–  å®Ÿè£…é †åº
================================================================================

1. data-models.js: LayerModel.opacity è¿½åŠ 
2. layer-system.js: setLayerOpacity() å®Ÿè£…
3. layer-panel-renderer.js: é€æ˜åº¦UIå®Ÿè£…
4. main.css: ã‚¹ã‚¿ã‚¤ãƒ«è¿½åŠ ãƒ»ä¿®æ­£
5. camera-system.js: ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ä¿®æ­£
6. thumbnail-system.js: ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³çµ±ä¸€
7. çµ±åˆãƒ†ã‚¹ãƒˆ


================================================================================
â–  å‚è€ƒè³‡æ–™
================================================================================

ã€é–¢é€£Phaseã€‘
- Phase 2: èƒŒæ™¯ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè£…
  â†’ layer-system.js: _createCheckerPatternBackground()
- Phase 3: æ¶ˆã—ã‚´ãƒ é€æ˜åŒ–ä¿®æ­£
  â†’ é€æ˜åº¦ç¢ºèªã«ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå¿…è¦

ã€ä½¿ç”¨APIã€‘
- PIXI.Container.alpha : ãƒ¬ã‚¤ãƒ¤ãƒ¼é€æ˜åº¦ï¼ˆ0.0ï½1.0ï¼‰
- element.setPointerCapture() : ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ãƒã‚¤ãƒ³ã‚¿ãƒ¼æ•æ‰
- EventBus.emit() : ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«
- EventBus.on() : ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­

ã€ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ•°ã€‘
- --futaba-accent: æ©™è‰²ï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼‰
- --futaba-dark-maroon: èŒ¶è‰²ï¼ˆãƒ†ã‚­ã‚¹ãƒˆï¼‰
- --futaba-light-maroon: #aa5a56ï¼ˆæº–ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼‰


================================================================================
END
================================================================================