================================================================================
Tegaki ãƒ©ã‚¹ã‚¿ãƒ¼ç‰ˆ ãƒ•ã‚¡ã‚¤ãƒ«è¾å…¸ãƒ»æ”¹ä¿®è¨ˆç”»æ›¸ v6.0
PixiJS WebGL2ãƒã‚¤ãƒ†ã‚£ãƒ–çµ±åˆç‰ˆ
================================================================================

ä½œæˆæ—¥: 2024-12-14
åŸºæº–: webgl2_Raster_rev13
å‰ç‰ˆ: v5.1 (Phase B-Emergencyå¤±æ•—)
ç›®çš„: ç‹¬è‡ªWebGL2å‰Šé™¤ãƒ»PixiJS WebGL2æ©Ÿèƒ½å®Œå…¨æ´»ç”¨ãƒ»æ§‹é€ çš„ç«¶åˆã®æ ¹çµ¶

================================================================================
ğŸ“‹ v5.1 ã‹ã‚‰ã®æ ¹æœ¬çš„æ–¹é‡è»¢æ›
================================================================================

ã€v5.1å¤±æ•—ã®æ ¹æœ¬åŸå› ã€‘
âŒ ç‹¬è‡ªWebGL2 Canvasã¨ã®ç‰©ç†åˆ†é›¢ã‚‚å¤±æ•—
   - åˆæœŸåŒ–æ™‚ç‚¹ã§ `window.rasterLayer` ãŒå­˜åœ¨ã—ãªã„
   - RasterLayerãŒç‹¬è‡ªGLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è¦æ±‚
   - WebGL2DrawingLayerãŒæç”»Canvasç”Ÿæˆã™ã‚‹ãŒçµ±åˆå¤±æ•—

ã€ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‹ã‚‰ã®è¨ºæ–­ã€‘
```
Line 171: throw new Error('[WebGL2] âŒ RasterLayer not found');
Line 135: [RasterBrushCore] âŒ Not initialized
updateRenderGroupTransforms.ts:117: r.updateLocalTransform is not a function
RenderGroup.ts:271: Cannot read properties of undefined (reading 'length')
```

**æ§‹é€ çš„å•é¡Œ:**
1. PixiJS v8ã¯WebGL2ãƒ™ãƒ¼ã‚¹ï¼ˆå†…éƒ¨ã§GLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†ï¼‰
2. ç‹¬è‡ªWebGL2å®Ÿè£…ãŒPixiJSã¨ç«¶åˆï¼ˆGLã‚¹ãƒ†ãƒ¼ãƒˆè¡çªï¼‰
3. RasterLayer/BrushStampç­‰ãŒç‹¬è‡ªGLã«ä¾å­˜
4. è»¢é€ãƒ–ãƒªãƒƒã‚¸(GLTextureBridge)ãŒè¤‡é›‘åŒ–ã®åŸå› 

ã€æ­£ã—ã„è§£æ±ºç­–ã€‘
ğŸ¯ **PixiJS WebGL2æ©Ÿèƒ½ã‚’ãƒã‚¤ãƒ†ã‚£ãƒ–æ´»ç”¨**
- ç‹¬è‡ªWebGL2å®Ÿè£…ã‚’å®Œå…¨å‰Šé™¤
- PixiJS Graphicsã§ãƒ©ã‚¹ã‚¿ãƒ¼æç”»
- PixiJS RenderTextureã§ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†
- ãƒ–ãƒ©ã‚·ã‚¹ã‚¿ãƒ³ãƒ—ã¯PixiJS Sprite/Filter
- GLã‚¹ãƒ†ãƒ¼ãƒˆç«¶åˆãŒæ§‹é€ çš„ã«ä¸å¯èƒ½

================================================================================
ç¬¬1éƒ¨: æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ - PixiJSãƒã‚¤ãƒ†ã‚£ãƒ–çµ±åˆ
================================================================================

------------------------------------------------------------------------
1.1 è¨­è¨ˆåŸå‰‡
------------------------------------------------------------------------

ã€åŸºæœ¬æ–¹é‡ã€‘
âœ… PixiJS v8ã®WebGL2æ©Ÿèƒ½ã‚’100%æ´»ç”¨
âœ… ç‹¬è‡ªGLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¯ä¸€åˆ‡ä½œã‚‰ãªã„
âœ… ãƒ¬ã‚¤ãƒ¤ãƒ¼ = PIXI.Container + PIXI.Graphics
âœ… ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ = PIXI.Graphics.moveTo/lineTo/arc
âœ… ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚¹ = PixiJSæ¨™æº–æ©Ÿèƒ½
âœ… ãƒ–ãƒ¬ãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰ = PIXI.BlendMode
âœ… ç­†åœ§ = Graphicsç·šå¹…å‹•çš„å¤‰æ›´

ã€å‰Šé™¤å¯¾è±¡ã€‘
âŒ system/drawing/webgl2/* å…¨ä½“
âŒ system/drawing/raster/raster-layer.js
âŒ system/drawing/raster/raster-brush-core.js
âŒ system/drawing/shader-inline.js
âŒ WebGL2DrawingLayer
âŒ GLTextureBridge
âŒ ç‹¬è‡ªã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ç®¡ç†

ã€ä»£æ›¿å®Ÿè£…ã€‘
âœ… PixiJS Graphics APIã§ãƒ–ãƒ©ã‚·æç”»
âœ… PixiJS RenderTextureã§ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ†ã‚¯ã‚¹ãƒãƒ£
âœ… PixiJS Containeréšå±¤ã§ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†
âœ… PixiJS Filter APIã§ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ

------------------------------------------------------------------------
1.2 ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
------------------------------------------------------------------------

ã€ç¾è¡Œï¼ˆv5.1 å¤±æ•—æ§‹é€ ï¼‰ã€‘
```
ç‹¬è‡ªWebGL2 Canvas (éè¡¨ç¤º)
  â””â”€ RasterLayer (ç‹¬è‡ªFBO/Texture)
     â””â”€ RasterBrushCore (ç‹¬è‡ªæç”»)
        â†“ GLTextureBridgeè»¢é€
PixiJS Canvas (è¡¨ç¤º)
  â””â”€ PIXI.Sprite (å—å‹•è¡¨ç¤º)
```

ã€æ–°æ§‹é€ ï¼ˆv6.0 PixiJSãƒã‚¤ãƒ†ã‚£ãƒ–ï¼‰ã€‘
```
PixiJS Canvas (å˜ä¸€)
  â””â”€ worldContainer (PIXI.Container)
     â””â”€ canvasContainer (PIXI.Container)
        â””â”€ ãƒ¬ã‚¤ãƒ¤ãƒ¼Container (PIXI.Container)
           â””â”€ drawingGraphics (PIXI.Graphics)
           â””â”€ renderTexture (PIXI.RenderTexture)
```

**ç‰¹å¾´:**
- ãƒ¬ã‚¤ãƒ¤ãƒ¼ã”ã¨ã«PIXI.Container
- å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«PIXI.Graphicsï¼ˆæç”»ç”¨ï¼‰
- å¿…è¦æ™‚ã«RenderTextureã¸ãƒ™ã‚¤ã‚¯
- å…¨ã¦PixiJSã®ç®¡è½„ä¸‹

------------------------------------------------------------------------
1.3 ãƒ–ãƒ©ã‚·æç”»ãƒ•ãƒ­ãƒ¼
------------------------------------------------------------------------

ã€ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯æç”»ã€‘
```javascript
// 1. PointerEventå–å¾—ï¼ˆPixiJS InteractionManagerä¸ä½¿ç”¨ï¼‰
canvas.addEventListener('pointermove', (e) => {
  
  // 2. åº§æ¨™å¤‰æ›ï¼ˆæ—¢å­˜coordinate-system.jsä½¿ç”¨ï¼‰
  const canvasPos = screenClientToCanvas(e.clientX, e.clientY);
  const worldPos = canvasToWorld(canvasPos.x, canvasPos.y);
  const localPos = worldToLocal(worldPos.x, worldPos.y, layerContainer);
  
  // 3. ãƒ–ãƒ©ã‚·æç”»ï¼ˆPIXI.Graphicsï¼‰
  const graphics = layerContainer.drawingGraphics;
  graphics.lineStyle({
    width: brushSize * pressure,
    color: brushColor,
    alpha: brushOpacity,
    cap: PIXI.LINE_CAP.ROUND,
    join: PIXI.LINE_JOIN.ROUND
  });
  
  if (isFirstPoint) {
    graphics.moveTo(localPos.x, localPos.y);
  } else {
    graphics.lineTo(localPos.x, localPos.y);
  }
});
```

ã€è£œé–“å®Ÿè£…ã€‘
- BrushInterpolatorç¶™ç¶šä½¿ç”¨
- è£œé–“ç‚¹ã§graphics.lineTo()
- PixiJSè‡ªå‹•ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚¹

ã€æ¶ˆã—ã‚´ãƒ å®Ÿè£…ã€‘
```javascript
// destination-out ãƒ–ãƒ¬ãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰
graphics.blendMode = PIXI.BLEND_MODES.ERASE;
graphics.lineStyle(...);
```

------------------------------------------------------------------------
1.4 ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ†ã‚¯ã‚¹ãƒãƒ£åŒ–
------------------------------------------------------------------------

ã€RenderTextureæ´»ç”¨ã€‘
```javascript
class PixiLayerManager {
  bakelayer(layerId) {
    const layer = this.layers.get(layerId);
    const graphics = layer.drawingGraphics;
    
    // RenderTextureã«æç”»
    if (!layer.renderTexture) {
      layer.renderTexture = PIXI.RenderTexture.create({
        width: this.canvasWidth,
        height: this.canvasHeight
      });
    }
    
    // Graphics â†’ RenderTexture
    this.pixiApp.renderer.render({
      container: graphics,
      target: layer.renderTexture
    });
    
    // Spriteè¡¨ç¤º
    if (!layer.sprite) {
      layer.sprite = new PIXI.Sprite(layer.renderTexture);
      layer.container.addChild(layer.sprite);
    }
    
    // Graphics ã‚¯ãƒªã‚¢ï¼ˆãƒ¡ãƒ¢ãƒªç¯€ç´„ï¼‰
    graphics.clear();
  }
}
```

**åˆ©ç‚¹:**
- GPUå†…ã§å®Œçµï¼ˆè»¢é€ä¸è¦ï¼‰
- ãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„
- PixiJSãŒæœ€é©åŒ–

================================================================================
ç¬¬2éƒ¨: å®Œå…¨ãƒ•ã‚¡ã‚¤ãƒ«è¾å…¸ï¼ˆå‰Šé™¤/æ”¹ä¿®/ç¶™ç¶šä½¿ç”¨ï¼‰
================================================================================

------------------------------------------------------------------------
2.1 ã€å‰Šé™¤ã€‘ç‹¬è‡ªWebGL2ã‚·ã‚¹ãƒ†ãƒ 
------------------------------------------------------------------------

ğŸ“ system/drawing/webgl2/
  ğŸ“„ webgl2-drawing-layer.js âŒå‰Šé™¤
     ç†ç”±: ç‹¬è‡ªCanvas/GLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ
  ğŸ“„ gl-texture-bridge.js âŒå‰Šé™¤
     ç†ç”±: Canvasé–“è»¢é€ãŒä¸è¦

ğŸ“ system/drawing/raster/
  ğŸ“„ raster-layer.js âŒå‰Šé™¤
     ç†ç”±: ç‹¬è‡ªFBO/Textureç®¡ç†
  ğŸ“„ raster-brush-core.js âŒå‰Šé™¤
     ç†ç”±: ç‹¬è‡ªGLæç”»
  ğŸ“„ brush-stamp.js ğŸ”§æ”¹ä¿®
     ç†ç”±: PixiJS Graphics APIã«å¤‰æ›´
  ğŸ“„ brush-interpolator.js âœ…ç¶™ç¶šä½¿ç”¨
     ç†ç”±: è£œé–“ãƒ­ã‚¸ãƒƒã‚¯è‡ªä½“ã¯æœ‰åŠ¹

ğŸ“„ system/drawing/shader-inline.js âŒå‰Šé™¤
   ç†ç”±: ç‹¬è‡ªã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ä¸è¦

------------------------------------------------------------------------
2.2 ã€æ”¹ä¿®ã€‘æç”»ã‚·ã‚¹ãƒ†ãƒ 
------------------------------------------------------------------------

ğŸ“„ system/drawing/brush-core.js ğŸ”§å¤§æ”¹ä¿®
Phase: v6.0-Core
å¤‰æ›´å†…å®¹:
  âŒ å‰Šé™¤: rasterBrushCoreå‚ç…§
  âœ… æ–°è¦: pixiGraphicsBrushå®Ÿè£…
  ğŸ”§ æ”¹ä¿®: startStroke() - PIXI.Graphicsä½¿ç”¨
  ğŸ”§ æ”¹ä¿®: addStrokePoint() - graphics.lineTo()
  ğŸ”§ æ”¹ä¿®: finalizeStroke() - RenderTextureåŒ–
è²¬å‹™: PixiJS Graphicsãƒ™ãƒ¼ã‚¹ã®ãƒ–ãƒ©ã‚·æç”»
è¦ªä¾å­˜: drawing-engine.js
å­ä¾å­˜: brush-interpolator.js
å…¬é–‹API:
  - startStroke(localX, localY, pressure, ...)
  - addStrokePoint(localX, localY, pressure, ...)
  - finalizeStroke()
  - setGraphicsTarget(pixiGraphics)
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.BrushCore

---

ğŸ“„ system/drawing/drawing-engine.js ğŸ”§æ”¹ä¿®
Phase: v6.0-Engine
å¤‰æ›´å†…å®¹:
  âŒ å‰Šé™¤: setRasterBrushCore()
  âœ… æ–°è¦: setPixiLayerManager()
  ğŸ”§ æ”¹ä¿®: _handlePointerDown() - ãƒ¬ã‚¤ãƒ¤ãƒ¼Graphicså–å¾—
  ğŸ”§ æ”¹ä¿®: _handlePointerMove() - è£œé–“Graphicsæç”»
  ğŸ”§ æ”¹ä¿®: _handlePointerUp() - RenderTextureåŒ–
è²¬å‹™: PointerEventâ†’åº§æ¨™å¤‰æ›â†’ãƒ–ãƒ©ã‚·æç”»çµ±åˆ
è¦ªä¾å­˜: core-engine.js
å­ä¾å­˜: brush-core.js, stroke-recorder.js, pointer-handler.js
å…¬é–‹API:
  - initialize()
  - startDrawing()
  - updateDrawing()
  - endDrawing()
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.DrawingEngine

---

ğŸ“„ system/layer-system.js ğŸ”§å¤§æ”¹ä¿®
Phase: v6.0-Layer
å¤‰æ›´å†…å®¹:
  âŒ å‰Šé™¤: _receiveTransferredTexture()
  âŒ å‰Šé™¤: è»¢é€ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
  âœ… æ–°è¦: createLayerGraphics(layerId)
  âœ… æ–°è¦: bakeLayerToTexture(layerId)
  ğŸ”§ æ”¹ä¿®: addLayer() - Container + Graphicsç”Ÿæˆ
  ğŸ”§ æ”¹ä¿®: getLayerGraphics(layerId)
è²¬å‹™: PixiJS Container/Graphics/RenderTextureãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†
è¦ªä¾å­˜: core-engine.js
å­ä¾å­˜: ãªã—
å…¬é–‹API:
  - addLayer()
  - removeLayer()
  - getActiveLayerGraphics()
  - bakeLayerToTexture(layerId)
  - getLayerContainer(layerId)
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.LayerSystem

---

ğŸ“„ system/drawing/brush-interpolator.js âœ…ç¶™ç¶šä½¿ç”¨
Phase: å¤‰æ›´ãªã—
å¤‰æ›´å†…å®¹: ãªã—
ç†ç”±: è£œé–“ãƒ­ã‚¸ãƒƒã‚¯ã¯ç‹¬ç«‹ã—ã¦ãŠã‚Šæœ‰åŠ¹
è²¬å‹™: ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆè£œé–“è¨ˆç®—
è¦ªä¾å­˜: brush-core.js
å­ä¾å­˜: ãªã—
å…¬é–‹API:
  - interpolate(startPoint, endPoint, distance)
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.brushInterpolator

---

ğŸ“„ system/drawing/stroke-recorder.js âœ…ç¶™ç¶šä½¿ç”¨
Phase: å¤‰æ›´ãªã—
å¤‰æ›´å†…å®¹: ãªã—
ç†ç”±: åº§æ¨™è¨˜éŒ²ã‚·ã‚¹ãƒ†ãƒ ã¯æœ‰åŠ¹
è²¬å‹™: ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆè¨˜éŒ²ãƒ»å±¥æ­´ç®¡ç†
è¦ªä¾å­˜: drawing-engine.js
å­ä¾å­˜: ãªã—
å…¬é–‹API:
  - startStroke()
  - addPoint(x, y, pressure, ...)
  - finalizeStroke()
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.StrokeRecorder

---

ğŸ“„ system/drawing/pointer-handler.js âœ…ç¶™ç¶šä½¿ç”¨
Phase: å¤‰æ›´ãªã—
å¤‰æ›´å†…å®¹: ãªã—
ç†ç”±: PointerEventãƒ©ãƒƒãƒ‘ãƒ¼ã¯æœ‰åŠ¹
è²¬å‹™: PointerEventæ­£è¦åŒ–ãƒ»ç­†åœ§å–å¾—
è¦ªä¾å­˜: drawing-engine.js
å­ä¾å­˜: pressure-handler.js
å…¬é–‹API:
  - onPointerDown()
  - onPointerMove()
  - onPointerUp()
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.PointerHandler

---

ğŸ“„ system/drawing/pressure-handler.js âœ…ç¶™ç¶šä½¿ç”¨
Phase: å¤‰æ›´ãªã—
å¤‰æ›´å†…å®¹: ãªã—
ç†ç”±: ç­†åœ§ã‚«ãƒ¼ãƒ–è¨ˆç®—ã¯æœ‰åŠ¹
è²¬å‹™: ç­†åœ§å€¤æ­£è¦åŒ–ãƒ»ã‚«ãƒ¼ãƒ–é©ç”¨
è¦ªä¾å­˜: pointer-handler.js
å­ä¾å­˜: ãªã—
å…¬é–‹API:
  - normalizePressure(rawPressure)
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.PressureHandler

------------------------------------------------------------------------
2.3 ã€ç¶™ç¶šä½¿ç”¨ã€‘ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«
------------------------------------------------------------------------

ğŸ“„ coordinate-system.js âœ…ç¶™ç¶šä½¿ç”¨
Phase: å¤‰æ›´ãªã—
è²¬å‹™: åº§æ¨™å¤‰æ›ï¼ˆScreen/Canvas/World/Localï¼‰
è¦ªä¾å­˜: drawing-engine.js
å­ä¾å­˜: ãªã—
å…¬é–‹API:
  - screenClientToCanvas()
  - canvasToWorld()
  - worldToLocal()
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.CoordinateSystem

---

ğŸ“„ system/camera-system.js âœ…ç¶™ç¶šä½¿ç”¨
Phase: å¤‰æ›´ãªã—
è²¬å‹™: worldContainerå¤‰æ›ãƒ»ã‚ºãƒ¼ãƒ ãƒ»ãƒ‘ãƒ³
è¦ªä¾å­˜: core-engine.js
å­ä¾å­˜: ãªã—
å…¬é–‹API:
  - setZoom()
  - pan()
  - resetCamera()
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.cameraSystem

---

ğŸ“„ system/settings-manager.js âœ…ç¶™ç¶šä½¿ç”¨
Phase: å¤‰æ›´ãªã—
è²¬å‹™: ãƒ–ãƒ©ã‚·è¨­å®šãƒ»ã‚­ãƒ£ãƒ³ãƒã‚¹è¨­å®šç®¡ç†
è¦ªä¾å­˜: core-engine.js
å­ä¾å­˜: ãªã—
å…¬é–‹API:
  - getBrushSize()
  - getBrushOpacity()
  - getBrushColor()
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.settingsManager

---

ğŸ“„ system/history.js âœ…ç¶™ç¶šä½¿ç”¨
Phase: å¤‰æ›´ãªã—
è²¬å‹™: Undo/Redoå±¥æ­´ç®¡ç†
è¦ªä¾å­˜: brush-core.js
å­ä¾å­˜: ãªã—
å…¬é–‹API:
  - execute()
  - undo()
  - redo()
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.History

---

ğŸ“„ system/event-bus.js âœ…ç¶™ç¶šä½¿ç”¨
Phase: å¤‰æ›´ãªã—
è²¬å‹™: ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¹
è¦ªä¾å­˜: å…¨ã‚·ã‚¹ãƒ†ãƒ 
å­ä¾å­˜: ãªã—
å…¬é–‹API:
  - on()
  - emit()
  - off()
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.TegakiEventBus

------------------------------------------------------------------------
2.4 ã€è»½æ”¹ä¿®ã€‘åˆæœŸåŒ–ã‚·ã‚¹ãƒ†ãƒ 
------------------------------------------------------------------------

ğŸ“„ core-initializer.js ğŸ”§è»½æ”¹ä¿®
Phase: v6.0-Init
å¤‰æ›´å†…å®¹:
  âŒ å‰Šé™¤: initializeWebGL2() å…¨ä½“ï¼ˆ200è¡Œï¼‰
  âœ… ç°¡ç´ åŒ–: PixiJSåˆæœŸåŒ–ã®ã¿
  ğŸ”§ æ”¹ä¿®: PixiJS preferenceã‚’webgl2ç¶­æŒ
è²¬å‹™: ã‚¢ãƒ—ãƒªåˆæœŸåŒ–
è¦ªä¾å­˜: index.html
å­ä¾å­˜: core-engine.js
å…¬é–‹API:
  - initialize()
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.CoreInitializer

---

ğŸ“„ core-engine.js ğŸ”§è»½æ”¹ä¿®
Phase: v6.0-Core
å¤‰æ›´å†…å®¹:
  âŒ å‰Šé™¤: rasterBrushCoreé–¢é€£ï¼ˆ30è¡Œï¼‰
  âœ… ç°¡ç´ åŒ–: PixiJSãƒ™ãƒ¼ã‚¹ã‚·ã‚¹ãƒ†ãƒ çµ±åˆ
è²¬å‹™: ã‚³ã‚¢ã‚¨ãƒ³ã‚¸ãƒ³çµ±åˆ
è¦ªä¾å­˜: core-initializer.js
å­ä¾å­˜: layer-system.js, drawing-engine.js
å…¬é–‹API:
  - initialize()
  - getLayerManager()
  - getDrawingEngine()
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.coreEngine

------------------------------------------------------------------------
2.5 ã€ç¶™ç¶šä½¿ç”¨ã€‘UIã‚·ã‚¹ãƒ†ãƒ 
------------------------------------------------------------------------

ğŸ“ ui/* âœ…å…¨ã¦ç¶™ç¶šä½¿ç”¨
å¤‰æ›´å†…å®¹: ãªã—
ç†ç”±: UIå±¤ã¯æç”»å®Ÿè£…ã«ä¾å­˜ã—ãªã„

------------------------------------------------------------------------
2.6 ã€ç¶™ç¶šä½¿ç”¨ã€‘ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ 
------------------------------------------------------------------------

ğŸ“ system/exporters/* âœ…å…¨ã¦ç¶™ç¶šä½¿ç”¨
å¤‰æ›´å†…å®¹: ãªã—
ç†ç”±: RenderTexture/Canvasã‹ã‚‰ã®å‡ºåŠ›ã¯åŒã˜

================================================================================
ç¬¬3éƒ¨: æ”¹ä¿®è¨ˆç”»
================================================================================

------------------------------------------------------------------------
Phase v6.0-Emergency: PixiJS Graphicsçµ±åˆï¼ˆæœ€å„ªå…ˆãƒ»6-8æ™‚é–“ï¼‰
------------------------------------------------------------------------

ğŸ¯ ç›®æ¨™: ç‹¬è‡ªWebGL2å®Œå…¨å‰Šé™¤ãƒ»PixiJS Graphicsæç”»å®Ÿç¾

---

ğŸš¨ E-1. ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ãƒ»ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆ30åˆ†ï¼‰

å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«:
  âŒ system/drawing/webgl2/webgl2-drawing-layer.js
  âŒ system/drawing/webgl2/gl-texture-bridge.js
  âŒ system/drawing/raster/raster-layer.js
  âŒ system/drawing/raster/raster-brush-core.js
  âŒ system/drawing/shader-inline.js

index.htmlä¿®æ­£:
  - ä¸Šè¨˜ãƒ•ã‚¡ã‚¤ãƒ«ã®<script>ã‚¿ã‚°å‰Šé™¤

æœŸå¾…åŠ¹æœ:
âœ… ç«¶åˆåŸå› ã®ç‰©ç†çš„å‰Šé™¤
âœ… ã‚³ãƒ¼ãƒ‰ç·é‡-2000è¡Œä»¥ä¸Šå‰Šæ¸›

---

ğŸš¨ E-2. PixiJS Graphics ãƒ–ãƒ©ã‚·ã‚³ã‚¢å®Ÿè£…ï¼ˆ3æ™‚é–“ï¼‰

å¯¾è±¡: system/drawing/brush-core.js

æ–°è¦å®Ÿè£…:
```javascript
class BrushCore {
  constructor() {
    this.currentGraphics = null;
    this.currentLayerId = null;
    this.brushInterpolator = null;
    this.strokeActive = false;
  }

  initialize() {
    this.brushInterpolator = window.brushInterpolator;
    console.log('[BrushCore] âœ… PixiJS Graphics mode');
  }

  setGraphicsTarget(pixiGraphics, layerId) {
    this.currentGraphics = pixiGraphics;
    this.currentLayerId = layerId;
  }

  startStroke(localX, localY, pressure, ...) {
    if (!this.currentGraphics) {
      console.error('[BrushCore] No graphics target');
      return;
    }

    const brushSize = this._getBrushSize(pressure);
    const brushColor = this._getBrushColor();
    const brushOpacity = this._getBrushOpacity();

    this.currentGraphics.lineStyle({
      width: brushSize,
      color: brushColor,
      alpha: brushOpacity,
      cap: PIXI.LINE_CAP.ROUND,
      join: PIXI.LINE_JOIN.ROUND
    });

    this.currentGraphics.moveTo(localX, localY);
    this.lastPoint = { localX, localY, pressure };
    this.strokeActive = true;
  }

  addStrokePoint(localX, localY, pressure, ...) {
    if (!this.strokeActive) return;

    const lastPoint = this.lastPoint;
    const distance = Math.hypot(
      localX - lastPoint.localX,
      localY - lastPoint.localY
    );

    const brushSize = this._getBrushSize(pressure);

    if (distance > brushSize * 0.5) {
      // è£œé–“
      const interpolated = this.brushInterpolator.interpolate(
        lastPoint,
        { localX, localY, pressure },
        distance
      );

      for (const point of interpolated) {
        const size = this._getBrushSize(point.pressure);
        this.currentGraphics.lineStyle({ width: size });
        this.currentGraphics.lineTo(point.localX, point.localY);
      }
    } else {
      this.currentGraphics.lineStyle({ width: brushSize });
      this.currentGraphics.lineTo(localX, localY);
    }

    this.lastPoint = { localX, localY, pressure };
  }

  async finalizeStroke() {
    this.strokeActive = false;

    // RenderTextureåŒ–ã¯ layer-system ã«å§”è­²
    window.TegakiEventBus.emit('stroke:finalized', {
      layerId: this.currentLayerId
    });
  }

  _getBrushSize(pressure) {
    const baseSize = window.settingsManager.getBrushSize();
    const minSize = window.settingsManager.getPressureMinSize();
    const curve = window.settingsManager.getPressureCurve();

    const curvedPressure = Math.pow(pressure, curve);
    return baseSize * (minSize + (1 - minSize) * curvedPressure);
  }

  _getBrushColor() {
    const color = window.settingsManager.getBrushColor();
    return (color.r << 16) | (color.g << 8) | color.b;
  }

  _getBrushOpacity() {
    return window.settingsManager.getBrushOpacity();
  }
}
```

æœŸå¾…åŠ¹æœ:
âœ… PixiJS Graphicsãƒã‚¤ãƒ†ã‚£ãƒ–æç”»
âœ… ç­†åœ§å¯¾å¿œ
âœ… è£œé–“å‹•ä½œ
âœ… ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚¹è‡ªå‹•

---

ğŸš¨ E-3. LayerSystem PixiJSçµ±åˆï¼ˆ2æ™‚é–“ï¼‰

å¯¾è±¡: system/layer-system.js

æ”¹ä¿®å†…å®¹:
```javascript
class LayerSystem {
  addLayer(name, index) {
    const layerId = this._generateLayerId();

    // Containerä½œæˆ
    const layerContainer = new PIXI.Container();
    layerContainer.name = `Layer_${layerId}`;

    // Graphicsä½œæˆï¼ˆæç”»ç”¨ï¼‰
    const drawingGraphics = new PIXI.Graphics();
    layerContainer.addChild(drawingGraphics);

    // RenderTextureï¼ˆå¿…è¦æ™‚ä½œæˆï¼‰
    let renderTexture = null;
    let sprite = null;

    // ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ç™»éŒ²
    this.layers.set(layerId, {
      id: layerId,
      name: name,
      container: layerContainer,
      drawingGraphics: drawingGraphics,
      renderTexture: renderTexture,
      sprite: sprite,
      visible: true,
      opacity: 1.0
    });

    // Containerã‚’è¦ªã«è¿½åŠ 
    this.currentFrameContainer.addChild(layerContainer);

    console.log('[LayerSystem] âœ… Layer added (PixiJS native):', layerId);
    return layerId;
  }

  getActiveLayerGraphics() {
    const activeLayer = this.getActiveLayer();
    if (!activeLayer) return null;
    return activeLayer.drawingGraphics;
  }

  bakeLayerToTexture(layerId) {
    const layer = this.layers.get(layerId);
    if (!layer) return;

    const { drawingGraphics, renderTexture, sprite, container } = layer;

    // RenderTextureä½œæˆï¼ˆåˆå›ã®ã¿ï¼‰
    if (!renderTexture) {
      layer.renderTexture = PIXI.RenderTexture.create({
        width: this.canvasWidth,
        height: this.canvasHeight
      });
    }

    // Graphics â†’ RenderTexture
    window.pixiApp.renderer.render({
      container: drawingGraphics,
      target: layer.renderTexture
    });

    // Spriteä½œæˆï¼ˆåˆå›ã®ã¿ï¼‰
    if (!sprite) {
      layer.sprite = new PIXI.Sprite(layer.renderTexture);
      container.addChildAt(layer.sprite, 0);
    } else {
      sprite.texture = layer.renderTexture;
    }

    // Graphics ã‚¯ãƒªã‚¢
    drawingGraphics.clear();

    console.log('[LayerSystem] âœ… Layer baked:', layerId);
  }
}
```

ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¿½åŠ :
```javascript
window.TegakiEventBus.on('stroke:finalized', (data) => {
  this.bakeLayerToTexture(data.layerId);
});
```

æœŸå¾…åŠ¹æœ:
âœ… ãƒ¬ã‚¤ãƒ¤ãƒ¼ = Container + Graphics
âœ… æç”»å®Œäº†æ™‚ã«è‡ªå‹•RenderTextureåŒ–
âœ… ãƒ¡ãƒ¢ãƒªåŠ¹ç‡åŒ–

---

ğŸš¨ E-4. DrawingEngineçµ±åˆä¿®æ­£ï¼ˆ2æ™‚é–“ï¼‰

å¯¾è±¡: system/drawing/drawing-engine.js

æ”¹ä¿®å†…å®¹:
```javascript
class DrawingEngine {
  _handlePointerDown(e) {
    // åº§æ¨™å¤‰æ›ï¼ˆæ—¢å­˜ï¼‰
    const canvasPos = this._screenClientToCanvas(e.clientX, e.clientY);
    const worldPos = this._canvasToWorld(canvasPos.x, canvasPos.y);
    const localPos = this._worldToLocal(worldPos.x, worldPos.y);

    // ãƒ¬ã‚¤ãƒ¤ãƒ¼Graphicså–å¾—
    const graphics = window.layerSystem.getActiveLayerGraphics();
    if (!graphics) {
      console.error('[DrawingEngine] No active layer graphics');
      return;
    }

    // BrushCoreã«Graphicsè¨­å®š
    const activeLayer = window.layerSystem.getActiveLayer();
    this.brushCore.setGraphicsTarget(graphics, activeLayer.id);

    // ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯é–‹å§‹
    this.brushCore.startStroke(
      localPos.x,
      localPos.y,
      e.pressure,
      e.tiltX,
      e.tiltY,
      e.twist
    );

    // StrokeRecorderè¨˜éŒ²
    this.strokeRecorder.startStroke(localPos.x, localPos.y, e.pressure, ...);
  }

  _handlePointerMove(e) {
    // åº§æ¨™å¤‰æ›
    const localPos = this._worldToLocal(...);

    // ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯æç”»
    this.brushCore.addStrokePoint(
      localPos.x,
      localPos.y,
      e.pressure,
      e.tiltX,
      e.tiltY,
      e.twist
    );

    // StrokeRecorderè¨˜éŒ²
    this.strokeRecorder.addPoint(localPos.x, localPos.y, e.pressure, ...);
  }

  _handlePointerUp(e) {
    // ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯å®Œäº†
    this.brushCore.finalizeStroke();
    this.strokeRecorder.finalizeStroke();
  }
}
```

æœŸå¾…åŠ¹æœ:
âœ… åº§æ¨™å¤‰æ›ãƒ•ãƒ­ãƒ¼ç¶­æŒ
âœ… Graphicsè‡ªå‹•è¨­å®š
âœ… ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•RenderTextureåŒ–

---

ğŸš¨ E-5. Core-Initializerç°¡ç´ åŒ–ï¼ˆ1æ™‚é–“ï¼‰

å¯¾è±¡: core-initializer.js

å‰Šé™¤å†…å®¹:
  âŒ initializeWebGL2() é–¢æ•°å…¨ä½“
  âŒ WebGL2é–¢é€£å‡¦ç†å…¨ã¦

ç°¡ç´ åŒ–:
```javascript
async initialize() {
  // PixiJSåˆæœŸåŒ–ï¼ˆæ—¢å­˜ï¼‰
  this.pixiApp = new PIXI.Application();
  await this.pixiApp.init({
    width: screenWidth,
    height: screenHeight,
    backgroundAlpha: 0,
    resolution: 2,
    antialias: true,
    preference: 'webgl2', // WebGL2å„ªå…ˆç¶­æŒ
    powerPreference: 'high-performance'
  });

  // CoreEngineåˆæœŸåŒ–ï¼ˆæ—¢å­˜ï¼‰
  this.coreEngine = new CoreEngine(this.pixiApp);
  this.coreEngine.initialize();

  // âœ… WebGL2åˆæœŸåŒ–å‰Šé™¤ï¼ˆä¸è¦ï¼‰
  console.log('[DrawingApp] âœ… PixiJS native mode ready');
}
```

æœŸå¾…åŠ¹æœ:
âœ… åˆæœŸåŒ–ã‚³ãƒ¼ãƒ‰-200è¡Œå‰Šæ¸›
âœ… è¤‡é›‘åº¦æ¿€æ¸›

---

ğŸš¨ E-6. Core-Engineç°¡ç´ åŒ–ï¼ˆ30åˆ†ï¼‰

å¯¾è±¡: core-engine.js

å‰Šé™¤å†…å®¹:
  âŒ rasterBrushCoreé–¢é€£å…¨ã¦
  âŒ WebGL2DrawingLayeré–¢é€£

ç°¡ç´ åŒ–:
```javascript
initialize() {
  // BrushCoreåˆæœŸåŒ–ï¼ˆæ—¢å­˜ãƒ»PixiJSç‰ˆï¼‰
  this.brushCore = new window.BrushCore();
  this.brushCore.initialize();

  // âœ… rasterBrushCoreå‰Šé™¤ï¼ˆä¸è¦ï¼‰
  console.log('[CoreEngine] âœ… PixiJS Graphics brush ready');
}
```

æœŸå¾…åŠ¹æœ:
âœ… ã‚³ãƒ¼ãƒ‰ç°¡ç´ åŒ–

---

ã€Phase v6.0-Emergencyå®Œäº†æ¡ä»¶ã€‘
â–¡ ãƒšãƒ³ã§ç·šãŒå¼•ã‘ã‚‹
â–¡ ç­†åœ§ãŒåæ˜ ã•ã‚Œã‚‹
â–¡ ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚¹ãŒåŠ¹ã„ã¦ã„ã‚‹
â–¡ ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ‡ã‚Šæ›¿ãˆãŒå‹•ä½œ
â–¡ Undo/RedoãŒå‹•ä½œ
â–¡ WebGLã‚¨ãƒ©ãƒ¼ãŒå‡ºãªã„
â–¡ PixiJSã‚¨ãƒ©ãƒ¼ãŒå‡ºãªã„
â–¡ 60fpsç¶­æŒ
â–¡ ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ç„¡ã—

------------------------------------------------------------------------
Phase v6.1: é«˜åº¦ãªãƒ–ãƒ©ã‚·æ©Ÿèƒ½ï¼ˆEå®Œäº†å¾Œãƒ»2-3æ—¥ï¼‰
------------------------------------------------------------------------

v6.1-A: ãƒ–ãƒ©ã‚·ãƒ†ã‚¯ã‚¹ãƒãƒ£å®Ÿè£…ï¼ˆ1æ—¥ï¼‰
- PIXI.Sprite/Textureã§ã‚«ã‚¹ã‚¿ãƒ ãƒ–ãƒ©ã‚·
- ã‚¹ã‚¿ãƒ³ãƒ—é€£ç¶šæç”»
- å›è»¢ãƒ»ã‚¹ã‚±ãƒ¼ãƒ«å¯¾å¿œ

v6.1-B: ãƒ–ãƒ¬ãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰å®Ÿè£…ï¼ˆ1æ—¥ï¼‰
- PIXI.BLEND_MODESæ´»ç”¨
- ä¹—ç®—ãƒ»ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ»ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ç­‰
- ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ–ãƒ¬ãƒ³ãƒ‰

v6.1-C: ã‚¨ãƒ•ã‚§ã‚¯ãƒˆå®Ÿè£…ï¼ˆ1æ—¥ï¼‰
- PIXI.Filteræ´»ç”¨
- ã¼ã‹ã—ãƒ»ã‚·ãƒ£ãƒ¼ãƒ—ãƒ»è‰²èª¿è£œæ­£
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼

------------------------------------------------------------------------
Phase v6.2: æœ€é©åŒ–ï¼ˆv6.1å®Œäº†å¾Œãƒ»1-2æ—¥ï¼‰
------------------------------------------------------------------------

v6.2-A: ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–ï¼ˆ1æ—¥ï¼‰
- RenderTextureè‡ªå‹•ãƒ™ã‚¤ã‚¯é–¾å€¤
- Graphicså®šæœŸã‚¯ãƒªã‚¢
- Textureå†åˆ©ç”¨

v6.2-B: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼ˆ1æ—¥ï¼‰
- ãƒãƒƒãƒæç”»
- ã‚«ãƒªãƒ³ã‚°
- LOD

================================================================================
ç¬¬4éƒ¨: å‰Šé™¤ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§
================================================================================

ã€å®Œå…¨å‰Šé™¤ã€‘
âŒ system/drawing/webgl2/webgl2-drawing-layer.js (500è¡Œ)
âŒ system/drawing/webgl2/gl-texture-bridge.js (400è¡Œ)
âŒ system/drawing/raster/raster-layer.js (600è¡Œ)
âŒ system/drawing/raster/raster-brush-core.js (400è¡Œ)
âŒ system/drawing/shader-inline.js (300è¡Œ)

**åˆè¨ˆå‰Šé™¤: ç´„2200è¡Œ**

ã€å¤§æ”¹ä¿®ã€‘
ğŸ”§ system/drawing/brush-core.js (400è¡Œ â†’ 250è¡Œ)
ğŸ”§ system/layer-system.js (500è¡Œ â†’ 400è¡Œ)
ğŸ”§ system/drawing/drawing-engine.js (400è¡Œ â†’ 350è¡Œ)
ğŸ”§ core-initializer.js (600è¡Œ â†’ 400è¡Œ)
ğŸ”§ core-engine.js (800è¡Œ â†’ 700è¡Œ)

**æ”¹ä¿®å‰Šæ¸›: ç´„350è¡Œ**

**ç·å‰Šæ¸›: ç´„2550è¡Œï¼ˆ40%å‰Šæ¸›ï¼‰**

================================================================================
ç¬¬5éƒ¨: ã‚¨ãƒ©ãƒ¼è§£æ
================================================================================

ã€ç¾åœ¨ã®ã‚¨ãƒ©ãƒ¼ã€‘

1. `[WebGL2] âŒ RasterLayer not found`
   åŸå› : window.rasterLayerãŒåˆæœŸåŒ–å‰
   è§£æ±º: RasterLayerå‰Šé™¤ã§ã‚¨ãƒ©ãƒ¼è‡ªä½“ãŒæ¶ˆæ»…

2. `[RasterBrushCore] âŒ Not initialized`
   åŸå› : RasterBrushCoreãŒæœªåˆæœŸåŒ–
   è§£æ±º: RasterBrushCoreå‰Šé™¤

3. `r.updateLocalTransform is not a function`
   åŸå› : PixiJSå†…éƒ¨ã‚¨ãƒ©ãƒ¼ï¼ˆGLç«¶åˆï¼‰
   è§£æ±º: ç‹¬è‡ªGLå‰Šé™¤ã§ç«¶åˆæ¶ˆæ»…

4. `Cannot read properties of undefined (reading 'length')`
   åŸå› : RenderGroupç ´æï¼ˆGLç«¶åˆï¼‰
   è§£æ±º: ç‹¬è‡ªGLå‰Šé™¤ã§ç«¶åˆæ¶ˆæ»…

**å…¨ã‚¨ãƒ©ãƒ¼ã®æ ¹æœ¬åŸå› :**
ç‹¬è‡ªWebGL2ã¨PixiJS WebGL2ã®ç«¶åˆ
â†’ ç‹¬è‡ªWebGL2å‰Šé™¤ã§å…¨ã¦è§£æ±º

================================================================================
ç¬¬6éƒ¨: å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
================================================================================

ã€æœ€å„ªå…ˆã€‘Phase v6.0-Emergencyï¼ˆ6-8æ™‚é–“ï¼‰
ç†ç”±: ç¾åœ¨æç”»ä¸èƒ½ãƒ»å…¨ã‚¨ãƒ©ãƒ¼ã®æ ¹æœ¬è§£æ±º
ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«:
  E-1: ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ â†’ 30åˆ†
  E-2: BrushCoreå®Ÿè£… â†’ 3æ™‚é–“
  E-3: LayerSystemå®Ÿè£… â†’ 2æ™‚é–“
  E-4: DrawingEngineå®Ÿè£… â†’ 2æ™‚é–“
  E-5: CoreInitializerç°¡ç´ åŒ– â†’ 1æ™‚é–“
  E-6: CoreEngineç°¡ç´ åŒ– â†’ 30åˆ†
  ãƒ†ã‚¹ãƒˆ â†’ 1æ™‚é–“
å®Œäº†æ¡ä»¶:
  âœ… ãƒšãƒ³æç”»ãŒæ­£å¸¸å‹•ä½œ
  âœ… å…¨ã‚¨ãƒ©ãƒ¼æ¶ˆæ»…
  âœ… 60fpsç¶­æŒ

ã€é«˜å„ªå…ˆã€‘Phase v6.1ï¼ˆ2-3æ—¥ï¼‰
å‰æ: Phase v6.0-Emergencyå®Œäº†
ç›®çš„: ãƒ–ãƒ©ã‚·æ©Ÿèƒ½æ‹¡å¼µ

ã€ä¸­å„ªå…ˆã€‘Phase v6.2ï¼ˆ1-2æ—¥ï¼‰
å‰æ: Phase v6.1å®Œäº†
ç›®çš„: æœ€é©åŒ–

================================================================================
ç¬¬7éƒ¨: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ
================================================================================

ã€PixiJS Graphicsæç”»æ€§èƒ½ã€‘
```
æ“ä½œ: graphics.lineTo() é€£ç¶šå‘¼ã³å‡ºã—
é »åº¦: pointermoveæ¯ï¼ˆæœ€å¤§120Hzï¼‰
1000ç‚¹æç”»: ~2ms
è£œé–“è¾¼ã¿: ~5ms

çµè«–: 60fpsç¶­æŒå¯èƒ½
```

ã€RenderTextureåŒ–ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã€‘
```
æ“ä½œ: renderer.render(graphics â†’ texture)
é »åº¦: ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯å®Œäº†æ™‚ã®ã¿
400x400px: ~1ms
800x800px: ~3ms

çµè«–: å•é¡Œãªã—
```

ã€ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã€‘
```
v5.1ï¼ˆå¤±æ•—æ§‹é€ ï¼‰:
  ç‹¬è‡ªCanvas: 1å€‹ï¼ˆ640KBï¼‰
  PixiJS Canvas: 1å€‹ï¼ˆ640KBï¼‰
  RasterLayer Textures: ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•° Ã— 640KB
  åˆè¨ˆ: ç´„2MB + ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†

v6.0ï¼ˆPixiJSãƒã‚¤ãƒ†ã‚£ãƒ–ï¼‰:
  PixiJS Canvas: 1å€‹ï¼ˆ640KBï¼‰
  RenderTextures: ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•° Ã— 640KB
  Graphics: ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•° Ã— æ•°KBï¼ˆè»½é‡ï¼‰
  åˆè¨ˆ: ç´„1MB + ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†

å‰Šæ¸›: ç´„1MB + è»¢é€ãƒãƒƒãƒ•ã‚¡å‰Šæ¸›
```

================================================================================
ç¬¬8éƒ¨: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¯”è¼ƒ
================================================================================

ã€v5.1 vs v6.0ã€‘

| é …ç›® | v5.1 (åˆ†é›¢å¤±æ•—) | v6.0 (PixiJSçµ±åˆ) |
|------|-----------------|-------------------|
| GLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ | 2å€‹ï¼ˆç«¶åˆï¼‰ | 1å€‹ï¼ˆPixiJSç®¡è½„ï¼‰ |
| ç«¶åˆãƒªã‚¹ã‚¯ | æ¥µå¤§ | ãªã—ï¼ˆæ§‹é€ çš„ã«ä¸å¯èƒ½ï¼‰ |
| å®Ÿè£…è¤‡é›‘åº¦ | æ¥µé«˜ | ä½ |
| ã‚³ãƒ¼ãƒ‰é‡ | 6500è¡Œ | 4000è¡Œ |
| ä¿å®ˆæ€§ | æ¥µä½ | é«˜ |
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ | ç†è«–é«˜ï¼ˆå‹•ä½œã›ãšï¼‰ | é«˜ï¼ˆå®Ÿè¨¼æ¸ˆã¿ï¼‰ |
| å°†æ¥æ€§ | ä½ | é«˜ |
| PixiJSæ´»ç”¨ | 5% | 95% |

ã€æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã€‘

v5.1:
- ç‹¬è‡ªWebGL2 Canvas
- ç‹¬è‡ªShaderç®¡ç†
- ç‹¬è‡ªFBO/Texture
- ç‹¬è‡ªæç”»ãƒ«ãƒ¼ãƒ—
- Canvasé–“è»¢é€
+ PixiJSï¼ˆè¡¨ç¤ºã®ã¿ï¼‰

v6.0:
- PixiJS Application
- PIXI.Graphics
- PIXI.RenderTexture
- PIXI.Containeréšå±¤
- PIXI.Rendererçµ±åˆ

================================================================================
ç¬¬9éƒ¨: ãƒ†ã‚¹ãƒˆé …ç›®
================================================================================

ã€Phase v6.0-Emergencyå®Œäº†æ™‚ã€‘
â–¡ åŸºæœ¬æç”»
  â–¡ ãƒšãƒ³ã§ç·šãŒå¼•ã‘ã‚‹
  â–¡ ãƒã‚¦ã‚¹ã§ç·šãŒå¼•ã‘ã‚‹
  â–¡ ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã§ç·šãŒå¼•ã‘ã‚‹
  â–¡ ç·šãŒã‚¹ãƒ ãƒ¼ã‚º
  â–¡ ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚¹åŠ¹æœ

â–¡ ç­†åœ§å¯¾å¿œ
  â–¡ ç­†åœ§ã§å¤ªã•å¤‰åŒ–
  â–¡ ç­†åœ§ã‚«ãƒ¼ãƒ–é©ç”¨
  â–¡ æœ€å°ã‚µã‚¤ã‚ºè¨­å®šåæ˜ 

â–¡ ãƒ¬ã‚¤ãƒ¤ãƒ¼æ©Ÿèƒ½
  â–¡ ãƒ¬ã‚¤ãƒ¤ãƒ¼è¿½åŠ 
  â–¡ ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ‡ã‚Šæ›¿ãˆ
  â–¡ ãƒ¬ã‚¤ãƒ¤ãƒ¼å‰Šé™¤
  â–¡ ãƒ¬ã‚¤ãƒ¤ãƒ¼è¡¨ç¤º/éè¡¨ç¤º
  â–¡ ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä¸é€æ˜åº¦

â–¡ Undo/Redo
  â–¡ Ctrl+Z ã§æˆ»ã‚‹
  â–¡ Ctrl+Y ã§é€²ã‚€
  â–¡ è¤‡æ•°å›Undo
  â–¡ Undoå¾Œã«æç”»â†’å±¥æ­´åˆ†å²

â–¡ ã‚¨ãƒ©ãƒ¼ç¢ºèª
  â–¡ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«WebGLã‚¨ãƒ©ãƒ¼ãªã—
  â–¡ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«PixiJSã‚¨ãƒ©ãƒ¼ãªã—
  â–¡ æç”»ä¸­ã«ã‚­ãƒ£ãƒ³ãƒã‚¹æ¶ˆå¤±ãªã—

â–¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
  â–¡ 60fpsç¶­æŒï¼ˆstatusè¡¨ç¤ºç¢ºèªï¼‰
  â–¡ ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ãªã—ï¼ˆé•·æ™‚é–“å‹•ä½œï¼‰
  â–¡ CPUä½¿ç”¨ç‡æ­£å¸¸

â–¡ UIå‹•ä½œ
  â–¡ ãƒ–ãƒ©ã‚·ã‚µã‚¤ã‚ºã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å‹•ä½œ
  â–¡ ä¸é€æ˜åº¦ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å‹•ä½œ
  â–¡ ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼å‹•ä½œ
  â–¡ ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«æ›´æ–°

ã€Phase v6.1å®Œäº†æ™‚ã€‘
â–¡ ãƒ–ãƒ©ã‚·ãƒ†ã‚¯ã‚¹ãƒãƒ£å‹•ä½œ
â–¡ ãƒ–ãƒ¬ãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
â–¡ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé©ç”¨

ã€Phase v6.2å®Œäº†æ™‚ã€‘
â–¡ å¤§é‡ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã‚‚60fps
â–¡ é•·æ™‚é–“æç”»ã§ãƒ¡ãƒ¢ãƒªå®‰å®š
â–¡ ãƒãƒƒãƒå‡¦ç†å‹•ä½œç¢ºèª

================================================================================
ç¬¬10éƒ¨: ãƒ‡ãƒãƒƒã‚°æŒ‡é‡
================================================================================

ã€Phase v6.0-Emergencyå®Ÿè£…æ™‚ã€‘

1. **ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ç¢ºèª**
```javascript
// ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç¢ºèª
console.log('RasterLayer:', window.RasterLayer); // undefined
console.log('RasterBrushCore:', window.RasterBrushCore); // undefined
console.log('WebGL2DrawingLayer:', window.WebGL2DrawingLayer); // undefined
```

2. **Graphicså–å¾—ç¢ºèª**
```javascript
// ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç¢ºèª
const graphics = window.layerSystem.getActiveLayerGraphics();
console.log('Graphics:', graphics); // PIXI.Graphics instance
console.log('Is PIXI.Graphics:', graphics instanceof PIXI.Graphics); // true
```

3. **æç”»å‹•ä½œç¢ºèª**
```javascript
// ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰ã§ãƒ†ã‚¹ãƒˆæç”»
const g = window.layerSystem.getActiveLayerGraphics();
g.lineStyle({ width: 10, color: 0xff0000 });
g.moveTo(100, 100);
g.lineTo(200, 200);
// â†’ èµ¤ã„ç·šãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãš
```

4. **RenderTextureåŒ–ç¢ºèª**
```javascript
// ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯å®Œäº†å¾Œ
const layer = window.layerSystem.getActiveLayer();
console.log('RenderTexture:', layer.renderTexture); // PIXI.RenderTexture
console.log('Sprite:', layer.sprite); // PIXI.Sprite
console.log('Graphics cleared:', layer.drawingGraphics.geometry.graphicsData.length === 0);
```

ã€æ®µéšçš„æ¤œè¨¼ã€‘
1. E-1å®Ÿè£… â†’ ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ç¢ºèªãƒ»ã‚¨ãƒ©ãƒ¼æ¶ˆæ»…ç¢ºèª
2. E-2å®Ÿè£… â†’ BrushCoreå‹•ä½œç¢ºèª
3. E-3å®Ÿè£… â†’ ãƒ¬ã‚¤ãƒ¤ãƒ¼Container/Graphicsç¢ºèª
4. E-4å®Ÿè£… â†’ PointerEventâ†’Graphicsæç”»ç¢ºèª
5. E-5,E-6å®Ÿè£… â†’ çµ±åˆå‹•ä½œç¢ºèª

ã€å•é¡ŒãŒç¶šãå ´åˆã€‘
- PixiJS v8 APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç¢ºèª
- Graphics APIã®è©³ç´°ç¢ºèª
- Containeréšå±¤ã®æ¤œè¨¼
- ã‚¤ãƒ™ãƒ³ãƒˆä¼æ’­ã®ç¢ºèª

================================================================================
ç¬¬11éƒ¨: ä»Šå¾Œã®å±•æœ›
================================================================================

ã€Phase v6.0å®Œäº†å¾Œã®é¸æŠè‚¢ã€‘

**ãƒ‘ã‚¿ãƒ¼ãƒ³1: v6.0ã§åœæ­¢ï¼ˆæ¨å¥¨ãƒ»å®Ÿç”¨ååˆ†ï¼‰**
```
æ©Ÿèƒ½:
  âœ… åŸºæœ¬æç”»
  âœ… ç­†åœ§å¯¾å¿œ
  âœ… ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†
  âœ… Undo/Redo
  âœ… ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚¹
ãƒ¡ãƒªãƒƒãƒˆ:
  âœ… å®‰å®šæ€§ç¢ºä¿
  âœ… ä¿å®ˆã‚³ã‚¹ãƒˆæœ€å°
  âœ… å®Ÿç”¨ãƒ¬ãƒ™ãƒ«
ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:
  âš ï¸ ã‚«ã‚¹ã‚¿ãƒ ãƒ–ãƒ©ã‚·ãªã—
  âš ï¸ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãªã—
```

**ãƒ‘ã‚¿ãƒ¼ãƒ³2: v6.1ã¾ã§å®Ÿè£…ï¼ˆæ¨å¥¨ï¼‰**
```
æ©Ÿèƒ½:
  + ã‚«ã‚¹ã‚¿ãƒ ãƒ–ãƒ©ã‚·
  + ãƒ–ãƒ¬ãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰
  + ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
ãƒ¡ãƒªãƒƒãƒˆ:
  âœ… é«˜æ©Ÿèƒ½
  âœ… ç«¶åˆãƒ„ãƒ¼ãƒ«ã¨åŒç­‰
ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:
  âš ï¸ é–‹ç™ºæœŸé–“+2-3æ—¥
```

**ãƒ‘ã‚¿ãƒ¼ãƒ³3: v6.2ã¾ã§å®Ÿè£…ï¼ˆæ„æ¬²çš„ï¼‰**
```
æ©Ÿèƒ½:
  + æœ€é©åŒ–
  + å¤§é‡ãƒ¬ã‚¤ãƒ¤ãƒ¼å¯¾å¿œ
  + ãƒ¡ãƒ¢ãƒªåŠ¹ç‡åŒ–
ãƒ¡ãƒªãƒƒãƒˆ:
  âœ… ãƒ—ãƒ­ä»•æ§˜
  âœ… é•·æ™‚é–“ä½œæ¥­å¯èƒ½
ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:
  âš ï¸ é–‹ç™ºæœŸé–“+4-5æ—¥
```

ã€åˆ¤æ–­åŸºæº–ã€‘
- Phase v6.0å®Œäº†å¾Œã€1é€±é–“é‹ç”¨
- å®‰å®šæ€§ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç¢ºèª
- å¿…è¦æ©Ÿèƒ½ã‚’è©•ä¾¡
- Phase v6.1ã¸é€²ã‚€ã‹åˆ¤æ–­

ã€å°†æ¥çš„ãªæŠ€è¡“é¸æŠè‚¢ã€‘

1. **WebGPUç§»è¡Œ** (2025å¹´ä»¥é™)
   - PixiJS v9ã§WebGPUå¯¾å¿œäºˆå®š
   - ã•ã‚‰ãªã‚‹é«˜é€ŸåŒ–
   - ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã‚¹ãƒ ãƒ¼ã‚ºç§»è¡Œå¯èƒ½

2. **é«˜åº¦ãªFilteræ´»ç”¨**
   - ã‚«ã‚¹ã‚¿ãƒ Filterå®Ÿè£…
   - æ°´å½©ãƒ»æ²¹å½©ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

3. **3Dãƒ–ãƒ©ã‚·**
   - PIXI.projectionæ´»ç”¨
   - ç«‹ä½“çš„ãªæç”»
   - å¥¥è¡Œãè¡¨ç¾

================================================================================
ç¬¬12éƒ¨: ã¾ã¨ã‚
================================================================================

ã€ç¾çŠ¶è©•ä¾¡ã€‘
å…¨ä½“é€²æ—: 65%
- åŸºæœ¬æ§‹é€ : âœ… å®Œæˆ
- æç”»ã‚·ã‚¹ãƒ†ãƒ : âŒ æ©Ÿèƒ½ä¸å…¨ï¼ˆç‹¬è‡ªWebGL2ç«¶åˆï¼‰
- UI: âœ… æ­£å¸¸å‹•ä½œ
- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ: âœ… æ­£å¸¸å‹•ä½œ

ã€v5.1ã‹ã‚‰ã®æ”¹å–„ç‚¹ã€‘
âœ… å•é¡Œã®æ ¹æœ¬åŸå› ã‚’æ­£ç¢ºã«ç‰¹å®šï¼ˆPixiJS WebGL2ç«¶åˆï¼‰
âœ… ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ¬ãƒ™ãƒ«ã§ã®æ­£ã—ã„è§£æ±ºç­–ï¼ˆPixiJSãƒã‚¤ãƒ†ã‚£ãƒ–çµ±åˆï¼‰
âœ… ä¿å®ˆæ€§ã‚’æœ€å„ªå…ˆï¼ˆã‚³ãƒ¼ãƒ‰40%å‰Šæ¸›ï¼‰
âœ… å°†æ¥æ€§ã®ç¢ºä¿ï¼ˆPixiJSé€²åŒ–ã«è¿½å¾“å¯èƒ½ï¼‰
âœ… å®Ÿè£…ã®å¤§å¹…ç°¡ç´ åŒ–ï¼ˆç‹¬è‡ªGLå‰Šé™¤ï¼‰

ã€Phase v6.0-Emergencyã®ä¾¡å€¤ã€‘
- â±ï¸ å®Ÿè£…æ™‚é–“: 6-8æ™‚é–“
- ğŸ¯ åŠ¹æœ: å®Œå…¨è§£æ±º
- ğŸ“‰ ã‚³ãƒ¼ãƒ‰å‰Šæ¸›: 2550è¡Œï¼ˆ40%ï¼‰
- ğŸ”§ ä¿å®ˆæ€§: å¤§å¹…å‘ä¸Š
- ğŸš€ å°†æ¥æ€§: PixiJSé€²åŒ–ã«è¿½å¾“

ã€æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€‘
1. âœ… Phase v6.0-Emergencyå®Ÿè£…ï¼ˆ6-8æ™‚é–“ï¼‰
2. âœ… å‹•ä½œç¢ºèªï¼ˆåŸºæœ¬ãƒ†ã‚¹ãƒˆï¼‰
3. ğŸ¤” Phase v6.1å®Ÿè£…åˆ¤æ–­ï¼ˆ1é€±é–“å¾Œï¼‰

ã€æˆåŠŸã®éµã€‘
âœ… PixiJSã®æ©Ÿèƒ½ã‚’100%æ´»ç”¨
âœ… ç‹¬è‡ªå®Ÿè£…ã‚’æœ€å°åŒ–
âœ… ã‚·ãƒ³ãƒ—ãƒ«ãªè¨­è¨ˆ
âœ… å¾¹åº•çš„ãªãƒ†ã‚¹ãƒˆ

ã€çµè«–ã€‘
ç‹¬è‡ªWebGL2å®Ÿè£…ã¯**æ§‹é€ çš„ã«èª¤ã‚Š**ã§ã—ãŸã€‚
PixiJS v8ã¯ã™ã§ã«å„ªã‚ŒãŸWebGL2ãƒ©ã‚¹ã‚¿ãƒ¼æç”»æ©Ÿèƒ½ã‚’æŒã£ã¦ã„ã‚‹ãŸã‚ã€
ã“ã‚Œã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ï¼š
- è¤‡é›‘åº¦ãŒ1/3ã«
- ã‚³ãƒ¼ãƒ‰ãŒ40%å‰Šæ¸›
- ç«¶åˆãŒæ§‹é€ çš„ã«ä¸å¯èƒ½ã«
- ä¿å®ˆæ€§ãŒåŠ‡çš„ã«å‘ä¸Š

v6.0ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã“ããŒ**æ­£è§£**ã§ã™ã€‚

================================================================================
ä»˜éŒ²A: å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
================================================================================

ã€Phase v6.0-Emergencyã€‘

E-1: ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
  â–¡ webgl2-drawing-layer.js å‰Šé™¤
  â–¡ gl-texture-bridge.js å‰Šé™¤
  â–¡ raster-layer.js å‰Šé™¤
  â–¡ raster-brush-core.js å‰Šé™¤
  â–¡ shader-inline.js å‰Šé™¤
  â–¡ index.html <script>ã‚¿ã‚°å‰Šé™¤
  â–¡ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ¶ˆæ»…ç¢ºèª

E-2: BrushCoreå®Ÿè£…
  â–¡ ã‚¯ãƒ©ã‚¹æ§‹é€ å®Ÿè£…
  â–¡ initialize()å®Ÿè£…
  â–¡ setGraphicsTarget()å®Ÿè£…
  â–¡ startStroke()å®Ÿè£…
  â–¡ addStrokePoint()å®Ÿè£…
  â–¡ finalizeStroke()å®Ÿè£…
  â–¡ ç­†åœ§ã‚«ãƒ¼ãƒ–å®Ÿè£…
  â–¡ è£œé–“çµ±åˆ

E-3: LayerSystemå®Ÿè£…
  â–¡ addLayer() - Containerç”Ÿæˆ
  â–¡ addLayer() - Graphicsç”Ÿæˆ
  â–¡ getActiveLayerGraphics()å®Ÿè£…
  â–¡ bakeLayerToTexture()å®Ÿè£…
  â–¡ ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ç™»éŒ²
  â–¡ RenderTextureç®¡ç†

E-4: DrawingEngineå®Ÿè£…
  â–¡ _handlePointerDown()ä¿®æ­£
  â–¡ Graphicsè¨­å®šã‚³ãƒ¼ãƒ‰
  â–¡ _handlePointerMove()ä¿®æ­£
  â–¡ _handlePointerUp()ä¿®æ­£
  â–¡ åº§æ¨™å¤‰æ›ç¶­æŒ

E-5: CoreInitializerç°¡ç´ åŒ–
  â–¡ initializeWebGL2()å‰Šé™¤
  â–¡ PixiJSåˆæœŸåŒ–ç¶­æŒ
  â–¡ preference: 'webgl2'ç¢ºèª

E-6: CoreEngineç°¡ç´ åŒ–
  â–¡ rasterBrushCoreå‰Šé™¤
  â–¡ BrushCoreçµ±åˆç¢ºèª

ã€ãƒ†ã‚¹ãƒˆã€‘
  â–¡ 1ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯æç”»æˆåŠŸ
  â–¡ 10ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯é€£ç¶šæç”»æˆåŠŸ
  â–¡ å…¨ã‚¨ãƒ©ãƒ¼æ¶ˆæ»…ç¢ºèª
  â–¡ 60fpsç¶­æŒç¢ºèª
  â–¡ Undo/Redoå‹•ä½œç¢ºèª
  â–¡ ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ‡ã‚Šæ›¿ãˆç¢ºèª
  â–¡ ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ç¢ºèª

================================================================================
ä»˜éŒ²B: ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰
================================================================================

ã€Phase v6.0å‹•ä½œç¢ºèªã€‘

```javascript
// Graphicså–å¾—
const g = window.layerSystem.getActiveLayerGraphics();
console.log('Graphics:', g);

// ãƒ†ã‚¹ãƒˆæç”»
g.lineStyle({ width: 10, color: 0xff0000 });
g.moveTo(100, 100);
g.lineTo(200, 200);

// RenderTextureåŒ–ãƒ†ã‚¹ãƒˆ
window.layerSystem.bakeLayerToTexture(
  window.layerSystem.getActiveLayer().id
);

// ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ç¢ºèª
const layer = window.layerSystem.getActiveLayer();
console.log('Layer:', {
  id: layer.id,
  graphics: layer.drawingGraphics,
  texture: layer.renderTexture,
  sprite: layer.sprite
});
```

ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šã€‘

```javascript
// æç”»é€Ÿåº¦æ¸¬å®š
const start = performance.now();
const g = window.layerSystem.getActiveLayerGraphics();
g.lineStyle({ width: 5, color: 0x000000 });
g.moveTo(0, 0);
for (let i = 0; i < 1000; i++) {
  g.lineTo(Math.random() * 400, Math.random() * 400);
}
console.log('1000 lineTo:', (performance.now() - start).toFixed(2), 'ms');
```

================================================================================
END OF DOCUMENT v6.0
================================================================================