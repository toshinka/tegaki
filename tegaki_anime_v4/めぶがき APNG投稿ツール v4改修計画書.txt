# ã‚ã¶ãŒã APNGæŠ•ç¨¿ãƒ„ãƒ¼ãƒ« v4æ”¹ä¿®è¨ˆç”»æ›¸

## 1. ç¾çŠ¶åˆ†æ

### ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³ï¼ˆv4ï¼‰
âœ… **å®Œäº†æ¸ˆã¿ï¼š**
- ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆæˆè¡¨ç¤ºæ©Ÿèƒ½
- æç”»ä¸­ã¯ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã¿è¡¨ç¤ºã€æç”»çµ‚äº†å¾Œã«åˆæˆè¡¨ç¤º
- æ¶ˆã—ã‚´ãƒ ã¯é€æ˜åŒ–ï¼ˆ`destination-out`ï¼‰
- ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¡¨ç¤º/éè¡¨ç¤ºã€ä¸é€æ˜åº¦èª¿æ•´æ©Ÿèƒ½
- ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ã‚¹ã€ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªUI

âš ï¸ **æ”¹ä¿®ãŒå¿…è¦ï¼š**
- ãƒšãƒ³/æ¶ˆã—ã‚´ãƒ ã®ã‚¹ãƒ­ãƒƒãƒˆæ©Ÿèƒ½ãŒæœªå®Ÿè£…
- ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒç¸¦ä¸¦ã³ï¼ˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ¡ˆã§ã¯æ¨ªä¸¦ã³ï¼‰
- UIã®ã‚«ãƒ©ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ ãŒçµ±ä¸€ã•ã‚Œã¦ã„ãªã„

---

## 2. ã‚«ãƒ©ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ çµ±ä¸€

### å®šç¾©ã‚«ãƒ©ãƒ¼
```javascript
{
  primary: '#800000',      // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è¦ç´ ã€ãƒšãƒ³ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè‰²
  secondary: '#aa5a56',    // éã‚¢ã‚¯ãƒ†ã‚£ãƒ–è¦ç´ 
  border: '#cf9c97',       // ãƒœãƒ¼ãƒ€ãƒ¼ã€ãƒ†ã‚­ã‚¹ãƒˆ
  light: '#e9c2ba',        // ãƒ©ã‚¤ãƒˆã‚¢ã‚¯ã‚»ãƒ³ãƒˆ
  background: '#f0e0d6',   // ã‚­ãƒ£ãƒ³ãƒã‚¹èƒŒæ™¯ã€ãƒ‘ãƒãƒ«èƒŒæ™¯
  white: '#ffffff'         // ãƒ›ãƒ¯ã‚¤ãƒˆ
}
```

### é©ç”¨ç®‡æ‰€
- ãƒœã‚¿ãƒ³ã®ãƒœãƒ¼ãƒ€ãƒ¼ï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–/éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼‰
- ãƒ‘ãƒãƒ«èƒŒæ™¯
- ãƒ†ã‚­ã‚¹ãƒˆã‚«ãƒ©ãƒ¼
- ãƒ•ãƒ¬ãƒ¼ãƒ ã‚µãƒ ãƒã‚¤ãƒ«ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚µãƒ ãƒã‚¤ãƒ«ã®ãƒœãƒ¼ãƒ€ãƒ¼

---

## 3. ãƒ„ãƒ¼ãƒ«ã‚¹ãƒ­ãƒƒãƒˆæ©Ÿèƒ½ã®å®Ÿè£…

### 3.1 UIæ§‹æˆ

#### ãƒšãƒ³ã‚¹ãƒ­ãƒƒãƒˆï¼ˆ3ã‚¹ãƒ­ãƒƒãƒˆï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   âœï¸   â”‚   âœï¸   â”‚   âœï¸   â”‚
â”‚  2.0   â”‚  5.0   â”‚  10.0  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²
    [ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼]
         â–¼
```

- å„ã‚¹ãƒ­ãƒƒãƒˆã«ãƒšãƒ³ã‚µã‚¤ã‚ºã‚’ä¿æŒï¼ˆåˆæœŸå€¤: 2, 5, 10ï¼‰
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ãƒ­ãƒƒãƒˆã‚’ãƒœãƒ¼ãƒ€ãƒ¼ã§å¼·èª¿
- ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ãƒ­ãƒƒãƒˆã®ã‚µã‚¤ã‚ºã‚’0.5åˆ»ã¿ã§èª¿æ•´
- ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ä¸Šã«â–²ãƒœã‚¿ãƒ³ï¼ˆ+0.5ï¼‰ã€ä¸‹ã«â–¼ãƒœã‚¿ãƒ³ï¼ˆ-0.5ï¼‰

#### æ¶ˆã—ã‚´ãƒ ã‚¹ãƒ­ãƒƒãƒˆï¼ˆ3ã‚¹ãƒ­ãƒƒãƒˆï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ§½   â”‚   ğŸ§½   â”‚   ğŸ§½   â”‚
â”‚  10    â”‚  20    â”‚  30    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²
    [ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼]
         â–¼
```

- åŒæ§˜ã®æ§‹æˆï¼ˆåˆæœŸå€¤: 10, 20, 30ï¼‰

### 3.2 ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ

**ç¾åœ¨ã®ãƒ„ãƒ¼ãƒ«åˆ‡æ›¿:**
- `P` â†’ ãƒšãƒ³
- `E` â†’ æ¶ˆã—ã‚´ãƒ 

**æ–°è¦è¿½åŠ :**
- ãƒšãƒ³ãƒ„ãƒ¼ãƒ«é¸æŠä¸­:
  - `[` â†’ å‰ã®ãƒšãƒ³ã‚¹ãƒ­ãƒƒãƒˆ
  - `]` â†’ æ¬¡ã®ãƒšãƒ³ã‚¹ãƒ­ãƒƒãƒˆ
  
- æ¶ˆã—ã‚´ãƒ ãƒ„ãƒ¼ãƒ«é¸æŠä¸­:
  - `[` â†’ å‰ã®æ¶ˆã—ã‚´ãƒ ã‚¹ãƒ­ãƒƒãƒˆ
  - `]` â†’ æ¬¡ã®æ¶ˆã—ã‚´ãƒ ã‚¹ãƒ­ãƒƒãƒˆ

### 3.3 å®Ÿè£…æ–¹æ³•

#### tegaki_anime_core.js ã«è¿½åŠ 

```javascript
constructor() {
    // ...
    
    // ãƒšãƒ³ã‚¹ãƒ­ãƒƒãƒˆï¼ˆ3ã¤ï¼‰
    this.penSlots = [
        { size: 2, active: true },
        { size: 5, active: false },
        { size: 10, active: false }
    ];
    this.activePenSlotIndex = 0;
    
    // æ¶ˆã—ã‚´ãƒ ã‚¹ãƒ­ãƒƒãƒˆï¼ˆ3ã¤ï¼‰
    this.eraserSlots = [
        { size: 10, active: true },
        { size: 20, active: false },
        { size: 30, active: false }
    ];
    this.activeEraserSlotIndex = 0;
}

// ãƒšãƒ³ã‚¹ãƒ­ãƒƒãƒˆåˆ‡æ›¿
switchPenSlot(direction) {
    if (this.drawingEngine.currentTool !== 'pen') return;
    
    // ç¾åœ¨ã®ã‚¹ãƒ­ãƒƒãƒˆã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
    this.penSlots[this.activePenSlotIndex].active = false;
    
    // æ¬¡ã®ã‚¹ãƒ­ãƒƒãƒˆã¸
    this.activePenSlotIndex = 
        (this.activePenSlotIndex + direction + this.penSlots.length) 
        % this.penSlots.length;
    
    // æ–°ã—ã„ã‚¹ãƒ­ãƒƒãƒˆã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
    this.penSlots[this.activePenSlotIndex].active = true;
    
    // ã‚µã‚¤ã‚ºã‚’é©ç”¨
    const newSize = this.penSlots[this.activePenSlotIndex].size;
    this.setPenSize(newSize);
    
    // UIã‚’æ›´æ–°
    this.uiBuilder.updatePenSlots(this.penSlots, this.activePenSlotIndex);
}

// æ¶ˆã—ã‚´ãƒ ã‚¹ãƒ­ãƒƒãƒˆåˆ‡æ›¿ï¼ˆåŒæ§˜ï¼‰
switchEraserSlot(direction) {
    if (this.drawingEngine.currentTool !== 'eraser') return;
    
    this.eraserSlots[this.activeEraserSlotIndex].active = false;
    
    this.activeEraserSlotIndex = 
        (this.activeEraserSlotIndex + direction + this.eraserSlots.length) 
        % this.eraserSlots.length;
    
    this.eraserSlots[this.activeEraserSlotIndex].active = true;
    
    const newSize = this.eraserSlots[this.activeEraserSlotIndex].size;
    this.setEraserSize(newSize);
    
    this.uiBuilder.updateEraserSlots(this.eraserSlots, this.activeEraserSlotIndex);
}

// ãƒšãƒ³ã‚µã‚¤ã‚ºæ›´æ–°æ™‚ã«ã‚¹ãƒ­ãƒƒãƒˆã‚‚æ›´æ–°
setPenSize(size) {
    this.penSize = size;
    if (this.drawingEngine.currentTool === 'pen') {
        this.drawingEngine.setSize(size);
        // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ãƒ­ãƒƒãƒˆã®ã‚µã‚¤ã‚ºã‚‚æ›´æ–°
        this.penSlots[this.activePenSlotIndex].size = size;
        this.uiBuilder.updatePenSlots(this.penSlots, this.activePenSlotIndex);
    }
}

// æ¶ˆã—ã‚´ãƒ ã‚µã‚¤ã‚ºæ›´æ–°æ™‚ã«ã‚¹ãƒ­ãƒƒãƒˆã‚‚æ›´æ–°
setEraserSize(size) {
    this.eraserSize = size;
    if (this.drawingEngine.currentTool === 'eraser') {
        this.drawingEngine.setSize(size);
        this.eraserSlots[this.activeEraserSlotIndex].size = size;
        this.uiBuilder.updateEraserSlots(this.eraserSlots, this.activeEraserSlotIndex);
    }
}
```

#### UIBuilder.js ã«è¿½åŠ 

```javascript
/**
 * ãƒšãƒ³ã‚¹ãƒ­ãƒƒãƒˆUIä½œæˆ
 */
createPenSlots(slots, onSlotClick, onSizeChange) {
    const section = document.createElement('div');
    
    const label = document.createElement('div');
    label.textContent = 'ãƒšãƒ³ã‚µã‚¤ã‚º';
    label.style.cssText = 'font-weight: bold; margin-bottom: 4px; font-size: 11px;';
    section.appendChild(label);
    
    // ã‚¹ãƒ­ãƒƒãƒˆè¡Œ
    const slotRow = document.createElement('div');
    slotRow.style.cssText = 'display: flex; gap: 4px; margin-bottom: 4px;';
    
    const slotButtons = [];
    slots.forEach((slot, i) => {
        const btn = document.createElement('button');
        btn.style.cssText = `
            flex: 1;
            padding: 4px;
            background: white;
            border: 2px solid ${slot.active ? this.config.activeColor : this.config.inactiveColor};
            border-radius: 2px;
            cursor: pointer;
            font-size: 9px;
            text-align: center;
        `;
        btn.innerHTML = `âœï¸<br>${slot.size.toFixed(1)}`;
        btn.onclick = () => onSlotClick(i);
        
        slotButtons.push(btn);
        slotRow.appendChild(btn);
    });
    section.appendChild(slotRow);
    
    // â–²ãƒœã‚¿ãƒ³
    const upBtn = document.createElement('button');
    upBtn.textContent = 'â–²';
    upBtn.style.cssText = `
        width: 100%;
        height: 20px;
        background: white;
        border: 1px solid ${this.config.border};
        cursor: pointer;
        font-size: 10px;
    `;
    upBtn.onclick = () => onSizeChange(0.5);
    section.appendChild(upBtn);
    
    // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
    const slider = document.createElement('input');
    slider.type = 'range';
    slider.min = '1';
    slider.max = '20';
    slider.step = '0.5';
    slider.value = slots.find(s => s.active).size;
    slider.style.cssText = 'width: 100%;';
    slider.oninput = (e) => onSizeChange(parseFloat(e.target.value) - slots.find(s => s.active).size);
    section.appendChild(slider);
    
    // â–¼ãƒœã‚¿ãƒ³
    const downBtn = document.createElement('button');
    downBtn.textContent = 'â–¼';
    downBtn.style.cssText = `
        width: 100%;
        height: 20px;
        background: white;
        border: 1px solid ${this.config.border};
        cursor: pointer;
        font-size: 10px;
    `;
    downBtn.onclick = () => onSizeChange(-0.5);
    section.appendChild(downBtn);
    
    return { section, slotButtons, slider };
}

/**
 * ãƒšãƒ³ã‚¹ãƒ­ãƒƒãƒˆæ›´æ–°
 */
updatePenSlots(slots, activeIndex) {
    // ã‚¹ãƒ­ãƒƒãƒˆãƒœã‚¿ãƒ³ã®æ›´æ–°å‡¦ç†
    this.penSlotButtons.forEach((btn, i) => {
        btn.style.borderColor = (i === activeIndex) ? 
            this.config.activeColor : this.config.inactiveColor;
        btn.innerHTML = `âœï¸<br>${slots[i].size.toFixed(1)}`;
    });
    
    // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å€¤ã‚’æ›´æ–°
    if (this.penSlider) {
        this.penSlider.value = slots[activeIndex].size;
    }
}
```

#### KeyboardManager.js ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆç™»éŒ²

```javascript
// tegaki_anime_core.js ã® registerKeyboardShortcuts() ã«è¿½åŠ 

// ãƒšãƒ³ã‚¹ãƒ­ãƒƒãƒˆåˆ‡æ›¿
km.register('[', {}, () => {
    if (this.drawingEngine.currentTool === 'pen') {
        this.switchPenSlot(-1);
    } else if (this.drawingEngine.currentTool === 'eraser') {
        this.switchEraserSlot(-1);
    }
}, 'Previous tool slot');

km.register(']', {}, () => {
    if (this.drawingEngine.currentTool === 'pen') {
        this.switchPenSlot(1);
    } else if (this.drawingEngine.currentTool === 'eraser') {
        this.switchEraserSlot(1);
    }
}, 'Next tool slot');
```

---

## 4. ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«æ”¹ä¿®

### 4.1 ç¾åœ¨ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆç¸¦ä¸¦ã³ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [è¡¨ç¤º]    â”‚
â”‚  L1        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ã‚µãƒ ãƒ  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â—€ 100% â–¶ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æ–°ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆæ¨ªä¸¦ã³ï¼šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ¡ˆæº–æ‹ ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [è¡¨ç¤º] â”Œâ”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  100%  â”‚ã‚µãƒ   â”‚  â”‚
â”‚   L1   â”‚ãƒã‚¤ãƒ«â”‚  â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ§‹æˆ:**
- å·¦å´ï¼šæƒ…å ±æ¬„
  - è¡¨ç¤º/éè¡¨ç¤ºãƒœã‚¿ãƒ³ï¼ˆğŸ‘/ğŸš«ï¼‰
  - ä¸é€æ˜åº¦ï¼ˆï¼…è¡¨ç¤º + â—€â–¶ãƒœã‚¿ãƒ³ï¼‰
  - ãƒ¬ã‚¤ãƒ¤ãƒ¼åï¼ˆL0, L1, L2...ï¼‰
  
- å³å´ï¼šã‚µãƒ ãƒã‚¤ãƒ«
  - ã‚µã‚¤ã‚ºã‚’ãƒ•ãƒ¬ãƒ¼ãƒ ã‚µãƒ ãƒã‚¤ãƒ«ã¨åŒç­‰ï¼ˆ50x50 â†’ 60x60æ¨å¥¨ï¼‰
  - ãƒã‚§ãƒƒã‚¯æŸ„èƒŒæ™¯ã§é€æ˜éƒ¨åˆ†ã‚’å¯è¦–åŒ–

### 4.3 UIBuilder.js ä¿®æ­£

```javascript
createLayerPanel(layerCount, currentFrameIndex, onLayerClick, onVisibilityChange, onOpacityChange) {
    // ...
    
    for (let i = 0; i < layerCount; i++) {
        const layerItem = document.createElement('div');
        layerItem.style.cssText = `
            border: 2px solid ${this.config.inactiveColor};
            border-radius: 2px;
            padding: 4px;
            transition: all 0.2s;
            background: white;
            display: flex;
            gap: 4px;
        `;
        
        // å·¦å´ï¼šæƒ…å ±æ¬„
        const infoColumn = document.createElement('div');
        infoColumn.style.cssText = `
            display: flex;
            flex-direction: column;
            gap: 2px;
            flex: 1;
            min-width: 50px;
        `;
        
        // è¡¨ç¤ºåˆ‡æ›¿ãƒœã‚¿ãƒ³
        const visibilityBtn = document.createElement('button');
        visibilityBtn.textContent = 'ğŸ‘ï¸';
        visibilityBtn.style.cssText = `
            width: 100%;
            height: 20px;
            border: 1px solid ${this.config.border};
            background: white;
            cursor: pointer;
            border-radius: 2px;
            font-size: 12px;
            padding: 0;
        `;
        visibilityBtn.onclick = (e) => {
            e.stopPropagation();
            onVisibilityChange(i);
        };
        infoColumn.appendChild(visibilityBtn);
        
        // ä¸é€æ˜åº¦è¡¨ç¤º
        const opacityDisplay = document.createElement('div');
        opacityDisplay.style.cssText = `
            text-align: center;
            font-weight: bold;
            font-size: 10px;
        `;
        opacityDisplay.textContent = '100%';
        infoColumn.appendChild(opacityDisplay);
        
        // ä¸é€æ˜åº¦èª¿æ•´ãƒœã‚¿ãƒ³
        const opacityRow = document.createElement('div');
        opacityRow.style.cssText = 'display: flex; gap: 2px;';
        
        const decreaseBtn = document.createElement('button');
        decreaseBtn.innerHTML = 'â—€';
        decreaseBtn.style.cssText = `
            flex: 1;
            height: 18px;
            border: 1px solid ${this.config.border};
            background: white;
            cursor: pointer;
            font-size: 9px;
            padding: 0;
        `;
        decreaseBtn.onclick = (e) => {
            e.stopPropagation();
            onOpacityChange(i, -10);
        };
        
        const increaseBtn = document.createElement('button');
        increaseBtn.innerHTML = 'â–¶';
        increaseBtn.style.cssText = `
            flex: 1;
            height: 18px;
            border: 1px solid ${this.config.border};
            background: white;
            cursor: pointer;
            font-size: 9px;
            padding: 0;
        `;
        increaseBtn.onclick = (e) => {
            e.stopPropagation();
            onOpacityChange(i, 10);
        };
        
        opacityRow.appendChild(decreaseBtn);
        opacityRow.appendChild(increaseBtn);
        infoColumn.appendChild(opacityRow);
        
        // ãƒ¬ã‚¤ãƒ¤ãƒ¼å
        const layerLabel = document.createElement('div');
        layerLabel.style.cssText = `
            font-size: 10px;
            text-align: center;
            font-weight: bold;
            cursor: pointer;
        `;
        layerLabel.textContent = i === 0 ? 'L0' : `L${i}`;
        layerLabel.onclick = () => onLayerClick(i);
        infoColumn.appendChild(layerLabel);
        
        // å³å´ï¼šã‚µãƒ ãƒã‚¤ãƒ«
        const layerCanvas = document.createElement('canvas');
        layerCanvas.width = 60;  // ãƒ•ãƒ¬ãƒ¼ãƒ ã‚µãƒ ãƒã‚¤ãƒ«ã¨åŒç­‰
        layerCanvas.height = 60;
        layerCanvas.style.cssText = `
            display: block;
            width: 60px;
            height: 60px;
            background: #f0e0d6;
            cursor: pointer;
            border: 1px solid ${this.config.border};
            flex-shrink: 0;
        `;
        layerCanvas.onclick = () => onLayerClick(i);
        
        layerItem.appendChild(infoColumn);
        layerItem.appendChild(layerCanvas);
        
        layers.push({ 
            item: layerItem, 
            canvas: layerCanvas, 
            label: layerLabel,
            visibilityBtn: visibilityBtn,
            opacityDisplay: opacityDisplay
        });
        layersContainer.appendChild(layerItem);
    }
    
    // ...
}
```

---

## 5. ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

### ä¸»è¦ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«
1. **src/tegaki_anime_core.js**
   - ã‚¹ãƒ­ãƒƒãƒˆç®¡ç†ã®è¿½åŠ 
   - ã‚¹ãƒ­ãƒƒãƒˆåˆ‡æ›¿ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿½åŠ 
   - ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆç™»éŒ²

2. **src/modules/UIBuilder.js**
   - createPenSlots() è¿½åŠ 
   - createEraserSlots() è¿½åŠ 
   - updatePenSlots(), updateEraserSlots() è¿½åŠ 
   - createLayerPanel() ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¤‰æ›´ï¼ˆæ¨ªä¸¦ã³ï¼‰
   - ã‚«ãƒ©ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ é©ç”¨

3. **src/utils/constants.js**
   - ã‚«ãƒ©ãƒ¼å®šç¾©ã®è¿½åŠ ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰

### å‹•ä½œç¢ºèªé …ç›®
- [ ] ãƒšãƒ³ã‚¹ãƒ­ãƒƒãƒˆåˆ‡æ›¿ï¼ˆ[/]ã‚­ãƒ¼ï¼‰
- [ ] æ¶ˆã—ã‚´ãƒ ã‚¹ãƒ­ãƒƒãƒˆåˆ‡æ›¿ï¼ˆ[/]ã‚­ãƒ¼ï¼‰
- [ ] ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§ã‚µã‚¤ã‚ºèª¿æ•´ï¼ˆ0.5åˆ»ã¿ï¼‰
- [ ] â–²â–¼ãƒœã‚¿ãƒ³ã§ã‚µã‚¤ã‚ºå¢—æ¸›
- [ ] ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«ã®æ¨ªä¸¦ã³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- [ ] ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚µãƒ ãƒã‚¤ãƒ«ã‚µã‚¤ã‚º60x60
- [ ] ã‚«ãƒ©ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ çµ±ä¸€

---

## 6. å®Ÿè£…å„ªå…ˆé †ä½

### Phase 1: ã‚¹ãƒ­ãƒƒãƒˆæ©Ÿèƒ½ï¼ˆé«˜å„ªå…ˆåº¦ï¼‰
1. tegaki_anime_core.jsã«ã‚¹ãƒ­ãƒƒãƒˆç®¡ç†è¿½åŠ 
2. UIBuilder.jsã«ã‚¹ãƒ­ãƒƒãƒˆ UIè¿½åŠ 
3. ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆç™»éŒ²

### Phase 2: ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«æ”¹ä¿®ï¼ˆä¸­å„ªå…ˆåº¦ï¼‰
1. ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’æ¨ªä¸¦ã³ã«å¤‰æ›´
2. ã‚µãƒ ãƒã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’60x60ã«æ‹¡å¤§
3. æƒ…å ±æ¬„ã®ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆåŒ–

### Phase 3: ã‚«ãƒ©ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ çµ±ä¸€ï¼ˆä½å„ªå…ˆåº¦ï¼‰
1. constants.jsã«ã‚«ãƒ©ãƒ¼å®šç¾©è¿½åŠ 
2. å…¨UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«é©ç”¨

---

## 7. è£œè¶³äº‹é …

### æ¶ˆã—ã‚´ãƒ ã«ã¤ã„ã¦
âœ… **æ—¢ã«å®Ÿè£…æ¸ˆã¿ï¼š**
- `destination-out` ã§é€æ˜åŒ–å‡¦ç†
- èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚‚é€æ˜åŒ–å¯èƒ½

### ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆæˆè¡¨ç¤ºã«ã¤ã„ã¦
âœ… **æ—¢ã«å®Ÿè£…æ¸ˆã¿ï¼š**
- æç”»ä¸­: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã¿è¡¨ç¤º
- æç”»çµ‚äº†å¾Œ: å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆæˆè¡¨ç¤º
- ãƒ•ãƒ¬ãƒ¼ãƒ ã‚µãƒ ãƒã‚¤ãƒ«: å¸¸ã«åˆæˆè¡¨ç¤º

### æ³¨æ„ç‚¹
- ã‚¹ãƒ­ãƒƒãƒˆåˆ‡æ›¿æ™‚ã€ç¾åœ¨ã®ãƒ„ãƒ¼ãƒ«ï¼ˆãƒšãƒ³/æ¶ˆã—ã‚´ãƒ ï¼‰ã«å¿œã˜ã¦å‹•ä½œã‚’åˆ†å²
- ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å€¤ã®å¤‰æ›´æ™‚ã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ãƒ­ãƒƒãƒˆã®ã‚µã‚¤ã‚ºã‚‚åŒæœŸæ›´æ–°
- ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«ã®æ¨ªå¹…ãŒç‹­ã„å ´åˆã€æƒ…å ±æ¬„ã¨ã‚µãƒ ãƒã‚¤ãƒ«ã®ãƒãƒ©ãƒ³ã‚¹ã«æ³¨æ„