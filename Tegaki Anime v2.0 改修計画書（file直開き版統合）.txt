Tegaki Anime v2.0 æ”¹ä¿®è¨ˆç”»æ›¸ï¼ˆfile://ç›´é–‹ãç‰ˆçµ±åˆï¼‰
ğŸ“‹ æ”¹ä¿®æ¦‚è¦
ç›®çš„

ãƒ™ã‚¯ã‚¿ãƒ¼ãƒšãƒ³ã‹ã‚‰WebGL2ãƒ©ã‚¹ã‚¿ãƒ¼ãƒšãƒ³ã¸ã®ç§»è¡Œ
Konva.jså°å…¥ã«ã‚ˆã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†ã®ã‚¹ãƒªãƒ åŒ–
ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã®é©æ­£åŒ–ï¼ˆ1ãƒ•ã‚¡ã‚¤ãƒ«1000è¡Œç›®å®‰ï¼‰
file://ç›´é–‹ãç‰ˆã®ã¿å¯¾å¿œï¼ˆViteç‰ˆå»ƒæ­¢ï¼‰
å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çµ±ä¸€åŒ–

ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±

æ—§: webgl2_rev30 (ãƒ™ã‚¯ã‚¿ãƒ¼å®Ÿè£…)
æ–°: v2.0 (ãƒ©ã‚¹ã‚¿ãƒ¼å®Ÿè£… + Konvaçµ±åˆ)

å¯¾å¿œæ²ç¤ºæ¿

nijiurachan.net (è™¹è£ã¡ã‚ƒã‚“)
ãƒ¬ã‚¹æ¬„ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰è»¢å†™å¯¾å¿œ
ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆèµ·å‹• â†’ Z-indexä¸Šå±¤è¡¨ç¤º â†’ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆ â†’ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼


ğŸ¯ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¤‰æ›´
å¤‰æ›´å‰
PixiJS v8 (UI + æç”») + è‡ªä½œãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚·ã‚¹ãƒ†ãƒ  + PerfectFreehand
å¤‰æ›´å¾Œ
Konva.js (ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç† + UI) + PixiJS v8 (WebGL2æç”»ã®ã¿) + file://ç›´é–‹ã

ğŸ“¦ ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
é–‹ç™ºä¸­: CDNçµŒç”±èª­ã¿è¾¼ã¿
<!-- Konva.js -->
<script src="https://cdn.jsdelivr.net/npm/konva@9/konva.min.js"></script>

<!-- PixiJS v8 -->
<script src="https://cdn.jsdelivr.net/npm/pixi.js@8/dist/pixi.min.js"></script>

<!-- UPNG (APNG/PNGåœ§ç¸®) -->
<script src="https://cdn.jsdelivr.net/npm/upng-js@2/UPNG.js"></script>

<!-- GSAP (ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³) -->
<script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/gsap.min.js"></script>
```

### æœ€çµ‚ãƒ“ãƒ«ãƒ‰: libs/ãƒ•ã‚©ãƒ«ãƒ€ã«æ ¼ç´
```
libs/
â”œâ”€â”€ konva.min.js          # npm install konva@9 â†’ node_modules/konva/konva.min.js
â”œâ”€â”€ pixi.min.js           # npm install pixi.js@8 â†’ node_modules/pixi.js/dist/pixi.min.js
â”œâ”€â”€ upng.min.js           # npm install upng-js@2 â†’ node_modules/upng-js/UPNG.js
â””â”€â”€ gsap.min.js           # npm install gsap@3 â†’ node_modules/gsap/dist/gsap.min.js

ãƒ“ãƒ«ãƒ‰æ‰‹é †
# 1. npmã§ä¾å­˜å–å¾—
npm install konva@9 pixi.js@8 upng-js@2 gsap@3

# 2. libs/ã«ã‚³ãƒ”ãƒ¼
cp node_modules/konva/konva.min.js libs/
cp node_modules/pixi.js/dist/pixi.min.js libs/
cp node_modules/upng-js/UPNG.js libs/upng.min.js
cp node_modules/gsap/dist/gsap.min.js libs/

# 3. å…¨JSãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµåˆ
cat libs/*.js src/**/*.js > dist/tegaki_anime_all.js

# 4. index.htmlã«çµ±åˆ
# <script src="dist/tegaki_anime_all.js"></script>
```

### å‰Šé™¤
- `perfect-freehand` - ãƒ™ã‚¯ã‚¿ãƒ¼å®Ÿè£…ä¸è¦
- `vite` - ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ä¸è¦
- `terser` - æ‰‹å‹•åœ§ç¸®ã¾ãŸã¯ä¸ä½¿ç”¨
- è‡ªä½œåº§æ¨™å¤‰æ›ã‚·ã‚¹ãƒ†ãƒ (coordinate-system.jsç­‰) - Konvaå†…è”µæ©Ÿèƒ½ã§ä»£æ›¿

---

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆï¼ˆfile://ç›´é–‹ãç‰ˆçµ±ä¸€ï¼‰
```
tegaki_anime_v2/
â”œâ”€â”€ index.html                      # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ styles/
â”‚   â””â”€â”€ main.css                    # å…¨ã‚¹ã‚¿ã‚¤ãƒ«çµ±åˆ
â”‚
â”œâ”€â”€ libs/                           # å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆæœ€çµ‚ãƒ“ãƒ«ãƒ‰æ™‚ï¼‰
â”‚   â”œâ”€â”€ konva.min.js
â”‚   â”œâ”€â”€ pixi.min.js
â”‚   â”œâ”€â”€ upng.min.js
â”‚   â””â”€â”€ gsap.min.js
â”‚
â”œâ”€â”€ assets/
â”‚   â””â”€â”€ ui-components.js            # ã€æ–°è¦ã€‘å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ»SVGçµ±åˆ
â”‚       # ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ãƒ»ãƒœã‚¿ãƒ³ãƒ»ã‚¹ã‚¤ãƒƒãƒãƒ»SVGã‚¢ã‚¤ã‚³ãƒ³ãƒ»è‰²å®šæ•°
â”‚
â”œâ”€â”€ config.js                       # 300è¡Œ è¨­å®šçµ±åˆï¼ˆæ—¢å­˜æµç”¨ï¼‰
â”‚
â”œâ”€â”€ system/
â”‚   â”œâ”€â”€ event-bus.js                # 150è¡Œï¼ˆæ—¢å­˜æµç”¨ï¼‰
â”‚   â”œâ”€â”€ state-manager.js            # 200è¡Œï¼ˆæ—¢å­˜æµç”¨ï¼‰
â”‚   â”œâ”€â”€ settings-manager.js         # 250è¡Œï¼ˆæ—¢å­˜æµç”¨ï¼‰
â”‚   â”œâ”€â”€ history.js                  # 400è¡Œï¼ˆæ—¢å­˜æµç”¨ï¼‰
â”‚   â”œâ”€â”€ camera-system.js            # 300è¡Œã€æ”¹ä¿®ã€‘Konvaçµ±åˆ
â”‚   â””â”€â”€ popup-manager.js            # 200è¡Œï¼ˆæ—¢å­˜æµç”¨ï¼‰
â”‚
â”œâ”€â”€ layers/
â”‚   â”œâ”€â”€ konva-layer-manager.js      # 800è¡Œã€æ–°è¦ã€‘Konvaãƒ¬ã‚¤ãƒ¤ãƒ¼çµ±åˆ
â”‚   â”œâ”€â”€ layer-folder-system.js      # 600è¡Œã€æ–°è¦ã€‘ãƒ•ã‚©ãƒ«ãƒ€éšå±¤ç®¡ç†
â”‚   â””â”€â”€ thumbnail-generator.js      # 400è¡Œã€æ–°è¦ã€‘Konvaãƒ™ãƒ¼ã‚¹ã‚µãƒ ãƒã‚¤ãƒ«
â”‚
â”œâ”€â”€ drawing/
â”‚   â”œâ”€â”€ raster-brush-engine.js      # 900è¡Œã€æ–°è¦ã€‘WebGL2ãƒ©ã‚¹ã‚¿ãƒ¼
â”‚   â”‚   # åˆ†å‰²å¯èƒ½: part1-core.js(500è¡Œ), part2-shader.js(400è¡Œ)
â”‚   â”œâ”€â”€ pressure-handler.js         # 200è¡Œï¼ˆæ—¢å­˜æµç”¨ï¼‰
â”‚   â”œâ”€â”€ pointer-handler.js          # 300è¡Œï¼ˆæ—¢å­˜æµç”¨ï¼‰
â”‚   â”œâ”€â”€ brush-settings.js           # 400è¡Œï¼ˆæ—¢å­˜æµç”¨ï¼‰
â”‚   â””â”€â”€ fill-tool.js                # 300è¡Œï¼ˆæ—¢å­˜æµç”¨ï¼‰
â”‚
â”œâ”€â”€ timeline/
â”‚   â”œâ”€â”€ frame-system.js             # 700è¡Œã€æ”¹ä¿®ã€‘Konvaçµ±åˆ
â”‚   â”œâ”€â”€ animation-controller.js     # 500è¡Œï¼ˆæ—¢å­˜æµç”¨ï¼‰
â”‚   â””â”€â”€ virtual-album.js            # 400è¡Œï¼ˆæ—¢å­˜æµç”¨ï¼‰
â”‚
â”œâ”€â”€ export/
â”‚   â”œâ”€â”€ export-manager.js           # 300è¡Œï¼ˆæ—¢å­˜æµç”¨ï¼‰
â”‚   â”œâ”€â”€ clipboard-exporter.js       # 200è¡Œã€æ–°è¦ã€‘
â”‚   â”œâ”€â”€ apng-exporter.js            # 600è¡Œï¼ˆæ—¢å­˜æµç”¨ï¼‰
â”‚   â””â”€â”€ png-exporter.js             # 200è¡Œï¼ˆæ—¢å­˜æµç”¨ï¼‰
â”‚
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ layer-panel.js              # 600è¡Œã€æ”¹ä¿®ã€‘Konvaé€£æº
â”‚   â”œâ”€â”€ timeline-panel.js           # 800è¡Œã€æ”¹ä¿®ã€‘Konvaçµ±åˆ
â”‚   â”œâ”€â”€ settings-popup.js           # 500è¡Œï¼ˆæ—¢å­˜æµç”¨ãƒ»è‰²ç¶™æ‰¿ï¼‰
â”‚   â”œâ”€â”€ album-popup.js              # 400è¡Œï¼ˆæ—¢å­˜æµç”¨ãƒ»è‰²ç¶™æ‰¿ï¼‰
â”‚   â””â”€â”€ keyboard-handler.js         # 300è¡Œï¼ˆæ—¢å­˜æµç”¨ï¼‰
â”‚
â”œâ”€â”€ core-runtime.js                 # 200è¡Œ åˆæœŸåŒ–å‡¦ç†
â””â”€â”€ core-engine.js                  # 300è¡Œ ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—


ğŸ¨ å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆçµ±åˆï¼ˆæ–°è¦ææ¡ˆï¼‰
assets/ui-components.js ã®è²¬å‹™

/**
 * ============================================================================
 * ãƒ•ã‚¡ã‚¤ãƒ«å: ui-components.js
 * è²¬å‹™: å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ»SVGã‚¢ã‚¤ã‚³ãƒ³ãƒ»è‰²å®šæ•°ã®çµ±ä¸€ç®¡ç†
 * ä¾å­˜: ãªã—ï¼ˆå®Œå…¨ç‹¬ç«‹ï¼‰
 * å…¬é–‹API:
 *   - UI_COLORS: è‰²å®šæ•°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 *   - SVG_ICONS: å…¨SVGã‚¢ã‚¤ã‚³ãƒ³ãƒãƒƒãƒ—
 *   - createSlider(options): ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼HTMLç”Ÿæˆ
 *   - createButton(options): ãƒœã‚¿ãƒ³HTMLç”Ÿæˆ
 *   - createSwitch(options): ã‚¹ã‚¤ãƒƒãƒHTMLç”Ÿæˆ
 *   - createDeleteButton(options): å‰Šé™¤ãƒœã‚¿ãƒ³ç”Ÿæˆ
 * ã‚°ãƒ­ãƒ¼ãƒãƒ«ç™»éŒ²: window.UIComponents
 * ============================================================================
 */

'use strict';

window.UIComponents = (() => {
  // ========================================
  // è‰²å®šæ•°ï¼ˆfutabaã‚«ãƒ©ãƒ¼çµ±ä¸€ï¼‰
  // ========================================
  const UI_COLORS = {
    maroon: '#800000',           // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒšãƒ³ã‚«ãƒ©ãƒ¼
    lightMaroon: '#aa5a56',      // ãƒ›ãƒãƒ¼çŠ¶æ…‹
    medium: '#cf9c97',           // ãƒœãƒ¼ãƒ€ãƒ¼ãƒ»éã‚¢ã‚¯ãƒ†ã‚£ãƒ–
    lightMedium: '#e9c2ba',      // ãƒ‘ãƒãƒ«èƒŒæ™¯
    cream: '#f0e0d6',            // ã‚­ãƒ£ãƒ³ãƒã‚¹èƒŒæ™¯
    background: '#ffffee',       // ãƒšãƒ¼ã‚¸èƒŒæ™¯
    activeSlider: '#800000',     // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚¢ã‚¯ãƒ†ã‚£ãƒ–
    inactiveSlider: '#cf9c97',   // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼éã‚¢ã‚¯ãƒ†ã‚£ãƒ–
    dangerRed: '#d32f2f'         // å‰Šé™¤ãƒœã‚¿ãƒ³
  };

  // ========================================
  // SVGã‚¢ã‚¤ã‚³ãƒ³ï¼ˆlucide-staticäº’æ›ï¼‰
  // ========================================
  const SVG_ICONS = {
    sprout: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M7 20h10"/>
      <path d="M10 20c5.5-2.5.8-6.4 3-10"/>
      <path d="M9.5 9.4c1.1.8 1.8 2.2 2.3 3.7-2 .4-3.5.4-4.8-.3-1.2-.6-2.3-1.9-3-4.2 2.8-.5 4.4 0 5.5.8z"/>
      <path d="M14.1 6a7 7 0 0 0-1.1 4c1.9-.1 3.3-.6 4.3-1.4 1-1 1.6-2.3 1.7-4.6-2.7.1-4 1-4.9 2z"/>
    </svg>`,
    
    layers: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polygon points="12 2 2 7 12 12 22 7 12 2"/>
      <polyline points="2 17 12 22 22 17"/>
      <polyline points="2 12 12 17 22 12"/>
    </svg>`,
    
    folder: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"/>
    </svg>`,
    
    folderOpen: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2"/>
    </svg>`,
    
    trash: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M3 6h18"/>
      <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
      <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
    </svg>`,
    
    eye: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/>
      <circle cx="12" cy="12" r="3"/>
    </svg>`,
    
    eyeOff: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/>
      <path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/>
      <path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"/>
      <line x1="2" x2="22" y1="2" y2="22"/>
    </svg>`,
    
    lock: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <rect width="18" height="11" x="3" y="11" rx="2" ry="2"/>
      <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
    </svg>`,
    
    unlock: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <rect width="18" height="11" x="3" y="11" rx="2" ry="2"/>
      <path d="M7 11V7a5 5 0 0 1 9.9-1"/>
    </svg>`,
    
    play: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polygon points="5 3 19 12 5 21 5 3"/>
    </svg>`,
    
    pause: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <rect width="4" height="16" x="6" y="4"/>
      <rect width="4" height="16" x="14" y="4"/>
    </svg>`,
    
    settings: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="3"/>
      <path d="M12 1v6m0 6v6"/>
      <path d="m15.14 2.75 2.12 3.68M4.74 14.57l2.12 3.68M6.86 2.75 4.74 6.43m14.52 8.14-2.12 3.68M23 12h-6M7 12H1"/>
    </svg>`,
    
    download: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
      <polyline points="7 10 12 15 17 10"/>
      <line x1="12" x2="12" y1="15" y2="3"/>
    </svg>`,
    
    plus: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <line x1="12" x2="12" y1="5" y2="19"/>
      <line x1="5" x2="19" y1="12" y2="12"/>
    </svg>`,
    
    minus: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <line x1="5" x2="19" y1="12" y2="12"/>
    </svg>`,
    
    x: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <line x1="18" x2="6" y1="6" y2="18"/>
      <line x1="6" x2="18" y1="6" y2="18"/>
    </svg>`
  };

  // ========================================
  // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ç”Ÿæˆ
  // ========================================
  function createSlider(options = {}) {
    const {
      min = 0,
      max = 100,
      value = 50,
      step = 1,
      label = '',
      onChange = () => {},
      id = `slider-${Date.now()}`
    } = options;

    return `
      <div class="ui-slider-container">
        ${label ? `<label for="${id}" style="color: ${UI_COLORS.maroon};">${label}</label>` : ''}
        <input 
          type="range" 
          id="${id}"
          class="ui-slider"
          min="${min}" 
          max="${max}" 
          value="${value}" 
          step="${step}"
          style="
            --slider-active: ${UI_COLORS.activeSlider};
            --slider-inactive: ${UI_COLORS.inactiveSlider};
          "
        />
        <span class="ui-slider-value" style="color: ${UI_COLORS.maroon};">${value}</span>
      </div>
    `;
  }

  // ========================================
  // ãƒœã‚¿ãƒ³ç”Ÿæˆ
  // ========================================
  function createButton(options = {}) {
    const {
      text = 'Button',
      icon = null,
      onClick = () => {},
      variant = 'primary', // primary, secondary, danger
      id = `btn-${Date.now()}`
    } = options;

    const colors = {
      primary: UI_COLORS.maroon,
      secondary: UI_COLORS.medium,
      danger: UI_COLORS.dangerRed
    };

    return `
      <button 
        id="${id}"
        class="ui-button ui-button-${variant}"
        style="
          background-color: ${colors[variant]};
          border-color: ${colors[variant]};
          color: #fff;
        "
      >
        ${icon ? SVG_ICONS[icon] || '' : ''}
        <span>${text}</span>
      </button>
    `;
  }

  // ========================================
  // ã‚¹ã‚¤ãƒƒãƒç”Ÿæˆ
  // ========================================
  function createSwitch(options = {}) {
    const {
      label = '',
      checked = false,
      onChange = () => {},
      id = `switch-${Date.now()}`
    } = options;

    return `
      <div class="ui-switch-container">
        ${label ? `<label for="${id}" style="color: ${UI_COLORS.maroon};">${label}</label>` : ''}
        <label class="ui-switch">
          <input type="checkbox" id="${id}" ${checked ? 'checked' : ''} />
          <span class="ui-switch-slider" style="
            --switch-active: ${UI_COLORS.activeSlider};
            --switch-inactive: ${UI_COLORS.inactiveSlider};
          "></span>
        </label>
      </div>
    `;
  }

  // ========================================
  // å‰Šé™¤ãƒœã‚¿ãƒ³ç”Ÿæˆ
  // ========================================
  function createDeleteButton(options = {}) {
    const {
      onClick = () => {},
      id = `del-btn-${Date.now()}`
    } = options;

    return `
      <button 
        id="${id}"
        class="ui-delete-button"
        style="
          background-color: ${UI_COLORS.dangerRed};
          color: #fff;
        "
        title="å‰Šé™¤"
      >
        ${SVG_ICONS.trash}
      </button>
    `;
  }

  // å…¬é–‹API
  return {
    UI_COLORS,
    SVG_ICONS,
    createSlider,
    createButton,
    createSwitch,
    createDeleteButton
  };
})();


CSSçµ±åˆï¼ˆmain.cssï¼‰

/* ========================================
   å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¹ã‚¿ã‚¤ãƒ«
   ======================================== */

.ui-slider-container {
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 8px 0;
}

.ui-slider {
  flex: 1;
  -webkit-appearance: none;
  appearance: none;
  height: 6px;
  border-radius: 3px;
  background: var(--slider-inactive);
  outline: none;
}

.ui-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: var(--slider-active);
  cursor: pointer;
}

.ui-slider::-moz-range-thumb {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: var(--slider-active);
  cursor: pointer;
  border: none;
}

.ui-slider-value {
  min-width: 40px;
  text-align: right;
  font-size: 12px;
}

.ui-button {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 16px;
  border: 2px solid;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  transition: opacity 0.2s;
}

.ui-button:hover {
  opacity: 0.8;
}

.ui-button svg {
  width: 16px;
  height: 16px;
}

.ui-switch-container {
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 8px 0;
}

.ui-switch {
  position: relative;
  display: inline-block;
  width: 44px;
  height: 24px;
}

.ui-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.ui-switch-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: var(--switch-inactive);
  border-radius: 24px;
  transition: 0.3s;
}

.ui-switch-slider:before {
  position: absolute;
  content: "";
  height: 18px;
  width: 18px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  border-radius: 50%;
  transition: 0.3s;
}

.ui-switch input:checked + .ui-switch-slider {
  background-color: var(--switch-active);
}

.ui-switch input:checked + .ui-switch-slider:before {
  transform: translateX(20px);
}

.ui-delete-button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  padding: 0;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: opacity 0.2s;
}

.ui-delete-button:hover {
  opacity: 0.8;
}

.ui-delete-button svg {
  width: 16px;
  height: 16px;
}
```

---

## ğŸ”„ ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥ æ”¹ä¿®æ–¹é‡

### ã€æ—¢å­˜æµç”¨ã€‘å¤‰æ›´ãªã—ï¼ˆ11ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
```
âœ… system/event-bus.js           - ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¹
âœ… system/state-manager.js       - çŠ¶æ…‹ç®¡ç†
âœ… system/settings-manager.js    - è¨­å®šç®¡ç†
âœ… system/history.js             - Undo/Redo
âœ… system/popup-manager.js       - ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—åˆ¶å¾¡
âœ… drawing/pressure-handler.js   - ç­†åœ§å‡¦ç†
âœ… drawing/pointer-handler.js    - ãƒã‚¤ãƒ³ã‚¿ãƒ¼å‡¦ç†
âœ… drawing/brush-settings.js     - ãƒ–ãƒ©ã‚·è¨­å®š
âœ… drawing/fill-tool.js          - å¡—ã‚Šã¤ã¶ã—
âœ… timeline/animation-controller.js - ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡
âœ… timeline/virtual-album.js     - ãƒãƒ¼ãƒãƒ£ãƒ«ã‚¢ãƒ«ãƒãƒ 
```

### ã€æ—¢å­˜æµç”¨ã€‘è‰²ãƒ»UIç¶™æ‰¿ï¼ˆ3ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
```
ğŸ¨ config.js                     - è‰²å®šæ•°ãƒ»è¨­å®šå€¤ç¶™æ‰¿
ğŸ¨ ui/settings-popup.js          - è¨­å®šUIãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ç¶™æ‰¿
ğŸ¨ ui/album-popup.js             - ã‚¢ãƒ«ãƒãƒ UIãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ç¶™æ‰¿
```

### ã€æ”¹ä¿®ã€‘Konvaçµ±åˆæ”¹ä¿®ï¼ˆ4ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
```
ğŸ”§ system/camera-system.js       - Konva.Stageåº§æ¨™ç³»ã«çµ±åˆ
ğŸ”§ timeline/frame-system.js      - Konvaãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ãƒ•ãƒ¬ãƒ¼ãƒ é€£æº
ğŸ”§ ui/layer-panel.js             - Konvaãƒ¬ã‚¤ãƒ¤ãƒ¼è¡¨ç¤ºãƒ»UIComponentsä½¿ç”¨
ğŸ”§ ui/timeline-panel.js          - Konvaã‚µãƒ ãƒã‚¤ãƒ«çµ±åˆãƒ»UIComponentsä½¿ç”¨
```

### ã€æ–°è¦ä½œæˆã€‘ï¼ˆ5ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
```
ğŸ†• assets/ui-components.js          - å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ»SVGãƒ»è‰²å®šæ•°
ğŸ†• layers/konva-layer-manager.js    - Konvaãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†ã‚³ã‚¢
ğŸ†• layers/layer-folder-system.js    - ãƒ•ã‚©ãƒ«ãƒ€éšå±¤å®Ÿè£…
ğŸ†• layers/thumbnail-generator.js    - Konvaãƒ™ãƒ¼ã‚¹ã‚µãƒ ãƒã‚¤ãƒ«
ğŸ†• drawing/raster-brush-engine.js   - WebGL2ãƒ©ã‚¹ã‚¿ãƒ¼æç”»
```

### ã€å‰Šé™¤ã€‘ä¸è¦ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ20+ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
```
âŒ coordinate-system.js              - Konvaã§ä»£æ›¿
âŒ system/layer-system.js            - Konvaçµ±åˆã«ã‚ˆã‚Šå‰Šé™¤
âŒ system/layer-transform.js         - Konvaçµ±åˆã«ã‚ˆã‚Šå‰Šé™¤
âŒ system/drawing/stroke-recorder.js - ãƒ™ã‚¯ã‚¿ãƒ¼ä¸è¦
âŒ system/drawing/stroke-renderer.js - ãƒ™ã‚¯ã‚¿ãƒ¼ä¸è¦
âŒ system/drawing/brush-core.js      - æ–°ã‚¨ãƒ³ã‚¸ãƒ³ã§çµ±åˆ
âŒ system/drawing/webgl2/* (å…¨ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼) - ãƒ™ã‚¯ã‚¿ãƒ¼ç”¨SDFä¸è¦
âŒ system/drawing/sdf-brush-shader.js - ãƒ™ã‚¯ã‚¿ãƒ¼ä¸è¦
âŒ system/drawing/stroke-transformer.js - ãƒ™ã‚¯ã‚¿ãƒ¼ä¸è¦
âŒ ui/layer-panel-renderer.js        - Konvaçµ±åˆã«ã‚ˆã‚Šå‰Šé™¤
âŒ ui/timeline-thumbnail-utils.js    - Konvaçµ±åˆã«ã‚ˆã‚Šå‰Šé™¤
âŒ ui/dom-builder.js                 - UIComponentsçµ±åˆã«ã‚ˆã‚Šå‰Šé™¤
âŒ ui/slider-utils.js                - UIComponentsçµ±åˆã«ã‚ˆã‚Šå‰Šé™¤


ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ãƒ«ãƒ¼ãƒ«
å¤§å‹ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ†å‰²æ–¹æ³•

// ========================================
// Part 1: Core Logic (500è¡Œ)
// ========================================
class RasterBrushEngine {
  constructor() { /* ... */ }
  initWebGL() { /* ... */ }
}

// ========================================
// Part 2: Shader Code (400è¡Œ)
// ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆã®ä¸‹ã« Part 2 ã‚’ã‚³ãƒ”ãƒšã—ã¦ãã ã•ã„
// ========================================
const VERTEX_SHADER = `#version 300 es
  // ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ¼ãƒ‰
`;
const FRAGMENT_SHADER = `#version 300 es
  // ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ¼ãƒ‰
`;

// ========================================
// Part 2 ã“ã“ã¾ã§
// ========================================


åˆ†å‰²ãƒ•ã‚¡ã‚¤ãƒ«ã®çµåˆè¦å‰‡


1. å„Partã¯ç‹¬ç«‹ã—ã¦ã‚³ãƒ”ãƒšå¯èƒ½
2. ã‚³ãƒ¡ãƒ³ãƒˆåŒºåˆ‡ã‚Šã§è¦–è¦šçš„ã«åˆ†é›¢
3. ä¾å­˜é–¢ä¿‚ã¯Part 1 â†’ Part 2ã®é †ã§æ˜è¨˜
4. å„Partçµ‚äº†æ™‚ã«ã€Œ========== Part N ã“ã“ã¾ã§ ==========ã€ã‚’è¨˜è¼‰
5. 1000è¡Œã‚’è¶…ãˆã‚‹å ´åˆã¯å¿…ãšåˆ†å‰²æŒ‡ç¤ºã‚’å‡ºã™


ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼è¦ç´„
å¿…é ˆãƒ˜ãƒƒãƒ€ãƒ¼ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

/**
 * ============================================================================
 * ãƒ•ã‚¡ã‚¤ãƒ«å: konva-layer-manager.js
 * è²¬å‹™: Konva.jsãƒ™ãƒ¼ã‚¹ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼éšå±¤ç®¡ç†
 * ä¾å­˜: 
 *   - konva (å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª - libs/konva.min.js)
 *   - event-bus.js (EventBus)
 *   - state-manager.js (StateManager)
 *   - ui-components.js (UIComponents - è‰²å®šæ•°ãƒ»SVG)
 * è¦ªä¾å­˜:
 *   - frame-system.js â†’ ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§
 *   - layer-panel.js â†’ ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§
 * å­ä¾å­˜:
 *   - ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ event-bus.js ã«ä¾å­˜
 *   - ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ state-manager.js ã«ä¾å­˜
 * å…¬é–‹API:
 *   - KonvaLayerManager.createLayer(name, options)
 *   - KonvaLayerManager.deleteLayer(layerId)
 *   - KonvaLayerManager.moveLayer(layerId, newIndex)
 *   - KonvaLayerManager.createFolder(name)
 * ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«:
 *   - 'layer:created' { layerId, name }
 *   - 'layer:deleted' { layerId }
 *   - 'layer:moved' { layerId, oldIndex, newIndex }
 * ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡:
 *   - 'drawing:stroke-complete' â†’ ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°
 *   - 'frame:changed' â†’ ãƒ¬ã‚¤ãƒ¤ãƒ¼å¯è¦–æ€§æ›´æ–°
 * ã‚°ãƒ­ãƒ¼ãƒãƒ«ç™»éŒ²: window.konvaLayerManager
 * å®Ÿè£…çŠ¶æ…‹: ğŸ†•æ–°è¦ / ğŸ”§æ”¹ä¿® / âœ…å®Œäº†
 * ============================================================================
 */

'use strict';

// ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¾å­˜ç¢ºèª
if (!window.Konva) {
  throw new Error('Konva.js ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
}
if (!window.EventBus) {
  throw new Error('EventBus ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
}
if (!window.StateManager) {
  throw new Error('StateManager ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
}
if (!window.UIComponents) {
  throw new Error('UIComponents ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
}

// ã‚¯ãƒ©ã‚¹å®šç¾©é–‹å§‹...
```

### ãƒ˜ãƒƒãƒ€ãƒ¼è¨˜è¼‰å¿…é ˆé …ç›®
```
1. ãƒ•ã‚¡ã‚¤ãƒ«å
2. è²¬å‹™ï¼ˆå˜ä¸€è²¬å‹™åŸå‰‡ï¼‰
3. ä¾å­˜ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆå¤–éƒ¨ãƒ»å†…éƒ¨æ˜è¨˜ï¼‰
4. è¦ªä¾å­˜ï¼ˆã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã™ã‚‹ä¸Šä½ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
5. å­ä¾å­˜ï¼ˆã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‚ç…§ã™ã‚‹ä¸‹ä½ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
6. å…¬é–‹APIä¸€è¦§
7. ç™ºç«ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ
8. å—ä¿¡ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ
9. ã‚°ãƒ­ãƒ¼ãƒãƒ«ç™»éŒ²åï¼ˆã‚ã‚‹å ´åˆï¼‰
10. å®Ÿè£…çŠ¶æ…‹ï¼ˆğŸ†•æ–°è¦ / ğŸ”§æ”¹ä¿® / âœ…å®Œäº†ï¼‰
```

---

## ğŸ› ï¸ ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ï¼ˆfile://ç›´é–‹ãç‰ˆå¯¾å¿œï¼‰

### åº§æ¨™å¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
```
PointerEvent.clientX/Y
 â†’ Konva.Stage.getPointerPosition() [DPIè£œæ­£è¾¼ã¿]
 â†’ Worldåº§æ¨™ç¢ºå®š
 â†’ ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ­ãƒ¼ã‚«ãƒ«åº§æ¨™: layer.getRelativePointerPosition()
 â†’ PixiJS WebGL2æç”»
```

### ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†
```
Konva.Stage (ãƒ«ãƒ¼ãƒˆ)
 â”œâ”€ BackgroundLayer (checkerèƒŒæ™¯)
 â”œâ”€ DrawingGroup (Konva.Group = ãƒ•ã‚©ãƒ«ãƒ€æ©Ÿèƒ½)
 â”‚   â”œâ”€ Layer1 (Konva.Layer)
 â”‚   â”‚   â””â”€ Image (Pixi RenderTextureè»¢é€)
 â”‚   â””â”€ Folder1 (Konva.Group)
 â”‚       â”œâ”€ Layer2
 â”‚       â””â”€ Layer3
 â””â”€ UILayer (é¸æŠæ ãƒ»ã‚«ãƒ¼ã‚½ãƒ«ç­‰)
```

### æç”»ãƒ•ãƒ­ãƒ¼
```
1. PointerEventå–å¾—ï¼ˆWebGL2 canvasï¼‰
2. Konvaåº§æ¨™å¤‰æ›ï¼ˆstage.getPointerPosition()ï¼‰
3. PixiJS WebGL2ã§ãƒ©ã‚¹ã‚¿ãƒ¼æç”»
4. Pixi.RenderTextureã‚’Konva.Imageã«è»¢é€
5. Konva.Layer.batchDraw()ã§æç”»æ›´æ–°
```

### ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã¨ãƒ•ãƒ¬ãƒ¼ãƒ ã®é–¢ä¿‚
```
Frame (ä¸Šä½æ¦‚å¿µ - ç¶™æ‰¿)
 â”œâ”€ duration: 100ms
 â”œâ”€ layers: [
 â”‚   { konvaLayerId: 'layer-1', visible: true },
 â”‚   { konvaLayerId: 'layer-2', visible: false }
 â”‚ ]
 â””â”€ thumbnail: DataURL (Konvaãƒ™ãƒ¼ã‚¹ç”Ÿæˆ)

Konva.Layer (ä¸‹ä½å®Ÿè£…)
 â”œâ”€ id: 'layer-1'
 â”œâ”€ name: 'ãƒ¬ã‚¤ãƒ¤ãƒ¼1'
 â”œâ”€ visible: true/false (ãƒ•ãƒ¬ãƒ¼ãƒ ã§åˆ¶å¾¡)
 â””â”€ children: [Konva.Image(Pixi RenderTexture)]
```

### å‘½åè¦å‰‡
```
- ãƒ¬ã‚¤ãƒ¤ãƒ¼é–¢é€£: konvaLayer, konvaStage, konvaGroup
- Pixié–¢é€£: pixiApp, pixiRenderer, pixiTexture
- ã‚¤ãƒ™ãƒ³ãƒˆ: component:actionå½¢å¼
  ä¾‹: layer:created, drawing:complete, frame:changed
- ãƒ¡ã‚½ãƒƒãƒ‰: createLayer, deleteLayer, updateLayer, getLayer
  ï¼ˆå‹•è©å§‹ã¾ã‚Šãƒ»CRUDçµ±ä¸€ï¼‰
- UIè¦ç´ : ui-slider, ui-button, ui-switch
  ï¼ˆui-ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹çµ±ä¸€ï¼‰
```

### ç¦æ­¢äº‹é …
```
âŒ äºŒé‡åº§æ¨™å¤‰æ›ï¼ˆKonva/Pixiä¸¡æ–¹ã§å¤‰æ›ï¼‰
âŒ ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã®ä¹±ç«‹ï¼ˆwindow.XXXçµ±ä¸€ç®¡ç†ï¼‰
âŒ Canvas2Dä½¿ç”¨ï¼ˆãƒ‡ãƒãƒƒã‚°ä»¥å¤–ï¼‰
âŒ 1ãƒ•ã‚¡ã‚¤ãƒ«1000è¡Œè¶…ãˆï¼ˆå¿…ãšåˆ†å‰²ï¼‰
âŒ ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆçœç•¥
âŒ è¦ªå­ä¾å­˜é–¢ä¿‚ã®æœªè¨˜è¼‰
âŒ UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å€‹åˆ¥å®Ÿè£…ï¼ˆUIComponentsä½¿ç”¨å¿…é ˆï¼‰
âŒ è‰²å®šæ•°ã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ï¼ˆUIComponents.UI_COLORSä½¿ç”¨ï¼‰
âŒ SVGã®ç›´æ¥åŸ‹ã‚è¾¼ã¿ï¼ˆUIComponents.SVG_ICONSä½¿ç”¨ï¼‰
âŒ import/exportæ§‹æ–‡ï¼ˆfile://éå¯¾å¿œï¼‰
âŒ ES Modulesï¼ˆå…¨ã¦ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã§å®Ÿè£…ï¼‰
```

### ã‚¨ãƒ©ãƒ¼å‡¦ç†
```
âœ… try-catchã§æ˜ç¤ºçš„ã«ã‚­ãƒ£ãƒƒãƒ
âœ… EventBusçµŒç”±ã§ã‚¨ãƒ©ãƒ¼é€šçŸ¥ï¼ˆ'error:occurred'ï¼‰
âœ… ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºï¼ˆé–‹ç™ºç”¨ï¼‰
âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼é€šçŸ¥ï¼ˆæœ¬ç•ªç”¨ãƒ»ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ï¼‰
âŒ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…ï¼ˆäºŒé‡å®Ÿè£…ã®æ¸©åºŠï¼‰
âŒ ã‚¨ãƒ©ãƒ¼æ¡ã‚Šã¤ã¶ã—
```

### DRY/SOLIDåŸå‰‡
```
âœ… å˜ä¸€è²¬å‹™: 1ãƒ•ã‚¡ã‚¤ãƒ«1è²¬å‹™
âœ… DRY: å…±é€šå‡¦ç†ã¯UIComponentsã«çµ±åˆ
âœ… ç–çµåˆ: EventBusçµŒç”±ã§é€šä¿¡
âœ… ä¾å­˜æ€§æ³¨å…¥: ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‚ç…§
âŒ äºŒé‡å®Ÿè£…: åŒã˜æ©Ÿèƒ½ã‚’è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ã‹ãªã„
âŒ å¾ªç’°ä¾å­˜: Aâ†’Bâ†’A ã®å‚ç…§ç¦æ­¢
```

### ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ç®¡ç†
```
âœ… é–‹ç™ºæ™‚ã®ã¿ä½¿ç”¨
âœ… é‡è¦ãªã‚¤ãƒ™ãƒ³ãƒˆç™ºç«æ™‚ã®ã¿è¨˜éŒ²
âŒ pointermoveç­‰ã®é«˜é »åº¦ã‚¤ãƒ™ãƒ³ãƒˆã§ã®ãƒ­ã‚°
âŒ å®Ÿè£…å®Œäº†å¾Œã®å†—é•·ãƒ­ã‚°
âŒ ãƒ‡ãƒãƒƒã‚°ç”¨é€”ä»¥å¤–ã®console.log

æ¨å¥¨: ãƒ‡ãƒãƒƒã‚°ã‚³ãƒãƒ³ãƒ‰çµŒç”±
window.debugLayer = (layerId) => {
  console.log(window.konvaLayerManager.getLayer(layerId));
}



ğŸ”§ Konvaçµ±åˆä»•æ§˜
ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€ ï¼ˆè©³ç´°ï¼‰


// Konva.StageåˆæœŸåŒ–
const stage = new Konva.Stage({
  container: 'canvas-container',
  width: 1920,
  height: 1080
});

// èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆchecker patternï¼‰
const bgLayer = new Konva.Layer({ id: 'bg-layer' });
const checker = new Konva.Rect({
  width: stage.width(),
  height: stage.height(),
  fillPatternImage: checkerImage,
  fillPatternRepeat: 'repeat'
});
bgLayer.add(checker);
stage.add(bgLayer);

// æç”»ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆãƒ•ã‚©ãƒ«ãƒ€æ©Ÿèƒ½ï¼‰
const drawingGroup = new Konva.Group({
  id: 'drawing-group',
  draggable: false
});
stage.add(drawingGroup);

// ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆ
const layer1 = new Konva.Layer({
  id: 'layer-1',
  name: 'ãƒ¬ã‚¤ãƒ¤ãƒ¼1'
});
drawingGroup.add(layer1);

// Pixi RenderTextureè»¢é€
const pixiImage = new Konva.Image({
  image: pixiRenderTexture.baseTexture.resource.source,
  x: 0,
  y: 0
});
layer1.add(pixiImage);

// UIãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆé¸æŠæ ç­‰ï¼‰
const uiLayer = new Konva.Layer({ id: 'ui-layer' });
stage.add(uiLayer);


ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ

// Konva.Layer.toDataURL()ã‚’ä½¿ç”¨
const thumbnail = layer.toDataURL({
  mimeType: 'image/png',
  quality: 0.8,
  pixelRatio: 0.25, // 1/4ã‚µã‚¤ã‚º
  x: 0,
  y: 0,
  width: layer.width(),
  height: layer.height()
});

// ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã«ç™»éŒ²
window.frameSystem.updateThumbnail(frameId, layerId, thumbnail);



ãƒ•ã‚©ãƒ«ãƒ€å®Ÿè£…

// Konva.Groupã§ãƒ•ã‚©ãƒ«ãƒ€ã‚’è¡¨ç¾
const folder = new Konva.Group({
  id: 'folder-001',
  name: 'ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼',
  draggable: false,
  // ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
  _isFolder: true,
  _expanded: true
});

// ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ 
folder.add(layer1);
folder.add(layer2);

// ãƒ•ã‚©ãƒ«ãƒ€ã‚’è¦ªã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ 
drawingGroup.add(folder);

// ãƒ•ã‚©ãƒ«ãƒ€å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿
folder._expanded = !folder._expanded;
window.EventBus.emit('folder:toggled', { folderId: folder.id(), expanded: folder._expanded });


ãƒ¬ã‚¤ãƒ¤ãƒ¼å¯è¦–æ€§åˆ¶å¾¡


// ãƒ•ãƒ¬ãƒ¼ãƒ åˆ‡ã‚Šæ›¿ãˆæ™‚
function setFrame(frameId) {
  const frame = window.frameSystem.getFrame(frameId);
  
  frame.layers.forEach(layerState => {
    const konvaLayer = window.konvaLayerManager.getLayer(layerState.konvaLayerId);
    if (konvaLayer) {
      konvaLayer.visible(layerState.visible);
    }
  });
  
  window.konvaLayerManager.stage.batchDraw();
}
```

---

## ğŸ¨ WebGL2ãƒ©ã‚¹ã‚¿ãƒ¼ãƒšãƒ³ä»•æ§˜

### æç”»ãƒ•ãƒ­ãƒ¼ï¼ˆè©³ç´°ï¼‰
```
1. PointerEvent â†’ Konva.Stage.getPointerPosition()
   åº§æ¨™: { x: 500, y: 300 } (Stageåº§æ¨™)

2. ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ­ãƒ¼ã‚«ãƒ«åº§æ¨™å–å¾—
   const localPos = layer.getRelativePointerPosition();
   åº§æ¨™: { x: 450, y: 250 } (Layeråº§æ¨™)

3. PixiJS WebGL2æç”»
   const graphics = new PIXI.Graphics();
   graphics.beginFill(color, opacity);
   graphics.drawCircle(localPos.x, localPos.y, brushSize);
   graphics.endFill();
   pixiRenderer.render(graphics, { renderTexture });

4. RenderTexture â†’ Konva.Imageè»¢é€
   konvaImage.image(renderTexture.baseTexture.resource.source);

5. Konva.Layeræ›´æ–°
   layer.batchDraw();


ãƒ–ãƒ©ã‚·ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿


const brushSettings = {
  size: 10,              // ã‚µã‚¤ã‚ºï¼ˆpxï¼‰
  opacity: 1.0,          // ä¸é€æ˜åº¦ 0.0-1.0
  flow: 0.5,             // æµé‡ï¼ˆé€£ç¶šæç”»æ™‚ã®æ¿ƒã•ï¼‰
  hardness: 0.8,         // ç¡¬ã•ï¼ˆ0=ã‚¨ã‚¢ãƒ–ãƒ©ã‚·, 1=ãƒãƒ¼ãƒ‰ã‚¨ãƒƒã‚¸ï¼‰
  spacing: 0.1,          // ã‚¹ã‚¿ãƒ³ãƒ—é–“éš”ï¼ˆã‚µã‚¤ã‚ºã®10%ï¼‰
  pressureCurve: 'linear', // ç­†åœ§ã‚«ãƒ¼ãƒ–ï¼ˆlinear, ease-in, ease-outï¼‰
  color: '#800000',      // è‰²ï¼ˆUIComponents.UI_COLORS.maroonï¼‰
  blendMode: 'normal'    // ãƒ–ãƒ¬ãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰ï¼ˆnormal, multiply, screenç­‰ï¼‰
};
```

### ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ä¸è¦ã®ç†ç”±
```
ç†ç”±: Pixi.Graphics ã®ãƒ“ãƒ«ãƒˆã‚¤ãƒ³æ©Ÿèƒ½ã§ååˆ†

åˆ©ç”¨æ©Ÿèƒ½:
- beginFill(color, alpha) ã§è‰²ãƒ»é€æ˜åº¦æŒ‡å®š
- drawCircle(x, y, radius) ã§å††æç”»
- endFill() ã§è‡ªå‹•ä¸‰è§’å½¢åŒ–
- blendMode = PIXI.BLEND_MODES.MULTIPLY ã§ãƒ–ãƒ¬ãƒ³ãƒ‰

ãƒ©ã‚¹ã‚¿ãƒ¼ãƒšãƒ³ã«å¿…è¦ãªæ©Ÿèƒ½:
âœ… å††å½¢ã‚¹ã‚¿ãƒ³ãƒ—æç”» â†’ drawCircle()
âœ… ä¸é€æ˜åº¦åˆ¶å¾¡ â†’ alpha ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
âœ… ãƒ–ãƒ¬ãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰ â†’ blendMode ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
âœ… ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚¹ â†’ WebGL2æ¨™æº–æ©Ÿèƒ½

ä¸è¦ãªæ©Ÿèƒ½:
âŒ SDFï¼ˆSigned Distance Fieldï¼‰
âŒ MSDFï¼ˆMulti-channel SDFï¼‰
âŒ ã‚«ã‚¹ã‚¿ãƒ ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼
âŒ GPU Compute


ğŸ“Š ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ç¶™æ‰¿ä»•æ§˜
ãƒ•ãƒ¬ãƒ¼ãƒ æ§‹é€ ï¼ˆç¶™æ‰¿ï¼‰


/**
 * ãƒ•ãƒ¬ãƒ¼ãƒ  = ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ä¸Šã®1ã‚³ãƒ
 * ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å¯è¦–æ€§ãƒ»é †åºã‚’ä¿æŒ
 */
class Frame {
  constructor(id, duration = 100) {
    this.id = id;                    // 'frame-001'
    this.duration = duration;        // ms
    this.layers = [];                // ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹é…åˆ—
    this.thumbnail = null;           // DataURL (Konvaãƒ™ãƒ¼ã‚¹ç”Ÿæˆ)
  }

  addLayer(konvaLayerId, visible = true) {
    this.layers.push({
      konvaLayerId,
      visible,
      opacity: 1.0,
      blendMode: 'normal'
    });
  }

  removeLayer(konvaLayerId) {
    this.layers = this.layers.filter(l => l.konvaLayerId !== konvaLayerId);
  }

  setLayerVisible(konvaLayerId, visible) {
    const layer = this.layers.find(l => l.konvaLayerId === konvaLayerId);
    if (layer) {
      layer.visible = visible;
    }
  }
}

Konvaçµ±åˆæ”¹ä¿®ç‚¹

// frame-system.js æ”¹ä¿®ä¾‹

class FrameSystem {
  constructor() {
    this.frames = new Map();         // frameId â†’ Frame
    this.currentFrameId = null;
    this.eventBus = window.EventBus;
    this.konvaLayerManager = window.konvaLayerManager;
  }

  /**
   * ãƒ•ãƒ¬ãƒ¼ãƒ åˆ‡ã‚Šæ›¿ãˆ
   * Konvaãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å¯è¦–æ€§ã‚’æ›´æ–°
   */
  setFrame(frameId) {
    const frame = this.frames.get(frameId);
    if (!frame) {
      throw new Error(`Frame not found: ${frameId}`);
    }

    // å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’éè¡¨ç¤ºåŒ–
    this.konvaLayerManager.getAllLayers().forEach(layer => {
      layer.visible(false);
    });

    // ãƒ•ãƒ¬ãƒ¼ãƒ å†…ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¡¨ç¤º
    frame.layers.forEach(layerState => {
      const konvaLayer = this.konvaLayerManager.getLayer(layerState.konvaLayerId);
      if (konvaLayer) {
        konvaLayer.visible(layerState.visible);
        konvaLayer.opacity(layerState.opacity);
        // blendModeè¨­å®šï¼ˆKonva v9å¯¾å¿œï¼‰
        konvaLayer.blendMode(layerState.blendMode);
      }
    });

    this.currentFrameId = frameId;
    this.konvaLayerManager.stage.batchDraw();
    
    this.eventBus.emit('frame:changed', { frameId });
  }

  /**
   * ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆï¼ˆKonvaãƒ™ãƒ¼ã‚¹ï¼‰
   */
  generateThumbnail(frameId) {
    const frame = this.frames.get(frameId);
    if (!frame) return null;

    // ä¸€æ™‚ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ãƒ•ãƒ¬ãƒ¼ãƒ çŠ¶æ…‹ã‚’å†ç¾
    const tempLayer = new Konva.Layer();
    frame.layers.forEach(layerState => {
      if (!layerState.visible) return;
      
      const srcLayer = this.konvaLayerManager.getLayer(layerState.konvaLayerId);
      if (srcLayer) {
        const cloned = srcLayer.clone();
        tempLayer.add(cloned);
      }
    });

    // ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ
    const thumbnail = tempLayer.toDataURL({
      mimeType: 'image/png',
      quality: 0.8,
      pixelRatio: 0.25
    });

    tempLayer.destroy();
    frame.thumbnail = thumbnail;
    
    return thumbnail;
  }
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«ç™»éŒ²
window.frameSystem = new FrameSystem();


ğŸ¨ UIè‰²ç¶™æ‰¿
æ—¢å­˜ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆï¼ˆUIComponentsçµ±åˆï¼‰

ğŸš¨ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’è¦‹ã¦é…è‰²ã‚’å¤‰ãˆã‚‹å¯èƒ½æ€§ãŒæœ‰ã‚‹ãŸã‚ã€å®¹æ˜“ã«å¤‰æ›´ã§ãã‚‹ä½œã‚Šã¨ã—ã¦ãŠãäº‹ã€‚
// assets/ui-components.js å†…ã§å®šç¾©
const UI_COLORS = {
  maroon: '#800000',           // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒšãƒ³ã‚«ãƒ©ãƒ¼ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
  lightMaroon: '#aa5a56',      // ãƒ›ãƒãƒ¼çŠ¶æ…‹
  medium: '#cf9c97',           // ãƒœãƒ¼ãƒ€ãƒ¼ãƒ»éã‚¢ã‚¯ãƒ†ã‚£ãƒ–
  lightMedium: '#e9c2ba',      // ãƒ‘ãƒãƒ«èƒŒæ™¯
  cream: '#f0e0d6',            // ã‚­ãƒ£ãƒ³ãƒã‚¹èƒŒæ™¯ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼0ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
  background: '#ffffee',       // ãƒšãƒ¼ã‚¸èƒŒæ™¯
  activeSlider: '#800000',     // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚¢ã‚¯ãƒ†ã‚£ãƒ–
  inactiveSlider: '#cf9c97',   // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼éã‚¢ã‚¯ãƒ†ã‚£ãƒ–
  dangerRed: '#d32f2f'         // å‰Šé™¤ãƒœã‚¿ãƒ³
};

ä½¿ç”¨ä¾‹

// layer-panel.js ã§ã®ä½¿ç”¨
const deleteButton = window.UIComponents.createDeleteButton({
  onClick: () => deleteLayer(layerId)
});

// æ‰‹å‹•ã§HTMLç”Ÿæˆã™ã‚‹å ´åˆ
const customButton = `
  <button style="background-color: ${window.UIComponents.UI_COLORS.maroon};">
    ã‚«ã‚¹ã‚¿ãƒ ãƒœã‚¿ãƒ³
  </button>
`;

// SVGã‚¢ã‚¤ã‚³ãƒ³ä½¿ç”¨
const layerIcon = window.UIComponents.SVG_ICONS.layers;


ğŸš€ ãƒ“ãƒ«ãƒ‰ãƒ•ãƒ­ãƒ¼


<!-- index.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Tegaki Anime v2.0</title>
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <div id="app"></div>

  <!-- CDNèª­ã¿è¾¼ã¿ï¼ˆé–‹ç™ºæ™‚ï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/konva@9/konva.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pixi.js@8/dist/pixi.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/upng-js@2/UPNG.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/gsap.min.js"></script>

  <!-- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ -->
  <script src="assets/ui-components.js"></script>
  <script src="config.js"></script>
  <script src="system/event-bus.js"></script>
  <script src="system/state-manager.js"></script>
  <!-- ... ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ« ... -->
  <script src="core-runtime.js"></script>
</body>
</html>


æœ¬ç•ªãƒ“ãƒ«ãƒ‰ï¼ˆlibsçµ±åˆï¼‰


# 1. npmã§ä¾å­˜å–å¾—
npm install konva@9 pixi.js@8 upng-js@2 gsap@3

# 2. libs/ã«ã‚³ãƒ”ãƒ¼
mkdir -p libs
cp node_modules/konva/konva.min.js libs/
cp node_modules/pixi.js/dist/pixi.min.js libs/
cp node_modules/upng-js/UPNG.js libs/upng.min.js
cp node_modules/gsap/dist/gsap.min.js libs/

# 3. å…¨JSãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµåˆï¼ˆæ‰‹å‹• or ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼‰
# çµåˆé †åº:
# libs/*.js â†’ assets/*.js â†’ config.js â†’ system/*.js â†’ layers/*.js
# â†’ drawing/*.js â†’ timeline/*.js â†’ export/*.js â†’ ui/*.js â†’ core-*.js

cat \
  libs/konva.min.js \
  libs/pixi.min.js \
  libs/upng.min.js \
  libs/gsap.min.js \
  assets/ui-components.js \
  config.js \
  system/event-bus.js \
  system/state-manager.js \
  system/settings-manager.js \
  system/history.js \
  system/camera-system.js \
  system/popup-manager.js \
  layers/konva-layer-manager.js \
  layers/layer-folder-system.js \
  layers/thumbnail-generator.js \
  drawing/raster-brush-engine.js \
  drawing/pressure-handler.js \
  drawing/pointer-handler.js \
  drawing/brush-settings.js \
  drawing/fill-tool.js \
  timeline/frame-system.js \
  timeline/animation-controller.js \
  timeline/virtual-album.js \
  export/export-manager.js \
  export/clipboard-exporter.js \
  export/apng-exporter.js \
  export/png-exporter.js \
  ui/layer-panel.js \
  ui/timeline-panel.js \
  ui/settings-popup.js \
  ui/album-popup.js \
  ui/keyboard-handler.js \
  core-runtime.js \
  core-engine.js \
  > dist/tegaki_anime_all.js

# 4. HTMLã‚’å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«åŒ–
# index.htmlã®CSSãƒ»JSã‚’å…¨ã¦ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–


æœ€çµ‚å‡ºåŠ›ï¼ˆAll in Oneï¼‰


<!-- dist/tegaki_anime_standalone.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Tegaki Anime v2.0</title>
  <style>
    /* styles/main.css ã®å†…å®¹ã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ */
    :root {
      --futaba-maroon: #800000;
      --futaba-light-maroon: #aa5a56;
      /* ... */
    }
    /* ... å…¨CSS ... */
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    // dist/tegaki_anime_all.js ã®å†…å®¹ã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³
    // libs + assets + å…¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰
  </script>
</body>
</html>
```

---

## ğŸ“‹ æ”¹ä¿®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: ç’°å¢ƒæ§‹ç¯‰ãƒ»å…±é€šåŸºç›¤
- [ ] ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ä½œæˆ
- [ ] assets/ui-components.js ä½œæˆï¼ˆSVGãƒ»è‰²ãƒ»ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰
- [ ] styles/main.css çµ±åˆï¼ˆUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆCSSè¿½åŠ ï¼‰
- [ ] config.js ã‚³ãƒ”ãƒ¼ï¼ˆæ—¢å­˜æµç”¨ï¼‰
- [ ] æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ”ãƒ¼ï¼ˆæµç”¨11ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

### Phase 2: Konvaçµ±åˆ
- [ ] layers/konva-layer-manager.js æ–°è¦ä½œæˆ
- [ ] layers/layer-folder-system.js æ–°è¦ä½œæˆ
- [ ] layers/thumbnail-generator.js æ–°è¦ä½œæˆ
- [ ] system/camera-system.js æ”¹ä¿®ï¼ˆKonvaçµ±åˆï¼‰
- [ ] Konva.StageåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ

### Phase 3: ãƒ©ã‚¹ã‚¿ãƒ¼æç”»
- [ ] drawing/raster-brush-engine.js æ–°è¦ä½œæˆï¼ˆPart 1: Coreï¼‰
- [ ] drawing/raster-brush-engine.js æ–°è¦ä½œæˆï¼ˆPart 2: Shaderï¼‰
- [ ] Pixi.RenderTextureçµ±åˆãƒ†ã‚¹ãƒˆ
- [ ] ãƒ–ãƒ¬ãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰å®Ÿè£…ç¢ºèª
- [ ] ç­†åœ§å¯¾å¿œç¢ºèª

### Phase 4: ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³çµ±åˆ
- [ ] timeline/frame-system.js æ”¹ä¿®ï¼ˆKonvaé€£æºï¼‰
- [ ] ãƒ•ãƒ¬ãƒ¼ãƒ åˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆ
- [ ] ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆãƒ†ã‚¹ãƒˆï¼ˆKonvaãƒ™ãƒ¼ã‚¹ï¼‰

### Phase 5: UIçµ±åˆ
- [ ] ui/layer-panel.js æ”¹ä¿®ï¼ˆUIComponentsä½¿ç”¨ï¼‰
- [ ] ui/timeline-panel.js æ”¹ä¿®ï¼ˆUIComponentsä½¿ç”¨ï¼‰
- [ ] ui/settings-popup.js è‰²ç¶™æ‰¿ç¢ºèª
- [ ] ui/album-popup.js è‰²ç¶™æ‰¿ç¢ºèª

### Phase 6: ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- [ ] export/clipboard-exporter.js æ–°è¦ä½œæˆ
- [ ] APNG/GIFã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆç¢ºèª

### Phase 7: ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ†ã‚¹ãƒˆ
- [ ] npm install ä¾å­˜å–å¾—
- [ ] libs/ã‚³ãƒ”ãƒ¼ç¢ºèª
- [ ] å…¨JSãƒ•ã‚¡ã‚¤ãƒ«çµåˆ
- [ ] HTMLã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–
- [ ] file://å‹•ä½œç¢ºèª
- [ ] å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆï¼ˆæç”»/ãƒ¬ã‚¤ãƒ¤ãƒ¼/ãƒ•ãƒ¬ãƒ¼ãƒ /ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼‰

---

## ğŸ› AIãƒŸã‚¹é˜²æ­¢ç­–

### 1. ãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã§ä¾å­˜æ˜è¨˜
```
âœ… ä¾å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¿…ãšè¨˜è¼‰ â†’ å‚ç…§ãƒŸã‚¹é˜²æ­¢
âœ… è¦ªä¾å­˜ãƒ»å­ä¾å­˜ã‚’æ˜è¨˜ â†’ å¾ªç’°ä¾å­˜é˜²æ­¢
âœ… ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¾å­˜ç¢ºèªã‚³ãƒ¼ãƒ‰è¿½åŠ  â†’ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼é˜²æ­¢
```

### 2. ãƒ¡ã‚½ãƒƒãƒ‰å‘½åçµ±ä¸€
```
create/delete/update/get ã®4å‹•è©ã®ã¿ä½¿ç”¨
ä¾‹: createLayer, deleteLayer, updateLayer, getLayer
```

### 3. ã‚¤ãƒ™ãƒ³ãƒˆåçµ±ä¸€
```
component:action å½¢å¼å³å®ˆ
ä¾‹: layer:created, drawing:complete, frame:changed


4. ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã®çµ±ä¸€ç®¡ç†

// core-runtime.js ã§ä¸€æ‹¬ç™»éŒ²
window.UIComponents = /* assets/ui-components.js */;
window.EventBus = /* system/event-bus.js */;
window.StateManager = /* system/state-manager.js */;
window.konvaLayerManager = /* layers/konva-layer-manager.js */;
window.rasterBrush = /* drawing/raster-brush-engine.js */;
window.frameSystem = /* timeline/frame-system.js */;

5. å‹å®šç¾©ã‚³ãƒ¡ãƒ³ãƒˆ

/**
 * ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆ
 * @param {string} layerId - ãƒ¬ã‚¤ãƒ¤ãƒ¼ID
 * @param {Object} options - ã‚ªãƒ—ã‚·ãƒ§ãƒ³
 * @param {string} options.name - ãƒ¬ã‚¤ãƒ¤ãƒ¼å
 * @param {number} options.opacity - ä¸é€æ˜åº¦ 0.0-1.0
 * @param {boolean} options.visible - å¯è¦–æ€§
 * @returns {Konva.Layer} ä½œæˆã•ã‚ŒãŸãƒ¬ã‚¤ãƒ¤ãƒ¼
 * @throws {Error} layerIdé‡è¤‡æ™‚
 */
createLayer(layerId, options = {}) {
  // å®Ÿè£…
}




6. åˆ†å‰²ãƒ•ã‚¡ã‚¤ãƒ«ã®æ˜ç¤º


// ========================================
// Part 1: Core Logic (500è¡Œ)
// ========================================
class RasterBrushEngine {
  // ã‚³ã‚¢å‡¦ç†
}

// ========================================
// Part 2: Shader Code (400è¡Œ)
// ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆã®ä¸‹ã« Part 2 ã‚’ã‚³ãƒ”ãƒšã—ã¦ãã ã•ã„
// ========================================
const VERTEX_SHADER = `#version 300 es
  // ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ¼ãƒ‰
`;

// ========================================
// Part 2 ã“ã“ã¾ã§
// ========================================



7. UIComponentsä½¿ç”¨ã®å¾¹åº•

// âŒ ç¦æ­¢: å€‹åˆ¥å®Ÿè£…
const slider = `<input type="range" ...>`;

// âœ… æ¨å¥¨: UIComponentsä½¿ç”¨
const slider = window.UIComponents.createSlider({
  min: 0,
  max: 100,
  value: 50,
  label: 'ãƒ–ãƒ©ã‚·ã‚µã‚¤ã‚º'
});


8. è‰²å®šæ•°ã®çµ±ä¸€

// âŒ ç¦æ­¢: ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
const buttonColor = '#800000';

// âœ… æ¨å¥¨: UIComponents.UI_COLORSä½¿ç”¨
const buttonColor = window.UIComponents.UI_COLORS.maroon;

9. äºŒé‡å®Ÿè£…ãƒã‚§ãƒƒã‚¯

å®Ÿè£…å‰ãƒã‚§ãƒƒã‚¯:
1. åŒã˜æ©Ÿèƒ½ãŒæ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã«ãªã„ã‹ï¼Ÿ
2. UIComponentsã«çµ±åˆã™ã¹ãã‹ï¼Ÿ
3. EventBusçµŒç”±ã§æ—¢å­˜æ©Ÿèƒ½ã‚’å‘¼ã¹ãªã„ã‹ï¼Ÿ


### 10. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®å‰Šæ¸›
```javascript
// âœ… é–‹ç™ºæ™‚ã®ã¿ãƒ»é‡è¦ã‚¤ãƒ™ãƒ³ãƒˆã®ã¿
if (window.DEBUG_MODE) {
  console.log('[LayerManager] Layer created:', layerId);
}

// âŒ é«˜é »åº¦ã‚¤ãƒ™ãƒ³ãƒˆã§ã®ãƒ­ã‚°
// pointermove, frame update ç­‰ã§ã¯ä½¿ç”¨ç¦æ­¢
```

---

## ğŸ“ è³ªå•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

æ”¹ä¿®ä¸­ã«ä¸æ˜ç‚¹ãŒã‚ã‚‹å ´åˆ:

ã€è³ªå•ã€‘konva-layer-manager.jsã®å®Ÿè£…ã«ã¤ã„ã¦
ã€çŠ¶æ³ã€‘

ãƒ•ã‚©ãƒ«ãƒ€éšå±¤ã®å®Ÿè£…æ–¹æ³•ãŒä¸æ˜
Konva.Group.add()ã®ä½¿ã„æ–¹ã‚’ç¢ºèªã—ãŸã„

ã€ä¾å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã€‘

event-bus.js ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã®ã¿æ·»ä»˜ï¼‰
state-manager.js ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã®ã¿æ·»ä»˜ï¼‰
ui-components.js ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã®ã¿æ·»ä»˜ï¼‰

ã€æœŸå¾…ã™ã‚‹å‹•ä½œã€‘

ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ãƒ•ã‚©ãƒ«ãƒ€ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§ç§»å‹•
ãƒ•ã‚©ãƒ«ãƒ€ã¯æŠ˜ã‚ŠãŸãŸã¿å¯èƒ½
UIComponents.SVG_ICONSã§ãƒ•ã‚©ãƒ«ãƒ€ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º

ã€å‚è€ƒã«ã™ã‚‹æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã€‘
ï¼ˆè©²å½“ç®‡æ‰€ã®ã¿æŠœç²‹ï¼‰
ã€è£œè¶³ã€‘

1000è¡Œè¶…ãˆã‚‹å ´åˆã¯åˆ†å‰²æŒ‡ç¤ºã‚’ãŠé¡˜ã„ã—ã¾ã™

---

## âœ… å®Œäº†æ¡ä»¶

- [ ] ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹
- [ ] è¦ªå­ä¾å­˜é–¢ä¿‚ãŒå…¨ãƒ•ã‚¡ã‚¤ãƒ«ã§æ˜è¨˜ã•ã‚Œã¦ã„ã‚‹
- [ ] 1ãƒ•ã‚¡ã‚¤ãƒ«1000è¡Œä»¥ä¸‹ï¼ˆåˆ†å‰²ã‚³ãƒ¡ãƒ³ãƒˆä»˜ãï¼‰
- [ ] UIComponentsçµ±åˆå®Œäº†ï¼ˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ãƒ»ãƒœã‚¿ãƒ³ãƒ»ã‚¹ã‚¤ãƒƒãƒãƒ»SVGï¼‰
- [ ] UI_COLORSã§è‰²çµ±ä¸€ï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰0ä»¶ï¼‰
- [ ] SVG_ICONSã§ã‚¢ã‚¤ã‚³ãƒ³çµ±ä¸€ï¼ˆç›´æ¥åŸ‹ã‚è¾¼ã¿0ä»¶ï¼‰
- [ ] file://ã§å‹•ä½œå¯èƒ½ï¼ˆimport/export 0ä»¶ï¼‰
- [ ] libs/ã«CDNãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ ¼ç´
- [ ] å…¨JSãƒ•ã‚¡ã‚¤ãƒ«çµåˆå¯èƒ½
- [ ] HTMLã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–å¯¾å¿œ
- [ ] Konva.StageåˆæœŸåŒ–æˆåŠŸ
- [ ] ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆ/å‰Šé™¤/ç§»å‹•ãŒå‹•ä½œ
- [ ] ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ/å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿ãŒå‹•ä½œ
- [ ] ãƒ©ã‚¹ã‚¿ãƒ¼æç”»ãŒå‹•ä½œ
- [ ] ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒ»ãƒ•ãƒ¬ãƒ¼ãƒ ãŒå‹•ä½œ
- [ ] ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆï¼ˆKonvaãƒ™ãƒ¼ã‚¹ï¼‰ãŒå‹•ä½œ
- [ ] APNG/PNG/GIFã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãŒå‹•ä½œ
- [ ] ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼ãŒå‹•ä½œ
- [ ] ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼0ä»¶
- [ ] äºŒé‡å®Ÿè£…0ä»¶ï¼ˆDRYåŸå‰‡éµå®ˆï¼‰
- [ ] å¾ªç’°ä¾å­˜0ä»¶

---

## ğŸ“ å‚™è€ƒ

### Konva vs PixiJS å½¹å‰²åˆ†æ‹…

Konva.js:
âœ… ãƒ¬ã‚¤ãƒ¤ãƒ¼éšå±¤ç®¡ç†
âœ… ãƒ•ã‚©ãƒ«ãƒ€æ©Ÿèƒ½
âœ… ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ
âœ… UIè¡¨ç¤ºï¼ˆé¸æŠæ ãƒ»ã‚«ãƒ¼ã‚½ãƒ«ç­‰ï¼‰
âœ… åº§æ¨™å¤‰æ›ï¼ˆStageåº§æ¨™ç³»ï¼‰
PixiJS v8:
âœ… WebGL2æç”»ã®ã¿
âœ… RenderTextureç”Ÿæˆ
âœ… ãƒ–ãƒ¬ãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰
âŒ ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†ï¼ˆKonvaã«ä¸€ä»»ï¼‰
âŒ åº§æ¨™å¤‰æ›ï¼ˆKonvaã«ä¸€ä»»ï¼‰


### ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã®ä¸Šä½æ¦‚å¿µ

Frame (æœ€ä¸Šä½)
â”œâ”€ duration
â”œâ”€ layers[] (Konvaãƒ¬ã‚¤ãƒ¤ãƒ¼å‚ç…§)
â””â”€ thumbnail (Konvaç”Ÿæˆ)
Konva.Layer (ä¸­ä½)
â”œâ”€ id, name, visible
â”œâ”€ children[] (Konva.Imageç­‰)
â””â”€ parent: Konva.Group (ãƒ•ã‚©ãƒ«ãƒ€)
Pixi.RenderTexture (æœ€ä¸‹ä½)
â””â”€ WebGL2æç”»çµæœ



### file://ç›´é–‹ãã®åˆ©ç‚¹

âœ… HTTPã‚µãƒ¼ãƒãƒ¼ä¸è¦
âœ… nijiurachan.netç›´æ¥è²¼ã‚Šä»˜ã‘å¯èƒ½
âœ… ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå¯¾å¿œ
âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ¶ç´„å°‘ãªã„
âœ… é…å¸ƒãŒå®¹æ˜“ï¼ˆ1ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

### ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

v2.1: ãƒ¢ãƒ¼ãƒ•ã‚£ãƒ³ã‚°æ©Ÿèƒ½ï¼ˆLive2Dé¢¨ï¼‰
v2.2: ãƒªã‚®ãƒ³ã‚°æ©Ÿèƒ½ï¼ˆSpineé¢¨ï¼‰
v2.3: ãƒ™ã‚¯ã‚¿ãƒ¼ãƒ¬ã‚¤ãƒ¤ãƒ¼å¾©æ´»ï¼ˆãƒãƒªã‚´ãƒ³ãƒ™ãƒ¼ã‚¹ï¼‰
v2.4: WebGPUå¯¾å¿œ

---

ä»¥ä¸Šã§æ”¹ä¿®è¨ˆç”»æ›¸ã¯å®Œäº†ã§ã™ã€‚
å„ãƒ•ã‚§ãƒ¼ã‚ºã”ã¨ã«Claudeã«æå‡ºã—ã€æ®µéšçš„ã«å®Ÿè£…ã‚’é€²ã‚ã¦ãã ã•ã„ã€‚




