config.js:523 âœ… config.js (Phase 2å®Œå…¨ç‰ˆ) loaded
config.js:524    - BRUSH_DEFAULTSè¿½åŠ å®Œäº†
event-bus.js:143 âœ… system/event-bus.js Phase 2: å„ªå…ˆåº¦æ©Ÿèƒ½è¿½åŠ ç‰ˆ loaded
coordinate-system.js:519 âœ… coordinate-system.js (Phase 2.5å®Œå…¨ä¿®æ­£ç‰ˆ) loaded
coordinate-system.js:520    - Phase 2.5: worldToLocal() ã® pivot/position/rotation/scale è¨ˆç®—é †åºã‚’å®Œå…¨ä¿®æ­£
coordinate-system.js:521    - Phase 2.5: localToWorld() ã‚‚åŒæ§˜ã«ä¿®æ­£ï¼ˆå®Œå…¨ãªé€†å¤‰æ›ã‚’ä¿è¨¼ï¼‰
coordinate-system.js:522    - ã‚µãƒ ãƒã‚¤ãƒ«å•é¡Œã®æ ¹æœ¬åŸå› ã‚’è§£æ±º
coordinate-system.js:601 âœ… Debug commands: TegakiDebug.coord.*
data-models.js:276 âœ… data-models.js (ãƒã‚¹ã‚¯ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆä¸å¯è¦–ç‰ˆ) loaded
batch-api.js:382 âœ… batch-api.js (Phase 6: Historyçµ±åˆç‰ˆ) loaded
popup-manager.js:357 âœ… popup-manager.js (quick-accessé™¤å¤–å¯¾å¿œç‰ˆ) loaded
camera-system.js:704 âœ… camera-system.js (v2.0: ãƒªã‚µã‚¤ã‚ºä¿®æ­£ç‰ˆ) loaded
layer-transform.js:910 âœ… layer-transform.js (Phase 1-5 GSAPçµ±åˆå®Œå…¨ç‰ˆ) loaded
layer-transform.js:911    âœ“ Phase 1-4: ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ãƒ»NaNå¯¾ç­–ãƒ»UIæ•´å‚™ãƒ»åè»¢æ©Ÿèƒ½
layer-transform.js:912    âœ“ Phase 5: GSAPçµ±åˆï¼ˆkillTweensOf + delayedCallï¼‰
layer-transform.js:913    âœ“ GPUåæ˜ ä¿è¨¼: Transformé©ç”¨ã‹ã‚‰1ãƒ•ãƒ¬ãƒ¼ãƒ å¾Œã«ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«
layer-transform.js:914    âœ“ ã‚µãƒ ãƒã‚¤ãƒ«åŒæœŸ: layer:transform-updated + thumbnail:layer-updated
layer-system.js:1247 âœ… layer-system.js (v2.0.1: åè»¢æ©Ÿèƒ½ä¿®å¾©ç‰ˆ) loaded
drawing-clipboard.js:603 âœ… drawing-clipboard.js Phase4æ”¹ä¿®ç‰ˆ+ç¢ºå®šã‚¤ãƒ™ãƒ³ãƒˆ loaded
drawing-clipboard.js:604    - âœ… CTRL+V behavior: overwrite active layer
drawing-clipboard.js:605    - âœ… Commit events: paste:commit, operation:commit
drawing-clipboard.js:606    - âœ… Thumbnail auto-update on paste
history.js:217 âœ… history.js (Phase 3: Redo nullå‚ç…§ä¿®æ­£ç‰ˆ) loaded
animation-system.js:218 [AnimationSystem] GSAP detected - using synchronized thumbnail generation
animation-system.js:1484 âœ… animation-system.js (GSAPçµ±åˆå®Œå…¨ç‰ˆ) loaded
animation-system.js:1485    âœ“ Phase 1: ãƒ•ãƒ¬ãƒ¼ãƒ åçµ±ä¸€ï¼ˆxFå½¢å¼ï¼‰
animation-system.js:1486    âœ“ Phase 3: Canvas2Då»ƒæ­¢ â†’ ThumbnailSystemçµ±ä¸€
animation-system.js:1487    âœ“ Phase 3-2: init()æ™‚ã«GSAP.delayedCall()ã§åˆå›ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ
animation-system.js:1488    âœ“ generateFrameThumbnail(): PixiJS RenderTextureä½¿ç”¨
animation-system.js:1489    âœ“ frame.thumbnailDataURLä¿å­˜ã§ UIå±¤é€£æº
pressure-handler.js:183 âœ… pressure-handler.js (Phase 3: è·é›¢ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿è¿½åŠ ç‰ˆ) loaded
pressure-handler.js:184    - applyDistanceFilter() è¿½åŠ 
pressure-handler.js:185    - çŸ­è·é›¢: alpha=0.9 (å³åº§åæ˜ )
pressure-handler.js:186    - é•·è·é›¢: alpha=0.3 (ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°å¼·)
curve-interpolator.js:205 âœ… curve-interpolator.js (Phase 3) loaded
curve-interpolator.js:206    - Catmull-Rom ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³è£œé–“
curve-interpolator.js:207    - é©å¿œçš„ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å¯¾å¿œ
curve-interpolator.js:208    - tiltX/Y/twist ãƒ‡ãƒ¼ã‚¿è£œé–“å¯¾å¿œ
stroke-renderer.js:247 âœ… system/drawing/stroke-renderer.js loaded (PixiJS v8å®Œå…¨å¯¾å¿œç‰ˆ)
thumbnail-system.js:505 âœ… thumbnail-system.js loaded (Phase 1-3)
brush-settings.js:183 âœ… brush-settings.js (APIçµ±ä¸€ç‰ˆ) loaded
brush-settings.js:184    - âœ… getOpacity() / setOpacity() è¿½åŠ 
brush-settings.js:185    - âœ… brush:opacity-changed ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­è¿½åŠ 
drawing-engine.js:376 âœ… drawing-engine.js (åº§æ¨™ç³»å®Œå…¨ä¿®æ­£ç‰ˆ) loaded
drawing-engine.js:459 âœ… Debug commands: TegakiDebug.drawing.*
quick-export-ui.js:292 âœ… quick-export-ui.js (ç„¡åŠ¹åŒ–ç‰ˆ) loaded
export-manager.js:224 âœ… export-manager.js (CUTâ†’FRAMEå®Œå…¨ä¿®æ­£ç‰ˆ) loaded
png-exporter.js:85 âœ… png-exporter.js (å˜ä¸€ãƒ•ãƒ¬ãƒ¼ãƒ å°‚ç”¨ãƒ»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾å¿œ) loaded
apng-exporter.js:236 âœ… apng-exporter.js (CUTâ†’FRAMEå®Œå…¨ä¿®æ­£ç‰ˆ) loaded
gif-exporter.js:300 âœ… gif-exporter.js (CUTâ†’FRAMEå®Œå…¨ä¿®æ­£ç‰ˆ) loaded
webp-exporter.js:289 âœ… webp-exporter.js (é™æ­¢ç”»ãƒ»å‹•ç”»è‡ªå‹•åˆ¤å®šå¯¾å¿œç‰ˆ) loaded
mp4-exporter.js:30 âœ… mp4-exporter.js (Phase 8å®Œæˆç‰ˆ) loaded
pdf-exporter.js:225 âœ… pdf-exporter.js (CUTâ†’FRAMEå®Œå…¨å¯¾å¿œç‰ˆ) loaded
dom-builder.js:494 âœ… dom-builder.js (IDé‡è¤‡è§£æ¶ˆç‰ˆ) loaded
dom-builder.js:495    - #pen-settings â†’ #legacy-pen-settings ã«å¤‰æ›´
dom-builder.js:496    - pen-size-slider â†’ legacy-pen-size-slider ã«å¤‰æ›´
dom-builder.js:497    - quick-access-popup.jsã¨ã®IDç«¶åˆã‚’å®Œå…¨è§£æ¶ˆ
slider-utils.js:197 âœ… ui/slider-utils.js loaded
slider-utils.js:198    - è²¬å‹™: ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼UIã®çµ±ä¸€å®Ÿè£…
slider-utils.js:199    - DRYåŸå‰‡: settings-popup.js ã¨ ui-panels.js ã§å…±æœ‰
slider-utils.js:200    - API: createSlider() / createSimpleSlider()
keyboard-handler.js:318 âœ… keyboard-handler.js (P/Eã‚µã‚¤ãƒ‰ãƒãƒ¼åŒæœŸç‰ˆ) loaded
resize-popup.js:452 âœ… resize-popup.js (Phase 4å®Œäº†: ãƒ­ã‚¸ãƒƒã‚¯å‰Šæ¸›ç‰ˆ) loaded
layer-panel-renderer.js:550 âœ… ui/layer-panel-renderer.js (Phase 2å®Œå…¨ä¿®æ­£ç‰ˆ) loaded
layer-panel-renderer.js:551    âœ“ ã‚¤ãƒ™ãƒ³ãƒˆå„ªå…ˆåº¦è¨­å®šãƒ»throttleæœ€é©åŒ–
layer-panel-renderer.js:552    âœ“ DOMæ¤œç´¢ã®å …ç‰¢åŒ–ï¼ˆ3ã¤ã®æ–¹æ³•ã§è©¦è¡Œï¼‰
layer-panel-renderer.js:553    âœ“ ThumbnailSystemåˆæœŸåŒ–ç¢ºèªå¼·åŒ–
layer-panel-renderer.js:554    âœ“ immediate ãƒ•ãƒ©ã‚°å¯¾å¿œãƒ»GSAP delayedCall åŒæœŸ
status-display-renderer.js:138 âœ… status-display-renderer.js (Phase 1æ”¹ä¿®ç‰ˆ) loaded
timeline-thumbnail-utils.js:258 âœ… ui/timeline-thumbnail-utils.js (Phase 3å®Œå…¨ç‰ˆ) loaded
timeline-thumbnail-utils.js:259    âœ“ Phase 1: layer:transform-updated è³¼èª­è¿½åŠ 
timeline-thumbnail-utils.js:260    âœ“ Phase 3: throttleæœ€é©åŒ–ï¼ˆ100msï¼‰
timeline-thumbnail-utils.js:261    âœ“ Phase 3: immediate ãƒ•ãƒ©ã‚°å¯¾å¿œ
timeline-thumbnail-utils.js:262    âœ“ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚µãƒ ãƒã‚¤ãƒ«ãŒãƒ¬ã‚¤ãƒ¤ãƒ¼å¤‰å½¢ã«å³åº§è¿½å¾“
timeline-ui.js:981 âœ… timeline-ui.js (Phase 4å®Œäº†: ãƒ¬ã‚¤ãƒ¤ãƒ¼å¤‰å½¢é€£æºç‰ˆ) loaded
album-popup.js:473 âœ… album-popup.js (FRAMEæ”¹ä¿®ç‰ˆ) loaded
settings-popup.js:583 âœ… settings-popup.js (å³å¿œæ€§å®Œå…¨ä¿®æ­£ç‰ˆ) loaded
settings-popup.js:584    - CSS transitionå®Œå…¨é™¤å»ï¼ˆ!importantä»˜ãï¼‰
settings-popup.js:585    - DOMæ›´æ–°ã‚’åŒæœŸçš„ã«å³åº§å®Ÿè¡Œ
settings-popup.js:586    - quick-access/resize-popupã¨å®Œå…¨åŒç­‰ã®å‹•ä½œ
quick-access-popup.js:538 âœ… quick-access-popup.js (èƒŒæ™¯ãƒ‰ãƒ©ãƒƒã‚° + é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ç‰ˆ) loaded
quick-access-popup.js:539    - èƒŒæ™¯ãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹•å¯èƒ½ï¼ˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼/ãƒœã‚¿ãƒ³ä»¥å¤–ï¼‰
quick-access-popup.js:540    - å³ä¸ŠÃ—ãƒœã‚¿ãƒ³ã§é–‰ã˜ã‚‹
quick-access-popup.js:541    - ç”»é¢å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ãªã„ï¼ˆå¸¸æ™‚é–‹ãã£ã±ãªã—å¯èƒ½ï¼‰
export-popup.js:423 âœ… export-popup.js (frameInfoä¿®æ­£ç‰ˆï¼‹PDFæœ‰åŠ¹åŒ–) loaded
ui-panels.js:408 âœ… ui-panels.js (ã‚µã‚¤ãƒ‰ãƒãƒ¼åŒæœŸãƒ»è‰²èª¿æ•´ç‰ˆ) loaded
core-runtime.js:713 âœ… core-runtime.js (Phase 1-3å®Œå…¨ç‰ˆ: ThumbnailSystemçµ±åˆ) loaded
core-engine.js:847 âœ… core-engine.js (Phase 4å®Œå…¨ä¿®æ­£ç‰ˆ) loaded
core-engine.js:848    âœ“ Phase 2: ãƒªã‚µã‚¤ã‚ºæ™‚ãƒ¬ã‚¤ãƒ¤ãƒ¼åº§æ¨™ã‚·ãƒ•ãƒˆ + èƒŒæ™¯è‰²ä¿®æ­£
core-engine.js:849    âœ“ Phase 4: onFlipRequestå†è©¦è¡Œãƒ¡ã‚«ãƒ‹ã‚ºãƒ å®Ÿè£…ï¼ˆç¢ºå®Ÿæ¥ç¶šï¼‰
core-engine.js:850    âœ“ Phase 5: GSAP Tickerçµ±åˆæº–å‚™å®Œäº†
core-engine.js:851    âœ“ destroy()ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ ï¼ˆãƒªãƒ­ãƒ¼ãƒ‰å®‰å®šåŒ–ï¼‰
core-initializer.js:347 âœ… core-initializer.js (å®Œå…¨ä¿®æ­£ç‰ˆãƒ»SettingsManagerï¼‹ExportPopupå¯¾å¿œ) loaded
core-engine.js:352 [CoreEngine] GSAP detected - Tickerçµ±åˆ available
layer-transform.js:46 [LayerTransform] GSAP detected - using synchronized updates
drawing-clipboard.js:19 DrawingClipboard: Initializing...
drawing-clipboard.js:26 âœ… DrawingClipboard initialized (Phase4æ”¹ä¿®ç‰ˆ + ç¢ºå®šã‚¤ãƒ™ãƒ³ãƒˆ)
thumbnail-system.js:50 âœ… ThumbnailSystem initialized (Phase 1-3)
thumbnail-system.js:51    âœ“ RenderTexture pool: max size 10
core-engine.js:758 âœ… ThumbnailSystem initialized in CoreEngine
animation-system.js:218 [AnimationSystem] GSAP detected - using synchronized thumbnail generation
core-initializer.js:63 âœ… SettingsManager initialized
popup-manager.js:16 âœ… PopupManager initialized
popup-manager.js:42 ğŸ“‹ Popup "settings" registered (priority: 1)
popup-manager.js:42 ğŸ“‹ Popup "quickAccess" registered (priority: 2)
popup-manager.js:42 ğŸ“‹ Popup "album" registered (priority: 3)
popup-manager.js:42 ğŸ“‹ Popup "resize" registered (priority: 4)
popup-manager.js:102 ğŸ”§ Initializing all popups...
popup-manager.js:87 âœ… Popup "settings" initialized successfully
popup-manager.js:87 âœ… Popup "quickAccess" initialized successfully
popup-manager.js:87 âœ… Popup "album" initialized successfully
popup-manager.js:87 âœ… Popup "resize" initialized successfully
popup-manager.js:118 ğŸ“Š Popup initialization: 4 ready, 0 deferred
animation-system.js:255 ğŸ¬ Regenerating 0 frame thumbnails...
animation-system.js:265 âœ… All frame thumbnails regenerated
popup-manager.js:42 ğŸ“‹ Popup "export" registered (priority: 5)
core-engine.js:509 âœ… [CoreEngine] onFlipRequest callback configured (retry: 0)
popup-manager.js:87 âœ… Popup "export" initialized successfully
core-initializer.js:245 âœ… ExportPopup registered and initialized
animation-system.js:777 ğŸ¬ Generating frame thumbnail: index=0, id=frame_1761801164539_pqwagkh5s
animation-system.js:794 âœ“ Frame thumbnail saved: frame_1761801164539_pqwagkh5s
animation-system.js:800 âœ“ Frame thumbnail dataURL generated
animation-system.js:812 âœ… Frame 0 thumbnail generation complete
// ================================================================================
// ãƒ‡ãƒãƒƒã‚°ã‚³ãƒãƒ³ãƒ‰ v2 - EventBusè¨ºæ–­å¼·åŒ–ç‰ˆ
// ================================================================================

console.log('=== ã‚·ã‚¹ãƒ†ãƒ è¨ºæ–­é–‹å§‹ ===\n');

// ========== 1. åŸºæœ¬ã‚·ã‚¹ãƒ†ãƒ ç¢ºèª ==========
console.log('ğŸ“‹ åŸºæœ¬ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹:');
console.log('  ThumbnailSystem:', typeof window.ThumbnailSystem, window.ThumbnailSystem?.isInitialized);
console.log('  AnimationSystem:', typeof window.animationSystem);
console.log('  LayerManager:', typeof window.layerManager);
console.log('  GSAP:', typeof gsap);
console.log('  EventBus:', typeof window.TegakiEventBus);
console.log('');

// ========== 2. EventBus è©³ç´°è¨ºæ–­ ==========
console.log('ğŸ” EventBus è¨ºæ–­:');
if (window.TegakiEventBus) {
    console.log('  Type:', typeof window.TegakiEventBus);
    console.log('  Methods:', Object.keys(window.TegakiEventBus).filter(k => typeof window.TegakiEventBus[k] === 'function'));
    
    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ç¢ºèªï¼ˆè¤‡æ•°ã®æ§‹é€ ã«å¯¾å¿œï¼‰
    const possibleEventKeys = ['_events', 'events', 'listeners', '_listeners'];
    let eventStore = null;
    
    for (const key of possibleEventKeys) {
        if (window.TegakiEventBus[key]) {
            eventStore = window.TegakiEventBus[key];
            console.log(`  Event storage found: ${key}`);
            break;
        }
    }
    
    if (eventStore) {
        const eventNames = Object.keys(eventStore);
        console.log(`  Total event types: ${eventNames.length}`);
        console.log('  Event types:', eventNames.slice(0, 10).join(', ') + (eventNames.length > 10 ? '...' : ''));
        
        // é‡è¦ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒªã‚¹ãƒŠãƒ¼æ•°ç¢ºèª
        const criticalEvents = [
            'layer:transform-updated',
            'thumbnail:layer-updated',
            'keyboard:vkey-pressed',
            'keyboard:vkey-released'
        ];
        
        console.log('\n  é‡è¦ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒªã‚¹ãƒŠãƒ¼æ•°:');
        criticalEvents.forEach(eventName => {
            const listeners = eventStore[eventName];
            if (listeners) {
                const count = Array.isArray(listeners) ? listeners.length : 1;
                console.log(`    ${eventName}: ${count} listeners`);
            } else {
                console.log(`    ${eventName}: âŒ NO LISTENERS`);
            }
        });
    } else {
        console.warn('  âš ï¸ Event storage not found - EventBus may not be initialized');
    }
} else {
    console.error('  âŒ TegakiEventBus not found!');
}
console.log('');

// ========== 3. LayerTransform è¨ºæ–­ ==========
console.log('ğŸ”§ LayerTransform è¨ºæ–­:');
const layerMgr = window.layerManager;
if (layerMgr) {
    console.log('  LayerManager: âœ…');
    console.log('  transform:', !!layerMgr.transform);
    
    if (layerMgr.transform) {
        console.log('  transform.app:', !!layerMgr.transform.app);
        console.log('  transform.gsapAvailable:', layerMgr.transform.gsapAvailable);
        console.log('  transform.onFlipRequest:', typeof layerMgr.transform.onFlipRequest);
        console.log('  transform.isVKeyPressed:', layerMgr.transform.isVKeyPressed);
        
        // flipLayer ãƒ¡ã‚½ãƒƒãƒ‰ç¢ºèª
        console.log('  transform.flipLayer:', typeof layerMgr.transform.flipLayer);
    } else {
        console.error('  âŒ transform not initialized');
    }
} else {
    console.error('  âŒ LayerManager not found');
}
console.log('');

// ========== 4. ThumbnailSystem è¨ºæ–­ ==========
console.log('ğŸ“¸ ThumbnailSystem è¨ºæ–­:');
if (window.ThumbnailSystem) {
    const info = window.ThumbnailSystem.getDebugInfo();
    console.log('  initialized:', info.isInitialized);
    console.log('  layer cache:', info.layerCacheSize);
    console.log('  frame cache:', info.frameCacheSize);
    console.log('  vKeyModeActive:', info.vKeyModeActive);
    console.log('  pendingVModeRefresh:', info.pendingVModeRefreshCount);
    
    if (info.pendingLayerIds && info.pendingLayerIds.length > 0) {
        console.log('  pending layer IDs:', info.pendingLayerIds);
    }
} else {
    console.error('  âŒ ThumbnailSystem not found');
}
console.log('');

// ========== 5. LayerPanelRenderer è¨ºæ–­ ==========
console.log('ğŸ¨ LayerPanelRenderer è¨ºæ–­:');
const layerPanel = window.TegakiUI?.layerPanelRenderer || 
                   window.CoreRuntime?.internal?.layerPanelRenderer;

if (layerPanel) {
    console.log('  LayerPanelRenderer: âœ…');
    console.log('  gsapAvailable:', layerPanel.gsapAvailable);
    console.log('  layerUpdateTimers size:', layerPanel.layerUpdateTimers?.size);
    console.log('  updateThrottle:', layerPanel.layerUpdateThrottle + 'ms');
} else {
    console.warn('  âš ï¸ LayerPanelRenderer not found');
}
console.log('');

// ========== 6. ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹ç¢ºèª ==========
console.log('ğŸ“‹ ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹:');
if (layerMgr) {
    const layers = layerMgr.getLayers();
    console.log('  Total layers:', layers.length);
    console.log('  Active index:', layerMgr.activeLayerIndex);
    
    layers.forEach((layer, i) => {
        const isActive = i === layerMgr.activeLayerIndex;
        const marker = isActive ? 'â†’' : ' ';
        console.log(`  ${marker} Layer ${i}: ${layer.layerData?.name}, id=${layer.layerData?.id}, visible=${layer.visible}`);
    });
}
console.log('');

// ========== ãƒ‡ãƒãƒƒã‚°é–¢æ•°å®šç¾© ==========
console.log('ğŸ› ï¸ ãƒ‡ãƒãƒƒã‚°é–¢æ•°ã‚’å®šç¾©ä¸­...\n');

// Vãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ
window.testVMode = function() {
    console.log('\n=== Vãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
    
    const transform = window.layerManager?.transform;
    if (!transform) {
        console.error('âŒ LayerTransform not found');
        return;
    }
    
    console.log('1. Vãƒ¢ãƒ¼ãƒ‰é–‹å§‹ï¼ˆenterMoveModeï¼‰...');
    transform.enterMoveMode();
    
    setTimeout(() => {
        console.log('2. Vãƒ¢ãƒ¼ãƒ‰çŠ¶æ…‹ç¢ºèª...');
        console.log('   isVKeyPressed:', transform.isVKeyPressed);
        console.log('   vKeyModeActive:', window.ThumbnailSystem?.vKeyModeActive);
        
        setTimeout(() => {
            console.log('3. Vãƒ¢ãƒ¼ãƒ‰çµ‚äº†ï¼ˆexitMoveModeï¼‰...');
            transform.exitMoveMode();
            
            setTimeout(() => {
                console.log('4. Vãƒ¢ãƒ¼ãƒ‰çµ‚äº†å¾Œã®çŠ¶æ…‹ç¢ºèª...');
                console.log('   isVKeyPressed:', transform.isVKeyPressed);
                console.log('   vKeyModeActive:', window.ThumbnailSystem?.vKeyModeActive);
                console.log('\nâœ… Vãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆå®Œäº†');
            }, 100);
        }, 1000);
    }, 100);
};

// åè»¢ãƒ†ã‚¹ãƒˆ
window.testFlip = function(direction = 'horizontal') {
    console.log(`\n=== åè»¢ãƒ†ã‚¹ãƒˆé–‹å§‹ (${direction}) ===`);
    
    const layerMgr = window.layerManager;
    if (!layerMgr) {
        console.error('âŒ LayerManager not found');
        return;
    }
    
    const transform = layerMgr.transform;
    if (!transform) {
        console.error('âŒ LayerTransform not found');
        return;
    }
    
    const activeLayer = layerMgr.getActiveLayer();
    if (!activeLayer) {
        console.error('âŒ No active layer');
        return;
    }
    
    console.log('Active layer:', activeLayer.layerData?.name);
    console.log('Before flip - scale:', activeLayer.scale.x, activeLayer.scale.y);
    
    // onFlipRequest çµŒç”±ã§å®Ÿè¡Œ
    if (transform.onFlipRequest) {
        console.log('âœ“ onFlipRequest callback found - calling...');
        transform.onFlipRequest(direction);
    } else {
        console.warn('âš ï¸ onFlipRequest not set - calling flipLayer directly...');
        transform.flipLayer(activeLayer, direction);
    }
    
    setTimeout(() => {
        console.log('After flip - scale:', activeLayer.scale.x, activeLayer.scale.y);
        console.log('âœ… åè»¢ãƒ†ã‚¹ãƒˆå®Œäº†');
    }, 100);
};

// ã‚¤ãƒ™ãƒ³ãƒˆç›£è¦–
window.monitorEvents = function() {
    console.log('\n=== ã‚¤ãƒ™ãƒ³ãƒˆç›£è¦–é–‹å§‹ ===');
    console.log('ç›£è¦–ä¸­ã®ã‚¤ãƒ™ãƒ³ãƒˆ: layer:transform-updated, thumbnail:layer-updated');
    
    const eventBus = window.TegakiEventBus;
    if (!eventBus) {
        console.error('âŒ EventBus not found');
        return;
    }
    
    // ãƒªã‚¹ãƒŠãƒ¼è¿½åŠ 
    const transformListener = ({ data }) => {
        console.log('ğŸ”” layer:transform-updated:', data);
    };
    
    const thumbnailListener = ({ data }) => {
        console.log('ğŸ”” thumbnail:layer-updated:', data);
    };
    
    eventBus.on('layer:transform-updated', transformListener);
    eventBus.on('thumbnail:layer-updated', thumbnailListener);
    
    console.log('âœ… ç›£è¦–é–‹å§‹ã€‚åœæ­¢ã™ã‚‹ã«ã¯ window.stopMonitor() ã‚’å®Ÿè¡Œ');
    
    // åœæ­¢é–¢æ•°ã‚’ä¿å­˜
    window.stopMonitor = function() {
        eventBus.off('layer:transform-updated', transformListener);
        eventBus.off('thumbnail:layer-updated', thumbnailListener);
        console.log('âœ… ã‚¤ãƒ™ãƒ³ãƒˆç›£è¦–åœæ­¢');
    };
};

// ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚µãƒ ãƒã‚¤ãƒ«å¼·åˆ¶æ›´æ–°
window.forceUpdateLayerThumb = function(layerIndex) {
    console.log(`\n=== ãƒ¬ã‚¤ãƒ¤ãƒ¼${layerIndex}ã‚µãƒ ãƒã‚¤ãƒ«å¼·åˆ¶æ›´æ–° ===`);
    
    const layerMgr = window.layerManager;
    if (!layerMgr) {
        console.error('âŒ LayerManager not found');
        return;
    }
    
    const layers = layerMgr.getLayers();
    const layer = layers[layerIndex];
    
    if (!layer) {
        console.error(`âŒ Layer ${layerIndex} not found`);
        return;
    }
    
    console.log('Layer:', layer.layerData?.name, 'ID:', layer.layerData?.id);
    
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
    if (window.ThumbnailSystem) {
        window.ThumbnailSystem._invalidateLayerCacheByLayerId(layer.layerData?.id);
        console.log('âœ“ Cache invalidated');
    }
    
    // ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ
    if (window.TegakiEventBus) {
        window.TegakiEventBus.emit('thumbnail:layer-updated', {
            component: 'manual',
            action: 'force-update',
            data: { layerIndex, layerId: layer.layerData?.id, immediate: true }
        });
        console.log('âœ“ Event emitted');
    }
    
    console.log('âœ… å¼·åˆ¶æ›´æ–°å®Œäº†');
};

// å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚µãƒ ãƒã‚¤ãƒ«å¼·åˆ¶æ›´æ–°
window.forceUpdateAllThumbs = function() {
    console.log('\n=== å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚µãƒ ãƒã‚¤ãƒ«å¼·åˆ¶æ›´æ–° ===');
    
    const layerPanel = window.TegakiUI?.layerPanelRenderer || 
                      window.CoreRuntime?.internal?.layerPanelRenderer;
    
    if (!layerPanel) {
        console.error('âŒ LayerPanelRenderer not found');
        return;
    }
    
    layerPanel.updateAllThumbnails();
    console.log('âœ… å…¨ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°é–‹å§‹');
};

// onFlipRequest ä¿®å¾©
window.fixFlipCallback = function() {
    console.log('\n=== onFlipRequestä¿®å¾© ===');
    
    const layerMgr = window.layerManager;
    if (!layerMgr?.transform) {
        console.error('âŒ LayerTransform not found');
        return;
    }
    
    const transform = layerMgr.transform;
    const eventBus = window.TegakiEventBus;
    
    transform.onFlipRequest = (direction) => {
        console.log(`ğŸ”„ Flip: ${direction}`);
        const layer = layerMgr.getActiveLayer();
        if (!layer) return;
        
        transform.flipLayer(layer, direction);
        
        if (eventBus) {
            eventBus.emit('thumbnail:layer-updated', {
                component: 'fix',
                action: 'flip',
                data: { 
                    layerIndex: layerMgr.activeLayerIndex, 
                    layerId: layer.layerData.id, 
                    immediate: true 
                }
            });
        }
    };
    
    console.log('âœ… onFlipRequest callback ä¿®å¾©å®Œäº†');
    console.log('   Type:', typeof transform.onFlipRequest);
};

console.log('âœ… ãƒ‡ãƒãƒƒã‚°é–¢æ•°æº–å‚™å®Œäº†\n');

// ========== ä½¿ã„æ–¹ ==========
console.log('ğŸ“– ä½¿ã„æ–¹:');
console.log('  window.testVMode()                - Vãƒ¢ãƒ¼ãƒ‰å‹•ä½œãƒ†ã‚¹ãƒˆ');
console.log('  window.testFlip("horizontal")     - æ°´å¹³åè»¢ãƒ†ã‚¹ãƒˆ');
console.log('  window.testFlip("vertical")       - å‚ç›´åè»¢ãƒ†ã‚¹ãƒˆ');
console.log('  window.monitorEvents()            - ã‚¤ãƒ™ãƒ³ãƒˆç›£è¦–é–‹å§‹');
console.log('  window.stopMonitor()              - ã‚¤ãƒ™ãƒ³ãƒˆç›£è¦–åœæ­¢');
console.log('  window.forceUpdateLayerThumb(0)   - ãƒ¬ã‚¤ãƒ¤ãƒ¼0ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°');
console.log('  window.forceUpdateAllThumbs()     - å…¨ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°');
console.log('  window.fixFlipCallback()          - onFlipRequestä¿®å¾©');
console.log('\n=== è¨ºæ–­å®Œäº† ===\n');
 === ã‚·ã‚¹ãƒ†ãƒ è¨ºæ–­é–‹å§‹ ===

 ğŸ“‹ åŸºæœ¬ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹:
   ThumbnailSystem: object true
   AnimationSystem: object
   LayerManager: object
   GSAP: object
   EventBus: object
 
 ğŸ” EventBus è¨ºæ–­:
   Type: object
   Methods: []
   Event storage found: events
   Total event types: 69
   Event types: camera:resized, brush:size-changed, brush:color-changed, brush:alpha-changed, brush:opacity-changed, layer:clear-active, layer:activated, drawing:completed, animation:system-ready, animation:frame-applied...
 
  é‡è¦ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒªã‚¹ãƒŠãƒ¼æ•°:
     layer:transform-updated: 2 listeners
     thumbnail:layer-updated: âŒ NO LISTENERS
     keyboard:vkey-pressed: 2 listeners
     keyboard:vkey-released: 2 listeners
VM803:63 
VM803:66 ğŸ”§ LayerTransform è¨ºæ–­:
VM803:69   LayerManager: âœ…
VM803:70   transform: true
VM803:73   transform.app: false
VM803:74   transform.gsapAvailable: true
VM803:75   transform.onFlipRequest: function
VM803:76   transform.isVKeyPressed: false
VM803:79   transform.flipLayer: function
VM803:86 
VM803:89 ğŸ“¸ ThumbnailSystem è¨ºæ–­:
VM803:92   initialized: true
VM803:93   layer cache: 0
VM803:94   frame cache: 1
VM803:95   vKeyModeActive: false
VM803:96   pendingVModeRefresh: 0
VM803:104 
VM803:107 ğŸ¨ LayerPanelRenderer è¨ºæ–­:
VM803:117   âš ï¸ LayerPanelRenderer not found
(anonymous) @ VM803:117
VM803:119 
VM803:122 ğŸ“‹ ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹:
VM803:125   Total layers: 2
VM803:126   Active index: 1
VM803:131     Layer 0: èƒŒæ™¯, id=layer_1761801164539_tap43lrqq, visible=true
VM803:131   â†’ Layer 1: ãƒ¬ã‚¤ãƒ¤ãƒ¼1, id=layer_1761801164539_vxdedfuie, visible=true
VM803:134 
VM803:137 ğŸ› ï¸ ãƒ‡ãƒãƒƒã‚°é–¢æ•°ã‚’å®šç¾©ä¸­...

VM803:336 âœ… ãƒ‡ãƒãƒƒã‚°é–¢æ•°æº–å‚™å®Œäº†

VM803:339 ğŸ“– ä½¿ã„æ–¹:
VM803:340   window.testVMode()                - Vãƒ¢ãƒ¼ãƒ‰å‹•ä½œãƒ†ã‚¹ãƒˆ
VM803:341   window.testFlip("horizontal")     - æ°´å¹³åè»¢ãƒ†ã‚¹ãƒˆ
VM803:342   window.testFlip("vertical")       - å‚ç›´åè»¢ãƒ†ã‚¹ãƒˆ
VM803:343   window.monitorEvents()            - ã‚¤ãƒ™ãƒ³ãƒˆç›£è¦–é–‹å§‹
VM803:344   window.stopMonitor()              - ã‚¤ãƒ™ãƒ³ãƒˆç›£è¦–åœæ­¢
VM803:345   window.forceUpdateLayerThumb(0)   - ãƒ¬ã‚¤ãƒ¤ãƒ¼0ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°
VM803:346   window.forceUpdateAllThumbs()     - å…¨ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°
VM803:347   window.fixFlipCallback()          - onFlipRequestä¿®å¾©
VM803:348 
=== è¨ºæ–­å®Œäº† ===

undefined
thumbnail-system.js:57 ğŸ”µ Vkey mode activated
animation-system.js:777 ğŸ¬ Generating frame thumbnail: index=0, id=frame_1761801164539_pqwagkh5s
animation-system.js:794 âœ“ Frame thumbnail saved: frame_1761801164539_pqwagkh5s
animation-system.js:800 âœ“ Frame thumbnail dataURL generated
animation-system.js:812 âœ… Frame 0 thumbnail generation complete
animation-system.js:777 ğŸ¬ Generating frame thumbnail: index=0, id=frame_1761801164539_pqwagkh5s
animation-system.js:794 âœ“ Frame thumbnail saved: frame_1761801164539_pqwagkh5s
animation-system.js:800 âœ“ Frame thumbnail dataURL generated
animation-system.js:812 âœ… Frame 0 thumbnail generation complete
animation-system.js:777 ğŸ¬ Generating frame thumbnail: index=0, id=frame_1761801164539_pqwagkh5s
animation-system.js:794 âœ“ Frame thumbnail saved: frame_1761801164539_pqwagkh5s
animation-system.js:800 âœ“ Frame thumbnail dataURL generated
animation-system.js:812 âœ… Frame 0 thumbnail generation complete
thumbnail-system.js:62 ğŸ”´ Vkey mode deactivated - refreshing...
thumbnail-system.js:131 ğŸ”„ Refreshing 1 layers
thumbnail-system.js:163 âœ… All pending thumbnails refreshed
animation-system.js:777 ğŸ¬ Generating frame thumbnail: index=0, id=frame_1761801164539_pqwagkh5s
animation-system.js:794 âœ“ Frame thumbnail saved: frame_1761801164539_pqwagkh5s
animation-system.js:800 âœ“ Frame thumbnail dataURL generated
animation-system.js:812 âœ… Frame 0 thumbnail generation complete
animation-system.js:777 ğŸ¬ Generating frame thumbnail: index=0, id=frame_1761801164539_pqwagkh5s
animation-system.js:794 âœ“ Frame thumbnail saved: frame_1761801164539_pqwagkh5s
animation-system.js:800 âœ“ Frame thumbnail dataURL generated
animation-system.js:812 âœ… Frame 0 thumbnail generation complete
animation-system.js:777 ğŸ¬ Generating frame thumbnail: index=0, id=frame_1761801164539_pqwagkh5s
animation-system.js:794 âœ“ Frame thumbnail saved: frame_1761801164539_pqwagkh5s
animation-system.js:800 âœ“ Frame thumbnail dataURL generated
animation-system.js:812 âœ… Frame 0 thumbnail generation complete
animation-system.js:777 ğŸ¬ Generating frame thumbnail: index=0, id=frame_1761801164539_pqwagkh5s
animation-system.js:794 âœ“ Frame thumbnail saved: frame_1761801164539_pqwagkh5s
animation-system.js:800 âœ“ Frame thumbnail dataURL generated
animation-system.js:812 âœ… Frame 0 thumbnail generation complete
animation-system.js:777 ğŸ¬ Generating frame thumbnail: index=0, id=frame_1761801164539_pqwagkh5s
animation-system.js:794 âœ“ Frame thumbnail saved: frame_1761801164539_pqwagkh5s
animation-system.js:800 âœ“ Frame thumbnail dataURL generated
animation-system.js:812 âœ… Frame 0 thumbnail generation complete
animation-system.js:777 ğŸ¬ Generating frame thumbnail: index=0, id=frame_1761801164539_pqwagkh5s
animation-system.js:794 âœ“ Frame thumbnail saved: frame_1761801164539_pqwagkh5s
animation-system.js:800 âœ“ Frame thumbnail dataURL generated
animation-system.js:812 âœ… Frame 0 thumbnail generation complete
animation-system.js:777 ğŸ¬ Generating frame thumbnail: index=0, id=frame_1761801164539_pqwagkh5s
animation-system.js:794 âœ“ Frame thumbnail saved: frame_1761801164539_pqwagkh5s
animation-system.js:800 âœ“ Frame thumbnail dataURL generated
animation-system.js:812 âœ… Frame 0 thumbnail generation complete
animation-system.js:777 ğŸ¬ Generating frame thumbnail: index=0, id=frame_1761801164539_pqwagkh5s
animation-system.js:794 âœ“ Frame thumbnail saved: frame_1761801164539_pqwagkh5s
animation-system.js:800 âœ“ Frame thumbnail dataURL generated
animation-system.js:812 âœ… Frame 0 thumbnail generation complete
// 1. ã‚¤ãƒ™ãƒ³ãƒˆç›£è¦–é–‹å§‹
window.monitorEvents();

// 2. Vãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ
window.testVMode();

// 3. åè»¢ãƒ†ã‚¹ãƒˆ
window.testFlip('horizontal');

// 4. ã‚µãƒ ãƒã‚¤ãƒ«å¼·åˆ¶æ›´æ–°
window.forceUpdateAllThumbs();
VM803:213 
=== ã‚¤ãƒ™ãƒ³ãƒˆç›£è¦–é–‹å§‹ ===
VM803:214 ç›£è¦–ä¸­ã®ã‚¤ãƒ™ãƒ³ãƒˆ: layer:transform-updated, thumbnail:layer-updated
VM803:234 âœ… ç›£è¦–é–‹å§‹ã€‚åœæ­¢ã™ã‚‹ã«ã¯ window.stopMonitor() ã‚’å®Ÿè¡Œ
VM803:141 
=== Vãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆé–‹å§‹ ===
VM803:149 1. Vãƒ¢ãƒ¼ãƒ‰é–‹å§‹ï¼ˆenterMoveModeï¼‰...
VM803:173 
=== åè»¢ãƒ†ã‚¹ãƒˆé–‹å§‹ (horizontal) ===
VM803:193 Active layer: ãƒ¬ã‚¤ãƒ¤ãƒ¼1
VM803:194 Before flip - scale: 1.1373076923076924 1.1373076923076924
VM803:198 âœ“ onFlipRequest callback found - calling...
VM803:224 ğŸ”” layer:transform-updated: undefined
VM803:285 
=== å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚µãƒ ãƒã‚¤ãƒ«å¼·åˆ¶æ›´æ–° ===
VM803:291 âŒ LayerPanelRenderer not found
window.forceUpdateAllThumbs @ VM803:291
(anonymous) @ VM823:11
undefined
animation-system.js:777 ğŸ¬ Generating frame thumbnail: index=0, id=frame_1761801164539_pqwagkh5s
animation-system.js:794 âœ“ Frame thumbnail saved: frame_1761801164539_pqwagkh5s
animation-system.js:800 âœ“ Frame thumbnail dataURL generated
animation-system.js:812 âœ… Frame 0 thumbnail generation complete
VM803:224 ğŸ”” layer:transform-updated: {layerIndex: 1, layerId: 'layer_1761801164539_vxdedfuie', transform: {â€¦}}
VM803:228 ğŸ”” thumbnail:layer-updated: {layerIndex: 1, layerId: 'layer_1761801164539_vxdedfuie'}
animation-system.js:777 ğŸ¬ Generating frame thumbnail: index=0, id=frame_1761801164539_pqwagkh5s
animation-system.js:794 âœ“ Frame thumbnail saved: frame_1761801164539_pqwagkh5s
animation-system.js:800 âœ“ Frame thumbnail dataURL generated
animation-system.js:812 âœ… Frame 0 thumbnail generation complete
VM803:153 2. Vãƒ¢ãƒ¼ãƒ‰çŠ¶æ…‹ç¢ºèª...
VM803:154    isVKeyPressed: true
VM803:155    vKeyModeActive: false
VM803:206 After flip - scale: -1.1373076923076924 1.1373076923076924
VM803:207 âœ… åè»¢ãƒ†ã‚¹ãƒˆå®Œäº†
VM803:228 ğŸ”” thumbnail:layer-updated: {layerIndex: 1, layerId: 'layer_1761801164539_vxdedfuie'}
VM803:158 3. Vãƒ¢ãƒ¼ãƒ‰çµ‚äº†ï¼ˆexitMoveModeï¼‰...
VM803:162 4. Vãƒ¢ãƒ¼ãƒ‰çµ‚äº†å¾Œã®çŠ¶æ…‹ç¢ºèª...
VM803:163    isVKeyPressed: false
VM803:164    vKeyModeActive: false
VM803:165 
âœ… Vãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆå®Œäº†
