/*!
 * @pixi/gif - v2.1.1
 * Compiled Fri, 16 Feb 2024 16:16:32 UTC
 *
 * @pixi/gif is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 * 
 * Copyright 2024, Matt Karl @bigtimebuddy, All Rights Reserved
 */import{Texture as G,Ticker as O,UPDATE_PRIORITY as Z,settings as R,SCALE_MODES as J,ExtensionType as Q,utils as V,extensions as W}from"@pixi/core";import{Sprite as ee}from"@pixi/sprite";var qe=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function te(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function He(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Ye(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")&&Object.keys(t).length===1?t.default:t}function Ke(t){if(t.__esModule)return t;var r=t.default;if(typeof r=="function"){var e=function a(){if(this instanceof a){var n=[null];n.push.apply(n,arguments);var o=Function.bind.apply(r,n);return new o}return r.apply(this,arguments)};e.prototype=r.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(t).forEach(function(a){var n=Object.getOwnPropertyDescriptor(t,a);Object.defineProperty(e,a,n.get?n:{enumerable:!0,get:function(){return t[a]}})}),e}var C={},E={},F={};Object.defineProperty(F,"__esModule",{value:!0});var re=F.loop=oe=F.conditional=ne=F.parse=void 0,ae=function t(r,e){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:a;if(Array.isArray(e))e.forEach(function(s){return t(r,s,a,n)});else if(typeof e=="function")e(r,a,n,t);else{var o=Object.keys(e)[0];Array.isArray(e[o])?(n[o]={},t(r,e[o],a,n[o])):n[o]=e[o](r,a,n,t)}return a},ne=F.parse=ae,ie=function(r,e){return function(a,n,o,s){e(a,n,o)&&s(a,r,n,o)}},oe=F.conditional=ie,se=function(r,e){return function(a,n,o,s){for(var i=[],c=a.pos;e(a,n,o);){var p={};if(s(a,r,n,p),a.pos===c)break;c=a.pos,i.push(p)}return i}};re=F.loop=se;var h={};Object.defineProperty(h,"__esModule",{value:!0});var de=h.readBits=we=h.readArray=xe=h.readUnsigned=me=h.readString=ve=h.peekBytes=fe=h.readBytes=he=h.peekByte=le=h.readByte=ce=h.buildStream=void 0,ue=function(r){return{data:r,pos:0}},ce=h.buildStream=ue,L=function(){return function(r){return r.data[r.pos++]}},le=h.readByte=L,pe=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(e){return e.data[e.pos+r]}},he=h.peekByte=pe,P=function(r){return function(e){return e.data.subarray(e.pos,e.pos+=r)}},fe=h.readBytes=P,ge=function(r){return function(e){return e.data.subarray(e.pos,e.pos+r)}},ve=h.peekBytes=ge,ye=function(r){return function(e){return Array.from(P(r)(e)).map(function(a){return String.fromCharCode(a)}).join("")}},me=h.readString=ye,_e=function(r){return function(e){var a=P(2)(e);return r?(a[1]<<8)+a[0]:(a[0]<<8)+a[1]}},xe=h.readUnsigned=_e,be=function(r,e){return function(a,n,o){for(var s=typeof e=="function"?e(a,n,o):e,i=P(r),c=new Array(s),p=0;p<s;p++)c[p]=i(a);return c}},we=h.readArray=be,Be=function(r,e,a){for(var n=0,o=0;o<a;o++)n+=r[e+o]&&Math.pow(2,a-o-1);return n},Te=function(r){return function(e){for(var a=L()(e),n=new Array(8),o=0;o<8;o++)n[7-o]=!!(a&1<<o);return Object.keys(r).reduce(function(s,i){var c=r[i];return c.length?s[i]=Be(n,c.index,c.length):s[i]=n[c.index],s},{})}};de=h.readBits=Te,function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=F,e=h,a={blocks:function(d){for(var f=0,u=[],b=d.data.length,m=0,v=(0,e.readByte)()(d);v!==f&&v;v=(0,e.readByte)()(d)){if(d.pos+v>=b){var x=b-d.pos;u.push((0,e.readBytes)(x)(d)),m+=x;break}u.push((0,e.readBytes)(v)(d)),m+=v}for(var y=new Uint8Array(m),w=0,_=0;_<u.length;_++)y.set(u[_],w),w+=u[_].length;return y}},n=(0,r.conditional)({gce:[{codes:(0,e.readBytes)(2)},{byteSize:(0,e.readByte)()},{extras:(0,e.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,e.readUnsigned)(!0)},{transparentColorIndex:(0,e.readByte)()},{terminator:(0,e.readByte)()}]},function(l){var d=(0,e.peekBytes)(2)(l);return d[0]===33&&d[1]===249}),o=(0,r.conditional)({image:[{code:(0,e.readByte)()},{descriptor:[{left:(0,e.readUnsigned)(!0)},{top:(0,e.readUnsigned)(!0)},{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{lct:(0,e.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,r.conditional)({lct:(0,e.readArray)(3,function(l,d,f){return Math.pow(2,f.descriptor.lct.size+1)})},function(l,d,f){return f.descriptor.lct.exists}),{data:[{minCodeSize:(0,e.readByte)()},a]}]},function(l){return(0,e.peekByte)()(l)===44}),s=(0,r.conditional)({text:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{preData:function(d,f,u){return(0,e.readBytes)(u.text.blockSize)(d)}},a]},function(l){var d=(0,e.peekBytes)(2)(l);return d[0]===33&&d[1]===1}),i=(0,r.conditional)({application:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{id:function(d,f,u){return(0,e.readString)(u.blockSize)(d)}},a]},function(l){var d=(0,e.peekBytes)(2)(l);return d[0]===33&&d[1]===255}),c=(0,r.conditional)({comment:[{codes:(0,e.readBytes)(2)},a]},function(l){var d=(0,e.peekBytes)(2)(l);return d[0]===33&&d[1]===254}),p=[{header:[{signature:(0,e.readString)(3)},{version:(0,e.readString)(3)}]},{lsd:[{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{gct:(0,e.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,e.readByte)()},{pixelAspectRatio:(0,e.readByte)()}]},(0,r.conditional)({gct:(0,e.readArray)(3,function(l,d){return Math.pow(2,d.lsd.gct.size+1)})},function(l,d){return d.lsd.gct.exists}),{frames:(0,r.loop)([n,i,c,o,s],function(l){var d=(0,e.peekByte)()(l);return d===33||d===44})}],g=p;t.default=g}(E);var Xe=te(E),U={};Object.defineProperty(U,"__esModule",{value:!0});var Fe=U.deinterlace=void 0,Se=function(r,e){for(var a=new Array(r.length),n=r.length/e,o=function(d,f){var u=r.slice(f*e,(f+1)*e);a.splice.apply(a,[d*e,e].concat(u))},s=[0,4,2,1],i=[8,8,4,2],c=0,p=0;p<4;p++)for(var g=s[p];g<n;g+=i[p])o(g,c),c++;return a};Fe=U.deinterlace=Se;var j={};Object.defineProperty(j,"__esModule",{value:!0});var Ce=j.lzw=void 0,ke=function(r,e,a){var n=4096,o=-1,s=a,i,c,p,g,l,d,f,S,u,b,_,m,T,B,I,A,v=new Array(a),x=new Array(n),y=new Array(n),w=new Array(n+1);for(m=r,c=1<<m,l=c+1,i=c+2,f=o,g=m+1,p=(1<<g)-1,u=0;u<c;u++)x[u]=0,y[u]=u;var _,S,D,T,B,A,I;for(_=S=D=T=B=A=I=0,b=0;b<s;){if(B===0){if(S<g){_+=e[I]<<S,S+=8,I++;continue}if(u=_&p,_>>=g,S-=g,u>i||u==l)break;if(u==c){g=m+1,p=(1<<g)-1,i=c+2,f=o;continue}if(f==o){w[B++]=y[u],f=u,T=u;continue}for(d=u,u==i&&(w[B++]=T,u=f);u>c;)w[B++]=y[u],u=x[u];T=y[u]&255,w[B++]=T,i<n&&(x[i]=f,y[i]=T,i++,!(i&p)&&i<n&&(g++,p+=i)),f=d}B--,v[A++]=w[B],b++}for(b=A;b<s;b++)v[b]=0;return v};Ce=j.lzw=ke,Object.defineProperty(C,"__esModule",{value:!0});var N=C.decompressFrames=Ee=C.decompressFrame=$=C.parseGIF=void 0,Ae=je(E),Ie=F,Oe=h,Pe=U,Ue=j;function je(t){return t&&t.__esModule?t:{default:t}}var Me=function(r){var e=new Uint8Array(r);return(0,Ie.parse)((0,Oe.buildStream)(e),Ae.default)},$=C.parseGIF=Me,De=function(r){for(var e=r.pixels.length,a=new Uint8ClampedArray(e*4),n=0;n<e;n++){var o=n*4,s=r.pixels[n],i=r.colorTable[s]||[0,0,0];a[o]=i[0],a[o+1]=i[1],a[o+2]=i[2],a[o+3]=s!==r.transparentIndex?255:0}return a},q=function(r,e,a){if(!r.image){console.warn("gif frame does not have associated image.");return}var n=r.image,o=n.descriptor.width*n.descriptor.height,s=(0,Ue.lzw)(n.data.minCodeSize,n.data.blocks,o);n.descriptor.lct.interlaced&&(s=(0,Pe.deinterlace)(s,n.descriptor.width));var i={pixels:s,dims:{top:r.image.descriptor.top,left:r.image.descriptor.left,width:r.image.descriptor.width,height:r.image.descriptor.height}};return n.descriptor.lct&&n.descriptor.lct.exists?i.colorTable=n.lct:i.colorTable=e,r.gce&&(i.delay=(r.gce.delay||10)*10,i.disposalType=r.gce.extras.disposal,r.gce.extras.transparentColorGiven&&(i.transparentIndex=r.gce.transparentColorIndex)),a&&(i.patch=De(i)),i},Ee=C.decompressFrame=q,ze=function(r,e){return r.frames.filter(function(a){return a.image}).map(function(a){return q(a,r.gct,e)})};N=C.decompressFrames=ze;var Ge=Object.defineProperty,M=Object.getOwnPropertySymbols,H=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable,K=(t,r,e)=>r in t?Ge(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,Re=(t,r)=>{for(var e in r||(r={}))H.call(r,e)&&K(t,e,r[e]);if(M)for(var e of M(r))Y.call(r,e)&&K(t,e,r[e]);return t},Le=(t,r)=>{var e={};for(var a in t)H.call(t,a)&&r.indexOf(a)<0&&(e[a]=t[a]);if(t!=null&&M)for(var a of M(t))r.indexOf(a)<0&&Y.call(t,a)&&(e[a]=t[a]);return e};const k=class extends ee{constructor(t,r){super(G.EMPTY),this.animationSpeed=1,this.loop=!0,this.duration=0,this.autoPlay=!0,this.dirty=!1,this._currentFrame=0,this._autoUpdate=!1,this._isConnectedToTicker=!1,this._playing=!1,this._currentTime=0;const e=Object.assign({},k.defaultOptions,r),{scaleMode:a,width:n,height:o}=e,s=Le(e,["scaleMode","width","height"]),i=document.createElement("canvas"),c=i.getContext("2d");i.width=n,i.height=o,this.texture=G.from(i,{scaleMode:a}),this.duration=t[t.length-1].end,this._frames=t,this._context=c,this._playing=!1,this._currentTime=0,this._isConnectedToTicker=!1,Object.assign(this,s),this.currentFrame=0,s.autoPlay&&this.play()}static fromBuffer(t,r){if(!t||t.byteLength===0)throw new Error("Invalid buffer");const e=m=>{var v;let x=null;for(const y of m.frames)x=(v=y.gce)!=null?v:x,"image"in y&&!("gce"in y)&&(y.gce=x)},a=$(t);e(a);const n=N(a,!0),o=[],s=document.createElement("canvas"),i=s.getContext("2d",{willReadFrequently:!0}),c=document.createElement("canvas"),p=c.getContext("2d");s.width=a.lsd.width,s.height=a.lsd.height;let g=0,l=null;const{fps:d}=Object.assign({},k.defaultOptions,r),f=1e3/d;for(let m=0;m<n.length;m++){const{disposalType:v=2,delay:x=f,patch:y,dims:{width:w,height:_,left:S,top:D}}=n[m];c.width=w,c.height=_,p.clearRect(0,0,w,_);const T=p.createImageData(w,_);T.data.set(y),p.putImageData(T,0,0),v===3&&(l=i.getImageData(0,0,s.width,s.height)),i.drawImage(c,S,D);const B=i.getImageData(0,0,s.width,s.height);v===2?i.clearRect(0,0,s.width,s.height):v===3&&i.putImageData(l,0,0),o.push({start:g,end:g+x,imageData:B}),g+=x}s.width=s.height=0,c.width=c.height=0;const{width:u,height:b}=a.lsd;return new k(o,Re({width:u,height:b},r))}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(O.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(O.shared.add(this.update,this,Z.HIGH),this._isConnectedToTicker=!0),!this.loop&&this.currentFrame===this._frames.length-1&&(this._currentTime=0))}get progress(){return this._currentTime/this.duration}get playing(){return this._playing}update(t){var r,e;if(!this._playing)return;const a=this.animationSpeed*t/R.TARGET_FPMS,n=this._currentTime+a,o=n%this.duration,s=this._frames.findIndex(i=>i.start<=o&&i.end>o);n>=this.duration?this.loop?(this._currentTime=o,this.updateFrameIndex(s),(r=this.onLoop)==null||r.call(this)):(this._currentTime=this.duration,this.updateFrameIndex(this._frames.length-1),(e=this.onComplete)==null||e.call(this),this.stop()):(this._currentTime=o,this.updateFrameIndex(s))}updateFrame(){if(!this.dirty)return;const{imageData:t}=this._frames[this._currentFrame];this._context.putImageData(t,0,0),this._context.fillStyle="transparent",this._context.fillRect(0,0,0,1),this.texture.update(),this.dirty=!1}_render(t){this.updateFrame(),super._render(t)}_renderCanvas(t){this.updateFrame(),super._renderCanvas(t)}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(O.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(O.shared.add(this.update,this),this._isConnectedToTicker=!0))}get currentFrame(){return this._currentFrame}set currentFrame(t){this.updateFrameIndex(t),this._currentTime=this._frames[t].start}updateFrameIndex(t){var r;if(t<0||t>=this._frames.length)throw new Error(`Frame index out of range, expecting 0 to ${this.totalFrames}, got ${t}`);this._currentFrame!==t&&(this._currentFrame=t,this.dirty=!0,(r=this.onFrameChange)==null||r.call(this,t))}get totalFrames(){return this._frames.length}destroy(){this.stop(),super.destroy(!0);const t=null;this._context=t,this._frames=t,this.onComplete=t,this.onFrameChange=t,this.onLoop=t}clone(){return new k([...this._frames],{autoUpdate:this._autoUpdate,loop:this.loop,autoPlay:this.autoPlay,scaleMode:this.texture.baseTexture.scaleMode,animationSpeed:this.animationSpeed,width:this._context.canvas.width,height:this._context.canvas.height,onComplete:this.onComplete,onFrameChange:this.onFrameChange,onLoop:this.onLoop})}};let z=k;z.defaultOptions={scaleMode:J.LINEAR,fps:30,loop:!0,animationSpeed:1,autoPlay:!0,autoUpdate:!0,onComplete:null,onFrameChange:null,onLoop:null};const X={extension:Q.Asset,detection:{test:async()=>!0,add:async t=>[...t,"gif"],remove:async t=>t.filter(r=>r!=="gif")},loader:{test:t=>V.path.extname(t)===".gif",load:async(t,r)=>{const e=await(await R.ADAPTER.fetch(t)).arrayBuffer();return z.fromBuffer(e,r==null?void 0:r.data)},unload:async t=>{t.destroy()}}};W.add(X);export{z as AnimatedGIF,X as AnimatedGIFAsset};
//# sourceMappingURL=pixi-gif.mjs.map
