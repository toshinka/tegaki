{"version":3,"file":"index.mjs","sources":["../../../../node_modules/gifuct-js/lib/index.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.decompressFrames = exports.decompressFrame = exports.parseGIF = void 0;\n\nvar _gif = _interopRequireDefault(require(\"js-binary-schema-parser/lib/schemas/gif\"));\n\nvar _jsBinarySchemaParser = require(\"js-binary-schema-parser\");\n\nvar _uint = require(\"js-binary-schema-parser/lib/parsers/uint8\");\n\nvar _deinterlace = require(\"./deinterlace\");\n\nvar _lzw = require(\"./lzw\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar parseGIF = function parseGIF(arrayBuffer) {\n  var byteData = new Uint8Array(arrayBuffer);\n  return (0, _jsBinarySchemaParser.parse)((0, _uint.buildStream)(byteData), _gif[\"default\"]);\n};\n\nexports.parseGIF = parseGIF;\n\nvar generatePatch = function generatePatch(image) {\n  var totalPixels = image.pixels.length;\n  var patchData = new Uint8ClampedArray(totalPixels * 4);\n\n  for (var i = 0; i < totalPixels; i++) {\n    var pos = i * 4;\n    var colorIndex = image.pixels[i];\n    var color = image.colorTable[colorIndex] || [0, 0, 0];\n    patchData[pos] = color[0];\n    patchData[pos + 1] = color[1];\n    patchData[pos + 2] = color[2];\n    patchData[pos + 3] = colorIndex !== image.transparentIndex ? 255 : 0;\n  }\n\n  return patchData;\n};\n\nvar decompressFrame = function decompressFrame(frame, gct, buildImagePatch) {\n  if (!frame.image) {\n    console.warn('gif frame does not have associated image.');\n    return;\n  }\n\n  var image = frame.image; // get the number of pixels\n\n  var totalPixels = image.descriptor.width * image.descriptor.height; // do lzw decompression\n\n  var pixels = (0, _lzw.lzw)(image.data.minCodeSize, image.data.blocks, totalPixels); // deal with interlacing if necessary\n\n  if (image.descriptor.lct.interlaced) {\n    pixels = (0, _deinterlace.deinterlace)(pixels, image.descriptor.width);\n  }\n\n  var resultImage = {\n    pixels: pixels,\n    dims: {\n      top: frame.image.descriptor.top,\n      left: frame.image.descriptor.left,\n      width: frame.image.descriptor.width,\n      height: frame.image.descriptor.height\n    }\n  }; // color table\n\n  if (image.descriptor.lct && image.descriptor.lct.exists) {\n    resultImage.colorTable = image.lct;\n  } else {\n    resultImage.colorTable = gct;\n  } // add per frame relevant gce information\n\n\n  if (frame.gce) {\n    resultImage.delay = (frame.gce.delay || 10) * 10; // convert to ms\n\n    resultImage.disposalType = frame.gce.extras.disposal; // transparency\n\n    if (frame.gce.extras.transparentColorGiven) {\n      resultImage.transparentIndex = frame.gce.transparentColorIndex;\n    }\n  } // create canvas usable imagedata if desired\n\n\n  if (buildImagePatch) {\n    resultImage.patch = generatePatch(resultImage);\n  }\n\n  return resultImage;\n};\n\nexports.decompressFrame = decompressFrame;\n\nvar decompressFrames = function decompressFrames(parsedGif, buildImagePatches) {\n  return parsedGif.frames.filter(function (f) {\n    return f.image;\n  }).map(function (f) {\n    return decompressFrame(f, parsedGif.gct, buildImagePatches);\n  });\n};\n\nexports.decompressFrames = decompressFrames;"],"names":["require$$0","require$$1","require$$2","require$$3","require$$4"],"mappings":";;;;;;;;;;;;AAEA,MAAM,CAAC,cAAc,CAAC,GAAO,EAAE,YAAY,EAAE;AAC7C,EAAE,KAAK,EAAE,IAAI;AACb,CAAC,CAAC,CAAC;AACH,IAAA,kBAAA,GAAA,GAAA,CAAA,gBAAwB,GAA0B,GAAA,CAAA,eAAA,GAAG,yBAAgB,GAAG,KAAK,EAAE;AAC/E;AACA,IAAI,IAAI,GAAG,sBAAsB,CAACA,GAAkD,CAAC,CAAC;AACtF;AACA,IAAI,qBAAqB,GAAGC,KAAkC,CAAC;AAC/D;AACA,IAAI,KAAK,GAAGC,KAAoD,CAAC;AACjE;AACA,IAAI,YAAY,GAAGC,WAAwB,CAAC;AAC5C;AACA,IAAI,IAAI,GAAGC,GAAgB,CAAC;AAC5B;AACA,SAAS,sBAAsB,CAAC,GAAG,EAAE,EAAE,OAAO,GAAG,IAAI,GAAG,CAAC,UAAU,GAAG,GAAG,GAAG,EAAE,SAAS,EAAE,GAAG,EAAE,CAAC,EAAE;AACjG;AACA,IAAI,QAAQ,GAAG,SAAS,QAAQ,CAAC,WAAW,EAAE;AAC9C,EAAE,IAAI,QAAQ,GAAG,IAAI,UAAU,CAAC,WAAW,CAAC,CAAC;AAC7C,EAAE,OAAO,IAAI,qBAAqB,CAAC,KAAK,EAAE,IAAI,KAAK,CAAC,WAAW,EAAE,QAAQ,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;AAC7F,CAAC,CAAC;AACF;AACgB,IAAA,UAAA,GAAA,GAAA,CAAA,QAAA,GAAG,SAAS;AAC5B;AACA,IAAI,aAAa,GAAG,SAAS,aAAa,CAAC,KAAK,EAAE;AAClD,EAAE,IAAI,WAAW,GAAG,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC;AACxC,EAAE,IAAI,SAAS,GAAG,IAAI,iBAAiB,CAAC,WAAW,GAAG,CAAC,CAAC,CAAC;AACzD;AACA,EAAE,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,WAAW,EAAE,CAAC,EAAE,EAAE;AACxC,IAAI,IAAI,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC;AACpB,IAAI,IAAI,UAAU,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;AACrC,IAAI,IAAI,KAAK,GAAG,KAAK,CAAC,UAAU,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;AAC1D,IAAI,SAAS,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;AAC9B,IAAI,SAAS,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;AAClC,IAAI,SAAS,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;AAClC,IAAI,SAAS,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,UAAU,KAAK,KAAK,CAAC,gBAAgB,GAAG,GAAG,GAAG,CAAC,CAAC;AACzE,GAAG;AACH;AACA,EAAE,OAAO,SAAS,CAAC;AACnB,CAAC,CAAC;AACF;AACA,IAAI,eAAe,GAAG,SAAS,eAAe,CAAC,KAAK,EAAE,GAAG,EAAE,eAAe,EAAE;AAC5E,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE;AACpB,IAAI,OAAO,CAAC,IAAI,CAAC,2CAA2C,CAAC,CAAC;AAC9D,IAAI,OAAO;AACX,GAAG;AACH;AACA,EAAE,IAAI,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC;AAC1B;AACA,EAAE,IAAI,WAAW,GAAG,KAAK,CAAC,UAAU,CAAC,KAAK,GAAG,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC;AACrE;AACA,EAAE,IAAI,MAAM,GAAG,IAAI,IAAI,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,CAAC,WAAW,EAAE,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;AACrF;AACA,EAAE,IAAI,KAAK,CAAC,UAAU,CAAC,GAAG,CAAC,UAAU,EAAE;AACvC,IAAI,MAAM,GAAG,IAAI,YAAY,CAAC,WAAW,EAAE,MAAM,EAAE,KAAK,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;AAC3E,GAAG;AACH;AACA,EAAE,IAAI,WAAW,GAAG;AACpB,IAAI,MAAM,EAAE,MAAM;AAClB,IAAI,IAAI,EAAE;AACV,MAAM,GAAG,EAAE,KAAK,CAAC,KAAK,CAAC,UAAU,CAAC,GAAG;AACrC,MAAM,IAAI,EAAE,KAAK,CAAC,KAAK,CAAC,UAAU,CAAC,IAAI;AACvC,MAAM,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,UAAU,CAAC,KAAK;AACzC,MAAM,MAAM,EAAE,KAAK,CAAC,KAAK,CAAC,UAAU,CAAC,MAAM;AAC3C,KAAK;AACL,GAAG,CAAC;AACJ;AACA,EAAE,IAAI,KAAK,CAAC,UAAU,CAAC,GAAG,IAAI,KAAK,CAAC,UAAU,CAAC,GAAG,CAAC,MAAM,EAAE;AAC3D,IAAI,WAAW,CAAC,UAAU,GAAG,KAAK,CAAC,GAAG,CAAC;AACvC,GAAG,MAAM;AACT,IAAI,WAAW,CAAC,UAAU,GAAG,GAAG,CAAC;AACjC,GAAG;AACH;AACA;AACA,EAAE,IAAI,KAAK,CAAC,GAAG,EAAE;AACjB,IAAI,WAAW,CAAC,KAAK,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,IAAI,EAAE,IAAI,EAAE,CAAC;AACrD;AACA,IAAI,WAAW,CAAC,YAAY,GAAG,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC;AACzD;AACA,IAAI,IAAI,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,qBAAqB,EAAE;AAChD,MAAM,WAAW,CAAC,gBAAgB,GAAG,KAAK,CAAC,GAAG,CAAC,qBAAqB,CAAC;AACrE,KAAK;AACL,GAAG;AACH;AACA;AACA,EAAE,IAAI,eAAe,EAAE;AACvB,IAAI,WAAW,CAAC,KAAK,GAAG,aAAa,CAAC,WAAW,CAAC,CAAC;AACnD,GAAG;AACH;AACA,EAAE,OAAO,WAAW,CAAC;AACrB,CAAC,CAAC;AACF;AACuB,GAAA,CAAA,eAAA,GAAG,gBAAgB;AAC1C;AACA,IAAI,gBAAgB,GAAG,SAAS,gBAAgB,CAAC,SAAS,EAAE,iBAAiB,EAAE;AAC/E,EAAE,OAAO,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,EAAE;AAC9C,IAAI,OAAO,CAAC,CAAC,KAAK,CAAC;AACnB,GAAG,CAAC,CAAC,GAAG,CAAC,UAAU,CAAC,EAAE;AACtB,IAAI,OAAO,eAAe,CAAC,CAAC,EAAE,SAAS,CAAC,GAAG,EAAE,iBAAiB,CAAC,CAAC;AAChE,GAAG,CAAC,CAAC;AACL,CAAC,CAAC;AACF;AACA,kBAAA,GAAA,GAAA,CAAA,gBAAwB,GAAG,gBAAgB;;;;"}