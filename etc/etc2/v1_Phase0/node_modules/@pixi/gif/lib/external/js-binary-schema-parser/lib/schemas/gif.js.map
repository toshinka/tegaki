{"version":3,"file":"gif.js","sources":["../../../../../node_modules/js-binary-schema-parser/lib/schemas/gif.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _ = require(\"../\");\n\nvar _uint = require(\"../parsers/uint8\");\n\n// a set of 0x00 terminated subblocks\nvar subBlocksSchema = {\n  blocks: function blocks(stream) {\n    var terminator = 0x00;\n    var chunks = [];\n    var streamSize = stream.data.length;\n    var total = 0;\n\n    for (var size = (0, _uint.readByte)()(stream); size !== terminator; size = (0, _uint.readByte)()(stream)) {\n      // size becomes undefined for some case when file is corrupted and  terminator is not proper \n      // null check to avoid recursion\n      if (!size) break; // catch corrupted files with no terminator\n\n      if (stream.pos + size >= streamSize) {\n        var availableSize = streamSize - stream.pos;\n        chunks.push((0, _uint.readBytes)(availableSize)(stream));\n        total += availableSize;\n        break;\n      }\n\n      chunks.push((0, _uint.readBytes)(size)(stream));\n      total += size;\n    }\n\n    var result = new Uint8Array(total);\n    var offset = 0;\n\n    for (var i = 0; i < chunks.length; i++) {\n      result.set(chunks[i], offset);\n      offset += chunks[i].length;\n    }\n\n    return result;\n  }\n}; // global control extension\n\nvar gceSchema = (0, _.conditional)({\n  gce: [{\n    codes: (0, _uint.readBytes)(2)\n  }, {\n    byteSize: (0, _uint.readByte)()\n  }, {\n    extras: (0, _uint.readBits)({\n      future: {\n        index: 0,\n        length: 3\n      },\n      disposal: {\n        index: 3,\n        length: 3\n      },\n      userInput: {\n        index: 6\n      },\n      transparentColorGiven: {\n        index: 7\n      }\n    })\n  }, {\n    delay: (0, _uint.readUnsigned)(true)\n  }, {\n    transparentColorIndex: (0, _uint.readByte)()\n  }, {\n    terminator: (0, _uint.readByte)()\n  }]\n}, function (stream) {\n  var codes = (0, _uint.peekBytes)(2)(stream);\n  return codes[0] === 0x21 && codes[1] === 0xf9;\n}); // image pipeline block\n\nvar imageSchema = (0, _.conditional)({\n  image: [{\n    code: (0, _uint.readByte)()\n  }, {\n    descriptor: [{\n      left: (0, _uint.readUnsigned)(true)\n    }, {\n      top: (0, _uint.readUnsigned)(true)\n    }, {\n      width: (0, _uint.readUnsigned)(true)\n    }, {\n      height: (0, _uint.readUnsigned)(true)\n    }, {\n      lct: (0, _uint.readBits)({\n        exists: {\n          index: 0\n        },\n        interlaced: {\n          index: 1\n        },\n        sort: {\n          index: 2\n        },\n        future: {\n          index: 3,\n          length: 2\n        },\n        size: {\n          index: 5,\n          length: 3\n        }\n      })\n    }]\n  }, (0, _.conditional)({\n    lct: (0, _uint.readArray)(3, function (stream, result, parent) {\n      return Math.pow(2, parent.descriptor.lct.size + 1);\n    })\n  }, function (stream, result, parent) {\n    return parent.descriptor.lct.exists;\n  }), {\n    data: [{\n      minCodeSize: (0, _uint.readByte)()\n    }, subBlocksSchema]\n  }]\n}, function (stream) {\n  return (0, _uint.peekByte)()(stream) === 0x2c;\n}); // plain text block\n\nvar textSchema = (0, _.conditional)({\n  text: [{\n    codes: (0, _uint.readBytes)(2)\n  }, {\n    blockSize: (0, _uint.readByte)()\n  }, {\n    preData: function preData(stream, result, parent) {\n      return (0, _uint.readBytes)(parent.text.blockSize)(stream);\n    }\n  }, subBlocksSchema]\n}, function (stream) {\n  var codes = (0, _uint.peekBytes)(2)(stream);\n  return codes[0] === 0x21 && codes[1] === 0x01;\n}); // application block\n\nvar applicationSchema = (0, _.conditional)({\n  application: [{\n    codes: (0, _uint.readBytes)(2)\n  }, {\n    blockSize: (0, _uint.readByte)()\n  }, {\n    id: function id(stream, result, parent) {\n      return (0, _uint.readString)(parent.blockSize)(stream);\n    }\n  }, subBlocksSchema]\n}, function (stream) {\n  var codes = (0, _uint.peekBytes)(2)(stream);\n  return codes[0] === 0x21 && codes[1] === 0xff;\n}); // comment block\n\nvar commentSchema = (0, _.conditional)({\n  comment: [{\n    codes: (0, _uint.readBytes)(2)\n  }, subBlocksSchema]\n}, function (stream) {\n  var codes = (0, _uint.peekBytes)(2)(stream);\n  return codes[0] === 0x21 && codes[1] === 0xfe;\n});\nvar schema = [{\n  header: [{\n    signature: (0, _uint.readString)(3)\n  }, {\n    version: (0, _uint.readString)(3)\n  }]\n}, {\n  lsd: [{\n    width: (0, _uint.readUnsigned)(true)\n  }, {\n    height: (0, _uint.readUnsigned)(true)\n  }, {\n    gct: (0, _uint.readBits)({\n      exists: {\n        index: 0\n      },\n      resolution: {\n        index: 1,\n        length: 3\n      },\n      sort: {\n        index: 4\n      },\n      size: {\n        index: 5,\n        length: 3\n      }\n    })\n  }, {\n    backgroundColorIndex: (0, _uint.readByte)()\n  }, {\n    pixelAspectRatio: (0, _uint.readByte)()\n  }]\n}, (0, _.conditional)({\n  gct: (0, _uint.readArray)(3, function (stream, result) {\n    return Math.pow(2, result.lsd.gct.size + 1);\n  })\n}, function (stream, result) {\n  return result.lsd.gct.exists;\n}), // content frames\n{\n  frames: (0, _.loop)([gceSchema, applicationSchema, commentSchema, imageSchema, textSchema], function (stream) {\n    var nextCode = (0, _uint.peekByte)()(stream); // rather than check for a terminator, we should check for the existence\n    // of an ext or image block to avoid infinite loops\n    //var terminator = 0x3B;\n    //return nextCode !== terminator;\n\n    return nextCode === 0x21 || nextCode === 0x2c;\n  })\n}];\nvar _default = schema;\nexports[\"default\"] = _default;"],"names":["require$$0","require$$1"],"mappings":"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"}