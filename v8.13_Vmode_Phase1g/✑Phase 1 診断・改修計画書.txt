# Phase 1 è¨ºæ–­ãƒ»æ”¹ä¿®è¨ˆç”»æ›¸

## ç¾åœ¨ã®å•é¡ŒçŠ¶æ³

### ğŸ”´ å•é¡Œ1: ãƒšãƒ³è‰²ãŒé»’ï¼ˆ#000000ï¼‰ã«ãªã£ã¦ã„ã‚‹
**ç—‡çŠ¶**: futaba-maroon (#800000) ã§ã¯ãªãé»’ã§æç”»ã•ã‚Œã‚‹

**åŸå› å€™è£œ**:
1. `BrushSettings.color` ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒ `0x000000` ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹
2. `config.js` ã® `pen.color: 0x800000` ãŒå‚ç…§ã•ã‚Œã¦ã„ãªã„
3. `StrokeData` ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãŒ `0x000000`
4. EventBusã® `brush:color-changed` ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ã¦ã„ãªã„

**ç¾åœ¨ã®å®Ÿè£…ãƒ•ãƒ­ãƒ¼**:
```
config.js: pen.color = 0x800000
  â†“
BrushSettings.__constructor: color = 0x000000 ï¼ˆä¸Šæ›¸ãï¼‰
  â†“
DrawingEngine.getBrushSettings(): brushSettings.getColor() = 0x000000
  â†“
StrokeRenderer.renderPreview(): color = 0x000000ã§æç”»
```

**æ”¹ä¿®æ–¹é‡**: 
- BrushSettingsã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’config.jsã‹ã‚‰å–å¾—
- ColorPaletteUIã‚’QuickAccessPopupã«çµ±åˆ
- è‰²å¤‰æ›´çµŒè·¯ã‚’æ˜ç¢ºåŒ–

---

### ğŸ”´ å•é¡Œ2: ãƒšãƒ³æç”»ãŒå³ã«ã‚ºãƒ¬ã¦ã„ã‚‹
**ç—‡çŠ¶**: ã‚¯ãƒªãƒƒã‚¯ä½ç½®ã‚ˆã‚Šå³ã«æç”»ã•ã‚Œã‚‹

**åŸå› å€™è£œ**:
1. `cameraSystem.screenToLayer()` ã®åº§æ¨™å¤‰æ›ãŒä¸æ­£ç¢º
2. PointerEventã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³åº§æ¨™è¨ˆç®—ã«ã‚ºãƒ¬
3. ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åº§æ¨™åŸºæº–ç‚¹ãŒã‚ºãƒ¬ã¦ã„ã‚‹

**ç¢ºèªé …ç›®**:
- `cameraSystem.canvasContainer` ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ä½ç½®
- `event.clientX/Y` vs `canvas.getBoundingClientRect()`

---

### ğŸ”´ å•é¡Œ3: QuickAccessPopupã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ãŒ3ã«å›ºå®š
**ç—‡çŠ¶**: ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’å‹•ã‹ã—ã¦ã‚‚å€¤ãŒ3px / 100% ã‹ã‚‰å‹•ã‹ãªã„

**åŸå› å€™è£œ**:
1. `_onSizeChange()` / `_onOpacityChange()` ãŒå‘¼ã°ã‚Œã¦ã„ãªã„
2. ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼æœªç™»éŒ²
3. inputè¦ç´ ãŒæœªä½œæˆã¾ãŸã¯IDå–å¾—å¤±æ•—
4. EventBusè³¼èª­ãŒé€†å‘ãï¼ˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ â†’ BrushSettingsã®çµŒè·¯ãŒé€†ï¼‰

**ç¾åœ¨ã®å®Ÿè£…ãƒ•ãƒ­ãƒ¼**:
```
ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã® input ã‚¤ãƒ™ãƒ³ãƒˆ
  â†“
_onSizeChange() å‘¼ã³å‡ºã—ï¼Ÿ
  â†“
EventBus.emit('brush:size-changed', {size})
  â†“
BrushSettings è³¼èª­? â†’ æ›´æ–°ã•ã‚Œãªã„?
```

**ç¢ºèªé …ç›®**:
- inputè¦ç´ ã®IDç¢ºèª: `pen-size-slider`, `pen-opacity-slider`
- addEventListenerç™»éŒ²ã®æœ‰ç„¡
- EventBusã®ç™ºç«ç¢ºèª

---

## è¨­è¨ˆä¸Šã®å•é¡Œ

### âœ‹ è‰²ç®¡ç†ã®äºŒé‡å®Ÿè£…
ç¾åœ¨ã€è‰²ãŒã“ã‚Œã‚‰ã®å ´æ‰€ã§ç®¡ç†ã•ã‚Œã¦ã„ã‚‹:
1. `config.js`: `pen.color`
2. `BrushSettings`: `this.color`
3. `StrokeData`: `color` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
4. `quick-access-popup.js`: UIå´ã§è‰²ç®¡ç†ãªã—

**æ”¹ä¿®æ–¹é‡**:
- **å”¯ä¸€ã®æƒ…å ±æº (SSOT)**: `BrushSettings`
- config.jsã¯åˆæœŸå€¤ã®ã¿æä¾›
- ColorPaletteã¯QuickAccessPopupå†…ã«çµ±åˆ
- EventBusã§è‰²å¤‰æ›´é€šçŸ¥

### âœ‹ åº§æ¨™ç³»ã®çµ±ä¸€ä¸è¶³
```
PointerEvent.clientX/Y (ãƒ–ãƒ©ã‚¦ã‚¶ã‚¹ã‚¯ãƒªãƒ¼ãƒ³åº§æ¨™)
  â†“ [cameraSystem.screenToLayer()]
canvasLocalåº§æ¨™ï¼ˆcanvasContainerãƒ­ãƒ¼ã‚«ãƒ«ï¼‰
  â†“ [æç”»å¯¾è±¡ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åº§æ¨™ç³»]
ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ­ãƒ¼ã‚«ãƒ«åº§æ¨™
```

**å•é¡Œ**: canvasLocal â†’ ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ­ãƒ¼ã‚«ãƒ«ã¸ã®å¤‰æ›ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒä¸æ˜ç¢º

---

## æ”¹ä¿®ã‚¹ã‚³ãƒ¼ãƒ—

### Phase 1-A: è‰²ç®¡ç†ã®çµ±ä¸€åŒ–
**ãƒ•ã‚¡ã‚¤ãƒ«**:
- `config.js`: Futabaè‰²å®šç¾©ã®æ‹¡å¼µ
- `brush-settings.js`: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’configå–å¾—ã«å¤‰æ›´
- `quick-access-popup.js`: ColorPalette UIè¿½åŠ 
- `drawing-engine.js`: è‰²å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆçµ±åˆ

**ä½œæ¥­é‡**: ä¸­

### Phase 1-B: ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼åŒæœŸä¿®æ­£
**ãƒ•ã‚¡ã‚¤ãƒ«**:
- `quick-access-popup.js`: ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ç¢ºèªãƒ»ä¿®å¾©

**ä½œæ¥­é‡**: å°

### Phase 1-C: åº§æ¨™ç³»çµ±ä¸€ãƒ»å³ã‚ºãƒ¬ä¿®æ­£
**ãƒ•ã‚¡ã‚¤ãƒ«**:
- `camera-system.js`: screenToLayer()ã®è©³ç´°æ¤œè¨¼
- `stroke-recorder.js`: åº§æ¨™å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ç¢ºèª
- `core-runtime.js`: PointerEventåº§æ¨™å–å¾—ã®ç¢ºèª

**ä½œæ¥­é‡**: å¤§ï¼ˆè¦ãƒ†ã‚¹ãƒˆï¼‰

---

## æ¨å¥¨æ”¹ä¿®é †åº

1. **Phase 1-B (ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ä¿®æ­£)** â† æœ€å„ªå…ˆï¼ˆã‚¯ã‚¤ãƒƒã‚¯ã‚¦ã‚£ãƒ³ï¼‰
2. **Phase 1-A (è‰²ç®¡ç†çµ±ä¸€)** â† æ˜ç¢ºãªè¨­è¨ˆ
3. **Phase 1-C (åº§æ¨™ç³»ä¿®æ­£)** â† è¤‡é›‘ãƒ»è¦èª¿æŸ»

---

## ã‚·ãƒ³ãƒœãƒ«å®šç¾©ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰è¾å…¸

### BrushSettings
```javascript
constructor(config, eventBus)
getCurrentSettings() â†’ {size, color, alpha}
getSize() â†’ number
setSize(size) â†’ void
getColor() â†’ 0xRRGGBB
setColor(color) â†’ void
getAlpha() â†’ 0.0-1.0
setAlpha(alpha) â†’ void
```

### DrawingEngine
```javascript
setBrushSettings(brushSettings) â†’ void
getBrushSettings() â†’ {size, color, alpha}
startDrawing(x, y, event) â†’ void
continueDrawing(x, y, event) â†’ void
stopDrawing() â†’ void
updatePreview() â†’ void
```

### CameraSystem
```javascript
screenToLayer(screenX, screenY) â†’ {x, y}
canvasContainer: PIXI.Container
worldContainer: PIXI.Container
```

### EventBus ã‚¤ãƒ™ãƒ³ãƒˆ
```
'brush:size-changed' â†’ {size}
'brush:color-changed' â†’ {color}
'brush:alpha-changed' â†’ {alpha}
'stroke:start' â†’ {layerId, settings}
'stroke:point' â†’ {points, settings}
'stroke:end' â†’ {strokeData}
```

---

## å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1-B (ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ä¿®æ­£)
- [ ] `quick-access-popup.js` ã® inputè¦ç´ IDç¢ºèª
- [ ] addEventListenerç™»éŒ²ã®æœ‰ç„¡ç¢ºèª
- [ ] EventBus.emit()å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ç¢ºèª
- [ ] BrushSettingsè³¼èª­å´ã®ç¢ºèª

### Phase 1-A (è‰²ç®¡ç†çµ±ä¸€)
- [ ] config.jsã«Futabaè‰²ãƒ‘ãƒ¬ãƒƒãƒˆè¿½åŠ 
- [ ] BrushSettingsåˆæœŸå€¤ã‚’configå–å¾—ã«å¤‰æ›´
- [ ] ColorPalette UIå®Ÿè£…
- [ ] quick-access-popup.jsã«çµ±åˆ

### Phase 1-C (åº§æ¨™ç³»ä¿®æ­£)
- [ ] cameraSystem.screenToLayer()å®Ÿè£…ç¢ºèª
- [ ] canvasContainer ã‚°ãƒ­ãƒ¼ãƒãƒ«ä½ç½®ãƒ­ã‚°å‡ºåŠ›
- [ ] PointerEventåº§æ¨™ vs getBoundingClientRect()æ¯”è¼ƒ
- [ ] core-runtime.js ã®PointerEventå‡¦ç†ç¢ºèª