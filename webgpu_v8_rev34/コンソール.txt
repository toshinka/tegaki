ğŸ“‹ è¨ˆç”»æ›¸Phase 5-6å®Œé‚å ±å‘Š
æ”¹ä¿®å®Œäº†ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ5ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
1. ğŸ—‘ï¸ stroke-renderer.js Phase 3

å‰Šé™¤: renderPreview() / renderFinalStroke() / renderMSDFPreview()
æ®‹å­˜: initMSDFMode() ã®ã¿ï¼ˆåˆæœŸåŒ–å°‚ç”¨ï¼‰
ç†ç”±: æç”»è²¬å‹™ã‚’brush-coreã«ä¸€å…ƒåŒ–ï¼ˆDRYåŸå‰‡ï¼‰

2. ğŸ—‘ï¸ æ—§ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ å‰Šé™¤ãƒãƒ¼ã‚¯ç‰ˆ
ä»¥ä¸‹4ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤ãƒãƒ¼ã‚¯ç‰ˆã‚’ä½œæˆï¼š

polygon-generator.js â†’ gpu-stroke-processor.jsã«çµ±åˆæ¸ˆã¿
webgpu-geometry-layer.js â†’ MSDF Pipelineã«çµ±åˆæ¸ˆã¿
webgpu-compute-sdf.js â†’ MSDF Shaderã«çµ±åˆæ¸ˆã¿
webgpu-compute-msdf.js â†’ msdf-pipeline-manager.jsã«çµ±åˆæ¸ˆã¿

3. ğŸ—‘ï¸ msdf-render.wgsl Phase 4

å‰Šé™¤: vertMain() ï¼ˆãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³Quadç”¨Vertex Shaderï¼‰
æ®‹å­˜: Fragment Shaderã®ã¿
ç†ç”±: msdf-quad-expansion.wgslãŒVertex Shaderã¨ã—ã¦æ©Ÿèƒ½

4. ğŸ—‘ï¸ msdf-pipeline-manager.js Phase 10

å‰Šé™¤: _renderMSDF() ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³Quadæç”»ï¼‰
å‰Šé™¤: generateMSDF()ã®elseåˆ†å²
çµ±ä¸€: PolygonçµŒè·¯ã®ã¿ä½¿ç”¨
ä¿æŒ: Phase 9ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°å…¨é …ç›®

5. ğŸ—‘ï¸ brush-core.js Phase 6ï¼ˆãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°è¿½åŠ ç‰ˆï¼‰

ä¿®æ­£: PIXI.BLEND_MODES.ERASE â†’ 'erase' æ–‡å­—åˆ—
è¿½åŠ : VertexBufferå†…å®¹ç¢ºèªãƒ­ã‚°

è¨ˆç”»æ›¸Phase 1-6 å®Œäº†çŠ¶æ³
Phaseé …ç›®çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«1BindGroupä¿®æ­£âœ…msdf-pipeline-manager.js1ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°âœ…brush-core.js, msdf-pipeline-manager.js2åˆ†å²çµ±ä¸€âœ…msdf-pipeline-manager.js Phase 103æ¶ˆã—ã‚´ãƒ å¯¾å¿œâœ…brush-core.js Phase 64ãƒã‚¹ã‚¯çµ±åˆâ¸ï¸Pixi blendModeå¯¾å¿œæ¸ˆã¿5æ—§ã‚³ãƒ¼ãƒ‰å‰Šé™¤âœ…å…¨5ãƒ•ã‚¡ã‚¤ãƒ«æ”¹ä¿®å®Œäº†6çµ±åˆãƒ†ã‚¹ãƒˆğŸ”œæ¬¡Phaseï¼ˆãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ç¢ºèªå¾Œï¼‰
æ¬¡å›ä½œæ¥­ï¼ˆPhase 11äºˆå®šï¼‰
ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°å‡ºåŠ›ã‚’ç¢ºèªå¾Œ:

VertexBuffer.sizeãŒæ­£å¸¸å€¤ã‹ï¼ˆ28bytes Ã— vertexCountï¼‰
draw(vertexCount)ãŒ6ã®å€æ•°ã‹ï¼ˆä¸‰è§’å½¢å˜ä½ï¼‰
BindGroup0æ§‹é€ ãŒWGSLã¨ä¸€è‡´ã—ã¦ã„ã‚‹ã‹
ãƒ•ãƒªãƒƒã‚«ãƒ¼/ã‚¸ãƒ£ã‚®ãƒ¼ã®æ ¹æœ¬åŸå› ç‰¹å®š

================================================================================

å•é¡Œã®æœ¬è³ªï¼ˆrev30ç‰¹æœ‰ï¼‰

ğŸ”¥æœ€é‡è¦å•é¡Œï¼š
msdf-pipeline-manager.js: generateMSDF()ã®åˆ†å²åˆ¤å®šãŒèª¤å‹•ä½œ

ã€_renderMSDFPolygon()ã®å•é¡Œï¼ˆ388-460è¡Œç›®ï¼‰ã€‘

å•é¡Œ1: BindGroupæ§‹é€ ãŒè¤‡é›‘
   â†’ @group(0): QuadUniforms
   â†’ @group(1): Sampler/Texture/RenderUniforms/Color
   â†’ msdf-quad-expansion.wgslã¨æ•´åˆæ€§å–ã‚Œã¦ã„ãªã„ï¼Ÿ

å•é¡Œ2: setVertexBuffer()å‘¼ã³å‡ºã—ã¯ã‚ã‚‹ï¼ˆ435è¡Œç›®ï¼‰
   â†’ renderPass.setVertexBuffer(0, vertexBuffer);
   â†’ å¼•æ•°vertexBufferã¯GPUBufferã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã¯ãš
   â†’ ã—ã‹ã—Vertex Shaderå´ã§å—ã‘å–ã‚Œã¦ã„ãªã„ï¼Ÿ

å•é¡Œ3: msdf-quad-expansion.wgsl ã¨ã®ä¸æ•´åˆ
   â†’ Vertex Shaderã®entry pointã¯ "main"
   â†’ _createPipelines()ã§ entryPoint: 'main' æŒ‡å®šï¼ˆ141è¡Œç›®ï¼‰
   â†’ âœ…ã“ã‚Œã¯æ­£ã—ã„
   â†’ âŒã§ã‚‚BindGroup @group(0) ã®æ§‹é€ ãŒé•ã†å¯èƒ½æ€§
================================================================================
ä»¥ä¸‹Console
================================================================================

config.js:507 âœ… config.js v8.14.2 Phase 1æ”¹ä¿®ç‰ˆ loaded
config.js:508    ğŸ”§ PerfectFreehandè¨­å®šãƒªãƒ‹ã‚¢åŒ–
config.js:509    âœ“ thinning: 0 (ç·šã®å¤ªã‚Šè£œæ­£ç„¡åŠ¹)
config.js:510    âœ“ smoothing: 0 (è£œé–“æœ€å°åŒ–)
config.js:511    âœ“ streamline: 0 (é…å»¶è£œæ­£ãªã—)
 âœ… data-models.js (backgroundColorè¿½åŠ ç‰ˆ) loaded
 âœ… batch-api.js (Phase 6: Historyçµ±åˆç‰ˆ) loaded
 âœ… popup-manager.js (quick-accessé™¤å¤–å¯¾å¿œç‰ˆ) loaded
 âœ… state-manager.js (Phase 8å®Œå…¨å®Ÿè£…ç‰ˆ) loaded
 âœ… settings-manager.js Phase 2 loaded
    ğŸ”§ exportResolution è¨­å®šé …ç›®è¿½åŠ 
 âœ… layer-transform.js Phase 6 loaded
    ğŸ”§ flipLayer(): confirmTransform()å‰Šé™¤ - åè»¢æ™‚ã®ç”»åƒæ¶ˆå¤±ã‚’è§£æ±º
 âœ… system/checker-utils.js çµ±ä¸€å®Ÿè£…ç‰ˆ loaded
 âœ… layer-system.js Phase 7å®Œæˆç‰ˆ loaded
    ğŸš¨ addPathToActiveLayer(): Historyç™»éŒ²ã‚’å‰Šé™¤
    ğŸš¨ brush-core.js ã«Historyç™»éŒ²ã‚’çµ±ä¸€
    âœ… DRYåŸå‰‡ã«åŸºã¥ãè²¬å‹™åˆ†æ‹…ã®æ˜ç¢ºåŒ–
 âœ… drawing-clipboard.js Phase 1 loaded
    ğŸ”§ cutActiveLayer(): æç”»ã®ã¿å‰Šé™¤ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼ä¿æŒï¼‰
    ğŸ¨ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—: ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚³ãƒ”ãƒ¼ã€åˆ‡ã‚Šå–ã‚Š
 âœ… history.js (Phase 3: Redo nullå‚ç…§ä¿®æ­£ç‰ˆ) loaded
 âœ… system/drawing/webgpu/webgpu-capabilities.js loaded
 âœ… wgsl-loader.js Phase 2+3å®Œå…¨ç‰ˆ loaded
    ğŸ”§ Phase 2: Bresenham Line Algorithmå®Ÿè£…
    ğŸ”§ Phase 3: msdf-quad-expansion.wgslç™»éŒ²
 âœ… gpu-stroke-processor.js Phase 7 loaded
 âœ… msdf-pipeline-manager.js Phase 10 loaded
 âœ… earcut-triangulator.js loaded
 âœ… webgpu-mask-layer.js (Phase 2å®Œå…¨ç‰ˆ) loaded
    ğŸ“¦ GPU Compute Shaderã§ãƒãƒªã‚´ãƒ³ãƒ©ã‚¹ã‚¿ãƒ©ã‚¤ã‚º
    ğŸ“¦ ãƒã‚¹ã‚¯åŠ ç®—/æ¸›ç®—
    ğŸ“¦ CPUãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯éå¯¾å¿œï¼ˆGPUå°‚ç”¨ï¼‰
 âœ… system/drawing/msdf/msdf-brush-shader.js loaded
 âœ… pointer-handler.js (Phase 2: ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯è¿½åŠ ç‰ˆ) loaded
    âœ“ pointerType="mouse" with pressure/tilt â†’ auto-corrects to "pen"
 âœ… pressure-handler.js (Phase 4: ã‚°ãƒ­ãƒ¼ãƒãƒ«å…¬é–‹ç‰ˆ) loaded
    âœ“ è·é›¢ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿å¯¾å¿œ
    âœ“ window.PressureHandler ã¨ã—ã¦å…¬é–‹
 âœ… stroke-recorder.js Phase 0 loaded
    âœ“ è‡ªå‹•åˆæœŸåŒ–å®Œäº†ï¼ˆinitialize()ä¸è¦ï¼‰
stroke-recorder.js:336    âœ“ Localåº§æ¨™è¨˜éŒ²å°‚ç”¨ï¼ˆåº§æ¨™å¤‰æ›ãªã—ï¼‰
stroke-recorder.js:337    âœ“ PerfectFreehandäº’æ›å½¢å¼å¯¾å¿œ
sdf-brush-shader.js:142 âœ… sdf-brush-shader.js (Phase 1-FIX: ãƒšãƒ³å°‚ç”¨) loaded
sdf-brush-shader.js:143    âœ“ æ¶ˆã—ã‚´ãƒ ãƒ¢ãƒ¼ãƒ‰å‰Šé™¤
sdf-brush-shader.js:144    âœ“ ãƒšãƒ³æç”»ã«ç‰¹åŒ–
stroke-renderer.js:165 âœ… stroke-renderer.js (Phase 2å®Œæˆç‰ˆ) loaded
thumbnail-system.js:507 âœ… thumbnail-system.js (v1.1: çµ±ä¸€ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”å¯¾å¿œ) loaded
brush-settings.js:222 âœ… brush-settings.js (Phase 3-D Clean) loaded
fill-tool.js:269 âœ… fill-tool.js (WebGPUç«¶åˆä¿®æ­£ç‰ˆ) loaded
fill-tool.js:270    âŒ ç‹¬è‡ªWebGPUåˆæœŸåŒ–ã‚’å‰Šé™¤
fill-tool.js:271    âœ… æ—¢å­˜ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å‚ç…§ã®ã¿
drawing-engine.js:286 âœ… drawing-engine.js (Phase 5 - åº§æ¨™ç³»çµ±ä¸€ä¿®æ­£ç‰ˆ) loaded
drawing-engine.js:287    âœ… BrushCore ã« Localåº§æ¨™ã‚’æ¸¡ã™ã‚ˆã†ã«ä¿®æ­£
drawing-engine.js:288    âœ… startStroke/updateStroke ã§ localX/localY ã‚’ä½¿ç”¨
quick-export-ui.js:292 âœ… quick-export-ui.js (ç„¡åŠ¹åŒ–ç‰ˆ) loaded
export-manager.js:531 âœ… export-manager.js v8.33.0 loaded
export-manager.js:532    ğŸ”§ PNGâ†’APNGç¶­æŒ / WEBPâ†’WebMè‡ªå‹•åˆ‡æ›¿å¯¾å¿œ
png-exporter.js:255 âœ… png-exporter.js v8.29.0 loaded
png-exporter.js:256    ğŸ”§ generatePreview()ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ 
png-exporter.js:257    ğŸ”§ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–
png-exporter.js:258    ğŸ”§ Blobç”Ÿæˆã®ç¢ºå®Ÿæ€§å‘ä¸Š
webp-exporter.js:249 âœ… webp-exporter.js v8.33.0 loaded (é™æ­¢ç”»WEBPå°‚ç”¨)
webp-exporter.js:250    âš ï¸ è¤‡æ•°ãƒ•ãƒ¬ãƒ¼ãƒ æ™‚ã¯WebMæ¨å¥¨ï¼ˆã‚¢ãƒ«ãƒ•ã‚¡å€¤ç¶­æŒãƒ»è»½é‡ï¼‰
psd-exporter.js:170 âœ… psd-exporter.js v8.18.0 loaded (Phase 5: ãƒœã‚¿ãƒ³é…ç½®ç”¨)
psd-exporter.js:171    âš ï¸ å®Ÿè£…ã¯å°†æ¥ãƒ•ã‚§ãƒ¼ã‚ºã§è¿½åŠ äºˆå®š
psd-exporter.js:172    âœ“ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§é–‹ç™ºä¸­ã‚’é€šçŸ¥
apng-exporter.js:281 âœ… apng-exporter.js v8.31.0 loaded
mp4-exporter.js:30 âœ… mp4-exporter.js (Phase 8å®Œæˆç‰ˆ) loaded
dom-builder.js:527 âœ… dom-builder.js v8.19.0 loaded
dom-builder.js:528    ğŸ”§ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³: PNG/WEBP/PSDï¼ˆGIF/PDFå‰Šé™¤ï¼‰
dom-builder.js:529    âœ“ Systemæƒ…å ±è¡¨ç¤ºï¼ˆWebGPU/GPUæ¤œå‡ºï¼‰
slider-utils.js:234 âœ… slider-utils.js v8.13.10 loaded
slider-utils.js:235    ğŸ”§ PointerEventå®Œå…¨å¯¾å¿œï¼ˆã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒšãƒ³å¼•ã£ã‹ã‹ã‚Šè§£æ¶ˆï¼‰
slider-utils.js:236    ğŸ”§ æ…£æ€§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å®Ÿè£…ï¼ˆvelocityè¨ˆç®—ï¼‰
slider-utils.js:237    ğŸ”§ requestAnimationFrameæœ€é©åŒ–
keyboard-handler.js:486 âœ… keyboard-handler.js Phase 6å®Œæˆç‰ˆ loaded
keyboard-handler.js:487    âœ… BS/DEL: æç”»å‰Šé™¤ãŒæ­£å¸¸å‹•ä½œ
keyboard-handler.js:488    âœ… Undo/Redo: childrenå‚ç…§ä¿æŒã§å®Œå…¨å¾©å…ƒ
keyboard-handler.js:489    ğŸ”§ åè»¢å‡¦ç†: ç”»åƒæ¶ˆå¤±å•é¡Œè§£æ±º
layer-panel-renderer.js:663 âœ… layer-panel-renderer.js (Phase 5+6å¯¾å¿œç‰ˆ) loaded
layer-panel-renderer.js:664    âœ“ layer:panel-update-requested ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¿½åŠ 
layer-panel-renderer.js:665    âœ“ LayerSystemã‹ã‚‰ã®ç›´æ¥å‘¼ã³å‡ºã—å®Œå…¨æ’é™¤
status-display-renderer.js:317 âœ… ui/status-display-renderer.js å®Œå…¨æ”¹ä¿®ç‰ˆ loaded
timeline-thumbnail-utils.js:258 âœ… ui/timeline-thumbnail-utils.js (Phase 3å®Œå…¨ç‰ˆ) loaded
timeline-thumbnail-utils.js:259    âœ“ Phase 1: layer:transform-updated è³¼èª­è¿½åŠ 
timeline-thumbnail-utils.js:260    âœ“ Phase 3: throttleæœ€é©åŒ–ï¼ˆ100msï¼‰
timeline-thumbnail-utils.js:261    âœ“ Phase 3: immediate ãƒ•ãƒ©ã‚°å¯¾å¿œ
timeline-thumbnail-utils.js:262    âœ“ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚µãƒ ãƒã‚¤ãƒ«ãŒãƒ¬ã‚¤ãƒ¤ãƒ¼å¤‰å½¢ã«å³åº§è¿½å¾“
timeline-ui.js:981 âœ… timeline-ui.js (Phase 4å®Œäº†: ãƒ¬ã‚¤ãƒ¤ãƒ¼å¤‰å½¢é€£æºç‰ˆ) loaded
album-popup.js:473 âœ… album-popup.js (FRAMEæ”¹ä¿®ç‰ˆ) loaded
settings-popup.js:649 âœ… settings-popup.js Phase 1 loaded
settings-popup.js:650    ğŸ”§ ui:open-settings ãƒªã‚¹ãƒŠãƒ¼è¿½åŠ ï¼ˆCtrl+, å¯¾å¿œï¼‰
quick-access-popup.js:740 âœ… quick-access-popup.js v8.13.17 loaded
export-popup.js:557 âœ… export-popup.js v8.29.0 loaded
export-popup.js:558    ğŸ”§ PNGâ†’APNGç¶­æŒ / WEBPâ†’WebMè‡ªå‹•åˆ‡æ›¿UIå¯¾å¿œ
ui-panels.js:420 âœ… ui-panels.js v8.13.15 loaded
ui-panels.js:421    ğŸ¨ ã‚µã‚¤ãƒ‰ãƒãƒ¼è»½é‡ãƒ‡ã‚¶ã‚¤ãƒ³: ã‚ªãƒ¬ãƒ³ã‚¸æ ã®ã¿
ui-panels.js:422    ğŸ¯ SVGè‰²çµ±ä¸€: å¸¸ã«var(--futaba-maroon)
core-runtime.js:578 âœ… core-runtime.js (Phase 5 - UIä¾‹å¤–ä¿®æ­£ç‰ˆ) loaded
core-engine.js:717 âœ… core-engine.js v8.33.0 loaded
core-engine.js:718    ğŸ”§ StrokeRecorderäºŒé‡åˆæœŸåŒ–ä¿®æ­£
core-engine.js:719    âœ… æ—¢å­˜ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½¿ç”¨æ–¹å¼ã«å¤‰æ›´
core-initializer.js:472 âœ… core-initializer.js (Phase 3-FIX) loaded
core-initializer.js:288 âœ… [PixiJS] Renderer initialized
core-engine.js:617 âœ… [CoreEngine] Using existing strokeRecorder instance
core-engine.js:634 âœ… [CoreEngine] Using existing strokeRenderer instance
popup-manager.js:16 âœ… PopupManager initialized
popup-manager.js:42 ğŸ“‹ Popup "settings" registered (priority: 1)
popup-manager.js:42 ğŸ“‹ Popup "quickAccess" registered (priority: 2)
popup-manager.js:42 ğŸ“‹ Popup "album" registered (priority: 3)
popup-manager.js:42 ğŸ“‹ Popup "resize" registered (priority: 4)
popup-manager.js:102 ğŸ”§ Initializing all popups...
popup-manager.js:87 âœ… Popup "settings" initialized successfully
popup-manager.js:87 âœ… Popup "quickAccess" initialized successfully
popup-manager.js:87 âœ… Popup "album" initialized successfully
popup-manager.js:87 âœ… Popup "resize" initialized successfully
popup-manager.js:118 ğŸ“Š Popup initialization: 4 ready, 0 deferred
webgpu-drawing-layer.js:51 The powerPreference option is currently ignored when calling requestAdapter() on Windows. See https://crbug.com/369219127
initialize @ webgpu-drawing-layer.js:51
initializeWebGPU @ core-initializer.js:176
initialize @ core-initializer.js:331
await in initialize
initialize @ core-initializer.js:452
ï¼ˆåŒ¿åï¼‰ @ index.html:120
webgpu-drawing-layer.js:77 âœ… [WebGPUDrawingLayer] Phase 3.1 Initialized
webgpu-drawing-layer.js:78    ğŸ“Š Device: GPUDeviceÂ {features: GPUSupportedFeatures, limits: GPUSupportedLimits, adapterInfo: GPUAdapterInfo, lost: Promise, queue: GPUQueue,Â â€¦}
webgpu-drawing-layer.js:79    ğŸ“Š Format: rgba8unorm
msdf-pipeline-manager.js:57 [MSDF] Pipelines initialized: {seed: true, jfa: true, encode: true, polygon: true}
core-initializer.js:205 âœ… [WebGPU] Polygon Render Pipeline created
webgpu-texture-bridge.js:48 âœ… [WebGPUTextureBridge] Phase 4å®Œå…¨ç‰ˆ
stroke-renderer.js:87 âœ… [StrokeRenderer] MSDF Mode enabled
core-initializer.js:231 âœ… [WebGPU] StrokeRenderer MSDF Mode enabled
core-initializer.js:234 âœ… [WebGPU] MSDF Pipelineå®Œå…¨åˆæœŸåŒ–å®Œäº†
index.html:121 âœ… Application initialized (WebGPU MSDF Pipelineç‰ˆ)
popup-manager.js:42 ğŸ“‹ Popup "export" registered (priority: 5)
popup-manager.js:87 âœ… Popup "export" initialized successfully
/**
 * ================================================================================
 * ãƒ‡ãƒãƒƒã‚°è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«å®Ÿè¡Œç”¨ï¼‰
 * ================================================================================
 * 
 * ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ä»¥ä¸‹ã‚’ã‚³ãƒ”ãƒšã—ã¦å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š
 * 
 * 1. åˆæœŸåŒ–çŠ¶æ…‹ç¢ºèª
 * 2. VertexBufferç”Ÿæˆãƒ†ã‚¹ãƒˆ
 * 3. PipelineçŠ¶æ…‹ç¢ºèª
 * 4. WGSL Shaderèª­ã¿è¾¼ã¿ç¢ºèª
 * 
 * ================================================================================
 */

// ================================================================================
// 1. åˆæœŸåŒ–çŠ¶æ…‹ç¢ºèª
// ================================================================================
console.log('=== 1. åˆæœŸåŒ–çŠ¶æ…‹ç¢ºèª ===');
console.log('BrushCore:', window.BrushCore);
console.log('GPUStrokeProcessor:', window.GPUStrokeProcessor);
console.log('MSDFPipelineManager:', window.MSDFPipelineManager);
console.log('WebGPUDrawingLayer:', window.WebGPUDrawingLayer);

if (window.MSDFPipelineManager) {
  console.log('MSDFPipelineManager.initialized:', window.MSDFPipelineManager.initialized);
  console.log('MSDFPipelineManager.device:', window.MSDFPipelineManager.device);
  console.log('MSDFPipelineManager.polygonRenderPipeline:', window.MSDFPipelineManager.polygonRenderPipeline);
}

// ================================================================================
// 2. VertexBufferç”Ÿæˆãƒ†ã‚¹ãƒˆ
// ================================================================================
console.log('\n=== 2. VertexBufferç”Ÿæˆãƒ†ã‚¹ãƒˆ ===');

const testPoints = [
  { x: 100, y: 100, pressure: 0.5 },
  { x: 150, y: 150, pressure: 0.5 },
  { x: 200, y: 100, pressure: 0.5 }
];

if (window.GPUStrokeProcessor) {
  try {
    const vertexResult = window.GPUStrokeProcessor.createPolygonVertexBuffer(testPoints);
    console.log('VertexBufferç”Ÿæˆçµæœ:', {
      vertexCount: vertexResult.vertexCount,
      bufferLength: vertexResult.buffer.length,
      expectedBufferLength: vertexResult.vertexCount * 7,
      match: vertexResult.buffer.length === vertexResult.vertexCount * 7
    });
    
    // æœ€åˆã®2é ‚ç‚¹ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
    const f32 = vertexResult.buffer;
    console.table([
      {
        index: 0,
        prev: [f32[0], f32[1]],
        curr: [f32[2], f32[3]],
        next: [f32[4], f32[5]],
        side: f32[6]
      },
      {
        index: 1,
        prev: [f32[7], f32[8]],
        curr: [f32[9], f32[10]],
        next: [f32[11], f32[12]],
        side: f32[13]
      }
    ]);
    
    // GPUè»¢é€ãƒ†ã‚¹ãƒˆ
    const uploadResult = window.GPUStrokeProcessor.uploadToGPU(vertexResult.buffer, 'vertex', 7 * 4);
    console.log('GPUè»¢é€çµæœ:', {
      gpuBuffer: uploadResult.gpuBuffer,
      size: uploadResult.gpuBuffer.size,
      expectedSize: vertexResult.vertexCount * 7 * 4,
      match: uploadResult.gpuBuffer.size === vertexResult.vertexCount * 7 * 4
    });
    
  } catch (error) {
    console.error('VertexBufferç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
  }
} else {
  console.error('GPUStrokeProcessor not found');
}

// ================================================================================
// 3. PipelineçŠ¶æ…‹ç¢ºèª
// ================================================================================
console.log('\n=== 3. PipelineçŠ¶æ…‹ç¢ºèª ===');

if (window.MSDFPipelineManager && window.MSDFPipelineManager.polygonRenderPipeline) {
  const pipeline = window.MSDFPipelineManager.polygonRenderPipeline;
  console.log('Polygon Render Pipeline:', pipeline);
  
  try {
    const layout0 = pipeline.getBindGroupLayout(0);
    const layout1 = pipeline.getBindGroupLayout(1);
    console.log('BindGroup Layout 0:', layout0);
    console.log('BindGroup Layout 1:', layout1);
  } catch (error) {
    console.error('Pipeline layoutå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
  }
} else {
  console.error('Polygon Render Pipeline not initialized');
}

// ================================================================================
// 4. WGSL Shaderèª­ã¿è¾¼ã¿ç¢ºèª
// ================================================================================
console.log('\n=== 4. WGSL Shaderèª­ã¿è¾¼ã¿ç¢ºèª ===');

const shaders = {
  'MSDF_SEED_INIT_WGSL': window.MSDF_SEED_INIT_WGSL,
  'MSDF_JFA_PASS_WGSL': window.MSDF_JFA_PASS_WGSL,
  'MSDF_ENCODE_WGSL': window.MSDF_ENCODE_WGSL,
  'MSDF_RENDER_WGSL': window.MSDF_RENDER_WGSL,
  'MSDF_QUAD_EXPANSION_WGSL': window.MSDF_QUAD_EXPANSION_WGSL
};

Object.entries(shaders).forEach(([name, code]) => {
  if (code) {
    console.log(`âœ… ${name}: ${code.length} chars`);
    
    // @group/@bindingç¢ºèª
    if (name === 'MSDF_QUAD_EXPANSION_WGSL') {
      const groupMatches = code.match(/@group\((\d+)\)/g) || [];
      console.log(`  - @group: ${groupMatches.join(', ')}`);
    }
    if (name === 'MSDF_RENDER_WGSL') {
      const groupMatches = code.match(/@group\((\d+)\)/g) || [];
      console.log(`  - @group: ${groupMatches.join(', ')}`);
    }
  } else {
    console.error(`âŒ ${name}: NOT LOADED`);
  }
});

// ================================================================================
// 5. StrokeRecorderçŠ¶æ…‹ç¢ºèª
// ================================================================================
console.log('\n=== 5. StrokeRecorderçŠ¶æ…‹ç¢ºèª ===');

if (window.strokeRecorder) {
  console.log('StrokeRecorder:', window.strokeRecorder);
  console.log('points:', window.strokeRecorder.points);
  console.log('isRecording:', window.strokeRecorder.isRecording);
} else {
  console.error('strokeRecorder not found');
}

// ================================================================================
// 6. LayerManagerçŠ¶æ…‹ç¢ºèª
// ================================================================================
console.log('\n=== 6. LayerManagerçŠ¶æ…‹ç¢ºèª ===');

if (window.layerManager || window.layerSystem) {
  const lm = window.layerManager || window.layerSystem;
  const activeLayer = lm.getActiveLayer();
  console.log('Active Layer:', activeLayer);
  
  if (activeLayer) {
    console.log('Layer ID:', activeLayer.id);
    console.log('Layer paths:', activeLayer.paths?.length || 0);
    console.log('Layer container:', activeLayer.container || activeLayer.drawingContainer);
  }
} else {
  console.error('layerManager not found');
}

console.log('\n=== è¨ºæ–­å®Œäº† ===');
console.log('ä¸Šè¨˜ãƒ­ã‚°ã‚’Claude AIã«å…±æœ‰ã—ã¦ãã ã•ã„');
VM906:19 === 1. åˆæœŸåŒ–çŠ¶æ…‹ç¢ºèª ===
VM906:20 BrushCore: BrushCoreÂ {strokeRecorder: StrokeRecorder, gpuStrokeProcessor: GPUStrokeProcessor, msdfPipelineManager: MSDFPipelineManager, textureBridge: WebGPUTextureBridge, layerManager: LayerSystem,Â â€¦}
VM906:21 GPUStrokeProcessor: GPUStrokeProcessorÂ {device: GPUDevice, queue: GPUQueue, initialized: true}
VM906:22 MSDFPipelineManager: MSDFPipelineManagerÂ {device: GPUDevice, queue: GPUQueue, format: 'rgba8unorm', seedInitPipeline: GPUComputePipeline, jfaPipeline: GPUComputePipeline,Â â€¦}
VM906:23 WebGPUDrawingLayer: WebGPUDrawingLayerÂ {device: GPUDevice, queue: GPUQueue, adapter: GPUAdapter, format: 'rgba8unorm', initialized: true}
VM906:26 MSDFPipelineManager.initialized: true
VM906:27 MSDFPipelineManager.device: GPUDeviceÂ {features: GPUSupportedFeatures, limits: GPUSupportedLimits, adapterInfo: GPUAdapterInfo, lost: Promise, queue: GPUQueue,Â â€¦}
VM906:28 MSDFPipelineManager.polygonRenderPipeline: GPURenderPipelineÂ {label: 'MSDF Polygon Render Pipeline'}
VM906:34 
=== 2. VertexBufferç”Ÿæˆãƒ†ã‚¹ãƒˆ ===
VM906:45 VertexBufferç”Ÿæˆçµæœ: {vertexCount: 12, bufferLength: 84, expectedBufferLength: 84, match: true}
VM906:54 ï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰indexprevcurrnextsideï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰indexprevcurrnextside00Array(2)Array(2)Array(2)-111Array(2)Array(2)Array(2)1Array(2)
VM906:73 GPUè»¢é€çµæœ: {gpuBuffer: GPUBuffer, size: 336, expectedSize: 336, match: true}
VM906:90 
=== 3. PipelineçŠ¶æ…‹ç¢ºèª ===
VM906:94 Polygon Render Pipeline: GPURenderPipelineÂ {label: 'MSDF Polygon Render Pipeline'}
VM906:99 BindGroup Layout 0: GPUBindGroupLayoutÂ {label: ''}
VM906:100 BindGroup Layout 1: GPUBindGroupLayoutÂ {label: ''}
VM906:111 
=== 4. WGSL Shaderèª­ã¿è¾¼ã¿ç¢ºèª ===
VM906:123 âœ… MSDF_SEED_INIT_WGSL: 1721 chars
VM906:123 âœ… MSDF_JFA_PASS_WGSL: 1695 chars
VM906:123 âœ… MSDF_ENCODE_WGSL: 2220 chars
VM906:123 âœ… MSDF_RENDER_WGSL: 1247 chars
VM906:132   - @group: @group(1), @group(1), @group(1), @group(1)
VM906:123 âœ… MSDF_QUAD_EXPANSION_WGSL: 993 chars
VM906:128   - @group: @group(0)
VM906:142 
=== 5. StrokeRecorderçŠ¶æ…‹ç¢ºèª ===
VM906:145 StrokeRecorder: StrokeRecorderÂ {pressureHandler: null, cameraSystem: null, points: Array(0), isRecording: false, strokeStartTime: 0,Â â€¦}
VM906:146 points: []
VM906:147 isRecording: false
VM906:155 
=== 6. LayerManagerçŠ¶æ…‹ç¢ºèª ===
VM906:160 Active Layer: ZÂ {_events: i, _eventsCount: 0, uid: 17, _updateFlags: 0, renderGroup: Ri,Â â€¦}
VM906:163 Layer ID: undefined
VM906:164 Layer paths: 0
VM906:165 Layer container: undefined
VM906:171 
=== è¨ºæ–­å®Œäº† ===
VM906:172 ä¸Šè¨˜ãƒ­ã‚°ã‚’Claude AIã«å…±æœ‰ã—ã¦ãã ã•ã„
undefined
brush-core.js:164 [BrushCore Preview] VertexBuffer: {vertexCount: 6, bufferSize: 42, gpuBuffer: GPUBuffer, edgeCount: 1}
msdf-pipeline-manager.js:433 [MSDF] Render path decision: {vertexBuffer: GPUBuffer, vertexCount: 6, edgeCount: 1, condition: true}
msdf-pipeline-manager.js:445 [MSDF] Using Polygon path
msdf-pipeline-manager.js:456 [MSDF] Texture dimensions: {rawWidth: 100, rawHeight: 100.5, finalWidth: 200, finalHeight: 201, oversample: 2}
msdf-pipeline-manager.js:300 [MSDF Render] VertexBuffer check: {type: 'GPUBuffer', size: 168, vertexCount: 6, usage: 40}
msdf-pipeline-manager.js:327 [MSDF Render] QuadUniforms: {canvasWidth: 200, canvasHeight: 201, halfWidth: 1.5, padding: 0}
msdf-pipeline-manager.js:347 [MSDF Render] BindGroup0 created: {entries: GPUBindGroup, bufferSize: 16}
msdf-pipeline-manager.js:400 [MSDF Render] Draw command: {vertexCount: 6, instanceCount: 1, expectedTriangles: 2}
brush-core.js:164 [BrushCore Preview] VertexBuffer: {vertexCount: 30, bufferSize: 210, gpuBuffer: GPUBuffer, edgeCount: 5}
msdf-pipeline-manager.js:433 [MSDF] Render path decision: {vertexBuffer: GPUBuffer, vertexCount: 30, edgeCount: 5, condition: true}
msdf-pipeline-manager.js:445 [MSDF] Using Polygon path
msdf-pipeline-manager.js:456 [MSDF] Texture dimensions: {rawWidth: 100, rawHeight: 115.5, finalWidth: 200, finalHeight: 231, oversample: 2}
msdf-pipeline-manager.js:300 [MSDF Render] VertexBuffer check: {type: 'GPUBuffer', size: 840, vertexCount: 30, usage: 40}
msdf-pipeline-manager.js:327 [MSDF Render] QuadUniforms: {canvasWidth: 200, canvasHeight: 231, halfWidth: 1.5, padding: 0}
msdf-pipeline-manager.js:347 [MSDF Render] BindGroup0 created: {entries: GPUBindGroup, bufferSize: 16}
msdf-pipeline-manager.js:400 [MSDF Render] Draw command: {vertexCount: 30, instanceCount: 1, expectedTriangles: 10}
brush-core.js:164 [BrushCore Preview] VertexBuffer: {vertexCount: 60, bufferSize: 420, gpuBuffer: GPUBuffer, edgeCount: 10}
msdf-pipeline-manager.js:433 [MSDF] Render path decision: {vertexBuffer: GPUBuffer, vertexCount: 60, edgeCount: 10, condition: true}
msdf-pipeline-manager.js:445 [MSDF] Using Polygon path
msdf-pipeline-manager.js:456 [MSDF] Texture dimensions: {rawWidth: 102, rawHeight: 144.5, finalWidth: 204, finalHeight: 289, oversample: 2}
msdf-pipeline-manager.js:300 [MSDF Render] VertexBuffer check: {type: 'GPUBuffer', size: 1680, vertexCount: 60, usage: 40}
msdf-pipeline-manager.js:327 [MSDF Render] QuadUniforms: {canvasWidth: 204, canvasHeight: 289, halfWidth: 1.5, padding: 0}
msdf-pipeline-manager.js:347 [MSDF Render] BindGroup0 created: {entries: GPUBindGroup, bufferSize: 16}
msdf-pipeline-manager.js:400 [MSDF Render] Draw command: {vertexCount: 60, instanceCount: 1, expectedTriangles: 20}
brush-core.js:164 [BrushCore Preview] VertexBuffer: {vertexCount: 90, bufferSize: 630, gpuBuffer: GPUBuffer, edgeCount: 15}
msdf-pipeline-manager.js:433 [MSDF] Render path decision: {vertexBuffer: GPUBuffer, vertexCount: 90, edgeCount: 15, condition: true}
msdf-pipeline-manager.js:445 [MSDF] Using Polygon path
msdf-pipeline-manager.js:456 [MSDF] Texture dimensions: {rawWidth: 103.5, rawHeight: 167, finalWidth: 207, finalHeight: 334, oversample: 2}
msdf-pipeline-manager.js:300 [MSDF Render] VertexBuffer check: {type: 'GPUBuffer', size: 2520, vertexCount: 90, usage: 40}
msdf-pipeline-manager.js:327 [MSDF Render] QuadUniforms: {canvasWidth: 207, canvasHeight: 334, halfWidth: 1.5, padding: 0}
msdf-pipeline-manager.js:347 [MSDF Render] BindGroup0 created: {entries: GPUBindGroup, bufferSize: 16}
msdf-pipeline-manager.js:400 [MSDF Render] Draw command: {vertexCount: 90, instanceCount: 1, expectedTriangles: 30}
brush-core.js:164 [BrushCore Preview] VertexBuffer: {vertexCount: 114, bufferSize: 798, gpuBuffer: GPUBuffer, edgeCount: 19}
msdf-pipeline-manager.js:433 [MSDF] Render path decision: {vertexBuffer: GPUBuffer, vertexCount: 114, edgeCount: 19, condition: true}
msdf-pipeline-manager.js:445 [MSDF] Using Polygon path
msdf-pipeline-manager.js:456 [MSDF] Texture dimensions: {rawWidth: 104.5, rawHeight: 173, finalWidth: 209, finalHeight: 346, oversample: 2}
brush-core.js:273 [BrushCore Finalize] VertexBuffer: {vertexCount: 114, bufferSize: 798, gpuBuffer: GPUBuffer, edgeCount: 19, mode: 'pen'}
msdf-pipeline-manager.js:433 [MSDF] Render path decision: {vertexBuffer: GPUBuffer, vertexCount: 114, edgeCount: 19, condition: true}
msdf-pipeline-manager.js:445 [MSDF] Using Polygon path
msdf-pipeline-manager.js:456 [MSDF] Texture dimensions: {rawWidth: 104.5, rawHeight: 173, finalWidth: 209, finalHeight: 346, oversample: 2}
msdf-pipeline-manager.js:300 [MSDF Render] VertexBuffer check: {type: 'GPUBuffer', size: 3192, vertexCount: 114, usage: 40}
msdf-pipeline-manager.js:327 [MSDF Render] QuadUniforms: {canvasWidth: 209, canvasHeight: 346, halfWidth: 1.5, padding: 0}
msdf-pipeline-manager.js:347 [MSDF Render] BindGroup0 created: {entries: GPUBindGroup, bufferSize: 16}
msdf-pipeline-manager.js:400 [MSDF Render] Draw command: {vertexCount: 114, instanceCount: 1, expectedTriangles: 38}
msdf-pipeline-manager.js:300 [MSDF Render] VertexBuffer check: {type: 'GPUBuffer', size: 3192, vertexCount: 114, usage: 40}
msdf-pipeline-manager.js:327 [MSDF Render] QuadUniforms: {canvasWidth: 209, canvasHeight: 346, halfWidth: 1.5, padding: 0}
msdf-pipeline-manager.js:347 [MSDF Render] BindGroup0 created: {entries: GPUBindGroup, bufferSize: 16}
msdf-pipeline-manager.js:400 [MSDF Render] Draw command: {vertexCount: 114, instanceCount: 1, expectedTriangles: 38}
brush-core.js:164 [BrushCore Preview] VertexBuffer: {vertexCount: 6, bufferSize: 42, gpuBuffer: GPUBuffer, edgeCount: 1}
msdf-pipeline-manager.js:433 [MSDF] Render path decision: {vertexBuffer: GPUBuffer, vertexCount: 6, edgeCount: 1, condition: true}
msdf-pipeline-manager.js:445 [MSDF] Using Polygon path
msdf-pipeline-manager.js:456 [MSDF] Texture dimensions: {rawWidth: 100.5, rawHeight: 100, finalWidth: 201, finalHeight: 200, oversample: 2}
msdf-pipeline-manager.js:300 [MSDF Render] VertexBuffer check: {type: 'GPUBuffer', size: 168, vertexCount: 6, usage: 40}
msdf-pipeline-manager.js:327 [MSDF Render] QuadUniforms: {canvasWidth: 201, canvasHeight: 200, halfWidth: 1.5, padding: 0}
msdf-pipeline-manager.js:347 [MSDF Render] BindGroup0 created: {entries: GPUBindGroup, bufferSize: 16}
msdf-pipeline-manager.js:364 [MSDF Render] Eraser mode: alpha=0.0
msdf-pipeline-manager.js:400 [MSDF Render] Draw command: {vertexCount: 6, instanceCount: 1, expectedTriangles: 2}
brush-core.js:164 [BrushCore Preview] VertexBuffer: {vertexCount: 30, bufferSize: 210, gpuBuffer: GPUBuffer, edgeCount: 5}
msdf-pipeline-manager.js:433 [MSDF] Render path decision: {vertexBuffer: GPUBuffer, vertexCount: 30, edgeCount: 5, condition: true}
msdf-pipeline-manager.js:445 [MSDF] Using Polygon path
msdf-pipeline-manager.js:456 [MSDF] Texture dimensions: {rawWidth: 107, rawHeight: 102, finalWidth: 214, finalHeight: 204, oversample: 2}
msdf-pipeline-manager.js:300 [MSDF Render] VertexBuffer check: {type: 'GPUBuffer', size: 840, vertexCount: 30, usage: 40}
msdf-pipeline-manager.js:327 [MSDF Render] QuadUniforms: {canvasWidth: 214, canvasHeight: 204, halfWidth: 1.5, padding: 0}
msdf-pipeline-manager.js:347 [MSDF Render] BindGroup0 created: {entries: GPUBindGroup, bufferSize: 16}
msdf-pipeline-manager.js:364 [MSDF Render] Eraser mode: alpha=0.0
msdf-pipeline-manager.js:400 [MSDF Render] Draw command: {vertexCount: 30, instanceCount: 1, expectedTriangles: 10}
brush-core.js:164 [BrushCore Preview] VertexBuffer: {vertexCount: 66, bufferSize: 462, gpuBuffer: GPUBuffer, edgeCount: 11}
msdf-pipeline-manager.js:433 [MSDF] Render path decision: {vertexBuffer: GPUBuffer, vertexCount: 66, edgeCount: 11, condition: true}
msdf-pipeline-manager.js:445 [MSDF] Using Polygon path
msdf-pipeline-manager.js:456 [MSDF] Texture dimensions: {rawWidth: 129, rawHeight: 107.5, finalWidth: 258, finalHeight: 215, oversample: 2}
msdf-pipeline-manager.js:300 [MSDF Render] VertexBuffer check: {type: 'GPUBuffer', size: 1848, vertexCount: 66, usage: 40}
msdf-pipeline-manager.js:327 [MSDF Render] QuadUniforms: {canvasWidth: 258, canvasHeight: 215, halfWidth: 1.5, padding: 0}
msdf-pipeline-manager.js:347 [MSDF Render] BindGroup0 created: {entries: GPUBindGroup, bufferSize: 16}
msdf-pipeline-manager.js:364 [MSDF Render] Eraser mode: alpha=0.0
msdf-pipeline-manager.js:400 [MSDF Render] Draw command: {vertexCount: 66, instanceCount: 1, expectedTriangles: 22}
brush-core.js:273 [BrushCore Finalize] VertexBuffer: {vertexCount: 78, bufferSize: 546, gpuBuffer: GPUBuffer, edgeCount: 13, mode: 'eraser'}
msdf-pipeline-manager.js:433 [MSDF] Render path decision: {vertexBuffer: GPUBuffer, vertexCount: 78, edgeCount: 13, condition: true}
msdf-pipeline-manager.js:445 [MSDF] Using Polygon path
msdf-pipeline-manager.js:456 [MSDF] Texture dimensions: {rawWidth: 134.5, rawHeight: 107.5, finalWidth: 269, finalHeight: 215, oversample: 2}
msdf-pipeline-manager.js:300 [MSDF Render] VertexBuffer check: {type: 'GPUBuffer', size: 2184, vertexCount: 78, usage: 40}
msdf-pipeline-manager.js:327 [MSDF Render] QuadUniforms: {canvasWidth: 269, canvasHeight: 215, halfWidth: 1.5, padding: 0}
msdf-pipeline-manager.js:347 [MSDF Render] BindGroup0 created: {entries: GPUBindGroup, bufferSize: 16}
msdf-pipeline-manager.js:364 [MSDF Render] Eraser mode: alpha=0.0
msdf-pipeline-manager.js:400 [MSDF Render] Draw command: {vertexCount: 78, instanceCount: 1, expectedTriangles: 26}
brush-core.js:313 [BrushCore] Eraser mode: blendMode set to "erase"
