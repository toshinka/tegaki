# PixiJS v8.13 アニメーション機能 問題修正計画書

## 問題点と修正方針

### 1. レイヤーパネル二重表示問題
**症状**: レイヤー1と背景が二重に出現している  
**原因**: AnimationSystemの初期CUT作成とLayerSystemの初期化が重複  
**修正**: 
- AnimationSystemの`createInitialCutIfNeeded()`でレイヤー重複チェック追加
- LayerSystemのレイヤー配列初期化タイミング調整

### 2. 描画位置ズレ問題
**症状**: 描画位置がズレるが、Vキー押下で修正される  
**原因**: CUT切り替え時の変形データ適用が不完全  
**修正**:
- `applyTransformToLayer()`で中心点基準の座標計算修正
- `rebuildLayersFromCutData()`で変形データ適用順序修正

### 3. タイムラインサムネイル不要ボタン削除
**症状**: サムネイル上の◀▶ボタンが不要  
**修正**: 
- `createCutItem()`からサムネイルナビゲーションボタンを削除
- 代わりに表示時間入力を◀▶スタイルに変更

### 4. 新規CUT作成時の絵消失問題
**症状**: 新規CUT作成で他のCUTの絵が消える  
**原因**: LayerSystemのレイヤークリア処理が過度  
**修正**:
- CUT作成時にレイヤーデータの独立性確保
- `switchToActiveCut()`でレイヤー状態保存処理追加

### 5. ショートカットキー競合問題
**症状**: Ctrl+Shift+Nでプライベートウィンドウが開く  
**修正**: 
- Ctrl+Nに変更、または preventDefault()を確実に実行
- ブラウザデフォルト動作を無効化

## 修正優先順位

1. **高**: レイヤー二重表示（UX直結）
2. **高**: 描画位置ズレ（機能破綻）
3. **中**: 新規CUT作成時絵消失（データ損失）
4. **中**: タイムラインUI改善
5. **低**: ショートカット競合

## 座標変換API統一チェック
- CoordinateSystem API使用状況確認
- LayerSystem変形処理統一
- AnimationSystem座標計算修正

## レイヤーAPI断片化チェック
- LayerSystem ↔ AnimationSystem連携強化
- レイヤー作成・削除・更新の統一化
- CUT間でのレイヤーデータ独立性確保

## EventBus統合完全性チェック
- イベント発火・受信の確実性確認
- UI更新タイミング調整
- 重複イベント防止

## PixiJS v8.13対応確認
- Graphics API使用方法統一
- RenderTexture作成・破棄処理確認
- メモリリーク防止処理強化