ğŸ” ç¾çŠ¶åˆ†æçµæœ
âœ… å®Œäº†ã—ã¦ã„ã‚‹æ”¹ä¿®

Canvasç›´æ¥ä¿å­˜: animation-system.jsã§cut.thumbnailCanvasã«Canvaså½¢å¼ã§ä¿å­˜
Textureå¾€å¾©æ’é™¤: generateLayerCompositeCanvasOptimized()ã§Canvasç›´æ¥ç”Ÿæˆ
ã‚­ãƒ£ãƒ³ãƒã‚¹æ¯”ç‡è¨ˆç®—: applyCutThumbnailAspectRatio()ã§å‹•çš„èª¿æ•´

âŒ æ®‹å­˜ã™ã‚‹å•é¡Œ
1. ã‚µãƒ ãƒã‚¤ãƒ«ã®æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°å•é¡Œ

CUTã‚’å¢—ã‚„ã—ãŸæ™‚ã®ã¿åæ˜ ã•ã‚Œã‚‹ã®ã¯ã€generateCutThumbnailOptimized()ã®å‘¼ã³å‡ºã—ãŒéåŒæœŸã§ã€æç”»å®Œäº†ã‚’å¾…ãŸãšã«å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ãŸã‚
ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«ã®ã‚µãƒ ãƒã‚¤ãƒ«ã¯åŒæœŸçš„ã«å³åº§æ›´æ–°ã•ã‚Œã‚‹ä¸€æ–¹ã€CUTã‚µãƒ ãƒã‚¤ãƒ«ã¯éåŒæœŸã§é…å»¶ç™ºç”Ÿ

2. CUTç‹¬ç«‹æ€§ã®ä¸å®Œå…¨ãªå®Ÿè£…

AnimationSystemå´ã¯å®Œå…¨ç‹¬ç«‹(cutLayerStates Map)
ã—ã‹ã—LayerSystemå´ã®è‡ªå‹•ä¿å­˜ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒä¸é©åˆ‡ã§ã€æç”»å®Œäº†æ™‚ã«å³åº§ä¿å­˜ã•ã‚Œã¦ã„ãªã„

3. åˆæœŸCUTä½œæˆã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®å•é¡Œ

ensureInitialCut()ãŒcreateNewCutFromCurrentLayers()ã‚’å‘¼ã¶ãŒã€ã“ã®æ™‚ç‚¹ã§ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒç©ºã®å ´åˆãŒã‚ã‚‹

ğŸ¯ æ”¹ä¿®è¨ˆç”»
å„ªå…ˆåº¦Aï¼šæç”»â†’ä¿å­˜â†’ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆã®åŒæœŸåŒ–

// layer-system.jså´ã§ã®å³æ™‚ä¿å­˜å¼·åŒ–
addPathToActiveLayer(path) {
    // ãƒ‘ã‚¹è¿½åŠ å¾Œã€å³åº§ã«AnimationSystemã¸é€šçŸ¥
    this.addPathToLayer(this.activeLayerIndex, path);
    
    if (this.animationSystem) {
        // æç”»å®Œäº†å¾Œã€å³åº§ã«ä¿å­˜
        requestAnimationFrame(() => {
            this.animationSystem.saveCutLayerStates();
        });
    }
}

å„ªå…ˆåº¦Bï¼šã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆã®ç¢ºå®Ÿæ€§å‘ä¸Š

// animation-system.js
async generateCutThumbnailOptimized(cutIndex) {
    // Canvasç”Ÿæˆå‰ã«ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã®å®Œäº†ã‚’ç¢ºå®Ÿã«å¾…ã¤
    await this.app.renderer.render(this.layerSystem.layersContainer);
    
    const thumbnailCanvas = await this.generateLayerCompositeCanvasOptimized();
    // ...
}

å„ªå…ˆåº¦Cï¼šåˆæœŸCUTä½œæˆã®æ”¹å–„

// timeline-ui.js
ensureInitialCut() {
    const animData = this.animationSystem.getAnimationData();
    if (animData.cuts.length === 0) {
        // ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿CUTä½œæˆ
        if (this.animationSystem.layerSystem?.layers?.length > 0) {
            this.animationSystem.createNewCutFromCurrentLayers();
        } else {
            // ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒç„¡ã„å ´åˆã¯ç©ºCUTä½œæˆ
            this.animationSystem.createNewBlankCut();
        }
    }
    this.updateLayerPanelIndicator();
}

ä»¥ä¸‹ã®é †åºã§é€²ã‚ã¾ã™ï¼š

1.system/layer-system.js - AnimationSystemåŒæœŸå¼·åŒ–
2.system/animation-system.js - ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆã®ç¢ºå®Ÿæ€§å‘ä¸Š
3.ui/timeline-ui.js - åˆæœŸCUTä½œæˆæ”¹å–„

