# Tegaki v8 「ルールブック／シンボル辞典」改修計画

目的:
- ヘッダー充実化に伴い、ルールブック（1_tegaki_rulebook_v8.txt）とシンボル辞典（2_symbol-dictionary_v8.txt）の責任を分界し、AI が改修・生成する際に「どの知識をどこで参照すべきか」を明確化する。
- 無意味なお手本コードや重複サンプルを排除し、文章契約（Design Contract）に徹する。
- AI にとって「良い伴侶」となるよう、曖昧な判断をなくし、構造化された辞書形式で提供する。

───────────────────────────────
A. ルールブック (1_tegaki_rulebook_v8.txt)
現状:
- Manager/Tool の初期化手順や禁止事項が列挙されている。
- しかし「どこまでがルール」「どこからが用語辞典に移すべきか」が曖昧。

改修方針:
1. ルールブックは「原則・契約・責任分界」のみを記載する文書とする。
2. お手本コードは極力排除し、手続きは「擬似コード形式の箇条書き」に留める。
3. 各章立てを以下に整理:
   - 1. ライフサイクル契約（Manager の configure/attach/init/isReady/dispose）
   - 2. 禁止事項（双方向依存禁止、DPR 二重補正禁止など）
   - 3. イベント契約（Pointer/Touchevent の取扱い）
   - 4. 座標契約（CoordinateManager を唯一ルートとする）
   - 5. 命名規則（startOperation()/endOperation()）
   - 6. テスト契約（runPhase15Test の実行基準など）
4. 各契約条項には必ず「出典タグ（@forbids, @event-contract など）」を付け、ヘッダー仕様と整合を取る。
5. ルールブック内で具体的 API 名を出す場合も、実装例やサンプルコードは記載せず、説明のみ。

───────────────────────────────
B. シンボル辞典 (2_symbol-dictionary_v8.txt)
現状:
- 用語やキーが羅列されているが、ルールブックと重複する部分が多い。
- 「規則文書」と「用語定義」が混在し、AI が迷いやすい。

改修方針:
1. シンボル辞典は「用語・キー・タグの統一定義」を担う。
   - Manager キー（@manager-key に記載されるもの）
   - ヘッダータグ（@provides / @uses / … の正式定義）
   - 契約用語（isReady, forceEndDrawing などの用語定義）
   - テスト用語（Phase1.5, integration-test など）
2. 各項目を **定義 → 用途 → 禁止事項との関係** の三部構成でまとめる。
3. 「禁止される言い換え」も併記（例: setManagers → setManagersObject が正、setManagers はエイリアス）。
4. サンプルコードは一切掲載せず、見出しと定義文だけ。
5. 「symbol-dictionary は生成系AIがヘッダを書き込むときの辞書」と位置付け、ヘッダに必須の語彙が全てここにある状態にする。
6. ルールブック側とリンクする場合は「参照: ルールブック第X章」とだけ書く。

───────────────────────────────
C. 改修計画ステップ

Step 1: ルールブック整理
- 現行 v8 のルールブックからサンプルコード・重複用語を削除。
- 「契約」単位に章立てを整理し、ヘッダーのタグに対応付ける。

Step 2: シンボル辞典整理
- 現行 v8 の辞典からルール系文章を削除。
- 全ての @provides / @uses / @initflow / @forbids / @manager-key / @dependencies-strict / @integration-flow / @method-naming-rules / @event-contract / @coordinate-contract を辞典項目化。
- 用語ごとに「定義・用途・禁止関係」を三行以内でまとめる。

Step 3: 相互参照追加
- ルールブックの各契約章末尾に「詳細用語定義はシンボル辞典参照」と明記。
- シンボル辞典の各用語末尾に「参照: ルールブック第X章」と明記。

───────────────────────────────
D. 完了後の責任分界

ルールブック:
- 「どう振る舞うべきか」「何をしてはいけないか」を列挙する契約集。
- サンプルコード禁止。擬似コードまたは文章のみ。

シンボル辞典:
- 「語彙の正しい意味」「使用場所」「禁止関係」を列挙する用語集。
- コード禁止。定義文と参照リンクのみ。

───────────────────────────────
E. AI 利用時のメリット

- AI が新しいファイルや修正パッチを生成する際、まずシンボル辞典を照合し、正しいタグやメソッド名を使える。
- ルールブックは参照するだけで「契約に違反していないか」を検証できる。
- 無駄なお手本コードが消えるので、AI がコード断片を誤ってコピペするリスクが減る。
- 今後ヘッダーが追加されても辞典に用語を足せば即座に反映できる。

───────────────────────────────
F. 判定
→ 現状の v8 文書では「辞典とルールブックの責任分界が曖昧」であり、この改修が必要。
→ 無意味なお手本コードを削除し、契約/辞典の二本立てに整理すべき。

以上。
