# ğŸš€ Tegaki v8 Phase1.5 åŒ…æ‹¬çš„æ”¹ä¿®è¨ˆç”»æ›¸ v2.1
## ğŸ“Š CoordinateManager ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ä¿®æ­£ãƒ»ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚¢ã‚¤ã‚³ãƒ³å¾©æ—§å¯¾å¿œ

### ğŸ¯ ç¾åœ¨ã®çŠ¶æ³ï¼ˆ2025-09-01 æœ€æ–°æ›´æ–°ï¼‰

#### âœ… è§£æ±ºæ¸ˆã¿å•é¡Œ
1. **CanvasManager åˆæœŸåŒ–é †åºå•é¡Œ** â†’ å®Œå…¨ä¿®æ­£æ¸ˆã¿
2. **TegakiApplication æ§‹æ–‡ã‚¨ãƒ©ãƒ¼** â†’ ä¿®æ­£æ¸ˆã¿
3. **Canvasè¡¨ç¤ºå•é¡Œ** â†’ ã‚­ãƒ£ãƒ³ãƒã‚¹400x400è¡¨ç¤ºæˆåŠŸ

#### âŒ ç¾åœ¨ç™ºç”Ÿä¸­ã®å•é¡Œ
1. **CoordinateManager ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«æœªå®Ÿè¡Œ**
   - `configured: false, attached: false, initialized: false`
   - Managerçµ±ä¸€ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ï¼ˆconfigure/attach/initï¼‰ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãªã„
2. **ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚¢ã‚¤ã‚³ãƒ³éè¡¨ç¤º**
   - EventBus `app:ready` ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§
   - TegakiIcons ã‚·ã‚¹ãƒ†ãƒ ãŒèµ·å‹•ã—ã¦ã„ãªã„

#### ğŸ“Š ã‚¨ãƒ©ãƒ¼åˆ†æçµæœ

**CoordinateManager ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‹ã‚‰åˆ¤æ˜:**
```json
{
  "lifecycle": {
    "configured": false,  // âŒ configure() æœªå®Ÿè¡Œ
    "attached": false,    // âŒ attach() æœªå®Ÿè¡Œ  
    "initialized": false, // âŒ init() æœªå®Ÿè¡Œ
    "ready": false       // âŒ çµæœçš„ã«æº–å‚™æœªå®Œäº†
  }
}
```

**åº§æ¨™è¨ˆç®—ã¯æ©Ÿèƒ½ã—ã¦ã„ã‚‹:**
- Canvas bounds: æ­£å¸¸å–å¾— (110.5, 103, 400x400)
- DPR: 2 (æ­£å¸¸)
- Transform: æ­£å¸¸

â†’ **å•é¡Œ**: Managerå¥‘ç´„ã® `isReady()` ãŒ `lifecycle.ready` ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã‚‹ãŒã€ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«å®Ÿè¡Œã•ã‚Œã¦ã„ãªã„

---

## ğŸ”§ ä¿®æ­£æ–¹é‡ãƒ»è§£æ±ºç­–

### ğŸ“‹ Priority 1: CoordinateManager ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ä¿®æ­£

#### å•é¡Œç®‡æ‰€ç‰¹å®š
AppCore.js ã® `createAndRegisterBasicManagers()` ã¨ `initializeV8Managers()` ã§ã€CoordinateManager ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãªã„ã€‚

#### ä¿®æ­£å†…å®¹
```javascript
// âŒ ç¾åœ¨ï¼ˆBROKENï¼‰
const coordinateManager = new window.Tegaki.CoordinateManager();
await coordinateManager.setCanvasManager(this.canvasManager); // ã„ããªã‚Šå°‚ç”¨ãƒ¡ã‚½ãƒƒãƒ‰
this.verifyManagerReady(coordinateManager, 'CoordinateManager'); // âŒ ready=false

// âœ… ä¿®æ­£å¾Œï¼ˆFIXEDï¼‰
const coordinateManager = new window.Tegaki.CoordinateManager();

// ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«å®Ÿè¡Œï¼ˆå¿…é ˆï¼‰
coordinateManager.configure({ coordinate: { dpr: 2.0 } });
coordinateManager.attach({ canvasManager: this.canvasManager });
await coordinateManager.init();

// å°‚ç”¨ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè¡Œï¼ˆãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«å¾Œï¼‰
await coordinateManager.setCanvasManager(this.canvasManager);

// æº–å‚™ç¢ºèªï¼ˆæˆåŠŸï¼‰
this.verifyManagerReady(coordinateManager, 'CoordinateManager'); // âœ… ready=true
```

### ğŸ“‹ Priority 2: å…¨Manager ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«çµ±ä¸€

#### RecordManager, ConfigManager ã‚‚åŒæ§˜ã®å•é¡Œ
```javascript
// ä¿®æ­£: å…¨Manager ã§ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«å®Ÿè¡Œ
const recordManager = new window.Tegaki.RecordManager();
recordManager.configure({});
recordManager.attach({});
recordManager.init();
```

### ğŸ“‹ Priority 3: EventBusé€£æºãƒ»ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚¢ã‚¤ã‚³ãƒ³å¾©æ—§

#### ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚¢ã‚¤ã‚³ãƒ³éè¡¨ç¤ºã®åŸå› 
1. `app:ready` ã‚¤ãƒ™ãƒ³ãƒˆæœªç™ºç«
2. EventBus ãŒ Managerçµ±åˆã«å«ã¾ã‚Œã¦ã„ãªã„å¯èƒ½æ€§
3. TegakiIcons ã‚·ã‚¹ãƒ†ãƒ ã®èµ·å‹•ã‚¿ã‚¤ãƒŸãƒ³ã‚°å•é¡Œ

#### ä¿®æ­£ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
```javascript
// AppCore å®Œäº†å¾Œã« app:ready ã‚¤ãƒ™ãƒ³ãƒˆç¢ºå®Ÿç™ºç«
async startV8System() {
    // ... ManageråˆæœŸåŒ–å®Œäº†å¾Œ
    this.emitAppReady(); // EventBusçµŒç”±ã§é€šçŸ¥
}

emitAppReady() {
    if (window.Tegaki?.EventBusInstance?.emit) {
        window.Tegaki.EventBusInstance.emit('app:ready', {
            timestamp: Date.now(),
            managers: Array.from(this.managers.keys())
        });
        console.log('ğŸ‰ app:ready ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«');
    }
}
```

---

## ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«ä¿®æ­£è¨ˆç”»

### ğŸ”§ js/app-core.jsï¼ˆãƒ¡ã‚¤ãƒ³ä¿®æ­£ï¼‰

**ä¿®æ­£ç®‡æ‰€:**
1. `createAndRegisterBasicManagers()` - å…¨Manager ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«å®Ÿè¡Œ
2. `initializeV8Managers()` Step 3 - CoordinateManager ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«è¿½åŠ 
3. `emitAppReady()` - EventBusé€£æºå¼·åŒ–

**è¿½åŠ æ©Ÿèƒ½:**
- Manager ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ä¸€æ‹¬å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ 
- EventBus çµ±åˆç¢ºèªãƒ»app:ready ç¢ºå®Ÿç™ºç«
- CoordinateManager å°‚ç”¨åˆæœŸåŒ–ã‚·ãƒ¼ã‚±ãƒ³ã‚¹

### ğŸ”§ js/tegaki-application.jsï¼ˆè»½å¾®ä¿®æ­£ï¼‰

**ä¿®æ­£ç®‡æ‰€:**
- åˆæœŸåŒ–ã‚¹ãƒ†ãƒƒãƒ—é‡è¤‡å•é¡Œä¿®æ­£
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–

### ğŸ”§ assets/icons.jsï¼ˆç¢ºèªè¦ï¼‰

**ãƒã‚§ãƒƒã‚¯é …ç›®:**
- EventBus 'app:ready' ãƒªã‚¹ãƒŠãƒ¼å­˜åœ¨ç¢ºèª
- `replaceAllToolIcons()` å‹•ä½œç¢ºèª
- DOMè¦ç´ å­˜åœ¨ç¢ºèªï¼ˆsidebarè¦ç´ ç­‰ï¼‰

---

## ğŸš€ ä¿®æ­£å®Ÿæ–½æ‰‹é †

### 1ï¸âƒ£ ãƒ•ã‚¡ã‚¤ãƒ«ç½®ãæ›ãˆå®Ÿæ–½

**js/app-core.js:**
- ä¸Šè¨˜ã®ä¿®æ­£ç‰ˆ AppCore ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«é©ç”¨

**ç¢ºèªã‚³ãƒãƒ³ãƒ‰:**
```javascript
// ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å®Ÿè¡Œ
console.log('CoordinateManager Status:', 
  window.Tegaki?.CoordinateManagerInstance?.getDebugInfo?.());
```

### 2ï¸âƒ£ å‹•ä½œç¢ºèª

**æœŸå¾…çµæœ:**
```json
{
  "lifecycle": {
    "configured": true,  // âœ… ä¿®æ­£å¾Œ
    "attached": true,    // âœ… ä¿®æ­£å¾Œ
    "initialized": true, // âœ… ä¿®æ­£å¾Œ
    "ready": true       // âœ… ä¿®æ­£å¾Œ
  }
}
```

**ã‚µã‚¤ãƒ‰ãƒãƒ¼è¡¨ç¤ºç¢ºèª:**
```javascript
// ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç¢ºèª
console.log('EventBus app:ready fired:', 
  !!document.querySelector('#pen-tool, #eraser-tool'));
```

### 3ï¸âƒ£ æç”»å‹•ä½œç¢ºèª

**ãƒ†ã‚¹ãƒˆæ‰‹é †:**
1. ãƒšãƒ³ãƒ„ãƒ¼ãƒ«ã‚¯ãƒªãƒƒã‚¯ â†’ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ç¢ºèª
2. ã‚­ãƒ£ãƒ³ãƒã‚¹ä¸Šã§ãƒ‰ãƒ©ãƒƒã‚° â†’ æç”»ã•ã‚Œã‚‹
3. åº§æ¨™è¡¨ç¤º â†’ (0,0)ä»˜è¿‘ã§æ­£ç¢º
4. æ¶ˆã—ã‚´ãƒ ãƒ„ãƒ¼ãƒ« â†’ åˆ‡ã‚Šæ›¿ãˆãƒ»å‹•ä½œç¢ºèª

---

## ğŸ“Š ä¿®æ­£åŠ¹æœäºˆæ¸¬

### âœ… è§£æ±ºã•ã‚Œã‚‹å•é¡Œ

1. **CoordinateManager readyçŠ¶æ…‹** â†’ `true`
2. **Managerçµ±ä¸€ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«** â†’ å…¨Manageræº–æ‹ 
3. **ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚¢ã‚¤ã‚³ãƒ³** â†’ è¡¨ç¤ºå¾©æ—§
4. **åº§æ¨™(x0,y0)å•é¡Œ** â†’ æ­£ç¢ºè¡¨ç¤º
5. **ãƒ„ãƒ¼ãƒ«åˆ‡ã‚Šæ›¿ãˆ** â†’ æ­£å¸¸å‹•ä½œ
6. **æ¶ˆã—ã‚´ãƒ æ©Ÿèƒ½** â†’ å¾©æ´»

### ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š

- **åˆæœŸåŒ–æ™‚é–“**: çŸ­ç¸®ï¼ˆä¸è¦ãªå†è©¦è¡Œå‰Šæ¸›ï¼‰
- **ã‚¨ãƒ©ãƒ¼ç‡**: å¤§å¹…æ¸›å°‘ï¼ˆãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«æº–æ‹ ï¼‰
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨**: å®‰å®šåŒ–ï¼ˆManagerçŠ¶æ…‹ç®¡ç†çµ±ä¸€ï¼‰

### ğŸ” æ®‹å­˜ãƒªã‚¹ã‚¯ãƒ»å¯¾å¿œ

**Low Risk:**
- ä»–Managerï¼ˆNavigationManagerç­‰ï¼‰ã®åˆæœŸåŒ–é †åº
- Toolå®Ÿè£…ã® Managerä¾å­˜é–¢ä¿‚

**å¯¾å¿œç­–:**
- æ®µéšçš„ ManageråˆæœŸåŒ–ç¶™ç¶š
- ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã«ã‚ˆã‚‹çŠ¶æ…‹ç›£è¦–å¼·åŒ–

---

## ğŸ¯ æ¬¡ãƒ•ã‚§ãƒ¼ã‚ºæº–å‚™

### Phase 2 æº–å‚™é …ç›®

1. **ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…**
   - layer0ï¼ˆèƒŒæ™¯ï¼‰/layer1ï¼ˆæç”»ï¼‰åˆ†é›¢å®Œæˆ
   - é€æ˜å¸‚æ¾æ¨¡æ§˜ï¼ˆPhotoshopé¢¨ï¼‰å®Ÿè£…

2. **æç”»ã‚¨ãƒ³ã‚¸ãƒ³æœ€é©åŒ–**
   - ãƒšãƒ³åœ§åŠ›å¯¾å¿œãƒ»ãƒ™ã‚¯ã‚¿ãƒ¼æç”»ç²¾åº¦å‘ä¸Š
   - å¤§é‡ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯æ€§èƒ½æœ€é©åŒ–

3. **UI/UX æ”¹å–„**
   - ãƒ„ãƒ¼ãƒ«ãƒ‘ãƒ¬ãƒƒãƒˆæ‹¡å¼µ
   - ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼å®Ÿè£…
   - Canvaså¤–ã‹ã‚‰ã®ãƒšãƒ³å…¥åŠ›å¯¾å¿œï¼ˆã‚¯ãƒªã‚¹ã‚¿é¢¨ï¼‰

### æŠ€è¡“è² å‚µè§£æ¶ˆ

1. **æ¶ç©ºãƒ¡ã‚½ãƒƒãƒ‰é˜²æ­¢ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨åŒ–**
2. **Managerå¥‘ç´„ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–**
3. **åº§æ¨™ç³»çµ±ä¸€åŒ–ãƒ»DPRå‡¦ç†æœ€é©åŒ–**

---

## ğŸ‰ æœŸå¾…ã•ã‚Œã‚‹æœ€çµ‚çŠ¶æ…‹

**ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³:**
```
ğŸŸ¢ PixiJS v8.12.0 - WebGL2/WebGPU
ğŸŸ¢ Canvas: 400x400 - æ ãªã—è¡¨ç¤º
ğŸŸ¢ Managerç¾¤: å…¨ã¦ ready=true
ğŸŸ¢ CoordinateManager: lifecycleå®Œäº†
ğŸŸ¢ ã‚µã‚¤ãƒ‰ãƒãƒ¼: ãƒšãƒ³ãƒ»æ¶ˆã—ã‚´ãƒ ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º
ğŸŸ¢ ãƒ„ãƒ¼ãƒ«åˆ‡ã‚Šæ›¿ãˆ: æ­£å¸¸å‹•ä½œ
ğŸŸ¢ æç”»æ©Ÿèƒ½: ãƒšãƒ³æç”»ãƒ»æ¶ˆå»å‹•ä½œ
ğŸŸ¢ åº§æ¨™ç²¾åº¦: (0,0)æ­£ç¢ºè¡¨ç¤ºãƒ»ã‚ªãƒ•ã‚»ãƒƒãƒˆè§£æ±º
```

**ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ï¼ˆæˆåŠŸæ™‚ï¼‰:**
```
âœ… AppCore v8ã‚·ã‚¹ãƒ†ãƒ å®Œäº†
ğŸ“Š PixiJS 8.12.0 | webgl | Manageræ•°: 7
ğŸ‰ app:ready ã‚¤ãƒ™ãƒ³ãƒˆç™ºç« - UIåˆæœŸåŒ–é–‹å§‹  
âœ… TegakiApplication åˆæœŸåŒ–å®Œäº† (< 1000ms)
```

ã“ã‚Œã‚‰ã®ä¿®æ­£ã«ã‚ˆã‚Šã€Tegaki v8 Phase1.5 ã¯å®Œå…¨å®‰å®šå‹•ä½œã‚’å®Ÿç¾ã—ã€Phase2ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ»ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼‰å®Ÿè£…ã¸ã®æº–å‚™ãŒæ•´ã„ã¾ã™ã€‚