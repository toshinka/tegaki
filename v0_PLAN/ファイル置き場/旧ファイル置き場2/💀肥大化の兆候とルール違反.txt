=== Tegaki v8 改修計画表（Phase1.5 → Phase2 移行準備）===

目的:
- エラー回避やデバッグ強化で肥大化したコードを整理
- ルールブック（責任分離・非冗長化・非依存肥大化）に即した形へ再統合
- ペン描画不具合の根本解決と将来拡張の土台作り

------------------------------------------------------------
1. ログ出力の簡素化
------------------------------------------------------------
[現状問題]
- Managerごとに多段階ログ（開始・method確認・注入確認・完了など）が冗長
- PixiJS内部構造(JSON.stringify)まで直列化して循環参照エラー発生

[改修方針]
- ログは「開始」「完了」のみ残す
- 内部構造は出さず、以下のキー情報のみ出力
  className, version, status("ready"/"error"), 必須Manager注入の有無
- AppCore.verifyManagerReady は safeStringifyを使うのではなく
  "必要なキーのみ抽出" に切り替える

------------------------------------------------------------
2. configure() 呼び出し設計の修正
------------------------------------------------------------
[現状問題]
- RecordManager / ConfigManager が configure() を持たないのに呼び出しを強制
- 警告ログが氾濫し肥大化

[改修方針]
- AppCore で Manager登録時に "configure存在チェック" を実装
- configure() 不要なManagerは呼び出さない
- 空スタブは廃止、責任は呼び出し側(AppCore)に限定する

------------------------------------------------------------
3. 初期化の二重実行防止
------------------------------------------------------------
[現状問題]
- Canvas作成処理が2回走り「Canvas作成完了(2)」と冗長化
- 同一Managerの重複初期化リスクあり

[改修方針]
- AppCore.initializeV8Managers に "isInitializedフラグ" を追加
- trueの場合は即returnで二重初期化を防止
- 各Managerも _status を内部に持ち、二重呼び出しをガード

------------------------------------------------------------
4. verifyManagerReady の再設計
------------------------------------------------------------
[現状問題]
- JSON.stringifyでPixiJSオブジェクト(root, renderGroup)を含め循環参照エラー
- 初期化が未完了扱いになり、描画ツールが無効化される

[改修方針]
- 出力対象を "managerInfoの基本属性" に限定
  className, version, isReady, requiredDepsのみ
- PixiJSオブジェクトはログ対象から除外
- JSON.stringifyは廃止し、独自にフォーマット出力

------------------------------------------------------------
5. 描画テストの復帰
------------------------------------------------------------
[現状問題]
- 初期化失敗によりPenToolのpointerイベントが無効
- runPhase15Test() が無意味状態

[改修方針]
- 上記修正後にrunPhase15Test()を実行し動作確認
- 描画系イベント (pointerdown→addStroke→draw) が正しく走るかを確認
- デバッグログは成功時 "描画イベント受信完了" までに限定する

------------------------------------------------------------
6. 今後の肥大化防止ルール
------------------------------------------------------------
- Managerは「開始」「完了」以外の冗長ログ禁止
- PixiJS内部構造をログに含めない
- configure()必須か否かをManager定義側に明記
- AppCoreは「初期化制御と依存解決」のみに責任を持つ
- デバッグ目的のtry/catch強化は許可するが、永続化しない

------------------------------------------------------------
実施順序
1. AppCore.verifyManagerReady を修正（JSON.stringify廃止）
2. AppCore.createAndRegisterBasicManagers を修正（configure存在チェック追加）
3. 各Managerに二重初期化防止フラグ追加
4. 冗長ログ削減（開始・完了のみ残す）
5. runPhase15Test() で描画テスト実施
6. 不要なスタブや仮処理を削除してソースを軽量化

=== 完了目標 ===
- ペン描画が正常に可能になる
- 循環参照エラーが発生しない
- ルールブック準拠のシンプル構造に戻る
