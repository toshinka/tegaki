==========================
ğŸ›  æ”¹ä¿®æ‰‹é †æ›¸ï¼ˆPhase1.4stepEXï¼‰
==========================

ç›®çš„:
- ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¾å­˜ã®è§£æ¶ˆ â†’ window.Tegaki åå‰ç©ºé–“ã«çµ±ä¸€
- ãƒ­ãƒ¼ãƒ‰é †åºä¾å­˜ã®ç·©å’Œ â†’ åˆæœŸåŒ–ãƒ¬ã‚¸ã‚¹ãƒˆãƒª _registry æ–¹å¼ã‚’å°å…¥
- æ§‹æ–‡å®Œæ•´æ€§ã®æ‹…ä¿ â†’ catch æ–‡ä¿®æ­£ã¨æœªå®šç¾©å‚ç…§å¯¾ç­–

å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«:
- js/utils/error-manager.js
- js/utils/config-manager.js
- js/utils/state-manager.js
- js/utils/event-bus.js
- js/utils/coordinate-manager.js
- js/utils/icon-manager.js
- js/utils/performance.js
- managers/*.js
- tools/abstract-tool.js
- tools/pen-tool.js
- tools/eraser-tool.js
- js/main.js
- index.html

==========================
ãƒ•ã‚¡ã‚¤ãƒ«é››å½¢ãƒ«ãƒ¼ãƒ«
==========================
1. å„ãƒ•ã‚¡ã‚¤ãƒ«ã®å†’é ­ã«:
   window.Tegaki = window.Tegaki || {};

2. ã‚¯ãƒ©ã‚¹å®šç¾©ã¯:
   class ClassName { ... }
   Tegaki.ClassName = ClassName;

3. ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã¯åˆæœŸåŒ–ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¸:
   Tegaki._registry = Tegaki._registry || [];
   Tegaki._registry.push(() => {
     Tegaki.ClassNameInstance = new Tegaki.ClassName();
   });

==========================
å…·ä½“çš„ãªä¿®æ­£ä¾‹
==========================

(1) error-manager.js
--------------------------
window.Tegaki = window.Tegaki || {};

class ErrorManager {
  handle(error) { console.error("[ErrorManager]", error); }
  getLastError() { return this.lastError; }
}
Tegaki.ErrorManager = ErrorManager;

Tegaki._registry = Tegaki._registry || [];
Tegaki._registry.push(() => {
  Tegaki.ErrorManagerInstance = new Tegaki.ErrorManager();
});

(2) config-manager.js
--------------------------
window.Tegaki = window.Tegaki || {};

class ConfigManager {
  getDebugInfo() { return { version: "Phase1.4EX", mode: "dev" }; }
}
Tegaki.ConfigManager = ConfigManager;

Tegaki._registry = Tegaki._registry || [];
Tegaki._registry.push(() => {
  Tegaki.ConfigManagerInstance = new Tegaki.ConfigManager();
});

(3) abstract-tool.js
--------------------------
window.Tegaki = window.Tegaki || {};

class AbstractTool {
  onPointerDown() {}
  onPointerMove() {}
  onPointerUp() {}
}
Tegaki.AbstractTool = AbstractTool;

// catch ä¿®æ­£æ¸ˆã¿
try {
  // ...
} catch (e) {
  // ã‚¨ãƒ©ãƒ¼å‡¦ç†
}

(4) pen-tool.js
--------------------------
window.Tegaki = window.Tegaki || {};

class PenTool extends Tegaki.AbstractTool {
  onPointerDown() {}
  onPointerMove() {}
  onPointerUp() {}
  drawLine() {}
}
Tegaki.PenTool = PenTool;

Tegaki._registry = Tegaki._registry || [];
Tegaki._registry.push(() => {
  Tegaki.PenToolInstance = new Tegaki.PenTool();
});

(5) eraser-tool.js
--------------------------
window.Tegaki = window.Tegaki || {};

class EraserTool extends Tegaki.AbstractTool {
  onPointerDown() {}
  onPointerMove() {}
  onPointerUp() {}
}
Tegaki.EraserTool = EraserTool;

Tegaki._registry = Tegaki._registry || [];
Tegaki._registry.push(() => {
  Tegaki.EraserToolInstance = new Tegaki.EraserTool();
});

(6) main.js
--------------------------
window.Tegaki = window.Tegaki || {};

class TegakiApplication {
  async initialize() {
    this.initializeCanvasSystem();
    this.registerTools();
    this.bindEvents();
  }

  initializeCanvasSystem() {
    const container = document.querySelector("#canvas-container");
    if (!container) throw new Error("Canvas container (#canvas-container) ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
    // CanvasManager ã‚’åˆ©ç”¨
    Tegaki.CanvasManagerInstance.initialize(container);
  }

  registerTools() {
    Tegaki.ToolManagerInstance.setTool("pen");
  }

  bindEvents() {
    // ä¾‹: pointerdown ã‚’ EventBus çµŒç”±ã§é€šçŸ¥
    container.addEventListener("pointerdown", e => {
      Tegaki.EventBusInstance.emit("pointerdown", e);
    });
  }
}
Tegaki.TegakiApplication = TegakiApplication;

document.addEventListener("DOMContentLoaded", async () => {
  try {
    if (Tegaki._registry) {
      Tegaki._registry.forEach(init => init());
      delete Tegaki._registry;
    }
    const app = new Tegaki.TegakiApplication();
    await app.initialize();
    Tegaki.AppInstance = app;
  } catch (e) {
    if (Tegaki.ErrorManagerInstance) {
      Tegaki.ErrorManagerInstance.handle(e);
    } else {
      console.error("Fatal Error:", e);
    }
  }
});

(7) index.html
--------------------------
<body>
  <div id="canvas-container"></div>

  <!-- utils -->
  <script src="js/utils/error-manager.js"></script>
  <script src="js/utils/config-manager.js"></script>
  <script src="js/utils/state-manager.js"></script>
  <script src="js/utils/event-bus.js"></script>
  <script src="js/utils/coordinate-manager.js"></script>
  <script src="js/utils/icon-manager.js"></script>
  <script src="js/utils/performance.js"></script>

  <!-- managers -->
  <script src="managers/canvas-manager.js"></script>
  <script src="managers/tool-manager.js"></script>
  <script src="managers/memory-manager.js"></script>
  <script src="managers/settings-manager.js"></script>
  <script src="managers/boundary-manager.js"></script>
  <script src="managers/ui-manager.js"></script>

  <!-- tools -->
  <script src="tools/abstract-tool.js"></script>
  <script src="tools/pen-tool.js"></script>
  <script src="tools/eraser-tool.js"></script>

  <!-- app core -->
  <script src="js/app-core.js"></script>
  <script src="js/main.js"></script>
</body>

==========================
åˆ©ç”¨ã™ã‚‹ã‚·ãƒ³ãƒœãƒ«ä¸€è¦§
==========================
Tegaki.ErrorManagerInstance.handle(error)
Tegaki.ConfigManagerInstance.getDebugInfo()
Tegaki.StateManagerInstance.getState(key), setState(key,val)
Tegaki.EventBusInstance.on(event,cb), emit(event,data)
Tegaki.CanvasManagerInstance.initialize(container), addLayer(name)
Tegaki.ToolManagerInstance.setTool(name), apply(event)
Tegaki.PenToolInstance.onPointerDown(), onPointerMove()
Tegaki.EraserToolInstance.onPointerDown(), onPointerMove()
