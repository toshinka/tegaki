# ğŸ¨ Tegaki Tool æ”¹ä¿®åˆ†æ & æ‰‹é †æ›¸ï¼ˆPhase1.4stepEX3ï¼‰

## 1. ç†æƒ³ãƒ¢ãƒ‡ãƒ«ï¼ˆå†æ²ï¼‰

ç†æƒ³ã®ãƒ•ãƒ­ãƒ¼ã¯æ¬¡ã®ã‚ˆã†ãªä¸€æœ¬ç­‹ï¼š

å…¥åŠ› (mouse/touch)  
   â†’ ToolManagerï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ„ãƒ¼ãƒ«ã¸å§”è­²ï¼‰  
      â†’ Toolï¼ˆPen/Eraser â€¦ï¼‰  
         â†’ EventBusï¼ˆæç”»å‘½ä»¤ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºè¡Œï¼‰  
            â†’ CanvasManagerï¼ˆæç”»ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«é©ç”¨ï¼‰  
               â†’ StateManagerï¼ˆå±¥æ­´ã¨ã—ã¦è¨˜éŒ²ï¼‰  
                  â†’ ErrorManagerï¼ˆå¾©æ—§å¯èƒ½ãªã‚¨ãƒ©ãƒ¼å‡¦ç†ï¼‰

---

## 2. ç¾çŠ¶ã¨ã®å·®åˆ†ï¼ˆv1_Phase1.4stepEX3ï¼‰

### âœ… è‰¯ã„ç‚¹
- æŠ½è±¡åŒ–ãƒ„ãƒ¼ãƒ«ã‚¯ãƒ©ã‚¹ï¼ˆabstract-tool.jsï¼‰ãŒå­˜åœ¨ã—ã€ãƒšãƒ³ãƒ»æ¶ˆã—ã‚´ãƒ ãŒç¶™æ‰¿ã—ã¦ã„ã‚‹ã€‚  
- EventBus / StateManager / ErrorManager ãŒå°å…¥æ¸ˆã¿ã€‚  
- CanvasManager ãŒ PixiJS ã®ã‚¹ãƒ†ãƒ¼ã‚¸ç®¡ç†ã‚’æ‹…ã†ã€‚  
- UI ã¨ãƒ­ã‚¸ãƒƒã‚¯ã®åˆ†é›¢ï¼ˆUIManager / PopupManager / SliderManagerï¼‰ãŒé€²ã‚“ã§ã„ã‚‹ã€‚  

### âš  å·®åˆ†ãƒ»èª²é¡Œ
1. **å…¥åŠ› â†’ ãƒ„ãƒ¼ãƒ«**  
   - main.js ã«ã¾ã ç›´æ¥ pointerdown/pointermove ã‚’ãƒã‚¤ãƒ³ãƒ‰ã—ã¦ã„ã‚‹ç®‡æ‰€ã‚ã‚Šã€‚  
   - æœ¬æ¥ã¯ ToolManager ã‚’çµŒç”±ã™ã¹ãã€‚

2. **ãƒ„ãƒ¼ãƒ« â†’ EventBus**  
   - PenTool ã‚„ EraserTool ãŒ CanvasManager ã‚’ç›´æ¥å‘¼ã‚“ã§ã„ã‚‹éƒ¨åˆ†ã‚ã‚Šã€‚  
   - å‘½ä»¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆDrawCommand çš„ãªã‚‚ã®ï¼‰ã‚’ EventBus ã«ç™ºè¡Œã™ã‚‹å½¢ã«ãªã£ã¦ã„ãªã„ã€‚

3. **EventBus â†’ StateManager**  
   - StateManager ãŒã€Œè¨­å®šä¿å­˜ã€å¯„ã‚Šã§ã€æç”»ã‚¤ãƒ™ãƒ³ãƒˆã®å±¥æ­´ã¯æœªå®Ÿè£…ã€‚  
   - Undo/Redo ã®ä¸‹åœ°ãŒä¸è¶³ã€‚

4. **ErrorManager**  
   - console.error ãŒå¤šç”¨ã•ã‚Œã€ãƒ•ãƒ­ãƒ¼å¾©æ—§å‡¦ç†ã«çµ±åˆã•ã‚Œã¦ã„ãªã„ã€‚

5. **CSS/HTML**  
   - index.html å†…ã«ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ãŒæ•£è¦‹ã•ã‚Œã€styles.css ã¸é›†ç´„ã•ã‚Œã¦ã„ãªã„ï¼ˆDRY/SOLID çš„ã«èª²é¡Œï¼‰ã€‚

---

## 3. æ”¹ä¿®æ‰‹é †æ›¸ï¼ˆçŸ­æœŸå®‰å®š â†’ ä¸­æœŸåŸºç›¤å¼·åŒ–ï¼‰

### ğŸ¥‡ Step 1: å…¥åŠ›ãƒ•ãƒ­ãƒ¼ã®çµ±ä¸€
- [ ] main.js ã§ã® pointerdown ç­‰ã®ç›´æ¥å‡¦ç†ã‚’å‰Šé™¤ã€‚  
- [ ] ä»£ã‚ã‚Šã« ToolManager.handlePointerDown/Move/Up ã‚’å‘¼ã¶ã€‚  
- [ ] ToolManager å†…ã§ç¾åœ¨ã®ãƒ„ãƒ¼ãƒ« (PenTool ãªã©) ã«å§”è­²ã™ã‚‹ã€‚  

ğŸ‘‰ åŠ¹æœ: å…¥åŠ›å‡¦ç†ãŒå¸¸ã« ToolManager çµŒç”±ã«ãªã‚Šã€ç›´æ¥æç”»ã¨ã®æ··åœ¨ãŒæ¶ˆãˆã‚‹ã€‚

---

### ğŸ¥ˆ Step 2: ãƒ„ãƒ¼ãƒ«ã‹ã‚‰ã®æç”»å‘½ä»¤ã‚’ EventBus çµŒç”±ã«ã™ã‚‹
- [ ] PenTool / EraserTool ã¯ CanvasManager ã‚’ç›´æ¥è§¦ã‚‰ãšã€ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œã«å°‚å¿µã™ã‚‹ã€‚  
  ä¾‹:  

EventBus.emit('draw:stroke', { tool: 'pen', points, color, size });

- [ ] CanvasManager ãŒ EventBus.on('draw:stroke') ã‚’è³¼èª­ã—ã€æç”»ã‚’åæ˜ ã™ã‚‹ã€‚  

ğŸ‘‰ åŠ¹æœ: æç”»çµŒè·¯ãŒä¸€æœ¬åŒ–ã•ã‚Œã€ãƒ­ã‚°åé›†ãƒ»å±¥æ­´ä¿å­˜ãƒ»ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå®¹æ˜“ã«ãªã‚‹ã€‚

---

### ğŸ¥‰ Step 3: StateManager ã«æç”»å±¥æ­´ã‚’è¿½åŠ 
- [ ] StateManager ã« pushAction(action) / undo() / redo() ã‚’å®Ÿè£…ã€‚  
- [ ] CanvasManager ãŒæç”»ã‚’é©ç”¨ã™ã‚‹ãŸã³ã« StateManager ã«è¨˜éŒ²ã€‚  
- [ ] Ctrl+Z / Ctrl+Y ã§æ“ä½œå¯èƒ½ã«ã™ã‚‹ã€‚  

ğŸ‘‰ åŠ¹æœ: Undo/Redo ãŒè‡ªç„¶ã«æ‹¡å¼µå¯èƒ½ã«ãªã‚Šã€å¾Œã€…ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼æ“ä½œã«ã‚‚å¯¾å¿œã§ãã‚‹ã€‚

---

### ğŸ… Step 4: ErrorManager ã‚’æç”»ãƒ•ãƒ­ãƒ¼ã«çµ±åˆ
- [ ] PenTool ã‚„ EraserTool å†…ã® console.error ã‚’æ’é™¤ã€‚  
- [ ] ä»£ã‚ã‚Šã« ErrorManager.handle(error, context) ã‚’å‘¼ã¶ã€‚  
- [ ] ä¾‹: NaN åº§æ¨™ãªã‚‰ã€Œã‚¹ã‚­ãƒƒãƒ—ã€ã‚¤ãƒ™ãƒ³ãƒˆã‚’ EventBus ã«é€šçŸ¥ã€‚  

ğŸ‘‰ åŠ¹æœ: ç•°å¸¸ãŒç™ºç”Ÿã—ã¦ã‚‚æç”»ãŒæ­¢ã¾ã‚‰ãšã€å®‰å…¨ã«ç¶™ç¶šã§ãã‚‹ã€‚

---

### ğŸ† Step 5: CSS ã®é›†ç´„
- [ ] index.html ã«æ®‹å­˜ã™ã‚‹ style="..." ã‚’ styles.css ã«ç§»æ¤ã€‚  
- [ ] Tabler Icons ãªã©å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã®è¡¨ç¤ºåˆ¶å¾¡ã‚‚ã‚¯ãƒ©ã‚¹æŒ‡å®š + CSS ã§çµ±ä¸€ã€‚  

ğŸ‘‰ åŠ¹æœ: HTML ãŒãƒ­ã‚¸ãƒƒã‚¯ã¨ UI æ§‹é€ ã«å°‚å¿µã§ãã€CSS ãŒè¦‹é€šã—ã‚ˆããªã‚‹ã€‚

---

## 4. æœ€çµ‚åƒï¼ˆç›®æ¨™ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼‰

[Pointer Input]  
 â†’ ToolManager  
    â†’ Tool(Pen/Eraser/â€¦)  
       â†’ EventBus ("draw:stroke", "draw:end", â€¦)  
          â†’ CanvasManager (PixiJS stage, layerç®¡ç†)  
             â†’ StateManager (Undo/Redo, replay)  
                â†” ErrorManager (ä¾‹å¤–å¾©æ—§)

---

## 5. æ¨å¥¨é€²ã‚æ–¹
1. Step1ï¼ˆå…¥åŠ›çµ±ä¸€ï¼‰ã ã‘ã‚’å…ˆã«ã‚„ã‚‹ â†’ ãƒšãƒ³å¾©å¸°ã®å®‰å®šç‰ˆãŒå‹•ãã€‚  
2. Step2ï¼ˆEventBusçµŒç”±åŒ–ï¼‰ â†’ ãƒ¬ã‚¤ãƒ¤ãƒ¼å¯¾å¿œã‚„å±¥æ­´å¯¾å¿œã®å¸ƒçŸ³ã«ãªã‚‹ã€‚  
3. Step3ä»¥é™ã¯æ®µéšçš„ã«è¿½åŠ ã—ã¦ã‚ˆã„ï¼ˆå¾Œæˆ»ã‚ŠãŒå°‘ãªããªã‚‹ï¼‰ã€‚  

---

ğŸ“Œ ã¾ã¨ã‚ã‚‹ã¨ï¼š  
- ä»Šã¯ã€Œãƒšãƒ³å¾©å¸°ã€ã‚’æ€¥ãã‚ˆã‚Šã€Step1 ã®ã€Œå…¥åŠ›çµ±ä¸€ã€ã‹ã‚‰å…¥ã‚‹ã®ãŒæ­£è§£ã€‚  
- ãã®å¾Œ Step2 ã§ EventBus çµŒç”±ã«åˆ‡ã‚Šæ›¿ãˆã‚Œã°ã€Undo/Redo ã‚„ãƒ¬ã‚¤ãƒ¤ãƒ¼è¿½åŠ ã«ã‚‚è€ãˆã‚‰ã‚Œã‚‹åŸºç›¤ãŒã§ãã¾ã™ã€‚



