ğŸ“Œ ç›®çš„

æœ¬è¨ˆç”»æ›¸ã¯ã€Tegakiãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆæ•´ç†ã€è²¬å‹™æ˜ç¢ºåŒ–ã€ãŠã‚ˆã³STEP1/STEP2ã®ä½œæ¥­è¨ˆç”» ã‚’ç¤ºã—ã¾ã™ã€‚

æ•™ç§‘æ›¸ v12 ã«åŸºã¥ãã€å„Managerãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»Canvasã®è²¬å‹™ã‚’æ˜ç¢ºã«ã—ãŸä¸Šã§ã€Phaseã”ã¨ã®ä½œæ¥­ã‚¹ãƒ†ãƒƒãƒ—ã‚’æ•´ç†ã—ã¦ã„ã¾ã™ã€‚ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã¯è£œè¶³ã¨ã—ã¦å°†æ¥æ‹¡å¼µã®ãŸã‚ã«è»½ãè§¦ã‚Œã¦ã„ã¾ã™ã€‚

1. å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã¨è²¬å‹™

abstract-tool.js: ãƒ„ãƒ¼ãƒ«å…±é€šæŠ½è±¡ã‚¯ãƒ©ã‚¹ï¼ˆã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ç®¡ç†ï¼‰

pen-tool.js / eraser-tool.js: ãƒ„ãƒ¼ãƒ«å›ºæœ‰ã®æç”»å‡¦ç†

tool-manager.js: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ„ãƒ¼ãƒ«ç®¡ç†ã€EventBusçµŒç”±ã§CanvasManagerã¸ä¼é”

canvas-manager.js: å®Ÿéš›ã®æç”»ã€stage.position/scaleç®¡ç†ã€Pointerã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†

memory-manager.js: Undo/Redoç®¡ç†

state-manager.js: ç¾åœ¨çŠ¶æ…‹ç®¡ç†

settings-manager.js: ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šç®¡ç†

boundary-manager.js: æç”»ç¯„å›²ç®¡ç†

ui-manager.js / popup-manager.js / slider-manager.js: UIè¡¨ç¤ºãƒ»æ“ä½œç®¡ç†

coordinate-manager.js: å…¥åŠ›åº§æ¨™è£œæ­£ã€ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆå¯¾å¿œ

icon-manager.js: ãƒ„ãƒ¼ãƒ«ãƒ»UIã‚¢ã‚¤ã‚³ãƒ³ç®¡ç†

config-manager.js: è¨­å®šå€¤ã®ä¿å­˜/èª­ã¿è¾¼ã¿

event-bus.js: Manageré–“ç–çµåˆé€šä¿¡

error-manager.js: ã‚¨ãƒ©ãƒ¼/ä¾‹å¤–å‡¦ç†

ã‚·ãƒ³ãƒœãƒ«å®šç¾©ä¾‹

AbstractTool.startStroke(point) / addPoint(point) / endStroke(point)

CanvasManager.pan(dx,dy) / setZoom(scale, centerPoint) / resetView()

EventBusã‚¤ãƒ™ãƒ³ãƒˆä¾‹: tool:change, canvas:pan, shortcut:*

MemoryManager.undo()/redo()/saveSnapshot()

LayerManagerï¼ˆSTEP2å°å…¥äºˆå®šï¼‰: addLayer() / removeLayer() / moveLayer()

2. ãƒ•ã‚¡ã‚¤ãƒ«é–“ãƒ•ãƒ­ãƒ¼ï¼ˆãƒšãƒ³æç”»æ™‚ï¼‰

PointerDown â†’ CanvasManager ãŒå—ã‘å–ã‚‹

CanvasManager â†’ ToolManager.activeTool.startStroke(point)

Toolï¼ˆPenToolï¼‰ãŒåº§æ¨™è£œæ­£ â†’ CanvasManagerã«æç”»å‘½ä»¤

PointerMove â†’ Tool.addPoint â†’ CanvasManageræç”»

PointerUp â†’ Tool.endStroke â†’ MemoryManager.saveSnapshot

UIãƒ»çŠ¶æ…‹æ›´æ–°ã¯EventBusçµŒç”±

3. STEPè¨ˆç”»
STEP1: åŸºæœ¬æç”»å®‰å®šåŒ–ãƒ»æº–å‚™

ãƒšãƒ³ãƒ»æ¶ˆã—ã‚´ãƒ ãƒ„ãƒ¼ãƒ«ã®å®‰å®šåŒ–

CanvasManageræ•´å‚™ï¼ˆposition/scaleç®¡ç†ï¼‰

EventBusã«ã‚ˆã‚‹ç–çµåˆè¨­è¨ˆ

ShortcutManagerãƒ•ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆæº–å‚™ï¼ˆå®Ÿè£…ã¯å¾Œå›ã—ï¼‰

åº§æ¨™è£œæ­£ãƒ»Pointerã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ç¢ºèª

STEP2: ãƒ¬ã‚¤ãƒ¤ãƒ¼å®Ÿè£…ãƒ»æ“ä½œå¼·åŒ–

LayerManagerå°å…¥

ãƒ¬ã‚¤ãƒ¤ãƒ¼å˜ä½ã§æç”»æŒ‡ç¤ºã‚’åˆ†é›¢

ãƒ¬ã‚¤ãƒ¤ãƒ¼æ“ä½œã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼ˆâ†‘/â†“, æ–°è¦/å‰Šé™¤ãªã©ï¼‰æº–å‚™

Canvasæ“ä½œï¼ˆæ‹¡ç¸®ãƒ»å›è»¢ï¼‰æ‹¡å¼µ

ãƒ„ãƒ¼ãƒ«åˆ‡æ›¿ãƒ»ãƒ—ãƒªã‚»ãƒƒãƒˆç®¡ç†ã®å®‰å®šåŒ–

STEP3ä»¥é™ï¼ˆè£œè¶³ãƒ»å°†æ¥æ‹¡å¼µï¼‰

ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½è¿½åŠ 

é«˜åº¦ãªãƒ¬ã‚¤ãƒ¤ãƒ¼ç·¨é›†ï¼ˆGPUæœ€é©åŒ–ï¼‰

ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆè©³ç´°ãƒãƒƒãƒ”ãƒ³ã‚°å®Ÿè£…

ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆè¨­å®šUI

4. è£œè¶³: ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ

ç¾æ®µéšã§ã¯ç¨®ã¨ã—ã¦ãƒ•ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã®ã¿ç¢ºä¿

å°†æ¥Phase2ã§ EventBus ã‚’ä»‹ã—ã¦å„Managerã«ä¼é”ã™ã‚‹è¨­è¨ˆ

Ctrl+Z/Space+Drag/P/E/I ãªã©ã€åŸºæœ¬ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã¯å°†æ¥ãƒãƒƒãƒ”ãƒ³ã‚°äºˆå®š