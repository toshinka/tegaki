# ğŸ¨ Tegaki Project å®Ÿè£…ã‚¬ã‚¤ãƒ‰ v12 - è²¬å‹™æ˜ç¢ºåŒ–ç‰ˆ

## ğŸ“Œ ç›®çš„
ãƒšãƒ³æç”»ã®å•é¡Œè§£æ±ºã®ãŸã‚ã€ãƒ•ã‚¡ã‚¤ãƒ«è²¬å‹™ã‚’æ˜ç¢ºåŒ–ã—ã€æ®µéšçš„ã«å®Ÿè£…ã™ã‚‹ä½œæ¥­æ‰‹é †æ›¸ã§ã™ã€‚

## ğŸ¯ å•é¡Œè§£æ±ºã®æ–¹é‡
1. **è²¬å‹™ã®æ˜ç¢ºåŒ–**: å„ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²ã‚’å³å¯†ã«å®šç¾©
2. **æ®µéšçš„å®Ÿè£…**: ã‚³ã‚¢â†’ãƒ„ãƒ¼ãƒ«â†’UI ã®é †åºã§æ§‹ç¯‰
3. **ã‚¨ãƒ©ãƒ¼é˜²æ­¢**: æ˜ç¢ºãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©

---

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«è²¬å‹™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹

| ãƒ•ã‚¡ã‚¤ãƒ« | ä¸»è²¬å‹™ | ä¾å­˜å…ˆ | å…¬é–‹ã‚·ãƒ³ãƒœãƒ« |
|---------|-------|--------|-------------|
| **event-bus.js** | ã‚¤ãƒ™ãƒ³ãƒˆä¸­ç¶™ | ãªã— | `EventBus` |
| **error-manager.js** | ã‚¨ãƒ©ãƒ¼å‡¦ç† | ãªã— | `ErrorManager` |
| **config-manager.js** | è¨­å®šç®¡ç† | ErrorManager | `ConfigManager` |
| **state-manager.js** | çŠ¶æ…‹ç®¡ç† | EventBus, ErrorManager | `StateManager` |
| **coordinate-manager.js** | åº§æ¨™å¤‰æ› | ErrorManager | `CoordinateManager` |
| **canvas-manager.js** | Canvasåˆ¶å¾¡ | EventBus, StateManager, CoordinateManager | `CanvasManager` |
| **abstract-tool.js** | ãƒ„ãƒ¼ãƒ«åŸºåº• | ErrorManager | `AbstractTool` |
| **pen-tool.js** | ãƒšãƒ³æç”» | AbstractTool, CanvasManager | `PenTool` |
| **eraser-tool.js** | æ¶ˆã—ã‚´ãƒ  | AbstractTool, CanvasManager | `EraserTool` |
| **tool-manager.js** | ãƒ„ãƒ¼ãƒ«ç®¡ç† | EventBus, StateManager, ãƒ„ãƒ¼ãƒ«ç¾¤ | `ToolManager` |
| **memory-manager.js** | Undo/Redo | EventBus, CanvasManager | `MemoryManager` |
| **settings-manager.js** | è¨­å®šUI | EventBus, ConfigManager | `SettingsManager` |
| **ui-manager.js** | UIåˆ¶å¾¡ | EventBus, SettingsManager | `UIManager` |
| **boundary-manager.js** | ç¯„å›²åˆ¶é™ | CanvasManager | `BoundaryManager` |

---

## ğŸ”§ ãƒ¡ã‚½ãƒƒãƒ‰ãƒ»ã‚·ãƒ³ãƒœãƒ«å®šç¾©

### EventBus
```javascript
class EventBus {
    on(event, callback)
    off(event, callback) 
    emit(event, data)
}
```

### AbstractTool
```javascript
class AbstractTool {
    constructor(name, options)
    startStroke(point)      // ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯é–‹å§‹
    addPoint(point)         // ç‚¹è¿½åŠ 
    endStroke(point)        // ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯çµ‚äº†
    activate()              // ãƒ„ãƒ¼ãƒ«æœ‰åŠ¹åŒ–
    deactivate()            // ãƒ„ãƒ¼ãƒ«ç„¡åŠ¹åŒ–
    getSettings()           // ãƒ„ãƒ¼ãƒ«è¨­å®šå–å¾—
    updateSettings(settings) // ãƒ„ãƒ¼ãƒ«è¨­å®šæ›´æ–°
}
```

### CanvasManager
```javascript
class CanvasManager {
    constructor()
    initialize(container)    // åˆæœŸåŒ–
    clear()                 // ã‚¯ãƒªã‚¢
    drawLine(points, style) // ç·šæç”»
    drawPoint(point, style) // ç‚¹æç”»
    erase(area)            // æ¶ˆå»
    getPixiApp()           // PIXI.Applicationå–å¾—
    getStage()             // Stageå–å¾—
    pan(dx, dy)            // ãƒ‘ãƒ³
    zoom(scale, center)    // ã‚ºãƒ¼ãƒ 
    resetView()            // ãƒ“ãƒ¥ãƒ¼ãƒªã‚»ãƒƒãƒˆ
}
```

### ToolManager
```javascript
class ToolManager {
    constructor()
    initialize()
    setActiveTool(toolName) // ãƒ„ãƒ¼ãƒ«åˆ‡æ›¿
    getActiveTool()        // ç¾åœ¨ãƒ„ãƒ¼ãƒ«å–å¾—
    handlePointerDown(event)
    handlePointerMove(event)
    handlePointerUp(event)
}
```

---

## ğŸš€ å®Ÿè£…æ‰‹é †ï¼ˆæ®µéšçš„ï¼‰

### STEP 1: ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰
**å®Ÿè£…é †åº**: ä¾å­˜é–¢ä¿‚ã«å¾“ã£ã¦ä¸‹ã‹ã‚‰ä¸Šã¸

#### 1.1 åŸºç›¤ã‚¯ãƒ©ã‚¹
```
1. event-bus.js       # ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ 
2. error-manager.js   # ã‚¨ãƒ©ãƒ¼å‡¦ç†
3. config-manager.js  # è¨­å®šç®¡ç†
4. state-manager.js   # çŠ¶æ…‹ç®¡ç†
```

#### 1.2 åº§æ¨™ãƒ»Canvas
```
5. coordinate-manager.js  # åº§æ¨™å¤‰æ›
6. canvas-manager.js      # Canvasåˆ¶å¾¡ï¼ˆPIXIçµ±åˆï¼‰
```

### STEP 2: ãƒ„ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰
#### 2.1 ãƒ„ãƒ¼ãƒ«åŸºç›¤
```
7. abstract-tool.js   # ãƒ„ãƒ¼ãƒ«åŸºåº•ã‚¯ãƒ©ã‚¹
```

#### 2.2 å…·ä½“ãƒ„ãƒ¼ãƒ«
```
8. pen-tool.js        # ãƒšãƒ³ãƒ„ãƒ¼ãƒ«
9. eraser-tool.js     # æ¶ˆã—ã‚´ãƒ ãƒ„ãƒ¼ãƒ«
10. tool-manager.js   # ãƒ„ãƒ¼ãƒ«ç®¡ç†
```

### STEP 3: æ©Ÿèƒ½æ‹¡å¼µ
```
11. memory-manager.js    # Undo/Redo
12. boundary-manager.js  # æç”»ç¯„å›²åˆ¶é™
13. settings-manager.js  # è¨­å®šUI
14. ui-manager.js        # UIçµ±åˆç®¡ç†
```

---

## ğŸ”„ ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼å®šç¾©

### ãƒšãƒ³æç”»ãƒ•ãƒ­ãƒ¼
```
1. PointerDown â†’ CanvasManager.handlePointerDown
2. CanvasManager â†’ ToolManager.handlePointerDown
3. ToolManager â†’ activeTool.startStroke(point)
4. Tool â†’ CoordinateManager.transform(point)
5. Tool â†’ CanvasManager.drawPoint/drawLine
6. PointerMove â†’ åŒæ§˜ã®ãƒ•ãƒ­ãƒ¼ (addPoint)
7. PointerUp â†’ endStroke + MemoryManager.saveSnapshot
```

### EventBusã‚¤ãƒ™ãƒ³ãƒˆ
```javascript
// ãƒ„ãƒ¼ãƒ«é–¢é€£
'tool:change' â†’ ToolManager
'tool:activate' â†’ UIæ›´æ–°
'tool:deactivate' â†’ UIæ›´æ–°

// Canvasé–¢é€£  
'canvas:draw' â†’ æç”»é€šçŸ¥
'canvas:clear' â†’ ã‚¯ãƒªã‚¢é€šçŸ¥
'canvas:pan' â†’ ãƒ‘ãƒ³æ“ä½œ
'canvas:zoom' â†’ ã‚ºãƒ¼ãƒ æ“ä½œ

// çŠ¶æ…‹é–¢é€£
'state:change' â†’ StateManager
'settings:change' â†’ SettingsManager

// å°†æ¥æ‹¡å¼µç”¨
'shortcut:*' â†’ ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå‡¦ç†
'layer:*' â†’ ãƒ¬ã‚¤ãƒ¤ãƒ¼å‡¦ç†
```

---

## ğŸ’¡ åº§æ¨™å¤‰æ›ãƒ«ãƒ¼ãƒ«

### CoordinateManagerè²¬å‹™
```javascript
// ãƒ–ãƒ©ã‚¦ã‚¶åº§æ¨™ â†’ Canvasåº§æ¨™å¤‰æ›
transformPoint(browserPoint) {
    return {
        x: (browserPoint.x - canvasOffset.x) / scale,
        y: (browserPoint.y - canvasOffset.y) / scale
    }
}

// ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆåœ§åŠ›å€¤æ­£è¦åŒ–
normalizePressure(pressure) {
    return Math.max(0, Math.min(1, pressure || 0.5))
}
```

---

## ğŸ¨ æç”»è²¬å‹™åˆ†é›¢

### CanvasManagerï¼ˆæç”»å®Ÿè¡Œè€…ï¼‰
- PIXI.Applicationç®¡ç†
- å®Ÿéš›ã®Graphicsæç”»
- ãƒ“ãƒ¥ãƒ¼æ“ä½œï¼ˆpan/zoomï¼‰
- ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æœ€é©åŒ–

### Toolï¼ˆæç”»æŒ‡ç¤ºè€…ï¼‰
- ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ç®¡ç†
- ã‚¹ã‚¿ã‚¤ãƒ«æ±ºå®š
- æç”»å‘½ä»¤ç”Ÿæˆ
- CanvasManagerã«æç”»æŒ‡ç¤º

---

## ğŸ” ãƒ‡ãƒãƒƒã‚°ãƒ»ãƒ†ã‚¹ãƒˆæ–¹é‡

### å„æ®µéšã§ã®æ¤œè¨¼é …ç›®

#### STEP 1å®Œäº†æ™‚
- [ ] EventBusã§ã‚¤ãƒ™ãƒ³ãƒˆé€å—ä¿¡
- [ ] ErrorManagerã§ã‚¨ãƒ©ãƒ¼ã‚­ãƒ£ãƒƒãƒ
- [ ] CanvasManagerã§PIXIæç”»

#### STEP 2å®Œäº†æ™‚  
- [ ] ãƒšãƒ³æç”»ï¼ˆå·¦ä¸Šç›´ç·šãƒã‚°è§£æ¶ˆï¼‰
- [ ] ãƒ„ãƒ¼ãƒ«åˆ‡æ›¿å‹•ä½œ
- [ ] PointerEventæ­£å¸¸å‡¦ç†

#### STEP 3å®Œäº†æ™‚
- [ ] Undo/Redoå‹•ä½œ
- [ ] UIæ“ä½œåæ˜ 
- [ ] è¨­å®šä¿å­˜/èª­ã¿è¾¼ã¿

---

## ğŸ“‹ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
- [ ] event-bus.js
- [ ] error-manager.js  
- [ ] config-manager.js
- [ ] state-manager.js
- [ ] coordinate-manager.js
- [ ] canvas-manager.js
- [ ] abstract-tool.js
- [ ] pen-tool.js
- [ ] eraser-tool.js
- [ ] tool-manager.js
- [ ] memory-manager.js
- [ ] boundary-manager.js
- [ ] settings-manager.js
- [ ] ui-manager.js

### çµ±åˆãƒ†ã‚¹ãƒˆ
- [ ] main.js ã§ã®åˆæœŸåŒ–é †åº
- [ ] window.*ã¸ã®å…¬é–‹ç¢ºèª
- [ ] ä¾å­˜é–¢ä¿‚ã‚¨ãƒ©ãƒ¼ãªã—
- [ ] ãƒšãƒ³æç”»æ­£å¸¸å‹•ä½œ

---

## ğŸ¯ æˆåŠŸåŸºæº–

1. **å·¦ä¸Šç›´ç·šãƒã‚°è§£æ¶ˆ**: æ­£ã—ã„åº§æ¨™ã§ãƒšãƒ³æç”»
2. **ãƒ„ãƒ¼ãƒ«åˆ‡æ›¿æ­£å¸¸**: ãƒšãƒ³/æ¶ˆã—ã‚´ãƒ åˆ‡æ›¿å¯èƒ½
3. **ã‚¨ãƒ©ãƒ¼ãƒ•ãƒªãƒ¼**: ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ãªã—
4. **æ‹¡å¼µæº–å‚™å®Œäº†**: ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ»ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå®Ÿè£…æº–å‚™

---

## ğŸ“ æ¬¡ãƒ•ã‚§ãƒ¼ã‚ºæº–å‚™äº‹é …

### ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆä»•è¾¼ã¿
- EventBusã« `'shortcut:*'` ã‚¤ãƒ™ãƒ³ãƒˆäºˆç´„
- ToolManagerã§ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå—ä¿¡æº–å‚™

### ãƒ¬ã‚¤ãƒ¤ãƒ¼ä»•è¾¼ã¿  
- CanvasManagerã§ãƒ¬ã‚¤ãƒ¤ãƒ¼æ¦‚å¿µè€ƒæ…®
- æç”»å‘½ä»¤ã«ãƒ¬ã‚¤ãƒ¤ãƒ¼IDä»˜ä¸æº–å‚™

---

ã“ã®ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦æ®µéšçš„ã«å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€è²¬å‹™ãŒæ˜ç¢ºã§æ‹¡å¼µã—ã‚„ã™ã„ Tegaki ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚