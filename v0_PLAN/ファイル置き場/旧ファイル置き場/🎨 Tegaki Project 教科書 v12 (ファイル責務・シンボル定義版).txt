ğŸ“Œ ç›®çš„

æœ¬æ•™ç§‘æ›¸ã¯ ãƒãƒ©ãƒãƒ©ãªãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã‚’æ•´ç†ã—ã€è²¬å‹™ã¨ã‚·ãƒ³ãƒœãƒ«å®šç¾©ã‚’æ˜ç¢ºåŒ– ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¾ã™ã€‚
ãƒšãƒ³æç”»ã®å®‰å®šåŒ–ã‚„ä»Šå¾Œã®ãƒ¬ã‚¤ãƒ¤ãƒ¼å®Ÿè£…ã®åœŸå°ã¨ã—ã¦ã€å„ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²ã€ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰ã€ã‚¤ãƒ™ãƒ³ãƒˆä¼é”ãƒ•ãƒ­ãƒ¼ã‚’ä½“ç³»åŒ–ã—ã¦ã„ã¾ã™ã€‚
ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆé¡ã¯å°†æ¥æ‹¡å¼µã®ãŸã‚ã®è£œè¶³æƒ…å ±ã¨ã—ã¦æœ€å¾Œã«è»½ãè§¦ã‚Œã¾ã™ã€‚

1. ãƒ•ã‚¡ã‚¤ãƒ«è²¬å‹™ä¸€è¦§
ãƒ•ã‚¡ã‚¤ãƒ«	ä¸»ãªè²¬å‹™	å‚™è€ƒ
abstract-tool.js	ãƒ„ãƒ¼ãƒ«å…±é€šã®æŠ½è±¡ã‚¯ãƒ©ã‚¹å®šç¾©ã€‚ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ç®¡ç†ã‚„å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’æä¾›ã€‚	æ–°è¦ãƒ„ãƒ¼ãƒ«è¿½åŠ æ™‚ã«ç¶™æ‰¿ã€‚
pen-tool.js / eraser-tool.js	å„ãƒ„ãƒ¼ãƒ«å›ºæœ‰ã®æç”»å‡¦ç†ã€‚AbstractToolã‚’ç¶™æ‰¿ã€‚	CanvasManager ã¨é€£æºã—ã¦æç”»ã€‚
tool-manager.js	ç¾åœ¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ„ãƒ¼ãƒ«ã®ç®¡ç†ã€ãƒ„ãƒ¼ãƒ«åˆ‡æ›¿ã€ãƒ„ãƒ¼ãƒ«å›ºæœ‰ã‚¤ãƒ™ãƒ³ãƒˆã®ä¸­ç¶™ã€‚	EventBus çµŒç”±ã§ CanvasManager ã«ä¼é”ã€‚
canvas-manager.js	å®Ÿéš›ã®ã‚­ãƒ£ãƒ³ãƒã‚¹æç”»ï¼ˆstage.position, stage.scale, æç”»å‘½ä»¤ã®é©ç”¨ï¼‰	Pointerã‚¤ãƒ™ãƒ³ãƒˆã¯ã“ã“ã§å—ã‘å–ã‚Šã€ToolManagerã«è»¢é€ã€‚
memory-manager.js	Undo/Redo ç®¡ç†ã€‚ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯å˜ä½ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä¿æŒã€‚	Toolçµ‚äº†æ™‚ã«ä¿å­˜ã€‚
state-manager.js	ç¾åœ¨çŠ¶æ…‹ç®¡ç†ï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ„ãƒ¼ãƒ«ã€æç”»ä¸­ãƒ•ãƒ©ã‚°ãªã©ï¼‰ã€‚	SettingsManager ã¨æ··åŒã—ãªã„ã€‚
settings-manager.js	ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šç®¡ç†ï¼ˆãƒ–ãƒ©ã‚·ã‚µã‚¤ã‚ºã€è‰²ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­å®šï¼‰ã€‚	StateManagerã¨ã¯è²¬å‹™ã‚’åˆ†é›¢ã€‚
boundary-manager.js	ã‚­ãƒ£ãƒ³ãƒã‚¹æç”»ç¯„å›²ã®åˆ¶é™ç®¡ç†ã€‚	CanvasManagerã¨å”èª¿ã€‚
ui-manager.js / popup-manager.js / slider-manager.js	UIè¡¨ç¤ºãƒ»æ“ä½œç®¡ç†ã€‚	ãƒ„ãƒ¼ãƒ«è¨­å®šã‚„ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ç®¡ç†ã€‚
coordinate-manager.js	å…¥åŠ›åº§æ¨™å¤‰æ›ãƒ»è£œæ­£ã€‚ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒšãƒ³å¯¾å¿œã€‚	CanvasManager ã¨å¯†æ¥é€£æºã€‚
icon-manager.js	ãƒ„ãƒ¼ãƒ«ãƒ»UIã‚¢ã‚¤ã‚³ãƒ³ç®¡ç†ã€‚	UIè¡¨ç¤ºç”¨ã€‚
config-manager.js	è¨­å®šå€¤ã®ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ã€‚	JSONã‚„ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ã€‚
event-bus.js	Manageré–“ã®ç–çµåˆé€šä¿¡ã€‚	Shortcutã‚„UIã‚¤ãƒ™ãƒ³ãƒˆã‚‚å°†æ¥é›†ç´„ã€‚
error-manager.js	ã‚¨ãƒ©ãƒ¼ãƒ»ä¾‹å¤–å‡¦ç†ã€ãƒ­ã‚°ã€‚	é–‹ç™ºè€…é€šçŸ¥ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼é€šçŸ¥ã‚’åˆ†é›¢ã€‚
2. ãƒ¡ã‚½ãƒƒãƒ‰ãƒ»ã‚·ãƒ³ãƒœãƒ«å®šç¾©

ãƒ»AbstractTool å…±é€šãƒ¡ã‚½ãƒƒãƒ‰ä¾‹
class AbstractTool {
startStroke(point) {}
addPoint(point) {}
endStroke(point) {}
}

startStroke(point) : ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯é–‹å§‹

addPoint(point) : æç”»ç‚¹è¿½åŠ 

endStroke(point) : ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯çµ‚äº†ã€MemoryManagerã«é€šçŸ¥

ãƒ»CanvasManager ä¸»ãªãƒ¡ã‚½ãƒƒãƒ‰

pan(dx, dy) {}
setZoom(scale, centerPoint) {}
resetView() {}
getTransform() {}

EventBus ã‚¤ãƒ™ãƒ³ãƒˆä¾‹

tool:change â†’ ToolManager ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ„ãƒ¼ãƒ«ã‚’åˆ‡æ›¿

canvas:pan / canvas:zoom / canvas:reset â†’ CanvasManager ãŒå®Ÿå‡¦ç†

shortcut:* â†’ å°†æ¥ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå…¥åŠ›ç”¨ãƒ•ãƒƒã‚¯

MemoryManager ä¸»ãªãƒ¡ã‚½ãƒƒãƒ‰

saveSnapshot() : ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯å˜ä½ã§Undo/Redoä¿å­˜

undo() / redo() : Undo/Redo å®Ÿè¡Œ

LayerManagerï¼ˆSTEP2ã§å°å…¥äºˆå®šï¼‰

addLayer() / removeLayer() / moveLayer(index)

ãƒ¬ã‚¤ãƒ¤ãƒ¼å˜ä½ã§æç”»æŒ‡ç¤ºã‚’åˆ†é›¢

3. ãƒ•ã‚¡ã‚¤ãƒ«é–“ãƒ•ãƒ­ãƒ¼ä¾‹ï¼ˆãƒšãƒ³æç”»æ™‚ï¼‰

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ PointerDown â†’ CanvasManager ãŒã‚¤ãƒ™ãƒ³ãƒˆå—ã‘å–ã‚Š

CanvasManager â†’ ToolManager.activeTool.startStroke(point) ã«è»¢é€

ãƒ„ãƒ¼ãƒ«ï¼ˆPenToolï¼‰å†…ã§åº§æ¨™è£œæ­£ â†’ CanvasManager ã«æç”»å‘½ä»¤ç™ºè¡Œ

PointerMove â†’ Tool.addPoint â†’ CanvasManageræç”»

PointerUp â†’ Tool.endStroke â†’ MemoryManager.saveSnapshot

UIãƒ»çŠ¶æ…‹ã®æ›´æ–°ã¯ EventBus çµŒç”±

4. STEPæ•´ç†

STEP1ï¼šãƒšãƒ³ãƒ»æ¶ˆã—ã‚´ãƒ å®‰å®šåŒ–ã€åº§æ¨™è£œæ­£ã€CanvasManageræ•´å‚™ã€EventBusçµŒç”±ã®è²¬å‹™æ•´ç†

STEP2ï¼šãƒ¬ã‚¤ãƒ¤ãƒ¼å®Ÿè£…ã€LayerManagerå°å…¥ã€æç”»ãƒ•ãƒ­ãƒ¼æ‹¡å¼µ

STEP3ä»¥é™ï¼šã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚„é«˜åº¦ç·¨é›†æ©Ÿèƒ½ã€ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆè©³ç´°å®Ÿè£…

5. è£œè¶³ï¼šã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼ˆå°†æ¥æ‹¡å¼µï¼‰

ShortcutManager ã§ã‚­ãƒ¼å…¥åŠ›ã‚’é›†ç´„ â†’ EventBus ã«é€šçŸ¥ã™ã‚‹è¨­è¨ˆã‚’äºˆç´„

ç¾æ®µéšã§ã¯ç¨®ã¨ã—ã¦ãƒ•ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã®ã¿è¨­å®š

Phase2ä»¥é™ã«è©³ç´°ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’æ±ºå®šäºˆå®šï¼ˆCtrl+Z, Space+Drag, P/E/I ãªã©ï¼‰

æ•™ç§‘æ›¸ v12 ã‚’ä½œæˆã—ã¾ã—ãŸã€‚

ãƒ•ã‚¡ã‚¤ãƒ«ã®è²¬å‹™ã€ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰ãƒ»ã‚·ãƒ³ãƒœãƒ«ã€æç”»ãƒ•ãƒ­ãƒ¼ã‚’æ•´ç†

STEP1/STEP2/STEP3ã®æ®µéšçš„è¨ˆç”»ã‚’æ˜ç¤º

ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã¯è£œè¶³ã¨ã—ã¦è»½ãè§¦ã‚Œã‚‹å½¢ã«ã—ã¦ã„ã¾ã™
