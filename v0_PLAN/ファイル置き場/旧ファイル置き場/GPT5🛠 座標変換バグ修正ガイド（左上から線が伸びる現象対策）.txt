ğŸ›  åº§æ¨™å¤‰æ›ãƒã‚°ä¿®æ­£ã‚¬ã‚¤ãƒ‰ï¼ˆå·¦ä¸Šã‹ã‚‰ç·šãŒä¼¸ã³ã‚‹ç¾è±¡å¯¾ç­–ï¼‰
ğŸ¯ ç›®çš„

screenToCanvas â†’ canvasToPixi ã¸ã®å¤‰æ›å‡¦ç†ã§ (0,0) ã«è½ã¡ã¦ã—ã¾ã†å•é¡Œã‚’ä¿®æ­£ã—ã€å·¦ä¸Šã‹ã‚‰ç›´ç·šãŒæã‹ã‚Œã‚‹ç¾è±¡ã‚’é˜²æ­¢ã™ã‚‹ã€‚

ç‰¹ã« canvasRect æ¸¡ã—å¿˜ã‚Œã€PixiJSã®å¤‰æ›åˆæœŸå€¤ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥èª¤ç™»éŒ²ãŒåŸå› ã«ãªã£ã¦ã„ã‚‹ã€‚

âœ… ä¿®æ­£æ‰‹é †
Step 1. canvasRect ã‚’æ¯å›å–å¾—ã™ã‚‹

pointerdown ã‚„ pointermove ãªã©åº§æ¨™ã‚’ä½¿ã†ç›´å‰ã§ canvas.getBoundingClientRect() ã‚’å¿…ãšå‘¼ã³å‡ºã™ã€‚

å‘¼ã³å‡ºã—å…ƒã‚³ãƒ¼ãƒ‰ä¾‹ï¼ˆToolManagerã‚„PenToolå†…ï¼‰ã‚’ä»¥ä¸‹ã«ä¿®æ­£ï¼š

const canvasRect = this.canvasElement.getBoundingClientRect();
const coords = this.coordinateManager.extractPointerCoordinates(event, canvasRect, this.pixiApp);

Step 2. åº§æ¨™å¤‰æ›ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’è¿½åŠ 

å¤‰æ›å‡¦ç†ã®ã©ã“ã§ (0,0) ã«ãªã‚‹ã‹è¿½è·¡ã™ã‚‹ãŸã‚ã«ãƒ­ã‚°ã‚’å…¥ã‚Œã‚‹ã€‚

console.log("ğŸ“åº§æ¨™ãƒã‚§ãƒƒã‚¯", {
    screen: { x: event.clientX, y: event.clientY },
    canvasRect,
    canvas: this.screenToCanvas(event.clientX, event.clientY, canvasRect)
});

Step 3. PixiJSåº§æ¨™å¤‰æ›ã‚’å®‰å…¨åŒ–

pixiApp.stage.scale ã‚„ position ãŒå­˜åœ¨ã—ãªã„å ´åˆã€ç„¡ç†ã«å¤‰æ›ã›ãš canvasåº§æ¨™ã‚’ãã®ã¾ã¾è¿”ã™ã‚ˆã†ã«ä¿®æ­£ã€‚

const scale = pixiApp.stage.scale || { x: 1, y: 1 };
const position = pixiApp.stage.position || { x: 0, y: 0 };

if (!scale || !position) {
    return { x: canvasX, y: canvasY };
}

Step 4. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç™»éŒ²ã®é˜²å¾¡å‡¦ç†

(0,0) åº§æ¨™ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ã€‚

if (canvasCoords.x === 0 && canvasCoords.y === 0) {
    console.warn("âš ï¸ ç„¡åŠ¹åº§æ¨™ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¾ã›ã‚“", canvasCoords);
} else {
    this.saveToCacheWithCleanup(cacheKey, coordinateData);
}

ğŸ“‹ æœ€çµ‚ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

 canvasRect ã‚’æ¯å›å–å¾—ã—ã¦æ¸¡ã—ã¦ã„ã‚‹ã‹ï¼Ÿ

 ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã§ screen / canvas / pixi åº§æ¨™ã‚’ç¢ºèªã§ãã‚‹ã‹ï¼Ÿ

 PixiJSåº§æ¨™å¤‰æ›ãŒ undefined ã®å ´åˆã« fallback ã—ã¦ã„ã‚‹ã‹ï¼Ÿ

 (0,0) ã®èª¤ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒé˜²æ­¢ã•ã‚Œã¦ã„ã‚‹ã‹ï¼Ÿ