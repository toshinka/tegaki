ğŸ” ç¾çŠ¶ã®å•é¡Œåˆ†æ
1. ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆã®å•é¡Œ

ãƒšãƒ³æç”»ãŒã‚µãƒ ãƒã‚¤ãƒ«ã«åæ˜ ã•ã‚Œãªã„
ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºå¤‰æ›´ãŒåæ˜ ã•ã‚Œãªã„
ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ä¸å…·åˆ

2. ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®å•é¡Œ

ãƒ¬ã‚¤ãƒ¤ãƒ¼UIæ¡ˆ.png â‘  ã¨ç•°ãªã‚‹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
ã‚µãƒ ãƒã‚¤ãƒ«ãŒå·¦å´ã«ã‚ã‚‹ï¼ˆå³å´ãŒç†æƒ³ï¼‰
æƒ…å ±é…ç½®ãŒä¸é©åˆ‡

3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡Œ

ãƒšãƒ³ãƒ»æ¶ˆã—ã‚´ãƒ ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ‚ªåŒ–
ä¸è¦ãªå¤ªã„å¤–æ 

4. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å•é¡Œ

ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆã®äºŒé‡å®Ÿè£…
ä¸é©åˆ‡ãªæ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°
å†—é•·ãªã‚³ãƒ¼ãƒ‰

# ğŸ”§ ã‚µãƒ ãƒã‚¤ãƒ«ä¿®æ­£ãƒ»ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ”¹å–„ è¨ˆç”»æ›¸ v1.0

## ğŸ¯ å•é¡Œåˆ†æ

### ç¾åœ¨ã®å•é¡Œç‚¹
1. **ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆä¸å…·åˆ**: ãƒšãƒ³æç”»ãŒåæ˜ ã•ã‚Œãªã„ã€ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ã®ä¸å…·åˆ
2. **ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé•ã„**: ãƒ¬ã‚¤ãƒ¤ãƒ¼UIæ¡ˆ.png â‘  ã¨ç•°ãªã‚‹é…ç½®
3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ–**: ãƒšãƒ³ãƒ»æ¶ˆã—ã‚´ãƒ ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ‚ªåŒ–
4. **ä¸è¦ãªè£…é£¾**: å¤ªã„å¤–æ ãªã©ã®ç„¡é§„
5. **ã‚³ãƒ¼ãƒ‰å†—é•·åŒ–**: äºŒé‡å®Ÿè£…ã«ã‚ˆã‚‹è‚¥å¤§åŒ–

---

## ğŸ—ï¸ ç†æƒ³çš„ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆãƒ•ãƒ­ãƒ¼ï¼ˆä¿®æ­£ç‰ˆï¼‰
```mermaid
graph TD
    A[æç”»å®Œäº†] --> B[DrawingEngineå†…ã§å³åº§ã«ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ]
    B --> C[UICallbacksçµŒç”±ã§ã‚µãƒ ãƒã‚¤ãƒ«é€ä¿¡]
    C --> D[UIå´ã§ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºæ›´æ–°]
    
    E[ã‚­ãƒ£ãƒ³ãƒã‚¹ãƒªã‚µã‚¤ã‚º] --> F[å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚µãƒ ãƒã‚¤ãƒ«å†ç”Ÿæˆ]
    F --> C
    
    G[ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ‡æ›¿] --> H[æ—¢å­˜ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤º]
    H --> I[å¿…è¦ã«å¿œã˜ã¦ç”Ÿæˆ]
```

### ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹é€ ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼UIæ¡ˆ.png â‘  æº–æ‹ ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘ï¸â€ğŸ—¨ï¸  100%              [ã‚µãƒ ãƒã‚¤ãƒ«]  â”‚
â”‚ ãƒ¬ã‚¤ãƒ¤ãƒ¼1                [48x48px]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ ä¿®æ­£è¨ˆç”»

### Phase A: ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆæ©Ÿèƒ½ã®çµ±ä¸€ãƒ»ç°¡ç´ åŒ–
**ç›®æ¨™**: äºŒé‡å®Ÿè£…ã‚’æ’é™¤ã—ã€ç¢ºå®Ÿã«ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ

#### A.1 DrawingEngine.js ã§ã®ä¸€å…ƒåŒ–
```javascript
class LayerThumbnailManager {
    constructor(drawingEngine) {
        this.engine = drawingEngine;
        this.cache = new Map();
    }
    
    // æç”»å®Œäº†æ™‚ã®å³åº§ç”Ÿæˆ
    generateImmediateThumbnail(layerId) {
        const thumbnailCanvas = this.createThumbnailCanvas();
        const ctx = thumbnailCanvas.getContext('2d');
        
        // èƒŒæ™¯æç”»
        ctx.fillStyle = '#f0e0d6';
        ctx.fillRect(0, 0, 48, 48);
        
        // ãƒ¡ã‚¤ãƒ³ã‚­ãƒ£ãƒ³ãƒã‚¹ã‹ã‚‰ç¸®å°æç”»
        ctx.drawImage(
            this.engine.app.canvas,
            0, 0, this.engine.app.canvas.width, this.engine.app.canvas.height,
            0, 0, 48, 48
        );
        
        const dataUrl = thumbnailCanvas.toDataURL();
        this.cache.set(layerId, dataUrl);
        
        // UIé€šçŸ¥
        window.UICallbacks?.onLayerThumbnailUpdated?.(layerId, dataUrl);
        
        return dataUrl;
    }
    
    createThumbnailCanvas() {
        const canvas = document.createElement('canvas');
        canvas.width = 48;
        canvas.height = 48;
        return canvas;
    }
}
```

#### A.2 æç”»å®Œäº†ã®ç¢ºå®Ÿãªæ¤œçŸ¥
```javascript
// DrawingTools.js å†…
stopDrawing() {
    if (this.drawing.path) {
        this.drawing.path.isComplete = true;
        
        const activeLayer = this.layers.getActiveLayer();
        if (activeLayer) {
            this.layers.addPathToActiveLayer(this.drawing.path);
            
            // å³åº§ã«ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ
            this.engine.thumbnailManager.generateImmediateThumbnail(activeLayer.id);
        }
    }
    this.drawing = { active: false, path: null, lastPoint: null };
}
```

### Phase B: ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿®æ­£ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼UIæ¡ˆ.png â‘  æº–æ‹ ï¼‰
**ç›®æ¨™**: æƒ…å ±é…ç½®ã®æœ€é©åŒ–

#### B.1 CSS Grid ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿®æ­£
```css
.layer-item {
    width: 180px;
    height: 64px;
    display: grid;
    grid-template-columns: 20px 1fr 48px; /* ç›®ç‰ æƒ…å ± ã‚µãƒ ãƒã‚¤ãƒ« */
    grid-template-rows: 1fr 1fr;
    gap: 4px 8px;
    padding: 4px 8px;
    border: 1px solid var(--futaba-light-medium); /* ç´°ã„å¤–æ  */
    border-radius: 6px;
}

.layer-visibility {
    grid-column: 1;
    grid-row: 1 / 3;
}

.layer-opacity {
    grid-column: 2;
    grid-row: 1;
    align-self: start;
}

.layer-name {
    grid-column: 2;
    grid-row: 2;
    align-self: end;
}

.layer-thumbnail {
    grid-column: 3;
    grid-row: 1 / 3;
    width: 48px;
    height: 48px;
}
```

#### B.2 HTMLæ§‹é€ ã®ç°¡ç´ åŒ–
```html
<div class="layer-item" data-layer-id="${layer.id}">
    <div class="layer-visibility" data-action="toggle-visibility">
        ${eyeIcon}
    </div>
    <div class="layer-opacity">100%</div>
    <div class="layer-name">${layer.name}</div>
    <div class="layer-thumbnail">
        <img src="${thumbnailData}" alt="">
    </div>
    <div class="layer-delete-button" data-action="delete-layer">
        ${deleteIcon}
    </div>
</div>
```

### Phase C: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
**ç›®æ¨™**: ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‘ä¸Šãƒ»ç„¡é§„å‰Šé™¤

#### C.1 ä¸è¦ã‚³ãƒ¼ãƒ‰å‰Šé™¤
- `ThumbnailGenerator` ã‚¯ãƒ©ã‚¹ï¼ˆmain.htmlï¼‰å®Œå…¨å‰Šé™¤
- äºŒé‡å®Ÿè£…ã®æ’é™¤
- ä¸è¦ãªã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°å‰Šé™¤

#### C.2 æç”»å‡¦ç†ã®æœ€é©åŒ–
```javascript
// æç”»æ™‚ã®ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ã‚’æœ€å°é™ã«
const THUMBNAIL_UPDATE_THROTTLE = 100; // 100ms
let lastThumbnailUpdate = 0;

function throttledThumbnailUpdate(layerId) {
    const now = Date.now();
    if (now - lastThumbnailUpdate > THUMBNAIL_UPDATE_THROTTLE) {
        engine.thumbnailManager.generateImmediateThumbnail(layerId);
        lastThumbnailUpdate = now;
    }
}
```

### Phase D: ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã®æœ€å°åŒ–
**ç›®æ¨™**: ãƒ•ã‚¡ã‚¤ãƒ«è‚¥å¤§åŒ–é˜²æ­¢

#### D.1 ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®ç°¡ç´ åŒ–
```javascript
// âŒ å†—é•·ãªã‚¨ãƒ©ãƒ¼å‡¦ç†
try {
    // å‡¦ç†
} catch (error) {
    console.error('è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸');
    showUserFriendlyError(error);
    fallbackProcess();
}

// âœ… ç°¡æ½”ãªã‚¨ãƒ©ãƒ¼å‡¦ç†
// å‡¦ç†ãŒå¤±æ•—ã—ãŸã‚‰ null ã‚„ false ã‚’è¿”ã™ã®ã¿
generateThumbnail(layerId) {
    if (!this.engine?.app?.canvas) return null;
    // å‡¦ç†...
    return dataUrl;
}
```

---

## ğŸ”§ å®Ÿè£…é †åº

### Step 1: æ—¢å­˜ã‚µãƒ ãƒã‚¤ãƒ«æ©Ÿèƒ½ã®å‰Šé™¤
- `ThumbnailGenerator` ã‚¯ãƒ©ã‚¹å‰Šé™¤ï¼ˆmain.htmlï¼‰
- `ThumbnailSystem` ã‚¯ãƒ©ã‚¹å‰Šé™¤ï¼ˆDrawingEngine.jsï¼‰
- é–¢é€£ã™ã‚‹ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ãƒ»é…å»¶å‡¦ç†å‰Šé™¤

### Step 2: DrawingEngine.js ã§ã®ä¸€å…ƒåŒ–å®Ÿè£…
- `LayerThumbnailManager` ã‚¯ãƒ©ã‚¹è¿½åŠ 
- æç”»å®Œäº†æ™‚ã®å³åº§ç”Ÿæˆå®Ÿè£…
- ã‚­ãƒ£ãƒ³ãƒã‚¹ãƒªã‚µã‚¤ã‚ºæ™‚ã®å…¨æ›´æ–°å®Ÿè£…

### Step 3: ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿®æ­£
- CSS Grid ã®ä¿®æ­£
- HTMLæ§‹é€ ã®ç°¡ç´ åŒ–
- å¤–æ ã®ç´°ç·šåŒ–

### Step 4: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- ä¸è¦ãªé…å»¶å‡¦ç†å‰Šé™¤
- ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°ã®å®Ÿè£…
- å†—é•·ãªã‚³ãƒ¼ãƒ‰å‰Šé™¤

---

## âœ… æœŸå¾…ã•ã‚Œã‚‹æ”¹å–„åŠ¹æœ

### æ©Ÿèƒ½é¢
- âœ… ãƒšãƒ³æç”»ã®ç¢ºå®Ÿãªã‚µãƒ ãƒã‚¤ãƒ«åæ˜ 
- âœ… ã‚­ãƒ£ãƒ³ãƒã‚¹ãƒªã‚µã‚¤ã‚ºã®å³åº§åæ˜   
- âœ… ãƒ¬ã‚¤ãƒ¤ãƒ¼UIæ¡ˆ.png â‘  æº–æ‹ ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é¢
- âœ… ãƒšãƒ³ãƒ»æ¶ˆã—ã‚´ãƒ ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‘ä¸Š
- âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºå‰Šæ¸›ï¼ˆå†—é•·ã‚³ãƒ¼ãƒ‰é™¤å»ï¼‰
- âœ… æç”»å‡¦ç†ã®æœ€é©åŒ–

### ä¿å®ˆæ€§é¢
- âœ… ã‚µãƒ ãƒã‚¤ãƒ«æ©Ÿèƒ½ã®ä¸€å…ƒåŒ–
- âœ… å˜ç´”ã§ç†è§£ã—ã‚„ã™ã„ãƒ•ãƒ­ãƒ¼
- âœ… ä¸è¦ãªã‚¨ãƒ©ãƒ¼å‡¦ç†ã®é™¤å»

---

## ğŸš¨ æ³¨æ„ç‚¹

### å‰Šé™¤å¯¾è±¡ã®ç¢ºèª
- `ThumbnailGenerator` é–¢é€£ã®å®Œå…¨å‰Šé™¤
- é‡è¤‡ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã®çµ±åˆ
- ä¸è¦ãªé…å»¶ãƒ»ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°å‰Šé™¤

### ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´
- Gridé…ç½®ã®ç´°ã‹ã„èª¿æ•´
- ã‚¢ã‚¤ã‚³ãƒ³ã‚µã‚¤ã‚ºãƒ»é…ç½®ã®å¾®èª¿æ•´
- å‰Šé™¤ãƒœã‚¿ãƒ³ã®é©åˆ‡ãªé…ç½®

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
- æç”»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ç¢ºèª
- ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆã®è² è·ç¢ºèª
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®ç›£è¦–

---

ã“ã®è¨ˆç”»ã«æ²¿ã£ã¦æ®µéšçš„ã«ä¿®æ­£ã‚’è¡Œã†ã“ã¨ã§ã€ç¢ºå®Ÿã«ã‚µãƒ ãƒã‚¤ãƒ«æ©Ÿèƒ½ã‚’ä¿®å¾©ã—ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’æ”¹å–„ã—ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚