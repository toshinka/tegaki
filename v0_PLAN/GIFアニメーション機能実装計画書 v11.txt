GIFã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½å®Ÿè£…è¨ˆç”»æ›¸ v11
æ®µéšçš„å®Ÿè£…ã‚¬ã‚¤ãƒ‰ï¼ˆPhase 0â†’1â†’2ï¼‰

ğŸ“Š ç¾çŠ¶åˆ†æãƒ¬ãƒãƒ¼ãƒˆ
âœ… ç¢ºèªæ¸ˆã¿é …ç›®

PixiJS v8.13: æ­£ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒCDNã§èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹
åŸºæœ¬æ§‹é€ : ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã¯ä½œæˆæ¸ˆã¿ã ãŒã€ä¸­èº«ãŒä¸å®Œå…¨
åº§æ¨™ç³»: coordinate-system.jsãŒå­˜åœ¨ã™ã‚‹ãŒã€APIçµ±ä¸€ãŒä¸å®Œå…¨
EventBus: æœªå®Ÿè£…ï¼ˆwindow.TegakiEventBusãŒå­˜åœ¨ã—ãªã„ï¼‰
è¨­å®š: config.jsã¯å­˜åœ¨ã™ã‚‹ãŒã€animationè¨­å®šãŒä¸è¶³

âš ï¸ è¦ä¿®æ­£é …ç›®

EventBusæœªå®Ÿè£…: å…¨ã‚·ã‚¹ãƒ†ãƒ é–“ã®é€šä¿¡åŸºç›¤ãŒæ¬ è½
AnimationSystemæœªåˆæœŸåŒ–: core-engine.jsã§ã®åˆæœŸåŒ–ã‚³ãƒ¼ãƒ‰ãªã—
TimelineUIæœªå®Ÿè£…: ç©ºãƒ•ã‚¡ã‚¤ãƒ«çŠ¶æ…‹
ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ‘ãƒãƒ«ä½ç½®: ä¸‹éƒ¨è¡¨ç¤ºã§ç«¶åˆ
GIFæ›¸ãå‡ºã—æœªå®Ÿè£…: gif-exporter.jsãŒç©º


ğŸ¯ Phase 0: åŸºç›¤æ•´å‚™ï¼ˆå¿…é ˆãƒ»æœ€å„ªå…ˆï¼‰
ç›®çš„
æ—¢å­˜æ©Ÿèƒ½ã‚’å£Šã•ãšã«ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã®åœŸå°ã‚’ä½œã‚‹
å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«
1. system/event-bus.jsï¼ˆæ–°è¦ä½œæˆï¼‰

(function() {
    'use strict';
    
    class EventBus {
        constructor() {
            this.events = {};
        }
        
        on(event, callback) {
            if (!this.events[event]) {
                this.events[event] = [];
            }
            this.events[event].push(callback);
        }
        
        off(event, callback) {
            if (!this.events[event]) return;
            this.events[event] = this.events[event].filter(cb => cb !== callback);
        }
        
        emit(event, data) {
            if (!this.events[event]) return;
            this.events[event].forEach(callback => {
                try {
                    callback(data);
                } catch (e) {
                    console.error(`EventBus error in ${event}:`, e);
                }
            });
        }
    }
    
    window.TegakiEventBus = new EventBus();
})();


2. config.jsï¼ˆanimationè¨­å®šè¿½åŠ ï¼‰

// æ—¢å­˜è¨­å®šã®å¾Œã«è¿½åŠ 
window.TEGAKI_CONFIG.animation = {
    defaultFPS: 12,
    maxCuts: 50,
    defaultCutDuration: 0.5,
    exportSettings: {
        maxWidth: 800,
        maxHeight: 800,
        quality: 10,
        workers: 2
    }
};

3. index.htmlï¼ˆscriptèª­ã¿è¾¼ã¿é †åºä¿®æ­£ï¼‰


<!-- å¿…ãšã“ã®é †åºã§èª­ã¿è¾¼ã‚€ -->
<script src="https://cdn.jsdelivr.net/npm/pixi.js@8.13.0/dist/pixi.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.min.js"></script>

<!-- åŸºç›¤ -->
<script src="system/event-bus.js"></script>
<script src="config.js"></script>
<script src="coordinate-system.js"></script>

<!-- ã‚·ã‚¹ãƒ†ãƒ  -->
<script src="system/layer-system.js"></script>
<script src="system/camera-system.js"></script>
<script src="system/drawing-clipboard.js"></script>
<script src="system/animation-system.js"></script>
<script src="system/gif-exporter.js"></script>

<!-- UI -->
<script src="ui/ui-panels.js"></script>
<script src="ui/timeline-ui.js"></script>

<!-- ã‚³ã‚¢ -->
<script src="core-runtime.js"></script>
<script src="core-engine.js"></script>


4. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ‘ãƒãƒ«ä½ç½®ä¿®æ­£ï¼ˆindex.htmlå†…CSSï¼‰


#status-panel {
    position: fixed;
    top: 10px;
    left: 10px;
    bottom: auto;
    z-index: 10000;
}

ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

 EventBuså‹•ä½œç¢ºèª: window.TegakiEventBus.emit('test') ã§ã‚¨ãƒ©ãƒ¼ãªã—
 config.animationå­˜åœ¨ç¢ºèª: window.TEGAKI_CONFIG.animation ãŒå®šç¾©æ¸ˆã¿
 ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ‘ãƒãƒ«ä¸Šéƒ¨è¡¨ç¤ºç¢ºèª


ğŸ”¨ Phase 1: AnimationSystemã¨TimelineUIå®Ÿè£…

ç›®çš„
åŸºæœ¬çš„ãªã‚«ãƒƒãƒˆç®¡ç†ã¨ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³UIã‚’å®Ÿè£…
å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«
1. system/animation-system.jsï¼ˆå®Œå…¨å®Ÿè£…ï¼‰

(function() {
    'use strict';
    
    class AnimationSystem {
        constructor() {
            this.cuts = [];
            this.currentCutIndex = 0;
            this.isPlaying = false;
            this.fps = window.TEGAKI_CONFIG.animation.defaultFPS;
        }
        
        init(layerSystem, app) {
            this.layerSystem = layerSystem;
            this.app = app;
            window.TegakiEventBus.emit('animation:initialized');
        }
        
        createCut() {
            const cut = {
                id: 'cut_' + Date.now(),
                name: 'CUT' + (this.cuts.length + 1),
                duration: window.TEGAKI_CONFIG.animation.defaultCutDuration,
                layerStates: this.captureLayerStates(),
                thumbnail: null
            };
            
            this.cuts.push(cut);
            this.generateThumbnail(this.cuts.length - 1);
            window.TegakiEventBus.emit('animation:cut-created', { cut });
            return cut;
        }
        
        captureLayerStates() {
            // LayerSystemã‹ã‚‰ç¾åœ¨ã®çŠ¶æ…‹ã‚’å–å¾—
            const states = [];
            this.layerSystem.layers.forEach(layer => {
                states.push({
                    id: layer.layerData.id,
                    visible: layer.visible,
                    opacity: layer.alpha,
                    transform: {
                        x: layer.position.x,
                        y: layer.position.y,
                        rotation: layer.rotation,
                        scaleX: layer.scale.x,
                        scaleY: layer.scale.y
                    }
                });
            });
            return states;
        }
        
        applyCut(index) {
            if (!this.cuts[index]) return;
            
            const cut = this.cuts[index];
            this.currentCutIndex = index;
            
            // ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹ã‚’å¾©å…ƒ
            cut.layerStates.forEach(state => {
                const layer = this.layerSystem.getLayerById(state.id);
                if (!layer) return;
                
                layer.visible = state.visible;
                layer.alpha = state.opacity;
                layer.position.set(state.transform.x, state.transform.y);
                layer.rotation = state.transform.rotation;
                layer.scale.set(state.transform.scaleX, state.transform.scaleY);
            });
            
            window.TegakiEventBus.emit('animation:cut-applied', { index });
        }
        
        generateThumbnail(index) {
            // 64x48pxã®ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ
            const renderTexture = PIXI.RenderTexture.create({
                width: 64,
                height: 48
            });
            
            this.app.renderer.render(
                this.layerSystem.layersContainer,
                { renderTexture }
            );
            
            this.cuts[index].thumbnail = renderTexture;
        }
        
        play() {
            this.isPlaying = true;
            window.TegakiEventBus.emit('animation:play');
        }
        
        stop() {
            this.isPlaying = false;
            this.currentCutIndex = 0;
            window.TegakiEventBus.emit('animation:stop');
        }
    }
    
    window.TegakiAnimationSystem = AnimationSystem;
})();


2. ui/timeline-ui.jsï¼ˆåŸºæœ¬UIå®Ÿè£…ï¼‰



(function() {
    'use strict';
    
    class TimelineUI {
        constructor(animationSystem) {
            this.animationSystem = animationSystem;
            this.panel = null;
            this.isVisible = false;
        }
        
        init() {
            this.createPanel();
            this.setupEvents();
        }
        
        createPanel() {
            const panel = document.createElement('div');
            panel.className = 'timeline-panel';
            panel.style.display = 'none';
            panel.innerHTML = `
                <div class="timeline-header">
                    <span>ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</span>
                    <button class="close-btn">Ã—</button>
                </div>
                <div class="timeline-controls">
                    <button id="tl-add-cut">+ CUT</button>
                    <button id="tl-play">â–¶</button>
                    <button id="tl-stop">â– </button>
                </div>
                <div class="cuts-container" id="cuts-container"></div>
                <div class="timeline-settings">
                    <label>FPS: <input type="number" id="tl-fps" value="12" min="1" max="60"></label>
                </div>
            `;
            
            document.body.appendChild(panel);
            this.panel = panel;
        }
        
        setupEvents() {
            // UIã‚¤ãƒ™ãƒ³ãƒˆ
            this.panel.querySelector('#tl-add-cut').addEventListener('click', () => {
                this.animationSystem.createCut();
                this.updateCutsList();
            });
            
            this.panel.querySelector('#tl-play').addEventListener('click', () => {
                this.animationSystem.play();
            });
            
            this.panel.querySelector('#tl-stop').addEventListener('click', () => {
                this.animationSystem.stop();
            });
            
            this.panel.querySelector('.close-btn').addEventListener('click', () => {
                this.hide();
            });
            
            // EventBusé€£æº
            window.TegakiEventBus.on('animation:cut-created', () => {
                this.updateCutsList();
            });
            
            // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
            document.addEventListener('keydown', (e) => {
                if (e.altKey && e.key === 'a') {
                    this.toggle();
                }
            });
        }
        
        updateCutsList() {
            const container = this.panel.querySelector('#cuts-container');
            container.innerHTML = '';
            
            this.animationSystem.cuts.forEach((cut, index) => {
                const cutEl = document.createElement('div');
                cutEl.className = 'cut-item';
                cutEl.innerHTML = `
                    <div class="cut-thumbnail"></div>
                    <div class="cut-name">${cut.name}</div>
                    <input type="number" class="cut-duration" value="${cut.duration}" step="0.1">
                `;
                
                cutEl.addEventListener('click', () => {
                    this.animationSystem.applyCut(index);
                });
                
                container.appendChild(cutEl);
            });
        }
        
        show() {
            this.panel.style.display = 'block';
            this.isVisible = true;
        }
        
        hide() {
            this.panel.style.display = 'none';
            this.isVisible = false;
        }
        
        toggle() {
            if (this.isVisible) {
                this.hide();
            } else {
                this.show();
            }
        }
    }
    
    window.TegakiTimelineUI = TimelineUI;
})();


3. core-engine.jsï¼ˆåˆæœŸåŒ–è¿½åŠ ï¼‰


// æ—¢å­˜åˆæœŸåŒ–ã®æœ€å¾Œã«è¿½åŠ 
if (window.TegakiAnimationSystem && window.TegakiTimelineUI) {
    const animationSystem = new window.TegakiAnimationSystem();
    animationSystem.init(window.layerSystem, window.app);
    
    const timelineUI = new window.TegakiTimelineUI(animationSystem);
    timelineUI.init();
    
    window.animationSystem = animationSystem;
    window.timelineUI = timelineUI;
}


