# Phase2çµ±åˆç‰ˆã‚¨ãƒ©ãƒ¼åˆ†æãƒ»æ”¹ä¿®è¨ˆç”»æ›¸

## ğŸš¨ ç™ºç”Ÿã‚¨ãƒ©ãƒ¼åˆ†æ

### 1. æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ (Syntax Errors)
```
camera-system.js:607 Uncaught SyntaxError: Invalid or unexpected token
layer-system.js:1289 Uncaught SyntaxError: Unexpected end of input
```

**åŸå› åˆ†æ:**
- camera-system.jsã®607è¡Œç›®ä»˜è¿‘ã§æ§‹æ–‡ã‚¨ãƒ©ãƒ¼
- layer-system.jsãŒé€”ä¸­ã§åˆ‡ã‚Œã¦ã„ã‚‹ï¼ˆUnexpected end of inputï¼‰
- ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—æ™‚ã®æ–‡å­—æ•°åˆ¶é™ã¾ãŸã¯ã‚³ãƒ”ãƒ¼ãƒŸã‚¹ã®å¯èƒ½æ€§

### 2. ä¾å­˜é–¢ä¿‚ã‚¨ãƒ©ãƒ¼ (Dependency Missing)
```
core-engine.js:47 Uncaught Error: TegakiCameraSeparated (camera-system.js) dependency missing
Missing separated systems: Array(3)
```

**åŸå› åˆ†æ:**
- camera-system.jsã€layer-system.jsã€drawing-clipboard.jsã®èª­ã¿è¾¼ã¿å¤±æ•—
- ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã®æœªå®šç¾©
- åˆ†é›¢ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–å¤±æ•—

## ğŸ” æ ¹æœ¬åŸå› ç‰¹å®š

### A. ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ã®å•é¡Œ
1. **camera-system.js**: 607è¡Œç›®ã§åˆ‡æ–­ â†’ ä¸å®Œå…¨ãªãƒ•ã‚¡ã‚¤ãƒ«
2. **layer-system.js**: 1289è¡Œç›®ã§åˆ‡æ–­ â†’ ä¸å®Œå…¨ãªãƒ•ã‚¡ã‚¤ãƒ«  
3. **drawing-clipboard.js**: æã‚‰ãå®Œå…¨ã ãŒä¾å­˜é–¢ä¿‚ã§åˆæœŸåŒ–å¤±æ•—

### B. APIå¢ƒç•Œã®å•é¡Œ
1. **åº§æ¨™å¤‰æ›APIä¸ä¸€è‡´**: CoordinateSystemã¨ã®é€£æºä¸å‚™
2. **ãƒ¬ã‚¤ãƒ¤ãƒ¼APIæ–­ç‰‡åŒ–**: LayerManagerã®åˆ†é›¢æ™‚ã®APIæ¬ è½
3. **EventBusçµ±åˆä¸å®Œå…¨**: ã‚·ã‚¹ãƒ†ãƒ é–“é€šä¿¡ã®æ–­çµ¶
4. **è¨­å®šå‚ç…§æ··åœ¨**: CONFIGå‚ç…§ã®ä¸æ•´åˆ

### C. PixiJS v8.13å¯¾å¿œå•é¡Œ
1. **APIå¤‰æ›´å¯¾å¿œæ¼ã‚Œ**: å¤ã„PixiJS APIã®ä½¿ç”¨
2. **eventModeè¨­å®š**: æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰ã¸ã®å¯¾å¿œä¸å‚™

## ğŸ“‹ ç·Šæ€¥æ”¹ä¿®è¨ˆç”»

### Phase 1: æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ä¿®æ­£ (æœ€å„ªå…ˆ)

#### 1.1 camera-system.jsã®ä¿®æ­£
**å•é¡Œ**: 607è¡Œç›®ä»˜è¿‘ã§ã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼
**å¯¾ç­–**:
- ãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã®å†å–å¾—ãƒ»æ¤œè¨¼
- ä¸å®Œå…¨ãªè¡Œã®ç‰¹å®šãƒ»ä¿®æ­£
- `console.log('âœ… camera-system.js loaded (Phase2 separated)');` ãŒé€”ä¸­ã§åˆ‡ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§

#### 1.2 layer-system.jsã®ä¿®æ­£  
**å•é¡Œ**: ãƒ•ã‚¡ã‚¤ãƒ«çµ‚ç«¯ãŒä¸å®Œå…¨
**å¯¾ç­–**:
- æœ€çµ‚è¡Œã®è£œå®Œ
- ã‚°ãƒ­ãƒ¼ãƒãƒ«å…¬é–‹éƒ¨åˆ†ã®ä¿®å¾©
- `})();` ã®è¿½åŠ ç¢ºèª

#### 1.3 drawing-clipboard.jsã®æ¤œè¨¼
**å¯¾ç­–**:
- æ§‹æ–‡ãƒã‚§ãƒƒã‚¯ãƒ»æ•´åˆæ€§ç¢ºèª
- ä¾å­˜é–¢ä¿‚ã®æ¤œè¨¼

### Phase 2: ä¾å­˜é–¢ä¿‚ä¿®æ­£

#### 2.1 ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°å…¬é–‹ã®ç¢ºèª
```javascript
// å„ãƒ•ã‚¡ã‚¤ãƒ«ã§å¿…è¦ãªå…¬é–‹
window.TegakiCameraSeparated = { CameraSystem };
window.TegakiLayerSeparated = { LayerManager };
window.TegakiDrawingClipboardSeparated = { DrawingClipboardSystem };
```

#### 2.2 èª­ã¿è¾¼ã¿é †åºã®æœ€é©åŒ–
```html
<!-- ä¾å­˜é–¢ä¿‚é †ã§ã®èª­ã¿è¾¼ã¿ -->
1. config.js
2. coordinate-system.js  
3. core-runtime.js
4. ui-panels.js
5. camera-system.js      â† ä¿®æ­£æ¸ˆã¿
6. layer-system.js       â† ä¿®æ­£æ¸ˆã¿
7. drawing-clipboard.js  â† æ¤œè¨¼æ¸ˆã¿
8. core-engine.js        â† çµ±åˆã‚¨ãƒ³ã‚¸ãƒ³
```

### Phase 3: APIæ•´åˆæ€§ä¿®æ­£

#### 3.1 åº§æ¨™å¤‰æ›APIçµ±ä¸€
**å•é¡Œ**: CoordinateSystemã¨ã®é€£æºä¸å‚™
**å¯¾ç­–**:
```javascript
// camera-system.jså†…
screenToCanvasForDrawing(screenX, screenY) {
    return window.CoordinateSystem.screenToCanvas(this.app, screenX, screenY);
}

// çµ±ä¸€APIä½¿ç”¨ã®å¾¹åº•
const worldCenter = window.CoordinateSystem.localToGlobal(
    this.worldContainer, { x: centerX, y: centerY }
);
```

#### 3.2 ãƒ¬ã‚¤ãƒ¤ãƒ¼APIçµ±åˆç¢ºèª
**å•é¡Œ**: LayerManagerã®åˆ†é›¢æ™‚APIæ¬ è½
**å¯¾ç­–**:
```javascript
// layer-system.jså†…ã§å¿…è¦ãªãƒ¡ã‚½ãƒƒãƒ‰ç¢ºèª
- createLayer()
- setActiveLayer() 
- updateLayerTransform()
- confirmLayerTransform()
- rebuildPathGraphics()
```

#### 3.3 EventBusçµ±åˆä¿®æ­£
**å•é¡Œ**: ã‚·ã‚¹ãƒ†ãƒ é–“é€šä¿¡ã®æ–­çµ¶
**å¯¾ç­–**:
```javascript
// core-engine.jså†…
setupCrossReferences() {
    this.cameraSystem.setLayerManager(this.layerManager);
    this.cameraSystem.setDrawingEngine(this.drawingClipboardSystem.getDrawingEngine());
    // ç›¸äº’å‚ç…§ã®å®Œå…¨è¨­å®š
}
```

### Phase 4: PixiJS v8.13å®Œå…¨å¯¾å¿œ

#### 4.1 ã‚¤ãƒ™ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰è¨­å®š
```javascript
// å…¨Containerã§eventModeè¨­å®š
container.eventMode = 'static';
```

#### 4.2 Graphics APIæ›´æ–°
```javascript
// v8.13å¯¾å¿œã®æç”»
graphics.circle(x, y, radius);
graphics.fill({ color: 0x800000, alpha: 0.8 });
```

#### 4.3 ApplicationåˆæœŸåŒ–
```javascript
// await app.init() ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç¢ºèª
await this.pixiApp.init({
    width: screenWidth,
    height: screenHeight,
    backgroundAlpha: 0,
    resolution: 1,
    antialias: true,
    eventMode: 'static'
});
```

## ğŸ› ï¸ ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆé †åº

### 1. camera-system.js (æœ€å„ªå…ˆ)
- 607è¡Œç›®ä»¥é™ã®å¾©æ—§
- æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ä¿®æ­£
- CoordinateSystemé€£æºä¿®æ­£
- PixiJS v8.13å¯¾å¿œç¢ºèª

### 2. layer-system.js (é«˜å„ªå…ˆ)  
- ãƒ•ã‚¡ã‚¤ãƒ«çµ‚ç«¯ã®å¾©æ—§
- APIå¢ƒç•Œã®ç¢ºèª
- éç ´å£Šå¤‰å½¢ã‚·ã‚¹ãƒ†ãƒ ã®æ•´åˆæ€§ç¢ºèª

### 3. core-engine.js (ä¸­å„ªå…ˆ)
- ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ã®ä¿®æ­£
- ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ­ã‚¸ãƒƒã‚¯ã®æ¤œè¨¼
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–

### 4. index.html (ä½å„ªå…ˆ)
- ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯å¼·åŒ–
- ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã®æ”¹å–„
- ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã®è¿½åŠ 

## ğŸ“Š ä¿®æ­£å®Œäº†åˆ¤å®šåŸºæº–

### âœ… æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
- [ ] camera-system.js æ§‹æ–‡ã‚¨ãƒ©ãƒ¼è§£æ¶ˆ
- [ ] layer-system.js å®Œå…¨æ€§ç¢ºèª
- [ ] drawing-clipboard.js æ•´åˆæ€§ç¢ºèª

### âœ… ä¾å­˜é–¢ä¿‚ç¢ºèª
- [ ] `window.TegakiCameraSeparated` å®šç¾©æ¸ˆã¿
- [ ] `window.TegakiLayerSeparated` å®šç¾©æ¸ˆã¿  
- [ ] `window.TegakiDrawingClipboardSeparated` å®šç¾©æ¸ˆã¿
- [ ] `window.TegakiCore.CoreEngine` å®šç¾©æ¸ˆã¿

### âœ… æ©Ÿèƒ½ç¢ºèª
- [ ] ã‚­ãƒ£ãƒ³ãƒã‚¹è¡¨ç¤º
- [ ] ãƒšãƒ³æç”»
- [ ] ãƒ¬ã‚¤ãƒ¤ãƒ¼æ“ä½œ
- [ ] ãƒ¬ã‚¤ãƒ¤ãƒ¼å¤‰å½¢ (V + ãƒ‰ãƒ©ãƒƒã‚°)
- [ ] ã‚«ãƒ¡ãƒ©æ“ä½œ

### âœ… ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ç¢ºèª
- [ ] æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ãªã—
- [ ] ä¾å­˜é–¢ä¿‚ã‚¨ãƒ©ãƒ¼ãªã—  
- [ ] åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ãªã—
- [ ] åº§æ¨™å¤‰æ›ã‚¨ãƒ©ãƒ¼ãªã—

## ğŸš€ ä¿®æ­£å®Ÿè¡Œè¨ˆç”»

### Step 1: ç·Šæ€¥æ§‹æ–‡ä¿®æ­£ (15åˆ†)
1. camera-system.js ã®607è¡Œç›®ä»¥é™å¾©æ—§
2. layer-system.js ã®çµ‚ç«¯è£œå®Œ
3. åŸºæœ¬çš„ãªæ§‹æ–‡ã‚¨ãƒ©ãƒ¼è§£æ¶ˆ

### Step 2: ä¾å­˜é–¢ä¿‚ä¿®æ­£ (15åˆ†)  
1. ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°å…¬é–‹ã®ç¢ºèª
2. èª­ã¿è¾¼ã¿é †åºã®æ¤œè¨¼
3. åˆæœŸåŒ–ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®ä¿®æ­£

### Step 3: APIçµ±åˆç¢ºèª (15åˆ†)
1. åº§æ¨™å¤‰æ›APIã®çµ±ä¸€ç¢ºèª
2. ã‚·ã‚¹ãƒ†ãƒ é–“é€£æºã®æ¤œè¨¼
3. åŸºæœ¬æ©Ÿèƒ½å‹•ä½œç¢ºèª

### Step 4: æœ€çµ‚ãƒ†ã‚¹ãƒˆ (15åˆ†)
1. å…¨æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª
2. ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®æ¤œè¨¼
3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

## ğŸ’¡ äºˆé˜²ç­–

### ä»Šå¾Œã®é–‹ç™ºæŒ‡é‡
1. **ãƒ•ã‚¡ã‚¤ãƒ«å®Œå…¨æ€§ç¢ºèª**: å„ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆå¾Œã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯å¿…é ˆ
2. **ä¾å­˜é–¢ä¿‚å›³ä½œæˆ**: ã‚·ã‚¹ãƒ†ãƒ é–“ä¾å­˜ã®æ˜ç¢ºåŒ–
3. **æ®µéšçš„ãƒ†ã‚¹ãƒˆ**: å„ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ æ™‚ã®å‹•ä½œç¢ºèª
4. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–**: å¤±æ•—æ™‚ã®è©³ç´°æƒ…å ±å‡ºåŠ›

### ãƒ‡ãƒãƒƒã‚°ç’°å¢ƒæ•´å‚™
1. **æ§‹æ–‡ãƒã‚§ãƒƒã‚¯ãƒ„ãƒ¼ãƒ«**: ESLintç­‰ã®æ´»ç”¨
2. **ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚«ãƒ¼**: è‡ªå‹•åŒ–ã•ã‚ŒãŸç¢ºèªæ©Ÿèƒ½
3. **æ®µéšçš„åˆæœŸåŒ–**: ã‚·ã‚¹ãƒ†ãƒ æ¯ã®åˆæœŸåŒ–çŠ¶æ³ç¢ºèª

---

## âš¡ ç·Šæ€¥å¯¾å¿œæŒ‡ç¤º

**æœ€å„ªå…ˆä¿®æ­£å¯¾è±¡:**
1. camera-system.js ã®607è¡Œç›®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ â†’ å³åº§ã«ä¿®æ­£
2. layer-system.js ã®çµ‚ç«¯è£œå®Œ â†’ å³åº§ã«ä¿®æ­£  
3. ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ã®è¦‹ç›´ã— â†’ core-engine.jsä¿®æ­£

**ä¿®æ­£å®Œäº†å¾Œã®ç¢ºèªé …ç›®:**
- ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼0ä»¶
- åŸºæœ¬æç”»æ©Ÿèƒ½å‹•ä½œ
- ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«è¡¨ç¤º
- Vã‚­ãƒ¼å¤‰å½¢ãƒ¢ãƒ¼ãƒ‰å‹•ä½œ