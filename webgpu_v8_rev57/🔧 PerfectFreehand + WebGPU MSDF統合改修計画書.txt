================================================================================
WebGPU MSDFæç”»ã‚·ã‚¹ãƒ†ãƒ æ®µéšçš„æ”¹ä¿®è¨ˆç”»æ›¸
PerfectFreehand + MSDF Pipeline å®Œå…¨çµ±åˆ
================================================================================

## ğŸš¨ æ ¹æœ¬åŸå› ã®ç‰¹å®š

### ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°è§£æçµæœ

```
brush-core.js:201 startStroke called: {localX: 350.5, localY: 88.5, pressure: 0.5}
brush-core.js:379 finalizeStroke called
brush-core.js:399 Points count: 1
brush-core.js:402 Stroke too short, aborting
stroke-recorder.js:128 [StrokeRecorder] Stroke too short, discarded
```

âŒ å•é¡Œç‚¹ï¼š
- startStroke ã¯å‘¼ã°ã‚Œã¦ã„ã‚‹
- finalizeStroke ã‚‚å‘¼ã°ã‚Œã¦ã„ã‚‹
- **recordPoint ãŒ1å›ã‚‚å‘¼ã°ã‚Œã¦ã„ãªã„**
- 1ç‚¹ã—ã‹è¨˜éŒ²ã•ã‚Œãªã„ãŸã‚ PerfectFreehandâ†’ãƒãƒªã‚´ãƒ³ç”ŸæˆãŒç ´æ£„
- MSDF Pipeline ã«æ¸¡ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ãªã„

ğŸ¯ çµè«–ï¼š**PointerMove ã‚¤ãƒ™ãƒ³ãƒˆãŒ drawing-engine â†’ brush-core â†’ stroke-recorder ã«æµã‚Œã¦ã„ãªã„**

================================================================================

## Phase 1: PointerEventé…ä¿¡çµŒè·¯ã®å®Œå…¨ä¿®å¾©

### 1-1. ã‚¤ãƒ™ãƒ³ãƒˆæ¨ªå–ã‚Šã®æ’é™¤

#### ğŸ”§ slider-utils.js (v8.13.10) - æ…£æ€§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å®Ÿè£…ã®å•é¡Œ

**ç¾çŠ¶å•é¡Œï¼š**
```javascript
// L158-167: documentå…¨ä½“ã®pointermoveã‚’captureã—ã¦ã„ã‚‹
document.addEventListener('pointermove', handlePointerMove, { 
    passive: false, 
    capture: true  // â† ã“ã‚ŒãŒæç”»ç”¨pointermoveã‚’æ¨ªå–ã‚Š
});
```

**ç—‡çŠ¶ï¼š**
- ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ“ä½œæ™‚ã«pointermoveã‚¤ãƒ™ãƒ³ãƒˆãŒcapture phaseã§æ¨ªå–ã‚Šã•ã‚Œã‚‹
- WebGPU canvas ã¸ã® pointermove é…ä¿¡ãŒé˜»å®³ã•ã‚Œã‚‹
- drawing-engine.js ã® _handlePointerMove ãŒå®Ÿè¡Œã•ã‚Œãªã„

**ä¿®æ­£æ–¹é‡ï¼š**
```javascript
// ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å†…ã§ã®ã¿pointermoveã‚’å‡¦ç†
containerEl.addEventListener('pointermove', handlePointerMove, { 
    passive: false 
});

// documentå…¨ä½“ã¸ã®listenerã¯å‰Šé™¤
// ã¾ãŸã¯ dragging ãƒ•ãƒ©ã‚°ã§å³å¯†ã«åˆ¶å¾¡
```

**å…·ä½“çš„æ”¹ä¿®ï¼š**
1. `document.addEventListener('pointermove', ...)` ã‚’å‰Šé™¤
2. `containerEl.setPointerCapture(e.pointerId)` ã‚’ä½¿ç”¨
3. PointerUp/Cancel æ™‚ã« `releasePointerCapture` ã‚’ç¢ºå®Ÿã«å®Ÿè¡Œ
4. stopPropagation() ã¯ containerEl å†…ã§ã®ã¿ä½¿ç”¨

---

### 1-2. pointer-handler.js ã®æ¥ç¶šå…ˆç¢ºèª

#### ğŸ” WebGPU Canvas ã¸ã®æ­£ã—ã„æ¥ç¶š

**ç¾çŠ¶ç¢ºèªï¼š**
```javascript
// pointer-handler.js L123-126
canvas.addEventListener('pointerdown', onPointerDown, { capture, passive: false });
canvas.addEventListener('pointermove', onPointerMove, { capture, passive: false });
canvas.addEventListener('pointerup', onPointerUp, { capture, passive: false });
canvas.addEventListener('pointercancel', onPointerCancel, { capture, passive: false });
```

**ç¢ºèªé …ç›®ï¼š**
- âœ… `canvas` ãŒ `#webgpu-canvas` ã‚’æ­£ã—ãå‚ç…§ã—ã¦ã„ã‚‹ã‹
- âœ… Pixi Canvas (`#pixi-ui-canvas`) ã«èª¤æ¥ç¶šã—ã¦ã„ãªã„ã‹
- âœ… `setPointerCapture(e.pointerId)` ãŒ pointerdown æ™‚ã«ç¢ºå®Ÿã«å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹

**ä¿®æ­£æ–¹é‡ï¼š**
1. drawing-engine.js ã® `_initializeCanvas()` ã§æ¥ç¶šå…ˆã‚’æ˜ç¤º
2. WebGPU canvas å°‚ç”¨ã® pointer ç™»éŒ²ã‚’ä¿è¨¼
3. Pixi canvas ã¯ UI ã‚¤ãƒ™ãƒ³ãƒˆå°‚ç”¨ã«é™å®š

---

### 1-3. drawing-engine.js ã®ãƒãƒƒãƒå‡¦ç†ç¢ºèª

#### ğŸ”§ pendingPoints ã®ãƒ•ãƒ­ãƒ¼æ¤œè¨¼

**ç¾çŠ¶ã‚³ãƒ¼ãƒ‰ï¼š**
```javascript
// L69-73: _handlePointerMove
_handlePointerMove(info, e) {
    const pointerInfo = this.activePointers.get(info.pointerId);
    if (!pointerInfo || !pointerInfo.isDrawing) return;

    pendingPoints.push({ type: 'move', info });
}
```

**å•é¡Œã®å¯èƒ½æ€§ï¼š**
- `activePointers.get(info.pointerId)` ãŒ null ã‚’è¿”ã—ã¦ã„ã‚‹
- `pointerInfo.isDrawing` ãŒ false ã®ã¾ã¾
- `pendingPoints` ã« 'move' ãŒè¿½åŠ ã•ã‚Œãªã„

**ä¿®æ­£æ–¹é‡ï¼š**
1. pointerdown æ™‚ã« `isDrawing: true` ã‚’ç¢ºå®Ÿã«è¨­å®š
2. pointermove æ™‚ã®ãƒ•ãƒ©ã‚°ãƒã‚§ãƒƒã‚¯ã‚’ç·©å’Œï¼ˆdebugç”¨ï¼‰
3. pendingPoints ã¸ã®è¿½åŠ ã‚’ console.log ã§ç¢ºèª

**ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ¼ãƒ‰è¿½åŠ ï¼š**
```javascript
_handlePointerMove(info, e) {
    console.log('[DrawingEngine] _handlePointerMove called:', {
        pointerId: info.pointerId,
        hasPointerInfo: this.activePointers.has(info.pointerId),
        isDrawing: this.activePointers.get(info.pointerId)?.isDrawing
    });
    
    const pointerInfo = this.activePointers.get(info.pointerId);
    if (!pointerInfo || !pointerInfo.isDrawing) return;

    console.log('[DrawingEngine] Queuing move point:', info.clientX, info.clientY);
    pendingPoints.push({ type: 'move', info });
}
```

---

### 1-4. core-engine.js ã® flushPointerBatch ç¢ºèª

#### âœ… Master Loop çµ±åˆã®å‹•ä½œç¢ºèª

**ç¾çŠ¶ã‚³ãƒ¼ãƒ‰ï¼š**
```javascript
// L248-265: _renderLoop
_renderLoop() {
    if (!this.isRenderLoopRunning) return;
    
    try {
        this.flushPointerBatch();  // â† ã“ã‚ŒãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹
        
        const brushCore = window.BrushCore;
        if (brushCore?.isDrawing && 
            !brushCore.isPreviewUpdating &&
            typeof brushCore.renderPreview === 'function') {
            
            brushCore.renderPreview().catch(err => {
                if (brushCore) {
                    brushCore.isPreviewUpdating = false;
                }
                console.error('[CoreEngine] Preview error:', err);
            });
        }
        
        if (this.app?.renderer && this.app?.stage) {
            this.app.renderer.render(this.app.stage);
        }
    } catch (error) {
        console.error('[CoreEngine] Render loop error:', error);
    }
    
    this.renderLoopId = requestAnimationFrame(() => this._renderLoop());
}
```

**ç¢ºèªé …ç›®ï¼š**
- âœ… `flushPointerBatch()` ãŒæ¯ãƒ•ãƒ¬ãƒ¼ãƒ ç¢ºå®Ÿã«å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹
- âœ… `pendingPoints` ãŒç©ºã®ã¾ã¾ flush ã•ã‚Œã¦ã„ãªã„ã‹

**ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ¼ãƒ‰è¿½åŠ ï¼š**
```javascript
flushPointerBatch() {
    if (this.drawingEngine && typeof this.drawingEngine.flushPendingPoints === 'function') {
        console.log('[CoreEngine] Flushing pendingPoints, count:', pendingPoints?.length);
        this.drawingEngine.flushPendingPoints();
    }
}
```

================================================================================

## Phase 2: brush-core.js ã®æç”»ãƒ•ãƒ­ãƒ¼ç¢ºèª

### 2-1. updateStroke ã®å‘¼ã³å‡ºã—ç¢ºèª

#### ğŸ”§ recordPoint å‘¼ã³å‡ºã—çµŒè·¯ã®æ¤œè¨¼

**ç¾çŠ¶ã‚³ãƒ¼ãƒ‰ï¼š**
```javascript
// brush-core.js L234-241
async updateStroke(localX, localY, pressure = 0.5) {
    if (!this.initialized || !this.isDrawing) return;
    
    this.strokeRecorder.addPoint(localX, localY, pressure);
    
    const historyManager = window.History;
    if (historyManager?.addPoint) {
        historyManager.addPoint(localX, localY, pressure);
    }
}
```

**å•é¡Œã®å¯èƒ½æ€§ï¼š**
- `this.isDrawing` ãŒ false ã®ã¾ã¾
- `updateStroke` è‡ªä½“ãŒå‘¼ã°ã‚Œã¦ã„ãªã„

**ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ¼ãƒ‰è¿½åŠ ï¼š**
```javascript
async updateStroke(localX, localY, pressure = 0.5) {
    console.log('[BrushCore] updateStroke called:', { 
        initialized: this.initialized, 
        isDrawing: this.isDrawing, 
        localX, localY, pressure 
    });
    
    if (!this.initialized || !this.isDrawing) {
        console.warn('[BrushCore] updateStroke blocked:', {
            initialized: this.initialized,
            isDrawing: this.isDrawing
        });
        return;
    }
    
    this.strokeRecorder.addPoint(localX, localY, pressure);
    
    const historyManager = window.History;
    if (historyManager?.addPoint) {
        historyManager.addPoint(localX, localY, pressure);
    }
}
```

---

### 2-2. drawing-engine ã® _processPointerMove ç¢ºèª

#### ğŸ”§ åº§æ¨™å¤‰æ›ã¨ BrushCore å‘¼ã³å‡ºã—ã®æ¤œè¨¼

**ç¾çŠ¶ã‚³ãƒ¼ãƒ‰ï¼š**
```javascript
// drawing-engine.js L164-181
_processPointerMove(info) {
    if (!this.brushCore || !this.brushCore.isActive || !this.brushCore.isActive()) {
        return;
    }

    const localCoords = this._screenToLocal(info.clientX, info.clientY);
    if (!localCoords) return;

    if (this.brushCore.updateStroke) {
        this.brushCore.updateStroke(
            localCoords.localX,
            localCoords.localY,
            info.pressure,
            info.pointerType
        );
    }
}
```

**å•é¡Œã®å¯èƒ½æ€§ï¼š**
- `this.brushCore.isActive()` ãŒ false ã‚’è¿”ã—ã¦ã„ã‚‹
- `_screenToLocal()` ãŒ null ã‚’è¿”ã—ã¦ã„ã‚‹

**ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ¼ãƒ‰è¿½åŠ ï¼š**
```javascript
_processPointerMove(info) {
    console.log('[DrawingEngine] _processPointerMove:', {
        hasBrushCore: !!this.brushCore,
        isActive: this.brushCore?.isActive?.(),
        clientX: info.clientX,
        clientY: info.clientY
    });
    
    if (!this.brushCore || !this.brushCore.isActive || !this.brushCore.isActive()) {
        console.warn('[DrawingEngine] BrushCore not active');
        return;
    }

    const localCoords = this._screenToLocal(info.clientX, info.clientY);
    
    if (!localCoords) {
        console.warn('[DrawingEngine] Local coords conversion failed');
        return;
    }
    
    console.log('[DrawingEngine] Calling updateStroke:', localCoords);

    if (this.brushCore.updateStroke) {
        this.brushCore.updateStroke(
            localCoords.localX,
            localCoords.localY,
            info.pressure,
            info.pointerType
        );
    }
}
```

================================================================================

## Phase 3: stroke-recorder.js ã®è¨˜éŒ²ç¢ºèª

### 3-1. addPoint ã®å®Ÿè¡Œç¢ºèª

#### âœ… GPT5ã‚¢ãƒ‰ãƒã‚¤ã‚¹é©ç”¨æ¸ˆã¿ã‚³ãƒ¼ãƒ‰ã®æ¤œè¨¼

**ç¾çŠ¶ã‚³ãƒ¼ãƒ‰ï¼š**
```javascript
// stroke-recorder.js L54-74
addPoint(localX, localY, pressure = 0.5, tiltX = 0, tiltY = 0) {
    if (!this.isRecording) {
        return;
    }

    const now = performance.now();
    const timeDelta = now - this.lastPointTime;

    const point = {
        x: localX,
        y: localY,
        pressure: Math.max(0.01, Math.min(1.0, pressure)),
        tiltX: tiltX,
        tiltY: tiltY,
        timestamp: now,
        timeDelta: timeDelta,
        edgeId: this.points.length,
        channelId: this.points.length % 3
    };

    this.points.push(point);
    this.lastPointTime = now;
    this.totalPoints++;
}
```

**ç¢ºèªé …ç›®ï¼š**
- âœ… `this.isRecording` ãŒ true ã«ãªã£ã¦ã„ã‚‹ã‹
- âœ… `this.points.push(point)` ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹

**ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ¼ãƒ‰è¿½åŠ ï¼š**
```javascript
addPoint(localX, localY, pressure = 0.5, tiltX = 0, tiltY = 0) {
    console.log('[StrokeRecorder] addPoint called:', {
        isRecording: this.isRecording,
        pointsCount: this.points.length,
        localX, localY, pressure
    });
    
    if (!this.isRecording) {
        console.warn('[StrokeRecorder] Not recording, point discarded');
        return;
    }

    const now = performance.now();
    const timeDelta = now - this.lastPointTime;

    const point = {
        x: localX,
        y: localY,
        pressure: Math.max(0.01, Math.min(1.0, pressure)),
        tiltX: tiltX,
        tiltY: tiltY,
        timestamp: now,
        timeDelta: timeDelta,
        edgeId: this.points.length,
        channelId: this.points.length % 3
    };

    this.points.push(point);
    this.lastPointTime = now;
    this.totalPoints++;
    
    console.log('[StrokeRecorder] Point added successfully, total:', this.points.length);
}
```

================================================================================

## Phase 4: PixiJSè²¬å‹™ã®å®Œå…¨åˆ†é›¢

### 4-1. index.html ã® Canvas åˆ†é›¢çŠ¶æ…‹ç¢ºèª

#### ğŸ”§ WebGPU Canvas ã¨ Pixi Canvas ã®ç‹¬ç«‹æ€§æ¤œè¨¼

**å¿…é ˆæ§‹æˆï¼š**
```html
<canvas id="webgpu-canvas" width="800" height="600"></canvas>
<canvas id="pixi-ui-canvas" width="800" height="600"></canvas>
```

**ç¢ºèªé …ç›®ï¼š**
- âœ… WebGPU canvas ãŒæç”»å°‚ç”¨
- âœ… Pixi canvas ãŒ UI ãƒ›ã‚¹ãƒˆå°‚ç”¨
- âœ… Z-index ã«ã‚ˆã‚‹é‡ã­é †ãŒæ­£ã—ã„
- âŒ Pixi ãŒ pointer ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¨ªå–ã‚Šã—ã¦ã„ãªã„

---

### 4-2. core-initializer.js ã®åˆæœŸåŒ–ãƒ•ãƒ­ãƒ¼ç¢ºèª

#### ğŸ“ PixiJS Application ã® ticker åœæ­¢ç¢ºèª

**å¿…é ˆè¨­å®šï¼š**
```javascript
// Pixi ã®è‡ªå‹•ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’åœæ­¢
app.ticker.stop();

// WebGPU Master Loop ã®ã¿ã‚’ä½¿ç”¨
```

**ç¢ºèªé …ç›®ï¼š**
- âœ… `app.ticker.stop()` ãŒç¢ºå®Ÿã«å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹
- âœ… Pixi renderer ãŒæ‰‹å‹•å‘¼ã³å‡ºã—ã®ã¿ã«ãªã£ã¦ã„ã‚‹ã‹
- âŒ Pixi ãŒç‹¬è‡ªã® render loop ã‚’æŒã£ã¦ã„ãªã„ã‹

---

### 4-3. ãƒ˜ãƒƒãƒ‰ãƒ©ã‚¤ãƒ³è¨˜è¿°ã®çµ±ä¸€

#### ğŸ“„ å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã« PixiJS è²¬å‹™åˆ¶é™ã‚’æ˜è¨˜

**è¿½åŠ ã™ã¹ããƒ˜ãƒƒãƒ‰ãƒ©ã‚¤ãƒ³ï¼š**
```javascript
/**
 * ã€PixiJSä½¿ç”¨åˆ¶é™ã€‘
 * - PixiJS ã¯ UI ãƒ›ã‚¹ãƒˆï¼ˆãƒœã‚¿ãƒ³ã€ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«ï¼‰å°‚ç”¨
 * - æç”»å‡¦ç†ï¼ˆãƒãƒªã‚´ãƒ³ç”Ÿæˆã€åˆæˆã€swapchainç®¡ç†ï¼‰ã¯ WebGPU ãŒæ‹…å½“
 * - Pixi.Graphics ã«ã‚ˆã‚‹ CPU ãƒ©ã‚¹ã‚¿ãƒ©ã‚¤ã‚ºã¯å³ç¦
 * - pointer ã‚¤ãƒ™ãƒ³ãƒˆã®ä¸€æ¬¡å–å¾—ã¯ WebGPU Canvas ãŒæ‹…å½“
 */
```

**å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ï¼š**
- drawing-engine.js
- brush-core.js
- stroke-renderer.js
- webgpu-drawing-layer.js
- core-engine.js
- core-initializer.js

================================================================================

## Phase 5: MSDF Pipeline ã®å‹•ä½œç¢ºèª

### 5-1. msdf-pipeline-manager.js ã®åˆæœŸåŒ–çŠ¶æ…‹ç¢ºèª

#### âœ… Pipeline ç”Ÿæˆã®æˆåŠŸç¢ºèª

**ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚ˆã‚Šï¼š**
```
[WebGPU] Pipelines created: {jfa: true, encode: true, render: true}
[BrushCore] MSDF Available: true
```

**ç¢ºèªæ¸ˆã¿ï¼š**
- âœ… JFA Pipeline ç”ŸæˆæˆåŠŸ
- âœ… Encode Pipeline ç”ŸæˆæˆåŠŸ
- âœ… Render Pipeline ç”ŸæˆæˆåŠŸ
- âœ… `msdfAvailable === true`

**çµè«–ï¼š**
MSDF Pipeline ã¯æ­£å¸¸å‹•ä½œã—ã¦ã„ã‚‹ã€‚
æç”»ã§ããªã„åŸå› ã¯ **ãƒã‚¤ãƒ³ãƒˆãŒ1ç‚¹ã—ã‹è¨˜éŒ²ã•ã‚Œãªã„ãŸã‚**ã€‚

================================================================================

## æ”¹ä¿®å„ªå…ˆåº¦ã¨å®Ÿè¡Œé †åº

### âš ï¸ Critical (å³åº§ã«ä¿®æ­£)

1. **slider-utils.js ã® pointermove capture å‰Šé™¤**
   - document.addEventListener('pointermove', ..., {capture: true}) ã‚’å‰Šé™¤
   - containerEl.setPointerCapture ã‚’ä½¿ç”¨

2. **drawing-engine.js ã«ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°è¿½åŠ **
   - _handlePointerMove ãŒå‘¼ã°ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   - pendingPoints ã¸ã®è¿½åŠ ã‚’ç¢ºèª

3. **brush-core.js ã«ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°è¿½åŠ **
   - updateStroke ãŒå‘¼ã°ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   - isDrawing ãƒ•ãƒ©ã‚°ã®çŠ¶æ…‹ã‚’ç¢ºèª

### ğŸ”§ High Priority (æ¬¡ã«ä¿®æ­£)

4. **pointer-handler.js ã®æ¥ç¶šå…ˆç¢ºèª**
   - WebGPU canvas ã¸ã®æ­£ã—ã„æ¥ç¶šã‚’ä¿è¨¼
   - setPointerCapture ã®ç¢ºå®Ÿãªå®Ÿè¡Œ

5. **stroke-recorder.js ã«ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°è¿½åŠ **
   - addPoint ãŒå‘¼ã°ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   - points é…åˆ—ã¸ã®è¿½åŠ ã‚’ç¢ºèª

### ğŸ“ Medium Priority (æ”¹ä¿®å¾Œã«å®Ÿæ–½)

6. **PixiJS è²¬å‹™ã®å®Œå…¨åˆ†é›¢**
   - å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ˜ãƒƒãƒ‰ãƒ©ã‚¤ãƒ³ã«åˆ¶é™äº‹é …ã‚’æ˜è¨˜
   - Pixi ticker ã®åœæ­¢ã‚’ç¢ºèª

7. **åº§æ¨™å¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ¤œè¨¼**
   - _screenToLocal ã®è¿”ã‚Šå€¤ã‚’ç¢ºèª
   - åº§æ¨™å¤‰æ›ã‚¨ãƒ©ãƒ¼ã®æœ‰ç„¡ã‚’ç¢ºèª

================================================================================

## ä¿®æ­£å¾Œã®å‹•ä½œç¢ºèªæ–¹æ³•

### âœ… å¿…ãšç¢ºèªã™ã¹ããƒ­ã‚°

**æ­£å¸¸å‹•ä½œæ™‚ã®ãƒ­ã‚°ï¼š**
```
[PointerHandler] pointerdown: {pointerId: 1, clientX: 350, clientY: 88}
[DrawingEngine] _handlePointerDown called
[BrushCore] startStroke called: {localX: 350.5, localY: 88.5, pressure: 0.5}

[PointerHandler] pointermove: {pointerId: 1, clientX: 351, clientY: 89}
[DrawingEngine] _handlePointerMove called
[DrawingEngine] Queuing move point: 351, 89
[CoreEngine] Flushing pendingPoints, count: 1
[DrawingEngine] _processPointerMove: calling updateStroke
[BrushCore] updateStroke called: {localX: 351.5, localY: 89.5, pressure: 0.51}
[StrokeRecorder] addPoint called: point added successfully, total: 2

[PointerHandler] pointermove: {pointerId: 1, clientX: 352, clientY: 90}
[DrawingEngine] _handlePointerMove called
[DrawingEngine] Queuing move point: 352, 90
[CoreEngine] Flushing pendingPoints, count: 1
[DrawingEngine] _processPointerMove: calling updateStroke
[BrushCore] updateStroke called: {localX: 352.5, localY: 90.5, pressure: 0.52}
[StrokeRecorder] addPoint called: point added successfully, total: 3

... (ä»¥é™ã€pointermove ã”ã¨ã«ç¹°ã‚Šè¿”ã—)

[PointerHandler] pointerup: {pointerId: 1, clientX: 380, clientY: 110}
[DrawingEngine] _handlePointerUp called
[BrushCore] finalizeStroke called
[BrushCore] Points count: 15
[BrushCore] Finalizing with MSDF
[BrushCore] Stroke finalized successfully
```

### âŒ å•é¡ŒãŒæ®‹ã£ã¦ã„ã‚‹å ´åˆã®ãƒ­ã‚°

```
[PointerHandler] pointerdown: {pointerId: 1, clientX: 350, clientY: 88}
[DrawingEngine] _handlePointerDown called
[BrushCore] startStroke called: {localX: 350.5, localY: 88.5, pressure: 0.5}

âŒ ã“ã“ã§ pointermove ãŒæ¥ãªã„

[PointerHandler] pointerup: {pointerId: 1, clientX: 350, clientY: 88}
[DrawingEngine] _handlePointerUp called
[BrushCore] finalizeStroke called
[BrushCore] Points count: 1
[BrushCore] Stroke too short, aborting
```

================================================================================

## æ”¹ä¿®å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: PointerEventé…ä¿¡
- [ ] slider-utils.js ã® pointermove capture å‰Šé™¤å®Œäº†
- [ ] pointer-handler.js ãŒ WebGPU canvas ã«æ­£ã—ãæ¥ç¶š
- [ ] drawing-engine.js ã§ pointermove ãŒç¢ºå®Ÿã«ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°
- [ ] core-engine.js ã§ pendingPoints ãŒç¢ºå®Ÿã«ãƒ•ãƒ©ãƒƒã‚·ãƒ¥

### Phase 2: BrushCore ãƒ•ãƒ­ãƒ¼
- [ ] drawing-engine ã‹ã‚‰ updateStroke ãŒç¢ºå®Ÿã«å‘¼ã³å‡ºã•ã‚Œã‚‹
- [ ] brush-core.js ã§ isDrawing ãƒ•ãƒ©ã‚°ãŒæ­£ã—ãç®¡ç†ã•ã‚Œã‚‹
- [ ] åº§æ¨™å¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒæ­£å¸¸å‹•ä½œ

### Phase 3: StrokeRecorder
- [ ] addPoint ãŒ pointermove ã”ã¨ã«å‘¼ã³å‡ºã•ã‚Œã‚‹
- [ ] points é…åˆ—ã« 2ç‚¹ä»¥ä¸Š ç¢ºå®Ÿã«è¨˜éŒ²ã•ã‚Œã‚‹
- [ ] endStroke ã§ strokeData ãŒæ­£å¸¸ç”Ÿæˆ

### Phase 4: PixiJSåˆ†é›¢
- [ ] å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ˜ãƒƒãƒ‰ãƒ©ã‚¤ãƒ³ã«è²¬å‹™åˆ¶é™ã‚’æ˜è¨˜
- [ ] Pixi ticker ãŒåœæ­¢ã—ã¦ã„ã‚‹
- [ ] WebGPU Master Loop ã®ã¿ãŒå‹•ä½œ

### Phase 5: MSDF Pipeline
- [ ] 2ç‚¹ä»¥ä¸Šã®ãƒã‚¤ãƒ³ãƒˆãŒ MSDF ã«æ¸¡ã•ã‚Œã‚‹
- [ ] generateMSDF ãŒæ­£å¸¸å®Ÿè¡Œ
- [ ] æç”»çµæœãŒ canvas ã«è¡¨ç¤ºã•ã‚Œã‚‹

================================================================================

## æœ€çµ‚ç¢ºèªã‚³ãƒãƒ³ãƒ‰

### ãƒ‡ãƒãƒƒã‚°ç”¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰

```javascript
// â‘  PointerEvent é…ä¿¡çŠ¶æ…‹ç¢ºèª
window.debugPointerFlow = true;

// â‘¡ BrushCore çŠ¶æ…‹ç¢ºèª
console.log('BrushCore:', {
    initialized: window.BrushCore?.initialized,
    msdfAvailable: window.BrushCore?.msdfAvailable,
    isDrawing: window.BrushCore?.isDrawing
});

// â‘¢ StrokeRecorder çŠ¶æ…‹ç¢ºèª
console.log('StrokeRecorder:', {
    isRecording: window.strokeRecorder?.isRecording,
    pointsCount: window.strokeRecorder?.points.length,
    stats: window.strokeRecorder?.getStats()
});

// â‘£ MSDF Pipeline çŠ¶æ…‹ç¢ºèª
console.log('MSDF Pipeline:', {
    gpuProcessor: window.GPUStrokeProcessor?.initialized,
    msdfManager: window.MSDFPipelineManager?.initialized,
    textureBridge: window.WebGPUTextureBridge?.initialized
});
```

================================================================================

## ã¾ã¨ã‚

### æ ¹æœ¬åŸå› 
**PointerMove ã‚¤ãƒ™ãƒ³ãƒˆãŒ drawing-engine ã«å±Šã„ã¦ã„ãªã„**

### ä¸»è¦åŸå› 
1. slider-utils.js ãŒ documentå…¨ä½“ã® pointermove ã‚’ capture ã—ã¦ã„ã‚‹
2. activePointers ã® isDrawing ãƒ•ãƒ©ã‚°ãŒæ­£ã—ãç®¡ç†ã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§
3. pendingPoints ã®ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ãŒæ©Ÿèƒ½ã—ã¦ã„ãªã„å¯èƒ½æ€§

### ä¿®æ­£æ–¹é‡
1. slider-utils.js ã® pointermove capture ã‚’å‰Šé™¤
2. drawing-engine / brush-core / stroke-recorder ã«è©³ç´°ãƒ­ã‚°ã‚’è¿½åŠ 
3. PointerEvent ã®é…ä¿¡çµŒè·¯ã‚’å®Œå…¨ã«å¯è¦–åŒ–
4. å•é¡Œç®‡æ‰€ã‚’ç‰¹å®šã—ã¦æ®µéšçš„ã«ä¿®æ­£

### MSDF Pipeline ã«ã¤ã„ã¦
âœ… **MSDF Pipeline ã¯æ­£å¸¸å‹•ä½œã—ã¦ã„ã‚‹**
å•é¡Œã¯ã€Œãƒã‚¤ãƒ³ãƒˆãŒ1ç‚¹ã—ã‹è¨˜éŒ²ã•ã‚Œãªã„ã€ã“ã¨ã§ã‚ã‚Šã€MSDF ä»¥å‰ã®å•é¡Œã€‚

================================================================================