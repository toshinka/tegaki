================================================================================
WebGPU MSDF ãƒãƒªã‚´ãƒ³ãƒšãƒ³ç§»è¡Œè¨ˆç”»æ›¸ v1.0
PerfectFreehandä¾å­˜è„±å´ â†’ Compute Shaderå®Œçµå‹æç”»åŸºç›¤æ§‹ç¯‰
================================================================================

ã€å‡¡ä¾‹ã€‘
âš ï¸ = å•é¡Œç®‡æ‰€ãƒ»å®Ÿè£…ä¸å®Œå…¨
ğŸ”§ = æ”¹ä¿®å¿…è¦
âœ… = æ­£å¸¸å‹•ä½œç¢ºèªæ¸ˆã¿
âŒ = æœªå®Ÿè£…ãƒ»æ©Ÿèƒ½ä¸å…¨
ğŸ” = è¦èª¿æŸ»
ğŸ“ = è¦ªãƒ•ã‚¡ã‚¤ãƒ«
ğŸ“„ = å­ãƒ•ã‚¡ã‚¤ãƒ«
ğŸ”€ = ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼é–¢é€£
ğŸš€ = æ–°è¦å®Ÿè£…
â™»ï¸ = å¤§è¦æ¨¡æ”¹ä¿®

================================================================================
1. ç§»è¡Œåˆ¤æ–­ã¨æˆ¦ç•¥æ–¹é‡
================================================================================

ã€ç¾çŠ¶è¨ºæ–­ã€‘
âš ï¸ PerfectFreehandä¾å­˜ã«ã‚ˆã‚Šä»¥ä¸‹ã®æ§‹é€ çš„å•é¡ŒãŒç™ºç”Ÿ:
  - CPU â†’ GPUé–“ã®äºŒæ®µéšå‡¦ç†ã«ã‚ˆã‚‹ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·
  - ãƒ©ã‚¹ã‚¿ãƒ©ã‚¤ã‚ºçš„ã¼ã‚„ã‘ï¼ˆFragment Shaderã®é™ç•Œï¼‰
  - æ¶ˆã—ã‚´ãƒ BlendModeã®ä¸å®‰å®šæ€§
  - åŒæœŸå¾…æ©Ÿã®è¤‡é›‘åŒ–ã«ã‚ˆã‚‹ãƒ•ãƒªãƒƒã‚«ãƒ¼

ã€ç§»è¡Œç†ç”±ã€‘
âœ… çµ±ä¸€æç”»åŸºç›¤: ãƒšãƒ³/æ¶ˆã—ã‚´ãƒ /ãƒ–ãƒ©ã‚·ã‚’SDFæ¼”ç®—ã§çµ±ä¸€
âœ… GPUå®Œçµå‡¦ç†: Computeå†…ã§è·é›¢è¨ˆç®—â†’åˆæˆâ†’å‡ºåŠ›
âœ… ãƒ™ã‚¯ã‚¿ãƒ¼å“è³ª: æ‹¡å¤§ç¸®å°è€æ€§ã®ã‚ã‚‹ã‚¨ãƒƒã‚¸è¡¨ç¾
âœ… æ‹¡å¼µå®¹æ˜“æ€§: æ–°ãƒ–ãƒ©ã‚· = è·é›¢é–¢æ•°ã®æ´¾ç”Ÿå®Ÿè£…

ã€æˆ¦ç•¥æ–¹é‡ã€‘
ğŸ“Œ æ®µéšçš„ç§»è¡Œï¼ˆPhaseåˆ¶ï¼‰ã§ãƒªã‚¹ã‚¯åˆ†æ•£
ğŸ“Œ CPU fallbackä¸è¦ï¼ˆWebGPUå‰æã§çµ±ä¸€ï¼‰
ğŸ“Œ PerfectFreehandå®Œå…¨å‰Šé™¤ï¼ˆä¾å­˜ã‚¼ãƒ­åŒ–ï¼‰
ğŸ“Œ åº§æ¨™å¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ç¶­æŒï¼ˆdrawing-engineçµŒç”±ï¼‰

================================================================================
2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ
================================================================================

ã€æ–°è¦æç”»ãƒ•ãƒ­ãƒ¼ã€‘

ğŸ”€ PointerEvent (screenåº§æ¨™)
  â†“
ğŸ“„ drawing-engine.js âœ… [å¤‰æ›´ä¸è¦]
  - screenClientToCanvas() [DPIè£œæ­£]
  - canvasToWorld() [worldContaineré€†è¡Œåˆ—]
  - worldToLocal() [è¦ªãƒã‚§ãƒ¼ãƒ³é€†ç®—]
  â†“ {localX, localY, pressure}
ğŸ“„ brush-core.js âœ… [å¤‰æ›´ä¸è¦]
  - startStroke() / updateStroke()
  â†“
ğŸ“„ stroke-recorder.js âœ… [å¤‰æ›´ä¸è¦]
  - addPoint() [Localåº§æ¨™è¨˜éŒ²]
  â†“ points[]
ğŸš€ gpu-stroke-processor.js ã€æ–°è¦ã€‘
  - points[] â†’ EdgeBufferå¤‰æ›
  - GPU StorageBufferè»¢é€
  â†“ EdgeBuffer (GPU)
ğŸš€ msdf-generator-compute.wgsl ã€æ–°è¦ã€‘
  - SeedåˆæœŸåŒ– Compute Pass
  - JFA (Jump Flood Algorithm) Compute Pass
  - MSDF Encode Compute Pass
  â†“ MSDF Texture (GPU)
ğŸš€ msdf-compose-compute.wgsl ã€æ–°è¦ã€‘
  - å‰ãƒ•ãƒ¬ãƒ¼ãƒ MSDF + æ–°ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯åˆæˆ
  - Pen: min() / Eraser: max()
  â†“ Composed MSDF Texture (GPU)
ğŸš€ msdf-render.wgsl ã€æ–°è¦ã€‘
  - median(r,g,b) â†’ smoothstep â†’ alpha
  â†“ Final Render Texture
ğŸ“„ webgpu-texture-bridge.js âœ… [å¤‰æ›´ä¸è¦]
  - GPUTexture â†’ Pixi.Sprite
  â†“
ğŸ“„ ç”»é¢è¡¨ç¤º

ã€å‰Šé™¤å¯¾è±¡ã€‘
âŒ polygon-generator.js (PerfectFreehandä¾å­˜)
âŒ webgpu-geometry-layer.js (Vertex/Indexè»¢é€ä¸è¦)
âŒ earcut-triangulator.js (ä¸‰è§’åŒ–ä¸è¦)
âŒ stroke-renderer.js (æ–°å®Ÿè£…ã¸ç½®æ›)

ã€æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã€‘
ğŸš€ gpu-stroke-processor.js
ğŸš€ msdf-seed-init.wgsl
ğŸš€ msdf-jfa-pass.wgsl
ğŸš€ msdf-encode.wgsl
ğŸš€ msdf-compose.wgsl
ğŸš€ msdf-render.wgsl
ğŸš€ msdf-pipeline-manager.js

ã€æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«ã€‘
â™»ï¸ core-initializer.js (åˆæœŸåŒ–é †åºå¤‰æ›´)
â™»ï¸ webgpu-drawing-layer.js (Computeå¯¾å¿œæ‹¡å¼µ)

================================================================================
3. æŠ€è¡“è¦ä»¶ãƒ»ä»•æ§˜è©³ç´°
================================================================================

ã€3-1. EdgeBufferæ§‹é€ ã€‘

Float32Arrayæ§‹é€ :
  [x0, y0, x1, y1, edgeId, channelId, padding, padding]
  - x0,y0: ã‚¨ãƒƒã‚¸å§‹ç‚¹
  - x1,y1: ã‚¨ãƒƒã‚¸çµ‚ç‚¹
  - edgeId: ã‚¨ãƒƒã‚¸è­˜åˆ¥å­ï¼ˆç¬¦å·åˆ¤å®šç”¨ï¼‰
  - channelId: MSDFå‰²ã‚Šå½“ã¦ãƒãƒ£ãƒ³ãƒãƒ« (0=R, 1=G, 2=B)

GPU StorageBuffer:
  @group(0) @binding(0) var<storage, read> edges: array<vec4<f32>>;

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€3-2. MSDFç”Ÿæˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã€‘

â–  Phase A: SeedåˆæœŸåŒ–
  - ã‚¨ãƒƒã‚¸ç«¯ç‚¹ãƒ»ä¸­ç‚¹ã‚’ seedTexture ã¸æ›¸ãè¾¼ã¿
  - å„Seedã«æœ€è¿‘æ¥EdgeIdè¨˜éŒ²
  - Format: rgba32float

â–  Phase B: JFA (Jump Flood Algorithm)
  - Ping-Pong ãƒ†ã‚¯ã‚¹ãƒãƒ£ã§è¿‘æ¥Seedä¼æ’­
  - Step: canvas_max_size / 2 â†’ 1 (log2åå¾©)
  - è·é›¢äºŒä¹—ã§æœ€å°Seedã‚’é¸æŠ

â–  Phase C: MSDF Encode
  - å„ãƒ”ã‚¯ã‚»ãƒ«ã§æœ€è¿‘æ¥Edgeã¸ã®Signed Distanceè¨ˆç®—
  - ç¬¦å·åˆ¤å®š: Edgeã®Winding Numberæ³•
  - 3ãƒãƒ£ãƒ³ãƒãƒ« (R/G/B) ã«ç•°ãªã‚‹Edgeè·é›¢è¨˜éŒ²

â–  Phase D: Compose
  - å‰ãƒ•ãƒ¬ãƒ¼ãƒ MSDF + æ–°ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯MSDFåˆæˆ
  - Pen: min(prev, new) [è·é›¢ã®æœ€å°å€¤]
  - Eraser: max(prev, new) [è·é›¢ã®æœ€å¤§å€¤]

â–  Phase E: Render
  - median(r,g,b) ã§çµ±åˆè·é›¢å–å¾—
  - smoothstep(threshold-range, threshold+range, d) â†’ alpha
  - Fragment Shaderå‡ºåŠ›

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€3-3. Compute Shader workgroupè¨­è¨ˆã€‘

seedInit: @workgroup_size(64)
  - 1D dispatch: edgeCount

jfaPass: @workgroup_size(8,8)
  - 2D dispatch: (width/8, height/8)

msdfEncode: @workgroup_size(8,8)
  - 2D dispatch: (width/8, height/8)

compose: @workgroup_size(8,8)
  - 2D dispatch: (width/8, height/8)

render: Fragment Shader (workgroupä¸è¦)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€3-4. Texture Formatã€‘

seedTexture: rgba32float
  - r,g: Seedåº§æ¨™ (x,y)
  - b: EdgeId
  - a: è·é›¢äºŒä¹—

msdfTexture: rgba16float
  - r,g,b: å„ãƒãƒ£ãƒ³ãƒãƒ«è·é›¢
  - a: æœªä½¿ç”¨ï¼ˆå°†æ¥æ‹¡å¼µç”¨ï¼‰

composedTexture: rgba16float

finalTexture: rgba8unorm

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€3-5. ç¬¦å·åˆ¤å®šï¼ˆInside/Outsideï¼‰ã€‘

æ–¹å¼: CPUäº‹å‰è¨ˆç®— + GPUå‚ç…§

stroke-recorder.js:
  - ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯çµ‚äº†æ™‚ã«Windingè¨ˆç®—
  - å„Edgeã«insideFlagä»˜ä¸ (-1 or +1)

EdgeBufferæ‹¡å¼µ:
  [x0, y0, x1, y1, edgeId, channelId, insideFlag, padding]

msdf-encode.wgsl:
  - EdgeBufferã‹ã‚‰insideFlagã‚’å‚ç…§
  - distance *= insideFlag ã§ç¬¦å·é©ç”¨

================================================================================
4. ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥æ”¹ä¿®è©³ç´°
================================================================================

ã€4-1. æ–°è¦: gpu-stroke-processor.jsã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸš€ è²¬å‹™:
  - stroke-recorder.points[] â†’ EdgeBufferå¤‰æ›
  - GPU StorageBufferä½œæˆãƒ»è»¢é€
  - EdgeBufferç®¡ç†ï¼ˆä½œæˆ/ç ´æ£„ï¼‰

ğŸ“ ä¾å­˜Parents:
  - stroke-recorder.js (pointså–å¾—)
  - webgpu-drawing-layer.js (device/queue)

ğŸ“„ ä¾å­˜Children:
  - msdf-pipeline-manager.js (EdgeBufferæ¸¡ã—)

ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:
  - createEdgeBuffer(points[], windingData)
    â†’ Float32Array EdgeBuffer
  
  - uploadToGPU(edgeBuffer)
    â†’ GPUBuffer
  
  - calculateWinding(points[])
    â†’ insideFlag[] (-1 or +1 per edge)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€4-2. æ–°è¦: msdf-pipeline-manager.jsã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸš€ è²¬å‹™:
  - Compute Pipelineçµ±åˆç®¡ç†
  - Seed/JFA/Encode/Compose/Render Passå®Ÿè¡Œ
  - Texture Ping-Pongç®¡ç†

ğŸ“ ä¾å­˜Parents:
  - webgpu-drawing-layer.js (device/queue/format)
  - gpu-stroke-processor.js (EdgeBuffer)

ğŸ“„ ä¾å­˜Children:
  - brush-core.js (å‘¼ã³å‡ºã—å…ƒ)

ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:
  - initialize(device, format)
  - generateMSDF(edgeBuffer, bounds, existingMSDF)
    â†’ MSDF Texture
  
  - composeMSDF(prevMSDF, newMSDF, mode='pen')
    â†’ Composed MSDF Texture
  
  - renderToTexture(msdfTexture, width, height)
    â†’ Final Render Texture

å†…éƒ¨ãƒ¡ã‚½ãƒƒãƒ‰:
  - _seedInitPass(edgeBuffer, seedTexture)
  - _jfaPass(srcTexture, dstTexture, step)
  - _encodePass(seedTexture, edgeBuffer, msdfTexture)
  - _composePass(prevMSDF, newMSDF, mode)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€4-3. æ–°è¦: msdf-seed-init.wgslã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸš€ Compute Shader

Input:
  @group(0) @binding(0) var<storage, read> edges: array<vec4<f32>>;
  @group(0) @binding(1) var seedTex: texture_storage_2d<rgba32float, write>;

å‡¦ç†:
  - ã‚¨ãƒƒã‚¸ç«¯ç‚¹ (x0,y0), (x1,y1) ã‚’ seedTex ã¸æ›¸ãè¾¼ã¿
  - ä¸­ç‚¹ ((x0+x1)/2, (y0+y1)/2) ã‚‚æ›¸ãè¾¼ã¿
  - å„Seedã« edgeId è¨˜éŒ²

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€4-4. æ–°è¦: msdf-jfa-pass.wgslã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸš€ Compute Shader (Ping-Pongç”¨)

Input:
  @group(0) @binding(0) var srcTex: texture_2d<f32>;
  @group(0) @binding(1) var dstTex: texture_storage_2d<rgba32float, write>;
  @group(0) @binding(2) var<uniform> uStep: u32;

å‡¦ç†:
  - è‡ªåº§æ¨™ + 8æ–¹å‘ (Â±step) ã®Seedã‚’ã‚µãƒ³ãƒ—ãƒ«
  - è·é›¢äºŒä¹—ã§æœ€å°Seedã‚’é¸æŠ
  - dstTex ã¸æ›¸ãè¾¼ã¿

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€4-5. æ–°è¦: msdf-encode.wgslã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸš€ Compute Shader

Input:
  @group(0) @binding(0) var seedTex: texture_2d<f32>;
  @group(0) @binding(1) var<storage, read> edges: array<vec4<f32>>;
  @group(0) @binding(2) var msdfTex: texture_storage_2d<rgba16float, write>;

å‡¦ç†:
  - seedTex ã‹ã‚‰æœ€è¿‘æ¥EdgeIdå–å¾—
  - Edgeã¸ã®æœ€çŸ­è·é›¢è¨ˆç®—ï¼ˆç‚¹-ç·šåˆ†è·é›¢ï¼‰
  - insideFlag ã§ç¬¦å·é©ç”¨
  - channelId ã«å¿œã˜ã¦ r/g/b ã«æ›¸ãè¾¼ã¿

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€4-6. æ–°è¦: msdf-compose.wgslã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸš€ Compute Shader

Input:
  @group(0) @binding(0) var prevMSDF: texture_2d<f32>;
  @group(0) @binding(1) var newMSDF: texture_2d<f32>;
  @group(0) @binding(2) var<uniform> uMode: u32; // 0=pen, 1=eraser
  @group(0) @binding(3) var outTex: texture_storage_2d<rgba16float, write>;

å‡¦ç†:
  - mode=pen: min(prev, new)
  - mode=eraser: max(prev, new)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€4-7. æ–°è¦: msdf-render.wgslã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸš€ Fragment Shader

Input:
  @group(0) @binding(0) var msdfSampler: sampler;
  @group(0) @binding(1) var msdfTex: texture_2d<f32>;
  @group(0) @binding(2) var<uniform> uThreshold: f32;
  @group(0) @binding(3) var<uniform> uRange: f32;
  @group(0) @binding(4) var<uniform> uColor: vec4<f32>;

å‡¦ç†:
  - ms = textureSample(msdfTex, uv)
  - d = median(ms.r, ms.g, ms.b)
  - alpha = smoothstep(uThreshold-uRange, uThreshold+uRange, d)
  - return vec4(uColor.rgb, uColor.a * alpha)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€4-8. æ”¹ä¿®: core-initializer.jsã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â™»ï¸ å¤‰æ›´å†…å®¹:

åˆæœŸåŒ–é †åºå¤‰æ›´:
  âŒ å‰Šé™¤: webgpu-geometry-layer.js
  âŒ å‰Šé™¤: earcut-triangulator.js
  ğŸš€ è¿½åŠ : gpu-stroke-processor.js
  ğŸš€ è¿½åŠ : msdf-pipeline-manager.js

åˆæœŸåŒ–ã‚·ãƒ¼ã‚±ãƒ³ã‚¹:
  1. webgpu-drawing-layer.initialize()
  2. gpu-stroke-processor.initialize()
  3. msdf-pipeline-manager.initialize()
  4. webgpu-texture-bridge.initialize()

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€4-9. æ”¹ä¿®: webgpu-drawing-layer.jsã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â™»ï¸ å¤‰æ›´å†…å®¹:

Computeå¯¾å¿œæ‹¡å¼µ:
  - createComputePipeline() ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ 
  - Compute BindGroupLayoutä½œæˆã‚µãƒãƒ¼ãƒˆ
  - StorageBufferä½œæˆãƒ˜ãƒ«ãƒ‘ãƒ¼è¿½åŠ 

ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ :
  - createStorageBuffer(size, label)
  - createComputePipeline(shaderModule, layout, entryPoint)
  - createStorageTexture(width, height, format)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€4-10. æ”¹ä¿®: brush-core.jsã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â™»ï¸ å¤‰æ›´å†…å®¹:

strokeçµ‚äº†å‡¦ç†å¤‰æ›´:
  
  // æ—§
  âŒ const polygon = polygonGenerator.generate(points);
  âŒ strokeRenderer.renderPreview(polygon, ...);

  // æ–°
  âœ… const edgeBuffer = gpuStrokeProcessor.createEdgeBuffer(points);
  âœ… const msdfTexture = msdfPipelineManager.generateMSDF(edgeBuffer, bounds);
  âœ… const sprite = textureBridge.createSpriteFromGPUTexture(msdfTexture, ...);

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€4-11. å‰Šé™¤å¯¾è±¡è©³ç´°ã€‘

âŒ polygon-generator.js
  - PerfectFreehandå®Ÿè¡Œå‡¦ç†
  - å®Œå…¨å‰Šé™¤

âŒ webgpu-geometry-layer.js
  - Vertex/IndexBufferè»¢é€
  - RenderPipelineç®¡ç†
  - å®Œå…¨å‰Šé™¤

âŒ earcut-triangulator.js
  - ä¸‰è§’åŒ–å‡¦ç†
  - å®Œå…¨å‰Šé™¤

âŒ stroke-renderer.js
  - æ—§æç”»ãƒ•ãƒ­ãƒ¼
  - msdf-pipeline-manager.js ã¸ç½®æ›

================================================================================
5. å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚ºè¨ˆç”»
================================================================================

ã€Phase 0: æº–å‚™ãƒ»æ¤œè¨¼ã€‘ (1æ—¥)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… WebGPU Computeæ©Ÿèƒ½ç¢ºèª
  - device.createComputePipeline() å‹•ä½œç¢ºèª
  - StorageBuffer read/write ç¢ºèª

âœ… ãƒ†ã‚¹ãƒˆã‚­ãƒ£ãƒ³ãƒã‚¹ä½œæˆ
  - å˜ç´”ãªçŸ©å½¢EdgeBufferã§SeedåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
  - seedTextureå¯è¦–åŒ–ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€Phase 1: SeedåˆæœŸåŒ–å®Ÿè£…ã€‘ (2æ—¥)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸš€ gpu-stroke-processor.js å®Ÿè£…
  - createEdgeBuffer() ãƒ¡ã‚½ãƒƒãƒ‰
  - uploadToGPU() ãƒ¡ã‚½ãƒƒãƒ‰

ğŸš€ msdf-seed-init.wgsl å®Ÿè£…
  - ã‚¨ãƒƒã‚¸ç«¯ç‚¹ãƒ»ä¸­ç‚¹æ›¸ãè¾¼ã¿

ğŸš€ msdf-pipeline-manager.js éª¨æ ¼ä½œæˆ
  - _seedInitPass() å®Ÿè£…

âœ… æ¤œè¨¼:
  - seedTextureå¯è¦–åŒ–ã§ç«¯ç‚¹ãŒæ­£ã—ãæ›¸ãè¾¼ã¾ã‚Œã‚‹

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€Phase 2: JFAå®Ÿè£…ã€‘ (3æ—¥)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸš€ msdf-jfa-pass.wgsl å®Ÿè£…
  - 8æ–¹å‘Seedä¼æ’­
  - è·é›¢äºŒä¹—æ¯”è¼ƒ

ğŸš€ Ping-Pong Textureç®¡ç†
  - msdf-pipeline-manager.js å†…å®Ÿè£…
  - _jfaPass() åå¾©å®Ÿè¡Œ

âœ… æ¤œè¨¼:
  - JFAå®Œäº†å¾Œã®seedTextureå¯è¦–åŒ–
  - å…¨ãƒ”ã‚¯ã‚»ãƒ«ãŒæœ€è¿‘æ¥Seedä¿æŒç¢ºèª

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€Phase 3: MSDF Encodeå®Ÿè£…ã€‘ (3æ—¥)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸš€ msdf-encode.wgsl å®Ÿè£…
  - ç‚¹-ç·šåˆ†è·é›¢è¨ˆç®—
  - ç¬¦å·åˆ¤å®šï¼ˆCPUäº‹å‰è¨ˆç®—ç‰ˆï¼‰

ğŸš€ Windingè¨ˆç®—å®Ÿè£…
  - gpu-stroke-processor.calculateWinding()
  - EdgeBufferã¸insideFlagè¿½åŠ 

âœ… æ¤œè¨¼:
  - msdfTextureå¯è¦–åŒ–ï¼ˆR/G/Bå„ãƒãƒ£ãƒ³ãƒãƒ«ï¼‰
  - ç¬¦å·ï¼ˆå†…å¤–åˆ¤å®šï¼‰æ­£ç¢ºæ€§ç¢ºèª

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€Phase 4: Compose & Renderå®Ÿè£…ã€‘ (2æ—¥)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸš€ msdf-compose.wgsl å®Ÿè£…
  - Pen: min() / Eraser: max()

ğŸš€ msdf-render.wgsl å®Ÿè£…
  - median() â†’ smoothstep â†’ alpha

ğŸš€ msdf-pipeline-manager.js çµ±åˆ
  - composeMSDF() / renderToTexture()

âœ… æ¤œè¨¼:
  - ãƒšãƒ³æç”»ã§ã‚¨ãƒƒã‚¸æ»‘ã‚‰ã‹
  - æ¶ˆã—ã‚´ãƒ ã§æ­£ç¢ºã«æ¶ˆå»

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€Phase 5: çµ±åˆãƒ»æœ€é©åŒ–ã€‘ (3æ—¥)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â™»ï¸ brush-core.js çµ±åˆ
  - æ—§ãƒ•ãƒ­ãƒ¼å‰Šé™¤
  - æ–°ãƒ•ãƒ­ãƒ¼æ¥ç¶š

ğŸ”§ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
  - workgroup_sizeèª¿æ•´
  - Seedå¯†åº¦ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°
  - Texture Formatæœ€é©åŒ–ï¼ˆrgba16floatç¢ºèªï¼‰

âœ… æ¤œè¨¼:
  - é€£ç¶šæç”»60fpsç¶­æŒ
  - ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ç„¡ã—
  - GPUä½¿ç”¨ç‡ç¢ºèª

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€Phase 6: QAãƒ»ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹å¯¾å¿œã€‘ (2æ—¥)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ” ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
  - æ¥µç«¯ã«ç´°ã„ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯
  - é«˜é€Ÿã‚¹ãƒˆãƒ­ãƒ¼ã‚¯
  - è‡ªå·±äº¤å·®ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯
  - ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ‡ã‚Šæ›¿ãˆæ™‚ã®æŒ™å‹•

ğŸ”§ ä¸å…·åˆä¿®æ­£
  - ç¬¦å·åˆ¤å®šç²¾åº¦æ”¹å–„
  - JFA Stepæ•°èª¿æ•´
  - Threshold/Rangeèª¿æ•´

âœ… æœ€çµ‚æ¤œè¨¼:
  - å„ãƒ–ãƒ©ã‚¦ã‚¶å‹•ä½œç¢ºèªï¼ˆChrome/Edgeï¼‰
  - DPRå›ºå®šå‹•ä½œç¢ºèª

================================================================================
6. ãƒ¡ã‚½ãƒƒãƒ‰ãƒ»ã‚·ãƒ³ãƒœãƒ«è¾å…¸
================================================================================

ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€‘

âœ… window.WebGPUDrawingLayer
  - device: GPUDevice
  - queue: GPUQueue
  - format: GPUTextureFormat
  - createStorageBuffer(size, label): GPUBuffer
  - createComputePipeline(module, layout, entry): GPUComputePipeline
  - createStorageTexture(w, h, format): GPUTexture

ğŸš€ window.GPUStrokeProcessor
  - initialize(device): Promise<void>
  - createEdgeBuffer(points[], windingData): Float32Array
  - uploadToGPU(edgeBuffer): GPUBuffer
  - calculateWinding(points[]): Float32Array
  - destroy(): void

ğŸš€ window.MSDFPipelineManager
  - initialize(device, format): Promise<void>
  - generateMSDF(edgeBuffer, bounds, existingMSDF): GPUTexture
  - composeMSDF(prevMSDF, newMSDF, mode): GPUTexture
  - renderToTexture(msdfTexture, w, h): GPUTexture
  - destroy(): void

âœ… window.WebGPUTextureBridge [å¤‰æ›´ä¸è¦]
  - createSpriteFromGPUTexture(texture, w, h): Promise<Sprite>

ã€å‰Šé™¤ã‚·ãƒ³ãƒœãƒ«ã€‘

âŒ window.WebGPUGeometryLayer
âŒ window.EarcutTriangulator
âŒ window.PolygonGenerator
âŒ window.StrokeRenderer

ã€åº§æ¨™å¤‰æ›ãƒ¡ã‚½ãƒƒãƒ‰ã€‘ [å¤‰æ›´ä¸è¦]

ğŸ“„ drawing-engine.js
  - screenClientToCanvas(screenX, screenY): {canvasX, canvasY}
  - canvasToWorld(canvasX, canvasY): {worldX, worldY}
  - worldToLocal(worldX, worldY, container): {localX, localY}

ã€æ–°è¦ãƒ¡ã‚½ãƒƒãƒ‰è©³ç´°ã€‘

gpu-stroke-processor.js:
  - createEdgeBuffer(points, windingData)
    Input: points[] = [x0,y0, x1,y1, ...]
           windingData = {insideFlags: [...]}
    Output: Float32Array EdgeBuffer
    
  - calculateWinding(points)
    Input: points[] (closed loop)
    Output: {insideFlags: Float32Array}
    Algorithm: Winding Numberæ³•

msdf-pipeline-manager.js:
  - generateMSDF(edgeBuffer, bounds, existingMSDF)
    Input: GPUBuffer edgeBuffer
           bounds = {minX, minY, maxX, maxY}
           existingMSDF = GPUTexture or null
    Output: GPUTexture (MSDF)
    
    å†…éƒ¨å‡¦ç†:
      1. SeedåˆæœŸåŒ– Compute Pass
      2. JFA Pass (log2(max(w,h)) åå¾©)
      3. MSDF Encode Compute Pass
      4. existingMSDFå­˜åœ¨æ™‚ã¯ Compose Passå®Ÿè¡Œ
    
  - composeMSDF(prevMSDF, newMSDF, mode)
    Input: prevMSDF, newMSDF (GPUTexture)
           mode = 'pen' | 'eraser'
    Output: GPUTexture (Composed MSDF)
    
  - renderToTexture(msdfTexture, w, h)
    Input: msdfTexture (GPUTexture)
    Output: GPUTexture (rgba8unorm, final render)

================================================================================
7. åº§æ¨™ç³»ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è©³ç´°
================================================================================

ã€åº§æ¨™ç³»ã€‘

Screen â†’ Canvas â†’ World â†’ Local â†’ EdgeBuffer â†’ GPU

EdgeBufferåº§æ¨™ç³»: Localåº§æ¨™ç³»
  - drawing-engine ã§ Localå¤‰æ›å®Œäº†æ¸ˆã¿
  - gpu-stroke-processor ã§å—ã‘å–ã‚Šãã®ã¾ã¾ä½¿ç”¨
  - GPUå´ã§ NDCå¤‰æ›ä¸è¦ï¼ˆComputeå†…ã§ç‹¬ç«‹å‡¦ç†ï¼‰

ã€ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã€‘

PointerEvent
  â†“ [drawing-engine]
Localåº§æ¨™ {localX, localY, pressure}
  â†“ [stroke-recorder]
points[] = [x0,y0, x1,y1, ...]
  â†“ [gpu-stroke-processor]
EdgeBuffer Float32Array + Windingè¨ˆç®—
  â†“ [uploadToGPU]
GPU StorageBuffer
  â†“ [msdf-pipeline-manager]
MSDF Generation (Seed â†’ JFA â†’ Encode)
  â†“
MSDF Texture (rgba16float)
  â†“ [Compose Pass]
Composed MSDF Texture
  â†“ [Render Pass]
Final Texture (rgba8unorm)
  â†“ [webgpu-texture-bridge]
Pixi.Sprite
  â†“
ç”»é¢è¡¨ç¤º

================================================================================
8. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™ãƒ»åˆ¶ç´„
================================================================================

ã€ç›®æ¨™ã€‘
âœ… 60fpsç¶­æŒï¼ˆ2048x2048ã‚­ãƒ£ãƒ³ãƒã‚¹ã€ãƒ–ãƒ©ã‚·å¾„32ï¼‰
âœ… 80-120fpsåˆ°é”ï¼ˆã‚¿ã‚¤ãƒ«åŒ–å®Ÿè£…å¾Œï¼‰
âœ… GPUä½¿ç”¨ç‡ < 50%
âœ… ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ç„¡ã—

ã€åˆ¶ç´„ã€‘
âš ï¸ Texture Format: rgba16float å¿…é ˆ
  - webgpu-capabilities.js ã§äº‹å‰ç¢ºèª
  - éå¯¾å¿œç’°å¢ƒã¯èµ·å‹•æ™‚ã‚¨ãƒ©ãƒ¼

âš ï¸ Compute Shaderåˆ¶é™
  - maxComputeInvocationsPerWorkgroup: 256
  - workgroup_size(8,8) = 64 (æ¨å¥¨)

âš ï¸ Seedå¯†åº¦ vs ç²¾åº¦ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•
  - Seedå¯†åº¦é«˜ â†’ ç²¾åº¦å‘ä¸Šã€ã‚³ã‚¹ãƒˆå¢—
  - åˆæœŸå€¤: ã‚¨ãƒƒã‚¸ç«¯ç‚¹ + ä¸­ç‚¹ã®ã¿