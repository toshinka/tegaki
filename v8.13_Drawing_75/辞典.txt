// ===== 完全なシンボル辞典の作成 =====

const symbolDict = {
    timestamp: new Date().toISOString(),
    
    // グローバルオブジェクト
    globals: {
        PIXI: {
            version: PIXI.VERSION,
            Graphics: typeof PIXI.Graphics,
            Container: typeof PIXI.Container,
            Application: typeof PIXI.Application
        },
        CoordinateSystem: typeof window.CoordinateSystem,
        TegakiEventBus: typeof window.TegakiEventBus,
        CoreRuntime: typeof window.CoreRuntime,
        DrawingEngine: typeof window.DrawingEngine,
        StrokeRenderer: typeof window.StrokeRenderer,
        StrokeRecorder: typeof window.StrokeRecorder,
        PressureHandler: typeof window.PressureHandler,
        CurveInterpolator: typeof window.CurveInterpolator
    },
    
    // CoreRuntime内部構造
    coreRuntime: {
        initialized: window.CoreRuntime?.internal?.initialized,
        pointerEventsSetup: window.CoreRuntime?.internal?.pointerEventsSetup,
        app: !!window.CoreRuntime?.internal?.app,
        stage: !!window.CoreRuntime?.internal?.app?.stage,
        worldContainer: !!window.CoreRuntime?.internal?.worldContainer,
        cameraSystem: !!window.CoreRuntime?.internal?.cameraSystem,
        layerManager: !!window.CoreRuntime?.internal?.layerManager,
        drawingEngine: !!window.CoreRuntime?.internal?.drawingEngine
    },
    
    // DrawingEngine構造
    drawingEngine: null,
    
    // StrokeRenderer構造
    strokeRenderer: null,
    
    // レイヤー構造
    layers: null,
    
    // イベントリスナー
    eventListeners: null
};

// DrawingEngine詳細
const engine = window.CoreRuntime?.internal?.drawingEngine;
if (engine) {
    symbolDict.drawingEngine = {
        className: engine.constructor.name,
        isDrawing: engine.isDrawing,
        currentTool: engine.currentTool,
        currentLayer: !!engine.currentLayer,
        currentStrokeGraphics: !!engine.currentStrokeGraphics,
        strokeRenderer: !!engine.strokeRenderer,
        strokeRecorder: !!engine.strokeRecorder,
        pressureHandler: !!engine.pressureHandler,
        brushSettings: !!engine.brushSettings,
        methods: Object.getOwnPropertyNames(Object.getPrototypeOf(engine)).filter(m => typeof engine[m] === 'function')
    };
}

// StrokeRenderer詳細
const renderer = engine?.strokeRenderer;
if (renderer) {
    symbolDict.strokeRenderer = {
        className: renderer.constructor.name,
        currentTool: renderer.currentTool,
        resolution: renderer.resolution,
        minPhysicalWidth: renderer.minPhysicalWidth,
        methods: Object.getOwnPropertyNames(Object.getPrototypeOf(renderer)).filter(m => typeof renderer[m] === 'function')
    };
}

// レイヤー構造
const layerMgr = window.CoreRuntime?.internal?.layerManager;
if (layerMgr) {
    const layers = layerMgr.getLayers();
    symbolDict.layers = {
        count: layers?.length || 0,
        activeIndex: layerMgr.activeLayerIndex,
        layers: layers?.map((layer, idx) => ({
            index: idx,
            id: layer.layerData?.id,
            isBackground: layer.layerData?.isBackground,
            visible: layer.visible,
            alpha: layer.alpha,
            childrenCount: layer.children?.length || 0,
            pathsCount: layer.layerData?.paths?.length || 0,
            position: { x: layer.x, y: layer.y },
            scale: { x: layer.scale?.x, y: layer.scale?.y }
        }))
    };
}

// Stage上のイベントリスナー
const stage = window.CoreRuntime?.internal?.app?.stage;
if (stage && stage._events) {
    symbolDict.eventListeners = {
        pointerdown: stage._events.pointerdown?.length || 0,
        pointermove: stage._events.pointermove?.length || 0,
        pointerup: stage._events.pointerup?.length || 0,
        pointerupoutside: stage._events.pointerupoutside?.length || 0
    };
}

console.log('===== シンボル辞典 =====');
console.log(JSON.stringify(symbolDict, null, 2));

// ファイル保存用
console.log('\n===== コピー用JSON =====');
console.log(JSON.stringify(symbolDict, null, 2));
VM355:110 ===== シンボル辞典 =====
VM355:111 {
  "timestamp": "2025-10-29T05:28:35.384Z",
  "globals": {
    "PIXI": {
      "version": "8.13.0",
      "Graphics": "function",
      "Container": "function",
      "Application": "function"
    },
    "CoordinateSystem": "object",
    "TegakiEventBus": "object",
    "CoreRuntime": "object",
    "DrawingEngine": "function",
    "StrokeRenderer": "function",
    "StrokeRecorder": "undefined",
    "PressureHandler": "undefined",
    "CurveInterpolator": "function"
  },
  "coreRuntime": {
    "initialized": true,
    "pointerEventsSetup": true,
    "app": true,
    "stage": true,
    "worldContainer": true,
    "cameraSystem": true,
    "layerManager": true,
    "drawingEngine": true
  },
  "drawingEngine": {
    "className": "DrawingEngine",
    "isDrawing": false,
    "currentTool": "pen",
    "currentLayer": false,
    "currentStrokeGraphics": false,
    "strokeRenderer": true,
    "strokeRecorder": true,
    "pressureHandler": true,
    "brushSettings": true,
    "methods": [
      "constructor",
      "initializeRenderers",
      "setBrushSettings",
      "setTool",
      "getCurrentSettings",
      "startDrawing",
      "continueDrawing",
      "stopDrawing",
      "getLocalCoordinates",
      "clearPreview",
      "clearEraserPreview",
      "updatePreview",
      "updatePenPreview",
      "updateEraserPreview",
      "destroy"
    ]
  },
  "strokeRenderer": {
    "className": "StrokeRenderer",
    "currentTool": "pen",
    "resolution": 2,
    "minPhysicalWidth": 0.5,
    "methods": [
      "constructor",
      "setTool",
      "calculateWidth",
      "renderPreview",
      "renderStroke",
      "renderFinalStroke",
      "renderDot",
      "updateResolution"
    ]
  },
  "layers": {
    "count": 2,
    "activeIndex": 1,
    "layers": [
      {
        "index": 0,
        "id": "layer_1761715562819_iaq5o37ll",
        "isBackground": true,
        "visible": true,
        "alpha": 1,
        "childrenCount": 1,
        "pathsCount": 0,
        "position": {
          "x": 0,
          "y": 0
        },
        "scale": {
          "x": 1,
          "y": 1
        }
      },
      {
        "index": 1,
        "id": "layer_1761715562819_c8ehxixhx",
        "isBackground": false,
        "visible": true,
        "alpha": 1,
        "childrenCount": 9,
        "pathsCount": 9,
        "position": {
          "x": 0,
          "y": 0
        },
        "scale": {
          "x": 1,
          "y": 1
        }
      }
    ]
  },
  "eventListeners": {
    "pointerdown": 0,
    "pointermove": 0,
    "pointerup": 0,
    "pointerupoutside": 0
  }
}
VM355:114 
===== コピー用JSON =====
VM355:115 {
  "timestamp": "2025-10-29T05:28:35.384Z",
  "globals": {
    "PIXI": {
      "version": "8.13.0",
      "Graphics": "function",
      "Container": "function",
      "Application": "function"
    },
    "CoordinateSystem": "object",
    "TegakiEventBus": "object",
    "CoreRuntime": "object",
    "DrawingEngine": "function",
    "StrokeRenderer": "function",
    "StrokeRecorder": "undefined",
    "PressureHandler": "undefined",
    "CurveInterpolator": "function"
  },
  "coreRuntime": {
    "initialized": true,
    "pointerEventsSetup": true,
    "app": true,
    "stage": true,
    "worldContainer": true,
    "cameraSystem": true,
    "layerManager": true,
    "drawingEngine": true
  },
  "drawingEngine": {
    "className": "DrawingEngine",
    "isDrawing": false,
    "currentTool": "pen",
    "currentLayer": false,
    "currentStrokeGraphics": false,
    "strokeRenderer": true,
    "strokeRecorder": true,
    "pressureHandler": true,
    "brushSettings": true,
    "methods": [
      "constructor",
      "initializeRenderers",
      "setBrushSettings",
      "setTool",
      "getCurrentSettings",
      "startDrawing",
      "continueDrawing",
      "stopDrawing",
      "getLocalCoordinates",
      "clearPreview",
      "clearEraserPreview",
      "updatePreview",
      "updatePenPreview",
      "updateEraserPreview",
      "destroy"
    ]
  },
  "strokeRenderer": {
    "className": "StrokeRenderer",
    "currentTool": "pen",
    "resolution": 2,
    "minPhysicalWidth": 0.5,
    "methods": [
      "constructor",
      "setTool",
      "calculateWidth",
      "renderPreview",
      "renderStroke",
      "renderFinalStroke",
      "renderDot",
      "updateResolution"
    ]
  },
  "layers": {
    "count": 2,
    "activeIndex": 1,
    "layers": [
      {
        "index": 0,
        "id": "layer_1761715562819_iaq5o37ll",
        "isBackground": true,
        "visible": true,
        "alpha": 1,
        "childrenCount": 1,
        "pathsCount": 0,
        "position": {
          "x": 0,
          "y": 0
        },
        "scale": {
          "x": 1,
          "y": 1
        }
      },
      {
        "index": 1,
        "id": "layer_1761715562819_c8ehxixhx",
        "isBackground": false,
        "visible": true,
        "alpha": 1,
        "childrenCount": 9,
        "pathsCount": 9,
        "position": {
          "x": 0,
          "y": 0
        },
        "scale": {
          "x": 1,
          "y": 1
        }
      }
    ]
  },
  "eventListeners": {
    "pointerdown": 0,
    "pointermove": 0,
    "pointerup": 0,
    "pointerupoutside": 0
  }
}
undefined