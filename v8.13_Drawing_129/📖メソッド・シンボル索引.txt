================================================================================
ãƒ–ãƒ©ã‚¦ã‚¶ãŠçµµã‹ããƒ„ãƒ¼ãƒ« v8.13 - ãƒ¡ã‚½ãƒƒãƒ‰ãƒ»ã‚·ãƒ³ãƒœãƒ«ç´¢å¼• ã€å®Œå…¨ç‰ˆã€‘
================================================================================
ä½œæˆæ—¥: 2025-11-08
å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³: v8.13_Drawing_124
æ›´æ–°: å‰å›é€”åˆ‡ã‚ŒãŸç®‡æ‰€ã‹ã‚‰ç¶™ç¶šå®Œæˆ

ã€å‡¡ä¾‹ã€‘
âš ï¸ = äºŒé‡å®Ÿè£…ã‚ã‚Šï¼ˆè¦çµ±ä¸€ï¼‰
ğŸ”§ = Phaseæ”¹ä¿®å¯¾è±¡
ğŸ“ = è¦ªãƒ•ã‚¡ã‚¤ãƒ«
ğŸ“„ = å­ãƒ•ã‚¡ã‚¤ãƒ«
ğŸ”€ = ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼é–¢é€£


================================================================================
ã€1ã€‘ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ 
================================================================================

â–  CoreEngine (core-engine.js) ğŸ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘å…¨ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ãƒ»çµ±åˆç®¡ç†
ã€ä¾å­˜ã€‘PIXI.Application, EventBus, config.js

â”œâ”€ initialize()
â”‚  â””â”€ å…¨ã‚µãƒ–ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ãƒ»ç›¸äº’æ¥ç¶š
â”œâ”€ getCameraSystem() â†’ CameraSystem
â”œâ”€ getLayerManager() â†’ LayerSystem
â”œâ”€ getDrawingEngine() â†’ DrawingEngine
â”œâ”€ getAnimationSystem() â†’ AnimationSystem
â”œâ”€ getBrushSettings() â†’ BrushSettings
â”œâ”€ undo() / redo() â†’ HistoryçµŒç”±
â””â”€ resizeCanvas(width, height, options)

ã€ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã€‘ãªã—ï¼ˆå„ã‚µãƒ–ã‚·ã‚¹ãƒ†ãƒ ãŒç™ºç«ï¼‰
ã€ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ã€‘ãªã—


â–  CoreRuntime (core-runtime.js) ğŸ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘å¤–éƒ¨APIãƒ¬ã‚¤ãƒ¤ãƒ¼ã€ãƒ¬ã‚¬ã‚·ãƒ¼äº’æ›æ€§
ã€ä¾å­˜ã€‘CoreEngine, EventBus

ã€APIæ§‹é€ ã€‘
api.draw.{clear, undo, redo}
api.tool.{set, get, setPen, setEraser}
api.brush.{setSize, getSize, setColor, getColor, setOpacity, getOpacity}
api.camera.{pan, zoom, reset, getZoom, getPosition, resize}
api.layer.{
  getActive, getActiveIndex, getAll, getCount,
  create, delete, setActive,
  setVisible, setOpacity,
  ğŸ”§ flipActiveLayer(direction, bypassVKeyCheck), â† Phase 2æ”¹ä¿®
  enterMoveMode, exitMoveMode
}
api.settings.{get, set, update, reset, getAll}
api.popup.{show, hide, toggle, hideAll, isVisible}
api.animation.{
  getCutCount, getCurrentCutIndex,
  createCut, deleteCut, goToCut,
  play, stop, isPlaying
}

ã€é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ã€‘
- core-engine.js (å†…éƒ¨ã‚·ã‚¹ãƒ†ãƒ )
- ui/ui-panels.js (UIåˆ¶å¾¡)


â–  CoreInitializer (core-initializer.js) ğŸ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•ã‚·ãƒ¼ã‚±ãƒ³ã‚¹
ã€ä¾å­˜ã€‘å…¨ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«

â”œâ”€ initialize()
â”‚  â”œâ”€ checkDependencies()
â”‚  â”œâ”€ buildDOM()
â”‚  â”œâ”€ initializeSettingsManager()
â”‚  â”œâ”€ initializePopupManager()
â”‚  â”œâ”€ setupEventBusListeners()
â”‚  â”œâ”€ initializeLayerPanel()
â”‚  â””â”€ initializeWebGPU()
â””â”€ DrawingApp.initialize()


================================================================================
ã€2ã€‘ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚·ã‚¹ãƒ†ãƒ 
================================================================================

â–  LayerSystem (layer-system.js) ğŸ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†ãƒ»æ“ä½œãƒ»ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒ çµ±åˆ
ã€ä¾å­˜ã€‘LayerTransform, EventBus, CoordinateSystem
ã€å­ãƒ•ã‚¡ã‚¤ãƒ«ã€‘layer-transform.js

â”œâ”€ init(container, eventBus, config)
â”œâ”€ createLayer(name, isBackground)
â”œâ”€ deleteLayer(layerIndex)
â”œâ”€ setActiveLayer(index) â† ğŸ”§èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ä¸å¯
â”œâ”€ getActiveLayer() â†’ PIXI.Container
â”œâ”€ getActiveLayerIndex() â†’ number
â”œâ”€ getLayers() â†’ PIXI.Container[]
â”œâ”€ getLayerIndex(layer) â†’ number
â”‚
â”œâ”€ toggleLayerVisibility(index)
â”œâ”€ setLayerOpacity(index, opacity)
â”œâ”€ changeBackgroundLayerColor(index, layerId)
â”‚
â”œâ”€ addPathToActiveLayer(path)
â”œâ”€ addPathToLayer(layerIndex, path)
â”œâ”€ rebuildPathGraphics(path) â†’ boolean
â”œâ”€ safeRebuildLayer(layer, newPaths) â†’ boolean
â”‚
â”œâ”€ reorderLayers(fromIndex, toIndex)
â”œâ”€ moveActiveLayerHierarchy(direction)
â”‚
â”œâ”€ ğŸ”§ flipActiveLayer(direction) â† Phase 2: bypassVKeyCheckè¿½åŠ 
â”œâ”€ moveActiveLayer(keyCode)
â”œâ”€ transformActiveLayer(keyCode)
â”œâ”€ confirmLayerTransform()
â”œâ”€ enterLayerMoveMode() / exitLayerMoveMode()
â”œâ”€ isLayerMoveMode (getter)
â”œâ”€ vKeyPressed (getter)
â”‚
â”œâ”€ âš ï¸ requestThumbnailUpdate(layerIndex) â† Phase 3å‰Šé™¤äºˆå®š
â”‚  ï¼ˆthumbnail-update-manager.js ã«çµ±ä¸€ï¼‰
â”‚
â””â”€ updateLayerPanelUI() ğŸ”€
   â””â”€ emit('layer:panel-update-requested')

ã€ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã€‘
- layer:created, layer:deleted, layer:activated
- layer:visibility-changed, layer:opacity-changed
- layer:reordered, layer:hierarchy-moved
- layer:background-color-changed
- layer:stroke-added, layer:path-added
- layer:updated, layer:transform-updated
- âš ï¸ thumbnail:layer-updated â† Phase 3ã§ç™ºç«ç¶™ç¶šã€å‡¦ç†ã¯çµ±ä¸€

ã€ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ã€‘
- keyboard:vkey-pressed
- layer:flip-by-key, layer:move-by-key
- layer:scale-by-key, layer:rotate-by-key
- layer:select-next, layer:select-prev
- layer:order-up, layer:order-down
- layer:copy-request, layer:paste-request
- camera:resized


â–  LayerTransform (layer-transform.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒ å‡¦ç†ï¼ˆç§»å‹•/å›è»¢/æ‹¡ç¸®/åè»¢ï¼‰
ã€ä¾å­˜ã€‘CoordinateSystem, config.js, EventBus
ã€è¦ªãƒ•ã‚¡ã‚¤ãƒ«ã€‘layer-system.js (this.transform)

â”œâ”€ init(app, cameraSystem)
â”œâ”€ enterMoveMode() / exitMoveMode()
â”œâ”€ toggleMoveMode()
â”œâ”€ isVKeyPressed (getter)
â”œâ”€ setVKeyPressed(state)
â”‚
â”œâ”€ ğŸ”§ flipLayer(layer, direction) â† Phase 2: Vã‚­ãƒ¼ãƒã‚§ãƒƒã‚¯å‰Šé™¤
â”œâ”€ moveLayer(layer, direction, amount)
â”œâ”€ scaleLayer(layer, keyCode)
â”œâ”€ rotateLayer(layer, keyCode)
â”œâ”€ updateTransform(layer, property, value)
â”œâ”€ applyTransform(layer, transform, centerX, centerY)
â”œâ”€ resetTransform()
â”‚
â”œâ”€ confirmTransform(layer) â†’ boolean
â”œâ”€ applyTransformToPaths(layer, transform) â†’ boolean
â”‚
â”œâ”€ updateTransformPanelValues(layer)
â”œâ”€ updateFlipButtons(layer)
â”‚
â”œâ”€ getTransform(layerId) â†’ Transform
â”œâ”€ setTransform(layerId, transform)
â””â”€ deleteTransform(layerId)

ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€‘ï¼ˆlayer-system.js ã‹ã‚‰è¨­å®šï¼‰
- onTransformComplete(layer, pathsBackup)
- onTransformUpdate(layer, transform)
- onFlipRequest(direction) ğŸ”§ â† Phase 2: å‘¼ã³å‡ºã—å…ƒã§Vã‚­ãƒ¼ãƒã‚§ãƒƒã‚¯
- onDragRequest(dx, dy, shiftKey)
- onSliderChange(sliderId, value)
- onGetActiveLayer() â†’ layer

ã€ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã€‘
- layer:transform-updated
- thumbnail:layer-updated

ã€ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ã€‘
- keyboard:vkey-pressed
- ğŸ”§ layer:flip-by-key â† Phase 2: Vã‚­ãƒ¼ãƒã‚§ãƒƒã‚¯å‰Šé™¤
- layer:reset-transform


================================================================================
ã€3ã€‘æç”»ã‚·ã‚¹ãƒ†ãƒ 
================================================================================

â–  DrawingEngine (drawing-engine.js) ğŸ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘æç”»å‡¦ç†ã®çµ±åˆç®¡ç†ã€åº§æ¨™å¤‰æ›
ã€ä¾å­˜ã€‘BrushCore, StrokeRenderer, CoordinateSystem
ã€å­ãƒ•ã‚¡ã‚¤ãƒ«ã€‘brush-core.js, stroke-renderer.js

â”œâ”€ initialize(layerSystem, cameraSystem, eventBus)
â”œâ”€ setTool(tool) // 'pen' | 'eraser'
â”œâ”€ getTool() â†’ string
â”œâ”€ isDrawing (getter) â†’ boolean
â”œâ”€ setBrushSettings(settings)
â”‚
â””â”€ _handlePointerEvents()
   â”œâ”€ onPointerDown(e) â†’ Localåº§æ¨™å¤‰æ› â†’ BrushCore.startStroke()
   â”œâ”€ onPointerMove(e) â†’ Localåº§æ¨™å¤‰æ› â†’ BrushCore.updateStroke()
   â””â”€ onPointerUp(e) â†’ BrushCore.finalizeStroke()

ã€åº§æ¨™å¤‰æ›ãƒ•ãƒ­ãƒ¼ã€‘
PointerEvent.clientX/Y
  â†’ screenClientToCanvas() [DPIè£œæ­£]
  â†’ canvasToWorld() [worldContaineré€†è¡Œåˆ—]
  â†’ worldToLocal() [æ‰‹å‹•é€†ç®—ãƒ»è¦ªãƒã‚§ãƒ¼ãƒ³é¡æŸ»]
  â†’ Localåº§æ¨™ç¢ºå®š â†’ BrushCore ã¸æ¸¡ã™

ã€ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã€‘
- drawing:stroke-started
- drawing:stroke-completed
- drawing:stroke-cancelled

ã€ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ã€‘
- tool:select


â–  BrushCore (brush-core.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ç®¡ç†ã€StrokeRecorder/Rendererã¸ã®å§”è­²
ã€ä¾å­˜ã€‘StrokeRecorder, StrokeRenderer, BrushSettings
ã€è¦ªãƒ•ã‚¡ã‚¤ãƒ«ã€‘drawing-engine.js

â”œâ”€ init(strokeRecorder, strokeRenderer, brushSettings)
â”œâ”€ startStroke(localX, localY, pressure)
â”‚  â””â”€ strokeRecorder.startStroke(localX, localY, pressure)
â”œâ”€ updateStroke(localX, localY, pressure)
â”‚  â””â”€ strokeRecorder.addPoint(localX, localY, pressure)
â”œâ”€ finalizeStroke()
â”‚  â”œâ”€ strokeRenderer.renderStroke(layer, strokeData, settings)
â”‚  â””â”€ strokeRecorder.reset()
â”œâ”€ cancelStroke()
â”œâ”€ setMode(mode) // 'pen' | 'eraser'
â””â”€ isActive() â†’ boolean


â–  StrokeRecorder (stroke-recorder.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘Localåº§æ¨™ãƒã‚¤ãƒ³ãƒˆç›´æ¥è¨˜éŒ²ï¼ˆåº§æ¨™å¤‰æ›ãªã—ï¼‰
ã€ä¾å­˜ã€‘ãªã—
ã€è¦ªãƒ•ã‚¡ã‚¤ãƒ«ã€‘brush-core.js

âš ï¸ é‡è¦: åº§æ¨™å¤‰æ›ã‚’è¡Œã‚ãªã„ï¼ˆdrawing-engineã§å®Œçµæ¸ˆã¿ï¼‰

â”œâ”€ startStroke(localX, localY, pressure)
â”‚  â””â”€ this.points = [{x: localX, y: localY, pressure}]
â”œâ”€ addPoint(localX, localY, pressure)
â”‚  â””â”€ this.points.push({x: localX, y: localY, pressure})
â”œâ”€ finalizeStroke() â†’ StrokeData
â””â”€ reset()


â–  StrokeRenderer (stroke-renderer.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘Localåº§æ¨™ã‹ã‚‰ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ç”Ÿæˆï¼ˆWebGPU/MSDF/SDF/Legacyï¼‰
ã€ä¾å­˜ã€‘WebGPUDrawingLayer, SDFBrushShader, MSDFBrushShader
ã€è¦ªãƒ•ã‚¡ã‚¤ãƒ«ã€‘brush-core.js

â”œâ”€ init(layerSystem, eventBus)
â”œâ”€ setTool(tool)
â”œâ”€ setWebGPULayer(webgpuLayer)
â”‚
â”œâ”€ renderStroke(layer, strokeData, settings)
â”‚  â”œâ”€ _renderFinalStrokeMSDF() [Phase 4-B]
â”‚  â”œâ”€ _renderFinalStrokeWebGPU() [Phase 4-A]
â”‚  â””â”€ _renderFinalStrokeLegacy() [Fallback]
â”‚
â”œâ”€ renderPreview(points, settings, targetGraphics)
â””â”€ renderDot(point, settings, targetGraphics)


â–  BrushSettings (brush-settings.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ãƒ–ãƒ©ã‚·è¨­å®šã®ç®¡ç†ãƒ»åŒæœŸ
ã€ä¾å­˜ã€‘EventBus
ã€è¦ªãƒ•ã‚¡ã‚¤ãƒ«ã€‘drawing-engine.js

â”œâ”€ setSize(size)
â”œâ”€ setColor(color)
â”œâ”€ setOpacity(opacity)
â”œâ”€ getSize() / getColor() / getAlpha()
â”œâ”€ getSettings() â†’ {size, color, opacity, tool}
â”œâ”€ updateSettings(settings)
â””â”€ resetToDefaults()

ã€ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã€‘
- brush:size-changed
- brush:color-changed
- brush:opacity-changed

ã€ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ã€‘
- brush:size-changed
- brush:color-changed
- brush:alpha-changed


â–  PointerHandler (pointer-handler.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘PointerEventçµ±ä¸€ãƒãƒ³ãƒ‰ãƒ©ï¼ˆãƒã‚¦ã‚¹ãƒ»ã‚¿ãƒƒãƒãƒ»ãƒšãƒ³å¯¾å¿œï¼‰
ã€ä¾å­˜ã€‘ãªã—
ã€è¦ªãƒ•ã‚¡ã‚¤ãƒ«ã€‘drawing-engine.js

ã€Phase 2ä¿®æ­£ã€‘pointerType='mouse'ã®ãƒšãƒ³èª¤èªè£œæ­£

â”œâ”€ static attach(element, handlers, options) â†’ detachFunc
â”‚  â”œâ”€ normalizeEvent(e) â†’ {pointerId, pointerType, clientX, clientY, pressure, tiltX, tiltY, twist}
â”‚  â”œâ”€ onPointerDown(e)
â”‚  â”œâ”€ onPointerMove(e)
â”‚  â”œâ”€ onPointerUp(e)
â”‚  â””â”€ onPointerCancel(e)
â”‚
â””â”€ static attachGlobal(handlers, options)

ã€ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯è£œæ­£ã€‘
- pointerType='mouse' ã§ã‚‚ pressure > 0.01 ã¾ãŸã¯ tiltå€¤ã‚ã‚Š â†’ 'pen'æ‰±ã„
- Windowsç­‰ã§ã® pen â†’ mouse èª¤èªå•é¡Œã«å¯¾å¿œ

ã€ã‚¤ãƒ™ãƒ³ãƒˆæ­£è¦åŒ–ã€‘
{
  pointerId: number,
  pointerType: 'pen' | 'mouse' | 'touch', // è£œæ­£å¾Œ
  clientX, clientY: number,
  pressure: number, // 0.0 ~ 1.0
  tiltX, tiltY: number, // -90 ~ 90 deg
  twist: number, // 0 ~ 359 deg
  button, buttons: number,
  originalEvent: PointerEvent
}


â–  PressureHandler (pressure-handler.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ç­†åœ§è£œæ­£å°‚ç”¨ã‚¯ãƒ©ã‚¹
ã€ä¾å­˜ã€‘ãªã—
ã€è¦ªãƒ•ã‚¡ã‚¤ãƒ«ã€‘brush-core.js

ã€Phase 3ä¿®æ­£ã€‘è·é›¢ãƒ™ãƒ¼ã‚¹é©å¿œãƒ•ã‚£ãƒ«ã‚¿è¿½åŠ 
ã€Phase 4ä¿®æ­£ã€‘window.PressureHandler ã¨ã—ã¦å…¬é–‹

â”œâ”€ startStroke()
â”œâ”€ updateTiltData(event)
â”œâ”€ getCalibratedPressure(rawPressure) â†’ calibratedPressure
â”‚  â”œâ”€ ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç®—å‡ºï¼ˆåˆæœŸ5ç‚¹ã®æœ€å°å€¤ï¼‰
â”‚  â””â”€ (raw - baseline) / (1 - baseline)
â”‚
â”œâ”€ applyDistanceFilter(currentPressure, prevPressure, distance) â†’ filteredPressure
â”‚  â””â”€ _calculateAlpha(distance) â†’ alpha
â”‚     â”œâ”€ distance < 5px  â†’ alpha=0.9 (å³åº§åæ˜ )
â”‚     â”œâ”€ distance > 20px â†’ alpha=0.3 (ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°å¼·)
â”‚     â””â”€ 5~20px â†’ ç·šå½¢è£œé–“
â”‚
â”œâ”€ setDistanceFilterEnabled(enabled)
â”œâ”€ getTiltData() â†’ {tiltX, tiltY, twist}
â”œâ”€ getBaseline() â†’ number
â”œâ”€ isReady() â†’ boolean
â”œâ”€ updatePreviousPressure(pressure)
â””â”€ getPreviousPressure() â†’ number

ã€è£œæ­£ãƒ•ãƒ­ãƒ¼ã€‘
rawPressure (0.0 ~ 1.0)
  â†’ ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³è£œæ­£ (getCalibratedPressure)
  â†’ è·é›¢ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ (applyDistanceFilter)
  â†’ æœ€çµ‚ç­†åœ§å€¤


â–  CurveInterpolator (curve-interpolator.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘Catmull-Romã‚¹ãƒ—ãƒ©ã‚¤ãƒ³è£œé–“
ã€ä¾å­˜ã€‘ãªã—
ã€è¦ªãƒ•ã‚¡ã‚¤ãƒ«ã€‘stroke-renderer.js

â”œâ”€ static interpolate(points, segments) â†’ interpolatedPoints
â”‚  â””â”€ Catmull-Romã‚¹ãƒ—ãƒ©ã‚¤ãƒ³è£œé–“
â”‚
â””â”€ static _catmullRom(t, p0, p1, p2, p3) â†’ interpolatedPoint

ã€è£œé–“ä»•æ§˜ã€‘
- å…¥åŠ›: [{x, y, pressure}, ...]
- å‡ºåŠ›: ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°å€ã®æ»‘ã‚‰ã‹ãªç‚¹åˆ—
- ç«¯ç‚¹ã¯å…¥åŠ›ç‚¹ã‚’ãã®ã¾ã¾ä½¿ç”¨


â–  StrokeTransformer (stroke-transformer.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ãƒ‘ã‚¹ã®åº§æ¨™å¤‰æ›
ã€ä¾å­˜ã€‘ãªã—
ã€è¦ªãƒ•ã‚¡ã‚¤ãƒ«ã€‘layer-transform.js

â”œâ”€ static transformPath(path, transform) â†’ transformedPath
â”‚  â””â”€ {tx, ty, sx, sy, rotation, flipH, flipV} é©ç”¨
â”‚
â””â”€ static transformPoint(x, y, transform) â†’ {x, y}


================================================================================
ã€4ã€‘ã‚µãƒ ãƒã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ 
================================================================================

â–  ThumbnailUpdateManager (thumbnail-update-manager.js) ğŸ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼ä¸€å…ƒç®¡ç†ã€ãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç†
ã€ä¾å­˜ã€‘EventBus, LayerPanelRenderer
ã€å­ãƒ•ã‚¡ã‚¤ãƒ«ã€‘layer-panel-renderer.js (æ›´æ–°å®Ÿè¡Œ)

âš ï¸ Phase 3ã§å®Œå…¨çµ±åˆäºˆå®š

â”œâ”€ init()
â”œâ”€ ğŸ”§ requestUpdate(layerIndex, reason, immediate) â† Phase 3æ‹¡å¼µ
â”œâ”€ requestUpdateAll(reason)
â”œâ”€ setEnabled(enabled)
â”œâ”€ setDebounceTime(ms)
â””â”€ _executeUpdate(layerIndex, reason) ğŸ”€
   â””â”€ emit('thumbnail:layer-updated', {layerIndex, layerId})

ã€ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã€‘
- thumbnail:layer-updated

ã€ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ã€‘
- layer:stroke-added
- layer:path-added
- layer:transform-updated
- layer:transform-confirmed
- layer:updated
- layer:flip-horizontal
- layer:flip-vertical
- layer:bucket-fill-applied
- layer:cleared
- layer:restored
- layer:visibility-changed
- layer:opacity-changed
- layer:background-color-changed
- camera:resized


â–  LayerPanelRenderer (layer-panel-renderer.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«UIæç”»ã€ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤º
ã€ä¾å­˜ã€‘ThumbnailSystem, EventBus, Sortable
ã€è¦ªãƒ•ã‚¡ã‚¤ãƒ«ã€‘thumbnail-update-manager.js (æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼)

â”œâ”€ render(layers, activeIndex, animationSystem)
â”œâ”€ createLayerElement(layer, index, isActive)
â”œâ”€ createThumbnail(layer, index)
â”‚  â””â”€ ğŸ”§ _calculateThumbnailSize() â† Phase 4è¿½åŠ äºˆå®š
â”œâ”€ ğŸ”§ _createBackgroundThumbnail(layer, index) â† Phase 5ä¿®æ­£
â”‚
â”œâ”€ requestUpdate()
â”œâ”€ âš ï¸ _updateSingleThumbnail(layerIndex) â† Phase 3ã§çµ±ä¸€
â”‚  â†’ updateSingleLayerThumbnail(layerIndex) ã«ãƒªãƒãƒ¼ãƒ äºˆå®š
â””â”€ updateAllThumbnails()

ã€ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã€‘
- ui:background-color-change-requested
- ui:layer-selected

ã€ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ã€‘
- layer:created, layer:deleted, layer:activated
- layer:visibility-changed, layer:opacity-changed
- layer:background-color-changed
- layer:name-changed
- animation:frame-changed
- ğŸ”§ thumbnail:layer-updated â† Phase 3çµ±åˆå¾Œã®ãƒ¡ã‚¤ãƒ³å—ä¿¡


â–  ThumbnailSystem (thumbnail-system.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒç”Ÿæˆ
ã€ä¾å­˜ã€‘PIXI.Application, EventBus

âš ï¸ Phase 3ã§çµ±åˆäºˆå®šï¼ˆç¾åœ¨ã¯ layer-panel-renderer.js ãŒç›´æ¥PIXIå‡¦ç†ï¼‰

â”œâ”€ generateLayerThumbnail(layer, index, maxW, maxH)
â”‚  â””â”€ â†’ {dataUrl, width, height}
â””â”€ generateFrameThumbnail(frameContainer, maxW, maxH)
   â””â”€ â†’ {dataUrl, width, height}


================================================================================
ã€5ã€‘UIã‚·ã‚¹ãƒ†ãƒ 
================================================================================

â–  KeyboardHandler (keyboard-handler.js) ğŸ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå‡¦ç†ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
ã€ä¾å­˜ã€‘TEGAKI_KEYMAP, EventBus

â”œâ”€ init()
â”œâ”€ handleKeyDown(e)
â”‚  â”œâ”€ isInputFocused() â†’ boolean
â”‚  â”œâ”€ Vã‚­ãƒ¼ãƒˆã‚°ãƒ«å‡¦ç† ğŸ”€ emit('keyboard:vkey-pressed')
â”‚  â”œâ”€ getAction(e, {vMode}) â†’ actionName
â”‚  â””â”€ handleAction(action, event, eventBus)
â”‚
â”œâ”€ ğŸ”§ handleAction(action, event, eventBus) â† Phase 1-2ä¿®æ­£
â”‚  â”œâ”€ UNDO / REDO
â”‚  â”œâ”€ TOOL_PEN / TOOL_ERASER
â”‚  â”œâ”€ LAYER_CREATE
â”‚  â”œâ”€ ğŸ”§ LAYER_DELETE_DRAWINGS â† Phase 1: å‹•ä½œç¢ºèªãƒ»ä¿®æ­£
â”‚  â”œâ”€ LAYER_CLEAR, LAYER_COPY, LAYER_PASTE, LAYER_RESET
â”‚  â”œâ”€ LAYER_MOVE_*, LAYER_SCALE_*, LAYER_ROTATE_*
â”‚  â”œâ”€ ğŸ”§ LAYER_FLIP_HORIZONTAL / VERTICAL â† Phase 2: Vã‚­ãƒ¼ãƒã‚§ãƒƒã‚¯çµ±ä¸€
â”‚  â”œâ”€ LAYER_HIERARCHY_UP/DOWN, LAYER_ORDER_UP/DOWN
â”‚  â”œâ”€ CAMERA_FLIP_*, CAMERA_RESET
â”‚  â”œâ”€ GIF_*, SETTINGS_OPEN, EXPORT_TOGGLE, QUICK_ACCESS_TOGGLE
â”‚  â””â”€ ...
â”‚
â”œâ”€ ğŸ”§ deleteActiveLayerDrawings() â† Phase 1: å‹•ä½œç¢ºèª
â”œâ”€ isVKeyPressed() â†’ boolean
â”œâ”€ setVKeyPressed(state)
â””â”€ getShortcutList() â†’ Array

ã€ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã€‘
- keyboard:vkey-pressed {pressed}
- layer:flip-by-key {direction}
- layer:clear-active
- layer:copy-request, layer:paste-request
- layer:reset-transform
- layer:move-by-key {direction}
- layer:scale-by-key, layer:rotate-by-key
- layer:select-next, layer:select-prev
- layer:order-up, layer:order-down
- camera:flip-horizontal, camera:flip-vertical, camera:reset
- ui:toggle-timeline, ui:open-settings
- ui:toggle-export, ui:toggle-quick-access
- frame:copy-current, frame:paste-right-adjacent


â–  UIController (ui-panels.js) ğŸ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘UIå…¨ä½“ã®åˆ¶å¾¡ã€ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ç®¡ç†
ã€ä¾å­˜ã€‘CoreRuntime, PopupManager, EventBus

â”œâ”€ setupEventDelegation()
â”œâ”€ handleToolClick(button)
â”œâ”€ updateToolUI(tool)
â”œâ”€ setupSliders()
â”œâ”€ setupCanvasResize()
â”œâ”€ ğŸ”§ setupFlipButtons() â† Phase 2: Vã‚­ãƒ¼ãƒã‚§ãƒƒã‚¯è¿½åŠ 
â”‚  â”œâ”€ flipHorizontalBtn.click â†’ CoreRuntime.api.layer.flipActiveLayer('horizontal', true)
â”‚  â””â”€ flipVerticalBtn.click â†’ CoreRuntime.api.layer.flipActiveLayer('vertical', true)
â”‚
â”œâ”€ showPopup(name) / hidePopup(name)
â”œâ”€ togglePopup(name)
â””â”€ closeAllPopups(exceptName)

ã€ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ã€‘
- ui:toggle-settings
- ui:show-settings
- ui:toggle-quick-access
- ui:toggle-album
- ui:toggle-export
- ui:sidebar:sync-tool {tool}


â–  PopupManager (popup-manager.js) ğŸ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†
ã€ä¾å­˜ã€‘EventBus

â”œâ”€ register(name, Class, options, config)
â”œâ”€ initialize(name)
â”œâ”€ initializeAll()
â”œâ”€ show(name) / hide(name)
â”œâ”€ toggle(name)
â”œâ”€ hideAll(exceptName)
â””â”€ isVisible(name) â†’ boolean


â–  DOMBuilder (dom-builder.js)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘DOMè¦ç´ ã®ãƒ“ãƒ«ãƒ€ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè£…
ã€ä¾å­˜ã€‘ãªã—

â”œâ”€ static create(tagName) â†’ DOMBuilder
â”œâ”€ attr(name, value) â†’ this
â”œâ”€ class(className) â†’ this
â”œâ”€ style(prop, value) â†’ this
â”œâ”€ text(content) â†’ this
â”œâ”€ html(content) â†’ this
â”œâ”€ on(event, handler) â†’ this
â”œâ”€ append(...children) â†’ this
â””â”€ build() â†’ HTMLElement

ã€ä½¿ç”¨ä¾‹ã€‘
```javascript
const button = DOMBuilder.create('button')
  .class('btn')
  .attr('data-tool', 'pen')
  .text('Pen')
  .on('click', handleClick)
  .build();
```


â–  SliderUtils (slider-utils.js)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼UIæ±ç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
ã€ä¾å­˜ã€‘ãªã—

â”œâ”€ static createSlider(options) â†’ {element, getValue, setValue, onChange}
â”‚  â””â”€ HTMLæ§‹é€ ç”Ÿæˆ + ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒ‰
â”‚
â””â”€ static attachSlider(container, options) â†’ controller


================================================================================
ã€6ã€‘ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ 
================================================================================

â–  AnimationSystem (animation-system.js) ğŸ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ãƒ•ãƒ¬ãƒ¼ãƒ ç®¡ç†ã€å†ç”Ÿåˆ¶å¾¡ã€ã‚«ãƒƒãƒˆç®¡ç†
ã€ä¾å­˜ã€‘LayerSystem, EventBus

â”œâ”€ init(layerSystem, app, cameraSystem)
â”œâ”€ createNewBlankFrame()
â”œâ”€ createNewFrameFromCurrentLayers()
â”œâ”€ deleteFrame(frameIndex)
â”œâ”€ reorderFrames(oldIndex, newIndex)
â”œâ”€ switchToActiveFrame(frameIndex)
â”‚
â”œâ”€ play() / pause() / stop()
â”œâ”€ goToPreviousFrame() / goToNextFrame()
â”‚
â”œâ”€ generateFrameThumbnail(frameIndex)
â”œâ”€ regenerateAllThumbnails()
â”œâ”€ handleCanvasResize(width, height)
â””â”€ getAnimationData() â†’ {cuts, currentCutIndex}

ã€ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã€‘
- animation:system-ready
- animation:initialized
- animation:frame-created
- animation:frame-deleted
- animation:frame-applied
- animation:frames-reordered
- animation:thumbnail-generated
- animation:playback-started/paused/stopped


â–  TimelineUI (timeline-ui.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒ‘ãƒãƒ«UI
ã€ä¾å­˜ã€‘AnimationSystem, EventBus, Sortable

â”œâ”€ init(animationSystem, eventBus)
â”œâ”€ render()
â”œâ”€ createFrameElement(frameData, index, isActive)
â”œâ”€ handleFrameClick(frameIndex)
â”œâ”€ handleAddFrame()
â”œâ”€ handleDeleteFrame(frameIndex)
â”œâ”€ handlePlayPause()
â””â”€ updatePlayButton(isPlaying)

ã€ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã€‘
- timeline:frame-selected
- timeline:frame-created
- timeline:frame-deleted
- timeline:play-toggled

ã€ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ã€‘
- animation:frame-created
- animation:frame-deleted
- animation:frame-applied
- animation:playback-started/paused/stopped


â–  TimelineThumbnailUtils (timeline-thumbnail-utils.js)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ
ã€ä¾å­˜ã€‘PIXI.Application

â”œâ”€ static generateFrameThumbnail(frameContainer, maxW, maxH)
â”‚  â””â”€ â†’ {dataUrl, width, height}
â””â”€ static createPlaceholderThumbnail(width, height, text)
   â””â”€ â†’ dataUrl


================================================================================
ã€7ã€‘åº§æ¨™ç³»ã‚·ã‚¹ãƒ†ãƒ 
================================================================================

â–  CoordinateSystem (coordinate-system.js) ğŸ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘åº§æ¨™å¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆScreenâ†’Canvasâ†’Worldâ†’Localï¼‰
ã€ä¾å­˜ã€‘CameraSystem

âš ï¸ é‡è¦: äºŒé‡å¤‰æ›ç¦æ­¢ï¼ˆdrawing-engineã§å®Œçµã€stroke-recorderã¯å¤‰æ›ã—ãªã„ï¼‰

â”œâ”€ setContainers({worldContainer, canvasContainer, app})
â”œâ”€ setCameraSystem(cameraSystem)
â”œâ”€ setLayerSystem(layerSystem)
â”‚
â”œâ”€ screenClientToCanvas(clientX, clientY) â†’ {canvasX, canvasY}
â”œâ”€ canvasToWorld(canvasX, canvasY) â†’ {worldX, worldY}
â”œâ”€ worldToLocal(worldX, worldY, layer) â†’ {localX, localY}
â”‚  âš ï¸ æ‰‹å‹•é€†ç®—ï¼ˆPIXI.toLocal() ä½¿ç”¨ç¦æ­¢ï¼‰
â”‚
â”œâ”€ applyLayerTransform(layer, transform, centerX, centerY)
â””â”€ localToGlobal(container, point) â†’ {x, y}


â–  CameraSystem (camera-system.js) ğŸ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ã‚«ãƒ¡ãƒ©åˆ¶å¾¡ã€ã‚ºãƒ¼ãƒ ãƒ»ãƒ‘ãƒ³ã€ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
ã€ä¾å­˜ã€‘EventBus, config.js

â”œâ”€ init(app, config, eventBus)
â”œâ”€ initializeCamera()
â”œâ”€ resetView()
â”œâ”€ resizeCanvas(width, height)
â”‚
â”œâ”€ setVKeyPressed(state)
â”œâ”€ showGuideLines() / hideGuideLines()
â”œâ”€ updateGuideLinesForCanvasResize()
â”‚
â”œâ”€ updateCursor()
â””â”€ updateTransformDisplay()

ã€ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã€‘
- camera:resized {width, height}
- camera:flip-horizontal, camera:flip-vertical, camera:reset


================================================================================
ã€8ã€‘WebGPUã‚·ã‚¹ãƒ†ãƒ 
================================================================================

â–  WebGPUCapabilities (webgpu-capabilities.js) ğŸ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘WebGPUæ©Ÿèƒ½æ¤œå‡ºãƒ»åˆæœŸåŒ–
ã€ä¾å­˜ã€‘ãªã—

â”œâ”€ static async checkSupport() â†’ boolean
â”œâ”€ static async initialize() â†’ {device, context}
â”œâ”€ static isSupported() â†’ boolean
â”œâ”€ static getDevice() â†’ GPUDevice
â””â”€ static getContext() â†’ GPUCanvasContext

ã€åˆæœŸåŒ–ãƒ•ãƒ­ãƒ¼ã€‘
checkSupport() â†’ navigator.gpu ç¢ºèª
  â†’ requestAdapter()
  â†’ requestDevice()
  â†’ canvas.getContext('webgpu')


â–  WebGPUDrawingLayer (webgpu-drawing-layer.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘WebGPUæç”»ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†
ã€ä¾å­˜ã€‘WebGPUCapabilities, WebGPUComputeSDF

â”œâ”€ init(device, canvas)
â”œâ”€ createRenderPipeline()
â”œâ”€ addStroke(points, settings)
â”œâ”€ render()
â”œâ”€ clear()
â””â”€ destroy()


â–  WebGPUComputeSDF (webgpu-compute-sdf.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘GPU Compute ã«ã‚ˆã‚‹ SDF ç”Ÿæˆ
ã€ä¾å­˜ã€‘WebGPUCapabilities, sdf-compute.wgsl

âš ï¸ é‡è¦: CPUå´ã§ã®è·é›¢å ´è¨ˆç®—ã¯ç¦æ­¢

â”œâ”€ init(device)
â”œâ”€ loadShader() â†’ wgslCode
â”œâ”€ createComputePipeline()
â”œâ”€ generateSDF(width, height, points) â†’ GPUBuffer
â””â”€ destroy()

ã€Compute Shaderä»•æ§˜ã€‘
- å…¥åŠ›: ãƒã‚¤ãƒ³ãƒˆé…åˆ— {x, y, radius}
- å‡ºåŠ›: SDF ãƒ†ã‚¯ã‚¹ãƒãƒ£ (è·é›¢å ´)
- ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã‚µã‚¤ã‚º: 8x8


â–  WebGPUComputeMSDF (webgpu-compute-msdf.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘GPU Compute ã«ã‚ˆã‚‹ MSDF ç”Ÿæˆ
ã€ä¾å­˜ã€‘WebGPUCapabilities, msdf-compute.wgsl

â”œâ”€ init(device)
â”œâ”€ loadShader() â†’ wgslCode
â”œâ”€ createComputePipeline()
â”œâ”€ generateMSDF(width, height, points) â†’ GPUBuffer
â””â”€ destroy()

ã€MSDFä»•æ§˜ã€‘
- Multi-channel Signed Distance Field
- RGBå„ãƒãƒ£ãƒãƒ«ã«ç•°ãªã‚‹è·é›¢å ´ã‚’æ ¼ç´
- ã‚¨ãƒƒã‚¸ã®ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚·ãƒ³ã‚°å“è³ªå‘ä¸Š


â–  WebGPUTextureBridge (webgpu-texture-bridge.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘WebGPUâ†”PixiJS ãƒ†ã‚¯ã‚¹ãƒãƒ£é€£æº
ã€ä¾å­˜ã€‘PIXI.Texture, WebGPUCapabilities

â”œâ”€ static createPixiTextureFromGPU(gpuTexture) â†’ PIXI.Texture
â”œâ”€ static createGPUTextureFromPixi(pixiTexture) â†’ GPUTexture
â””â”€ static syncTextures(source, target)


================================================================================
ã€9ã€‘SDF/MSDFæç”»ã‚·ã‚¹ãƒ†ãƒ 
================================================================================

â–  SDFBrushShader (sdf-brush-shader.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘SDFæç”»ç”¨ã‚«ã‚¹ã‚¿ãƒ ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼
ã€ä¾å­˜ã€‘PIXI.Shader

â”œâ”€ static createShader() â†’ PIXI.Shader
â”œâ”€ static vertexShader â†’ string (GLSL)
â””â”€ static fragmentShader â†’ string (GLSL)

ã€Fragmentã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ä»•æ§˜ã€‘
- SDFå€¤ã‹ã‚‰æ»‘ã‚‰ã‹ãªã‚¨ãƒƒã‚¸ç”Ÿæˆ
- smoothstep ã§ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚·ãƒ³ã‚°
- ç­†åœ§å¯¾å¿œã®é€æ˜åº¦è¨ˆç®—


â–  MSDFBrushShader (msdf-brush-shader.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘MSDFæç”»ç”¨ã‚«ã‚¹ã‚¿ãƒ ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼
ã€ä¾å­˜ã€‘PIXI.Shader

â”œâ”€ static createShader() â†’ PIXI.Shader
â”œâ”€ static vertexShader â†’ string (GLSL)
â””â”€ static fragmentShader â†’ string (GLSL)

ã€Fragmentã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ä»•æ§˜ã€‘
- RGBå„ãƒãƒ£ãƒãƒ«ã‹ã‚‰æœ€é©ãªè·é›¢ã‚’é¸æŠ
- median(r, g, b) ã§ã‚¨ãƒƒã‚¸æ¤œå‡º
- é«˜å“è³ªã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚·ãƒ³ã‚°


â–  SDFTextureGenerator (sdf-texture-generator.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘SDF ãƒ†ã‚¯ã‚¹ãƒãƒ£ç”Ÿæˆ
ã€ä¾å­˜ã€‘WebGPUComputeSDF or CPU fallback

âš ï¸ æ³¨æ„: å„ªå…ˆåº¦ã¯ GPU > CPU fallback

â”œâ”€ static async generate(width, height, points) â†’ PIXI.Texture
â”œâ”€ static _generateGPU(width, height, points) â†’ PIXI.Texture
â””â”€ static _generateCPUFallback(width, height, points) â†’ PIXI.Texture


â–  SDFMeshBuilder (sdf-mesh-builder.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘SDFæç”»ç”¨ãƒ¡ãƒƒã‚·ãƒ¥æ§‹ç¯‰
ã€ä¾å­˜ã€‘PIXI.Mesh

â”œâ”€ static buildMesh(points, settings) â†’ PIXI.Mesh
â”œâ”€ static _buildGeometry(points) â†’ PIXI.Geometry
â””â”€ static _buildUVs(points) â†’ Float32Array


================================================================================
ã€10ã€‘ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚·ã‚¹ãƒ†ãƒ 
================================================================================

â–  EventBus (event-bus.js) ğŸ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•é€šä¿¡
ã€ä¾å­˜ã€‘ãªã—

â”œâ”€ on(eventName, callback)
â”œâ”€ emit(eventName, data)
â”œâ”€ off(eventName, callback)
â””â”€ once(eventName, callback)


â–  History (history.js) ğŸ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘Undo/Redoç®¡ç†
ã€ä¾å­˜ã€‘EventBus

â”œâ”€ push(command) // {name, do, undo, meta}
â”œâ”€ undo()
â”œâ”€ redo()
â”œâ”€ canUndo() / canRedo()
â”œâ”€ clear()
â””â”€ setLayerSystem(layerSystem)

ã€Commandæ§‹é€ ã€‘
{
  name: string,
  do: function,
  undo: function,
  meta: object
}


â–  SettingsManager (settings-manager.js) ğŸ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šç®¡ç†
ã€ä¾å­˜ã€‘EventBus

â”œâ”€ getSettings() â†’ object
â”œâ”€ updateSettings(settings)
â”œâ”€ resetSettings()
â””â”€ saveSettings() / loadSettings()


â–  StateManager (state-manager.js) ğŸ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç†
ã€ä¾å­˜ã€‘EventBus

â”œâ”€ getCurrentState() â†’ object
â”œâ”€ setState(key, value)
â”œâ”€ getState(key) â†’ value
â”œâ”€ resetState()
â””â”€ saveState() / loadState()


â–  CheckerUtils (checker-utils.js)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ãƒã‚§ãƒƒã‚«ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆ
ã€ä¾å­˜ã€‘ãªã—

â”œâ”€ createCanvasChecker(width, height) â†’ PIXI.Graphics
â”œâ”€ resizeCanvasChecker(checker, width, height) â†’ PIXI.Graphics
â””â”€ createThumbnailCheckerDataURL(width, height, squareSize) â†’ dataURL


â–  VectorOperations (vector-operations.js)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ãƒ™ã‚¯ãƒˆãƒ«æ¼”ç®—ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
ã€ä¾å­˜ã€‘ãªã—

â”œâ”€ static distance(p1, p2) â†’ number
â”œâ”€ static dot(v1, v2) â†’ number
â”œâ”€ static cross(v1, v2) â†’ number
â”œâ”€ static normalize(v) â†’ {x, y}
â”œâ”€ static rotate(v, angle) â†’ {x, y}
â””â”€ static lerp(v1, v2, t) â†’ {x, y}


â–  BatchAPI (batch-api.js)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ãƒãƒƒãƒå‡¦ç†API
ã€ä¾å­˜ã€‘EventBus

â”œâ”€ executeBatch(operations) â†’ results
â”œâ”€ addOperation(operation)
â”œâ”€ clearOperations()
â””â”€ getOperations() â†’ Array


â–  DataModels (data-models.js)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å®šç¾©
ã€ä¾å­˜ã€‘ãªã—

ã€å®šç¾©ãƒ¢ãƒ‡ãƒ«ã€‘
- LayerModel: {id, name, visible, opacity, paths, transform}
- PathModel: {id, points, settings, timestamp}
- FrameModel: {id, layers, duration, thumbnail}
- StrokeModel: {id, points, pressure, tool, settings}


================================================================================
ã€11ã€‘ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ãƒ»å±¥æ­´ã‚·ã‚¹ãƒ†ãƒ 
================================================================================

â–  DrawingClipboard (drawing-clipboard.js) ğŸ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ãƒ¬ã‚¤ãƒ¤ãƒ¼/ãƒ•ãƒ¬ãƒ¼ãƒ ã®ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆ
ã€ä¾å­˜ã€‘EventBus, LayerSystem

â”œâ”€ copyActiveLayer()
â”œâ”€ pasteToActiveLayer()
â”œâ”€ copyFrame(frameIndex)
â”œâ”€ pasteFrame(position)
â”œâ”€ hasClipboard() â†’ boolean
â””â”€ getClipboardType() â†’ 'layer' | 'frame'

ã€ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã€‘
- clipboard:layer-copied
- clipboard:layer-pasted
- clipboard:frame-copied
- clipboard:frame-pasted

ã€ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ã€‘
- layer:copy-request
- layer:paste-request
- frame:copy-current
- frame:paste-right-adjacent


â–  VirtualAlbum (virtual-album.js) ğŸ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ä»®æƒ³ã‚¢ãƒ«ãƒãƒ ç®¡ç†ï¼ˆè¤‡æ•°ä½œå“ä¿å­˜ï¼‰
ã€ä¾å­˜ã€‘EventBus, StateManager

â”œâ”€ createAlbum(name) â†’ albumId
â”œâ”€ deleteAlbum(albumId)
â”œâ”€ saveCurrentToAlbum(albumId)
â”œâ”€ loadFromAlbum(albumId)
â”œâ”€ getAlbumList() â†’ Array
â””â”€ getAlbumThumbnail(albumId) â†’ dataUrl

ã€ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã€‘
- album:created
- album:deleted
- album:saved
- album:loaded

ã€ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ã€‘
- ui:album-save-request
- ui:album-load-request


================================================================================
ã€12ã€‘ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ 
================================================================================

â–  ExportManager (export-manager.js) ğŸ“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå‡¦ç†çµ±æ‹¬
ã€ä¾å­˜ã€‘å„ç¨®Exporter, EventBus

â”œâ”€ exportPNG(options)
â”œâ”€ exportAPNG(options)
â”œâ”€ exportGIF(options)
â”œâ”€ exportWebP(options)
â”œâ”€ exportMP4(options)
â””â”€ exportJSON(options)

ã€ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã€‘
- export:started {type}
- export:progress {percent}
- export:completed {type, dataUrl}
- export:error {type, error}

ã€ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ã€‘
- ui:export-request {type, options}


â–  PNGExporter (png-exporter.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘PNGé™æ­¢ç”»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
ã€ä¾å­˜ã€‘PIXI.Application

â”œâ”€ export(layers, options) â†’ dataUrl
â””â”€ exportWithBackground(layers, bgColor, options) â†’ dataUrl


â–  APNGExporter (apng-exporter.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘APNGã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‡ºåŠ›
ã€ä¾å­˜ã€‘UPNG.js, AnimationSystem

â”œâ”€ export(frames, options) â†’ blob
â””â”€ _encodeFrames(frames, delay) â†’ Uint8Array


â–  GIFExporter (gif-exporter.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘GIFã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‡ºåŠ›
ã€ä¾å­˜ã€‘gif.js, AnimationSystem

â”œâ”€ export(frames, options) â†’ blob
â””â”€ _addFrames(encoder, frames, delay)


â–  WebPExporter (webp-exporter.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘WebPã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‡ºåŠ›
ã€ä¾å­˜ã€‘WebP encoder, AnimationSystem

â”œâ”€ export(frames, options) â†’ blob
â””â”€ _encodeFrames(frames, quality, fps) â†’ Uint8Array


â–  MP4Exporter (mp4-exporter.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘MP4å‹•ç”»å‡ºåŠ›
ã€ä¾å­˜ã€‘MediaRecorder API, AnimationSystem

â”œâ”€ export(frames, options) â†’ blob
â”œâ”€ _setupRecorder(canvas, options) â†’ MediaRecorder
â””â”€ _captureFrames(recorder, frames, fps)


â–  QuickExportUI (quick-export-ui.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ã‚¯ã‚¤ãƒƒã‚¯ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆUI
ã€ä¾å­˜ã€‘ExportManager, PopupManager

â”œâ”€ init(exportManager, eventBus)
â”œâ”€ show()
â”œâ”€ hide()
â”œâ”€ selectFormat(format)
â””â”€ startExport()

ã€å¯¾å¿œãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‘
- PNG (é™æ­¢ç”»)
- APNG (ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³)
- GIF (ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³)
- WebP (é™æ­¢ç”»/ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³)
- MP4 (å‹•ç”»)
- JSON (ãƒ‡ãƒ¼ã‚¿)


================================================================================
ã€13ã€‘UIãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ 
================================================================================

â–  SettingsPopup (settings-popup.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘è¨­å®šç”»é¢ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
ã€ä¾å­˜ã€‘SettingsManager, PopupManager

â”œâ”€ init(settingsManager, eventBus)
â”œâ”€ show()
â”œâ”€ hide()
â”œâ”€ renderSettings()
â”œâ”€ handleSettingChange(key, value)
â””â”€ resetToDefaults()

ã€è¨­å®šé …ç›®ã€‘
- ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚º
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ–ãƒ©ã‚·è¨­å®š
- ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼
- WebGPUæœ‰åŠ¹/ç„¡åŠ¹
- ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰


â–  AlbumPopup (album-popup.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ã‚¢ãƒ«ãƒãƒ ç®¡ç†ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
ã€ä¾å­˜ã€‘VirtualAlbum, PopupManager

â”œâ”€ init(virtualAlbum, eventBus)
â”œâ”€ show()
â”œâ”€ hide()
â”œâ”€ renderAlbumList()
â”œâ”€ handleSave()
â”œâ”€ handleLoad(albumId)
â””â”€ handleDelete(albumId)


â–  ExportPopup (export-popup.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè¨­å®šãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
ã€ä¾å­˜ã€‘ExportManager, PopupManager

â”œâ”€ init(exportManager, eventBus)
â”œâ”€ show()
â”œâ”€ hide()
â”œâ”€ selectFormat(format)
â”œâ”€ renderFormatOptions(format)
â””â”€ startExport()


â–  QuickAccessPopup (quick-access-popup.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ãƒãƒ«
ã€ä¾å­˜ã€‘PopupManager, EventBus

â”œâ”€ init(eventBus)
â”œâ”€ show()
â”œâ”€ hide()
â”œâ”€ addAction(name, callback, icon)
â”œâ”€ removeAction(name)
â””â”€ renderActions()

ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€‘
- æ–°è¦ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆ
- ãƒ¬ã‚¤ãƒ¤ãƒ¼å‰Šé™¤
- Undo/Redo
- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- è¨­å®š


â–  ResizePopup (resize-popup.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ã‚­ãƒ£ãƒ³ãƒã‚¹ãƒªã‚µã‚¤ã‚ºãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
ã€ä¾å­˜ã€‘CameraSystem, PopupManager

â”œâ”€ init(cameraSystem, eventBus)
â”œâ”€ show()
â”œâ”€ hide()
â”œâ”€ getCurrentSize() â†’ {width, height}
â”œâ”€ setSize(width, height)
â””â”€ applyResize()


================================================================================
ã€14ã€‘ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ 
================================================================================

â–  StatusDisplayRenderer (status-display-renderer.js) ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€è²¬å‹™ã€‘ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æƒ…å ±è¡¨ç¤º
ã€ä¾å­˜ã€‘EventBus

â”œâ”€ render(statusData)
â”œâ”€ updateFPS(fps)
â”œâ”€ updateZoom(zoomLevel)
â”œâ”€ updateCanvasSize(width, height)
â”œâ”€ updateLayerInfo(activeIndex, totalCount)
â””â”€ updateToolInfo(tool, size, color)

ã€è¡¨ç¤ºé …ç›®ã€‘
- FPS (æç”»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹)
- ã‚ºãƒ¼ãƒ å€ç‡
- ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚º
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼
- ãƒ„ãƒ¼ãƒ«æƒ…å ±


================================================================================
ã€15ã€‘ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼å›³ï¼ˆä¸»è¦ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
================================================================================

ã€ãƒ‘ã‚¿ãƒ¼ãƒ³1: ãƒ¬ã‚¤ãƒ¤ãƒ¼åè»¢ï¼ˆã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼‰ã€‘Phase 2æ”¹ä¿®å¯¾è±¡
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
keyboard-handler.js
  â”œâ”€ handleKeyDown('H' + vKey)
  â”œâ”€ isVKeyPressed() === true ã‚’ç¢ºèª
  â””â”€ emit('layer:flip-by-key', {direction: 'horizontal'})
       â†“
layer-transform.js
  â”œâ”€ on('layer:flip-by-key')
  â”œâ”€ ğŸ”§ isVKeyPressed ãƒã‚§ãƒƒã‚¯å‰Šé™¤ï¼ˆPhase 2ï¼‰
  â””â”€ onFlipRequest('horizontal') ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè¡Œ
       â†“
layer-system.js
  â”œâ”€ flipActiveLayer('horizontal')
  â”œâ”€ ğŸ”§ isLayerMoveMode ãƒã‚§ãƒƒã‚¯å‰Šé™¤ï¼ˆbypassVKeyCheckå°å…¥ï¼‰
  â”œâ”€ transform.flipLayer(layer, 'horizontal')
  â”œâ”€ emit('layer:transform-updated')
  â””â”€ emit('thumbnail:layer-updated')
       â†“
thumbnail-update-manager.js (Phase 3çµ±åˆå¾Œ)
  â””â”€ layer-panel-renderer.updateSingleLayerThumbnail()


ã€ãƒ‘ã‚¿ãƒ¼ãƒ³2: ãƒ¬ã‚¤ãƒ¤ãƒ¼åè»¢ï¼ˆãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ï¼‰ã€‘Phase 2æ”¹ä¿®å¯¾è±¡
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ui-panels.js
  â”œâ”€ flipHorizontalBtn.click
  â””â”€ CoreRuntime.api.layer.flipActiveLayer('horizontal', true)
       â†“
core-runtime.js
  â””â”€ layerManager.flipActiveLayer('horizontal', true)
       â†“
layer-system.js
  â”œâ”€ flipActiveLayer('horizontal', bypassVKeyCheck: true)
  â”œâ”€ ğŸ”§ bypassVKeyCheck ã§ isLayerMoveMode ãƒã‚§ãƒƒã‚¯ã‚’ã‚¹ã‚­ãƒƒãƒ—
  â”œâ”€ transform.flipLayer(layer, 'horizontal')
  â””â”€ ... (ä»¥ä¸‹åŒã˜)


ã€ãƒ‘ã‚¿ãƒ¼ãƒ³3: ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ã€‘Phase 3æ”¹ä¿®å¯¾è±¡
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
layer-system.js (æç”»æ“ä½œ)
  â”œâ”€ addPathToActiveLayer(path)
  â””â”€ emit('layer:stroke-added', {layerIndex, layerId})
       â†“
thumbnail-update-manager.js
  â”œâ”€ on('layer:stroke-added')
  â”œâ”€ _requestUpdateWithActiveCheck(layerIndex)
  â”œâ”€ isActive ? immediate : debounce
  â””â”€ emit('thumbnail:layer-updated', {layerIndex, layerId})
       â†“
layer-panel-renderer.js
  â”œâ”€ on('thumbnail:layer-updated')
  â””â”€ ğŸ”§ updateSingleLayerThumbnail(layerIndex) â† Phase 3ã§publicåŒ–
       â†“
thumbnail-system.js (Phase 3çµ±åˆå¾Œ)
  â””â”€ generateLayerThumbnail(layer, index, maxW, maxH)


ã€ãƒ‘ã‚¿ãƒ¼ãƒ³4: BS/DELã‚­ãƒ¼ã§ãƒ¬ã‚¤ãƒ¤ãƒ¼å†…å®¹å‰Šé™¤ã€‘Phase 1ä¿®å¾©å¯¾è±¡
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
keyboard-handler.js
  â”œâ”€ handleKeyDown('Delete' or 'Backspace')
  â”œâ”€ ğŸ”§ getAction(e, {vMode: false}) â†’ 'LAYER_DELETE_DRAWINGS'
  â”œâ”€ handleAction('LAYER_DELETE_DRAWINGS')
  â””â”€ deleteActiveLayerDrawings()
       â”œâ”€ activeLayer.layerData.paths = []
       â”œâ”€ clearLayerDrawings(layerSystem, activeLayer)
       â”œâ”€ emit('layer:drawings-deleted')
       â””â”€ requestThumbnailUpdate(layerIndex)


ã€ãƒ‘ã‚¿ãƒ¼ãƒ³5: Vã‚­ãƒ¼ãƒˆã‚°ãƒ«ã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
keyboard-handler.js
  â”œâ”€ handleKeyDown('V')
  â”œâ”€ vKeyPressed = !vKeyPressed (toggle)
  â””â”€ emit('keyboard:vkey-pressed', {pressed: vKeyPressed})
       â†“
layer-transform.js
  â”œâ”€ on('keyboard:vkey-pressed')
  â””â”€ pressed ? enterMoveMode() : exitMoveMode()
       â”œâ”€ cameraSystem.showGuideLines()
       â”œâ”€ transformPanel.classList.add('show')
       â””â”€ updateFlipButtonsAvailability(true)
       â†“
layer-system.js
  â”œâ”€ on('keyboard:vkey-pressed')
  â””â”€ vKeyPressed = pressed


ã€ãƒ‘ã‚¿ãƒ¼ãƒ³6: ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯æç”»ã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pointer-handler.js
  â”œâ”€ normalizeEvent(pointerEvent)
  â””â”€ handlers.down(info)
       â†“
drawing-engine.js
  â”œâ”€ onPointerDown(info)
  â”œâ”€ screenClientToCanvas(clientX, clientY)
  â”œâ”€ canvasToWorld(canvasX, canvasY)
  â”œâ”€ worldToLocal(worldX, worldY, activeLayer)
  â””â”€ brushCore.startStroke(localX, localY, pressure)
       â†“
brush-core.js
  â”œâ”€ strokeRecorder.startStroke(localX, localY, pressure)
  â””â”€ emit('drawing:stroke-started')
       â†“
stroke-recorder.js
  â””â”€ points.push({x: localX, y: localY, pressure})

// ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯å®Œäº†æ™‚
brush-core.js
  â”œâ”€ finalizeStroke()
  â”œâ”€ strokeData = strokeRecorder.finalizeStroke()
  â””â”€ strokeRenderer.renderStroke(layer, strokeData, settings)
       â†“
stroke-renderer.js
  â”œâ”€ _renderFinalStrokeMSDF() ã¾ãŸã¯
  â”œâ”€ _renderFinalStrokeWebGPU() ã¾ãŸã¯
  â””â”€ _renderFinalStrokeLegacy()
       â†“
layer-system.js
  â”œâ”€ addPathToActiveLayer(path)
  â””â”€ emit('layer:stroke-added')


ã€ãƒ‘ã‚¿ãƒ¼ãƒ³7: WebGPU SDFç”Ÿæˆã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
stroke-renderer.js
  â””â”€ _renderFinalStrokeWebGPU(strokeData)
       â†“
sdf-texture-generator.js
  â”œâ”€ generate(width, height, points)
  â””â”€ _generateGPU(width, height, points)
       â†“
webgpu-compute-sdf.js
  â”œâ”€ generateSDF(width, height, points)
  â”œâ”€ createComputePipeline()
  â”œâ”€ dispatch compute shader (sdf-compute.wgsl)
  â””â”€ return GPUBuffer
       â†“
webgpu-texture-bridge.js
  â””â”€ createPixiTextureFromGPU(gpuTexture) â†’ PIXI.Texture
       â†“
stroke-renderer.js
  â””â”€ mesh = SDFMeshBuilder.buildMesh(points, settings)
       â””â”€ layer.addChild(mesh)


ã€ãƒ‘ã‚¿ãƒ¼ãƒ³8: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
timeline-ui.js
  â””â”€ handlePlayPause()
       â””â”€ emit('timeline:play-toggled')
            â†“
animation-system.js
  â”œâ”€ on('timeline:play-toggled')
  â”œâ”€ play()
  â”œâ”€ ticker.add(_onTick)
  â””â”€ emit('animation:playback-started')
       â†“
animation-system._onTick()
  â”œâ”€ currentTime += deltaTime
  â”œâ”€ if (currentTime >= frameDuration) {
  â”‚    goToNextFrame()
  â”‚  }
  â””â”€ emit('animation:frame-changed')
       â†“
layer-panel-renderer.js / timeline-ui.js
  â””â”€ UIã‚’æ›´æ–°ï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ãƒ¬ãƒ¼ãƒ è¡¨ç¤ºï¼‰


================================================================================
ã€16ã€‘ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§
================================================================================

â–  çµ±ä¸€æ¸ˆã¿
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.CoordinateSystem         - coordinate-system.js
window.cameraSystem             - camera-system.js
window.layerManager             - layer-system.js (via core-engine)
window.EventBus                 - event-bus.js
window.PointerHandler           - pointer-handler.js
window.PressureHandler          - pressure-handler.js
window.CoreRuntime              - core-runtime.js
window.CoreEngine               - core-engine.js

â–  å‰Šé™¤å€™è£œï¼ˆé‡è¤‡ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš ï¸ window.TEGAKI_COORDINATE_SYSTEM  - CoordinateSystemã¨é‡è¤‡


================================================================================
ã€17ã€‘è¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 
================================================================================

â–  TEGAKI_CONFIG (config.js)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{
  canvas: {
    width: 1920,
    height: 1080,
    backgroundColor: 0xFFFFFF,
    dpiScale: window.devicePixelRatio
  },
  
  brush: {
    defaultSize: 10,
    minSize: 1,
    maxSize: 500,
    defaultColor: '#000000',
    defaultOpacity: 1.0
  },
  
  camera: {
    minZoom: 0.1,
    maxZoom: 10.0,
    zoomSpeed: 0.001,
    panSpeed: 1.0
  },
  
  layer: {
    maxLayers: 100,
    defaultName: 'Layer',
    thumbnailSize: {width: 150, height: 100}
  },
  
  animation: {
    defaultFPS: 12,
    minFPS: 1,
    maxFPS: 60
  },
  
  webgpu: {
    enabled: true,
    fallbackToCPU: true,
    computeWorkgroupSize: [8, 8, 1]
  },
  
  debug: false
}

â–  TEGAKI_KEYMAP (config.js)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{
  actions: {
    UNDO: {keys: ['Ctrl+Z', 'Cmd+Z']},
    REDO: {keys: ['Ctrl+Shift+Z', 'Cmd+Shift+Z']},
    TOOL_PEN: {keys: ['P']},
    TOOL_ERASER: {keys: ['E']},
    LAYER_CREATE: {keys: ['Ctrl+Shift+N']},
    LAYER_DELETE_DRAWINGS: {keys: ['Delete', 'Backspace']},
    LAYER_FLIP_HORIZONTAL: {keys: ['H'], requiresVKey: true},
    LAYER_FLIP_VERTICAL: {keys: ['Shift+H'], requiresVKey: true},
    // ... ä»–å¤šæ•°
  }
}


================================================================================
ã€18ã€‘Phaseåˆ¥æ”¹ä¿®ãƒãƒƒãƒ”ãƒ³ã‚°
================================================================================

â–  Phase 1: åŸºç›¤è¨ºæ–­ãƒ»å³ä¿®æ­£å¯èƒ½é …ç›®
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å¯¾è±¡: keyboard-handler.js, layer-panel-renderer.js, config.js
ä¿®æ­£: 
  - deleteActiveLayerDrawings() ç™ºç«ç¢ºèª
  - _createBackgroundThumbnail() ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ä¿®æ­£
  - createThumbnail() çµ±ä¸€å‡¦ç†é©ç”¨

â–  Phase 2: ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒ åè»¢æ©Ÿèƒ½ã®å®Œå…¨å¾©æ—§
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å¯¾è±¡: layer-transform.js, layer-system.js, ui-panels.js, keyboard-handler.js
ä¿®æ­£:
  - layer-system.js: flipActiveLayer() ã« bypassVKeyCheck ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ 
  - ui-panels.js: setupFlipButtons() ã§ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ bypassVKeyCheck=true æ¸¡ã™
  - layer-transform.js: flipLayer() ã‹ã‚‰å†…éƒ¨Vã‚­ãƒ¼ãƒã‚§ãƒƒã‚¯å‰Šé™¤
  - keyboard-handler.js: Vã‚­ãƒ¼ãƒã‚§ãƒƒã‚¯ã¯ã“ã“ã§å®Œçµ

â–  Phase 3: ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ã‚·ã‚¹ãƒ†ãƒ ã®ä¸€å…ƒåŒ–
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å¯¾è±¡: thumbnail-update-manager.js, layer-panel-renderer.js, layer-system.js
ä¿®æ­£:
  - layer-panel-renderer.js: _updateSingleThumbnail() ã‚’ publicåŒ–
  - layer-system.js: requestThumbnailUpdate() ã‚’eventBus.emit()ã®ã¿ã«ç°¡ç•¥åŒ–
  - thumbnail-update-manager.js: ã™ã¹ã¦ã®æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç¢ºå®Ÿã«ãƒªã‚¹ãƒ³
  - thumbnail-system.js: çµ±åˆäºˆå®šï¼ˆç¾åœ¨ã¯ layer-panel-renderer ãŒç›´æ¥å‡¦ç†ï¼‰

â–  Phase 4: ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²æ¤œè¨ï¼ˆä»»æ„ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å¯¾è±¡: layer-transform.js (628è¡Œ)
åˆ†å‰²æ¡ˆ:
  - transform-core.js: åº§æ¨™å¤‰æ›ãƒ»è¡Œåˆ—æ¼”ç®—
  - transform-ui.js: ãƒ‘ãƒãƒ«UIãƒ»ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
  - transform-drag.js: ãƒ‰ãƒ©ãƒƒã‚°å‡¦ç†
  - transform-manager.js: çµ±åˆãƒ»APIæä¾›

â–  Phase 5: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã¸ã®ä¾å­˜é–¢ä¿‚è¨˜è¿°ï¼ˆç¶™ç¶šä½œæ¥­ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å¯¾è±¡: å…¨ãƒ•ã‚¡ã‚¤ãƒ«
ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:
  /**
   * @file [filename]
   * @description [è²¬å‹™]
   * ã€è¦ªãƒ•ã‚¡ã‚¤ãƒ« (ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¾å­˜)ã€‘
   * ã€å­ãƒ•ã‚¡ã‚¤ãƒ« (ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¾å­˜)ã€‘
   * ã€ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰ã€‘
   * ã€ãƒ•ãƒ­ãƒ¼ä½ç½®ã€‘
   */


================================================================================
ã€19ã€‘äºŒé‡å®Ÿè£…ã®è©³ç´°åˆ†æ
================================================================================

â–  A. ãƒ¬ã‚¤ãƒ¤ãƒ¼åè»¢å‡¦ç†
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€å®Ÿè£…ç®‡æ‰€ã€‘
1. layer-transform.js: flipLayer() (L239-261) â† å®Ÿä½“
2. layer-system.js: flipActiveLayer() (L340-364) â† ãƒ©ãƒƒãƒ‘ãƒ¼
3. ui-panels.js: setupFlipButtons() (L157-169) â† UIçµŒç”±å‘¼ã³å‡ºã—
4. keyboard-handler.js: handleAction('LAYER_FLIP_*') (L145-155) â† ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ

ã€è©•ä¾¡ã€‘
âœ… æ­£å¸¸ãªéšå±¤æ§‹é€ 
  - keyboard-handler â†’ eventBus â†’ layer-transform â†’ layer-system
  - ui-panels â†’ CoreRuntime â†’ layer-system â†’ layer-transform
  - å®Ÿä½“ã¯ layer-transform.flipLayer() ã®ã¿

ã€å•é¡Œã€‘
âš ï¸ Vã‚­ãƒ¼ãƒã‚§ãƒƒã‚¯ãŒè¤‡æ•°ç®‡æ‰€ã«åˆ†æ•£
  - keyboard-handler.js: isVKeyPressed() ãƒã‚§ãƒƒã‚¯
  - layer-transform.js: å†…éƒ¨ã§ã‚‚Vã‚­ãƒ¼ãƒã‚§ãƒƒã‚¯
  - layer-system.js: isLayerMoveMode ãƒã‚§ãƒƒã‚¯

ã€Phase 2æ”¹ä¿®ã€‘
- keyboard-handler ã§Vã‚­ãƒ¼ãƒã‚§ãƒƒã‚¯å®Œçµ
- layer-transform ã‹ã‚‰Vã‚­ãƒ¼ãƒã‚§ãƒƒã‚¯å‰Šé™¤
- layer-system ã« bypassVKeyCheck ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ 


â–  B. ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€å®Ÿè£…ç®‡æ‰€ã€‘
1. thumbnail-update-manager.js: requestUpdate() (L128-154) â† æ„å›³ã•ã‚ŒãŸä¸€å…ƒç®¡ç†
2. layer-panel-renderer.js: _updateSingleThumbnail() (L479-537) â† å®Ÿä½“
3. layer-system.js: requestThumbnailUpdate() (L938-946) â† ç›´æ¥å‘¼ã³å‡ºã—

ã€è©•ä¾¡ã€‘
âŒ ä¸€å…ƒåŒ–ãŒä¸å®Œå…¨
  - thumbnail-update-manager ã¯ eventBus.emit() ã™ã‚‹ã ã‘
  - å®Ÿéš›ã®æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ã¯ layer-panel-renderer ã«æ®‹å­˜
  - layer-system ãŒç›´æ¥ thumbnail-update-manager ã‚’å‘¼ã¶ç®‡æ‰€ã‚‚ã‚ã‚‹

ã€Phase 3æ”¹ä¿®ã€‘
- layer-panel-renderer._updateSingleThumbnail() ã‚’ publicåŒ–
- layer-system.requestThumbnailUpdate() ã‚’ eventBus.emit() ã®ã¿ã«
- ã™ã¹ã¦ã®æ›´æ–°ã¯ thumbnail-update-manager çµŒç”±ã«çµ±ä¸€


â–  C. Vã‚­ãƒ¼ãƒ¢ãƒ¼ãƒ‰ç®¡ç†
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€å®Ÿè£…ç®‡æ‰€ã€‘
1. keyboard-handler.js: vKeyPressed (L8, L40-52) â† çœŸã®ã‚½ãƒ¼ã‚¹
2. layer-transform.js: isVKeyPressed (L13) â† ãƒ—ãƒ­ã‚­ã‚·
3. layer-system.js: vKeyPressed getter (L332-334) â† ãƒ—ãƒ­ã‚­ã‚·

ã€è©•ä¾¡ã€‘
â–³ æ©Ÿèƒ½çš„ã«ã¯å•é¡Œãªã„ãŒå†—é•·
  - keyboard-handler ãŒçœŸã®ã‚½ãƒ¼ã‚¹
  - ä»–2ã¤ã¯å‚ç…§ç”¨ãƒ—ãƒ­ã‚­ã‚·
  - eventBus 'keyboard:vkey-pressed' ã§åŒæœŸ

ã€æ”¹å–„ææ¡ˆã€‘
- å„ãƒ•ã‚¡ã‚¤ãƒ«ã§ã® vKeyPressed çŠ¶æ…‹ä¿æŒã¯ç¶­æŒ
- åŒæœŸã¯ eventBus çµŒç”±ã§ç¶™ç¶š
- ç›´æ¥å‚ç…§ã‚’é¿ã‘ã‚‹ãŸã‚ç¾çŠ¶ç¶­æŒãŒå¦¥å½“


â–  D. åº§æ¨™å¤‰æ›ã®åˆ†æ•£
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€å®Ÿè£…ç®‡æ‰€ã€‘
1. coordinate-system.js: å…¨åº§æ¨™å¤‰æ›ãƒ¡ã‚½ãƒƒãƒ‰ â† å”¯ä¸€ã®å®Ÿä½“
2. drawing-engine.js: åº§æ¨™å¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ
3. stroke-recorder.js: åº§æ¨™è¨˜éŒ²ã®ã¿ï¼ˆå¤‰æ›ãªã—ï¼‰ â† æ­£ã—ã„è¨­è¨ˆ

ã€è©•ä¾¡ã€‘
âœ… å®Œç’§ãªè¨­è¨ˆ
  - coordinate-system ãŒå”¯ä¸€ã®åº§æ¨™å¤‰æ›å®Ÿè£…
  - drawing-engine ã§å¤‰æ›å®Œçµ
  - stroke-recorder ã¯å¤‰æ›æ¸ˆã¿åº§æ¨™ã‚’è¨˜éŒ²ã®ã¿

ã€é‡è¦ãƒ«ãƒ¼ãƒ«ã€‘
âŒ ç¦æ­¢: stroke-recorder ã§åº§æ¨™å¤‰æ›
âŒ ç¦æ­¢: PIXI v8 toLocal() ä½¿ç”¨ï¼ˆworldTransformå«ã‚€ãŸã‚ä¸æ­£ç¢ºï¼‰
âœ… å¿…é ˆ: coordinate-system.worldToLocal() æ‰‹å‹•é€†ç®—ä½¿ç”¨


================================================================================
ã€20ã€‘ã‚¤ãƒ™ãƒ³ãƒˆåè¦å‰‡
================================================================================

â–  å‘½åãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{component}:{action}[-{detail}]

ä¾‹:
- layer:created
- layer:stroke-added
- layer:flip-by-key
- thumbnail:layer-updated
- keyboard:vkey-pressed
- camera:resized
- animation:playback-started


â–  ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«å…ƒãƒãƒƒãƒ—
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€layer:*ã€‘
- layer-system.js, layer-transform.js

ã€thumbnail:*ã€‘
- thumbnail-update-manager.js

ã€keyboard:*ã€‘
- keyboard-handler.js

ã€camera:*ã€‘
- camera-system.js

ã€drawing:*ã€‘
- drawing-engine.js, brush-core.js

ã€animation:*ã€‘
- animation-system.js

ã€ui:*ã€‘
- ui-panels.js, layer-panel-renderer.js, å„ç¨®popup

ã€clipboard:*ã€‘
- drawing-clipboard.js

ã€export:*ã€‘
- export-manager.js

ã€brush:*ã€‘
- brush-settings.js


â–  ä¸»è¦ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ï¼ˆã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
animation:frame-changed
animation:frame-created
animation:frame-deleted
animation:initialized
animation:playback-started
animation:playback-paused
animation:playback-stopped

brush:size-changed
brush:color-changed
brush:opacity-changed

camera:resized
camera:flip-horizontal
camera:flip-vertical
camera:reset

clipboard:layer-copied
clipboard:layer-pasted
clipboard:frame-copied
clipboard:frame-pasted

drawing:stroke-started
drawing:stroke-completed
drawing:stroke-cancelled

export:started
export:progress
export:completed
export:error

keyboard:vkey-pressed

layer:created
layer:deleted
layer:activated
layer:visibility-changed
layer:opacity-changed
layer:reordered
layer:hierarchy-moved
layer:background-color-changed
layer:stroke-added
layer:path-added
layer:updated
layer:transform-updated
layer:transform-confirmed
layer:flip-by-key
layer:flip-horizontal
layer:flip-vertical
layer:clear-active
layer:copy-request
layer:paste-request
layer:reset-transform
layer:move-by-key
layer:scale-by-key
layer:rotate-by-key
layer:select-next
layer:select-prev
layer:order-up
layer:order-down

thumbnail:layer-updated

ui:toggle-settings
ui:show-settings
ui:toggle-quick-access
ui:toggle-album
ui:toggle-export
ui:toggle-timeline
ui:background-color-change-requested
ui:layer-selected
ui:sidebar:sync-tool


================================================================================
ã€21ã€‘ç¦æ­¢äº‹é …ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
================================================================================

âŒ Canvas2D ã®å®Œå…¨ç¦æ­¢
ç†ç”±: WebGPU/PixiJSçµ±ä¸€ã®ãŸã‚
ä»£æ›¿: PIXI.Graphics, WebGPU

âŒ ãƒ©ã‚¹ã‚¿ãƒ¼ãƒšãƒ³ã®å®Ÿè£…ç¦æ­¢
ç†ç”±: SDF/MSDFãƒ™ãƒ¼ã‚¹å®Ÿè£…ã«çµ±ä¸€
ä»£æ›¿: SDFBrushShader, MSDFBrushShader

âŒ localStorage/sessionStorage ä½¿ç”¨ç¦æ­¢
ç†ç”±: Claude.ai artifactsç’°å¢ƒã§éå¯¾å¿œ
ä»£æ›¿: ãƒ¡ãƒ¢ãƒªå†…çŠ¶æ…‹ç®¡ç† (StateManager)

âŒ PIXI v8 toLocal() ä½¿ç”¨ç¦æ­¢
ç†ç”±: worldContainer.positionå«ã¿è² æ•°åº§æ¨™ã«ãªã‚‹
ä»£æ›¿: coordinate-system.worldToLocal() æ‰‹å‹•é€†ç®—

âŒ CPUå´ã§ã®è·é›¢å ´è¨ˆç®—ç¦æ­¢
ç†ç”±: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»ãƒ¢ãƒ€ãƒ³å®Ÿè£…é‡è¦–
ä»£æ›¿: WebGPUComputeSDF, WebGPUComputeMSDF

âŒ ãƒšãƒ³/æ¶ˆã—ã‚´ãƒ ã®åˆ†é›¢å®Ÿè£…ç¦æ­¢
ç†ç”±: DRYåŸå‰‡é•å
ä»£æ›¿: çµ±ä¸€ BrushCore + mode='pen'|'eraser'

âŒ äºŒé‡å¤‰æ›ï¼ˆåº§æ¨™å¤‰æ›ã‚’è¤‡æ•°ç®‡æ‰€ã§å®Ÿæ–½ï¼‰
ç†ç”±: ãƒã‚°ã®æ¸©åºŠ
ä»£æ›¿: drawing-engineã§å®Œçµã€stroke-recorderã¯è¨˜éŒ²ã®ã¿

âŒ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ãƒ»ãƒ•ã‚§ã‚¤ãƒ«ã‚»ãƒ¼ãƒ•
ç†ç”±: æ›–æ˜§ãªå‹•ä½œãƒ»æš—é»™ä¿®å¾©ç¦æ­¢
ä»£æ›¿: ã‚¨ãƒ©ãƒ¼æ™‚ã¯æ˜ç¤ºçš„ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

âŒ ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ··åœ¨ï¼ˆPixiJS v7/v8åŒæ™‚å¯¾å¿œï¼‰
ç†ç”±: äºŒé‡ç®¡ç†ã®è¤‡é›‘åŒ–
ä»£æ›¿: v8ã®ã¿ã‚µãƒãƒ¼ãƒˆ

âŒ å¾ªç’°ä¾å­˜
ç†ç”±: åˆæœŸåŒ–é †åºå•é¡Œ
ä»£æ›¿: EventBusçµŒç”±ã®ç–çµåˆ


================================================================================
ã€22ã€‘åº§æ¨™ç³»å¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆè©³ç´°ï¼‰
================================================================================

â–  ãƒ•ãƒ­ãƒ¼å›³
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PointerEvent
  â”‚
  â”œâ”€ clientX, clientY (ãƒ–ãƒ©ã‚¦ã‚¶åº§æ¨™)
  â”‚
  â–¼
screenClientToCanvas() [coordinate-system.js]
  â”‚ DPIè£œæ­£: clientX * devicePixelRatio
  â”‚ Canvasè¦ç´ ã®boundingClientRectè€ƒæ…®
  â”‚
  â”œâ”€ canvasX, canvasY (Canvasåº§æ¨™)
  â”‚
  â–¼
canvasToWorld() [coordinate-system.js]
  â”‚ worldContaineré€†è¡Œåˆ—é©ç”¨
  â”‚ worldContainer.position, scale, rotation è£œæ­£
  â”‚
  â”œâ”€ worldX, worldY (Worldåº§æ¨™)
  â”‚
  â–¼
worldToLocal() [coordinate-system.js]
  â”‚ æ‰‹å‹•é€†ç®—ï¼ˆPIXI toLocalç¦æ­¢ï¼‰
  â”‚ è¦ªãƒã‚§ãƒ¼ãƒ³é¡æŸ»: layer â†’ layerContainer â†’ worldContainer
  â”‚ å„è¦ªã® position/scale/rotation ã‚’é€†é †é©ç”¨
  â”‚
  â”œâ”€ localX, localY (Localåº§æ¨™)
  â”‚
  â–¼
stroke-recorder.startStroke(localX, localY, pressure)
  â”‚ åº§æ¨™å¤‰æ›ãªã—ã€ãã®ã¾ã¾è¨˜éŒ²
  â”‚
  â””â”€ points.push({x: localX, y: localY, pressure})


â–  worldToLocal() å®Ÿè£…è©³ç´°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âŒ ä½¿ç”¨ç¦æ­¢: PIXI v8 container.toLocal()
ç†ç”±:
  - worldContainerå…¨ä½“ã®worldTransformã‚’ä½¿ç”¨
  - worldContainer.position ãŒå«ã¾ã‚Œã‚‹
  - ã‚«ãƒ¡ãƒ©ãƒ‘ãƒ³æ™‚ã«è² æ•°åº§æ¨™ã«ãªã‚‹

âœ… æ­£ã—ã„å®Ÿè£…: æ‰‹å‹•é€†ç®—
```javascript
worldToLocal(worldX, worldY, targetLayer) {
  let x = worldX;
  let y = worldY;
  
  // è¦ªãƒã‚§ãƒ¼ãƒ³å–å¾—
  const parents = [];
  let current = targetLayer;
  while (current && current !== worldContainer) {
    parents.unshift(current);
    current = current.parent;
  }
  
  // é€†é †é©ç”¨ï¼ˆWorld â†’ Parent1 â†’ Parent2 â†’ Localï¼‰
  for (const parent of parents) {
    // positioné€†ç®—
    x -= parent.position.x;
    y -= parent.position.y;
    
    // rotationé€†ç®—
    if (parent.rotation !== 0) {
      const cos = Math.cos(-parent.rotation);
      const sin = Math.sin(-parent.rotation);
      const tx = x * cos - y * sin;
      const ty = x * sin + y * cos;
      x = tx;
      y = ty;
    }
    
    // scaleé€†ç®—
    x /= parent.scale.x;
    y /= parent.scale.y;
  }
  
  return {localX: x, localY: y};
}
```


================================================================================
ã€23ã€‘ãƒ•ã‚¡ã‚¤ãƒ«è¡Œæ•°ãƒ»è¤‡é›‘åº¦åˆ†æ
================================================================================

â–  500è¡Œè¶…ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆåˆ†å‰²æ¤œè¨å€™è£œï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
layer-transform.js: 628è¡Œ â† Phase 4ã§åˆ†å‰²æ¤œè¨
layer-system.js: æ¨å®š900è¡Œ
drawing-engine.js: æ¨å®š400è¡Œ
keyboard-handler.js: æ¨å®š350è¡Œ
core-engine.js: æ¨å®š500è¡Œ

â–  é©åˆ‡ãªã‚µã‚¤ã‚ºï¼ˆãã®ã¾ã¾ç¶­æŒï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
stroke-recorder.js: æ¨å®š100è¡Œ
pressure-handler.js: 200è¡Œ
pointer-handler.js: 180è¡Œ
brush-core.js: æ¨å®š150è¡Œ
coordinate-system.js: æ¨å®š300è¡Œ


================================================================================
ã€24ã€‘ä»Šå¾Œã®æ‹¡å¼µäºˆå®šæ©Ÿèƒ½ï¼ˆå‚è€ƒï¼‰
================================================================================

â–  æç”»æ©Ÿèƒ½
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- ãƒ™ã‚¯ã‚¿ãƒ¼ãƒ–ãƒ©ã‚·ï¼ˆBÃ©zieræ›²ç·šï¼‰
- é¸æŠãƒ„ãƒ¼ãƒ«ï¼ˆçŸ©å½¢ãƒ»æŠ•ã’ç¸„ï¼‰
- å¡—ã‚Šã¤ã¶ã—ï¼ˆãƒã‚±ãƒ„ãƒ„ãƒ¼ãƒ«ï¼‰
- ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒ†ã‚­ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«

â–  ãƒ¬ã‚¤ãƒ¤ãƒ¼æ©Ÿèƒ½
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒã‚¹ã‚¯
- ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ãƒã‚¹ã‚¯
- ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆã¼ã‹ã—ãƒ»å½±ï¼‰
- ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—

â–  ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- ã‚ªãƒ‹ã‚ªãƒ³ã‚¹ã‚­ãƒ³
- ãƒ•ãƒ¬ãƒ¼ãƒ è£œé–“
- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è©³ç´°ç·¨é›†
- ã‚«ãƒ¼ãƒ–ã‚¨ãƒ‡ã‚£ã‚¿

â–  ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- PSDå½¢å¼å¯¾å¿œ
- SVGå‡ºåŠ›
- ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã‚·ãƒ¼ãƒˆç”Ÿæˆ
- ãƒãƒƒãƒã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ


================================================================================
ã€25ã€‘ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ãƒã‚¤ãƒ³ãƒˆ
================================================================================

â–  æç”»æœ€é©åŒ–
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- WebGPU Compute Shader ã«ã‚ˆã‚‹ SDF/MSDF ç”Ÿæˆ
- ãƒ¡ãƒƒã‚·ãƒ¥ãƒãƒƒãƒãƒ³ã‚°
- ã‚ªãƒ•ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- ãƒ‡ãƒã‚¦ãƒ³ã‚¹ãƒ»ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°é©ç”¨

â–  ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- ä¸è¦ãªGraphicsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç ´æ£„
- ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚µãƒ ãƒã‚¤ãƒ«ã®é…å»¶ç”Ÿæˆ
- å±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯ã®ä¸Šé™è¨­å®š

â–  UIæœ€é©åŒ–
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Virtual Scrollingï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«ï¼‰
- RAF (requestAnimationFrame) æ´»ç”¨
- CSS transform ã«ã‚ˆã‚‹ GPU ã‚¢ã‚¯ã‚»ãƒ©ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- ã‚¤ãƒ™ãƒ³ãƒˆå§”è­²ãƒ‘ã‚¿ãƒ¼ãƒ³


================================================================================
ã€ç´¢å¼•ä½œæˆå®Œäº†ã€‘
================================================================================

æœ¬ç´¢å¼•ã¯ä»¥ä¸‹ã‚’ç¶²ç¾…:
- å…¨ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ¡ã‚½ãƒƒãƒ‰ãƒ»ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
- ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼å›³
- åº§æ¨™å¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è©³ç´°
- Phaseåˆ¥æ”¹ä¿®ãƒãƒƒãƒ”ãƒ³ã‚°
- äºŒé‡å®Ÿè£…ã®è©³ç´°åˆ†æ
- ç¦æ­¢äº‹é …ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§
- ã‚¤ãƒ™ãƒ³ãƒˆåè¦å‰‡ãƒ»ä¸€è¦§

æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:
1. æœ¬ç´¢å¼•ã‚’åŸºã«ğŸ”§æ”¹ä¿®è¨ˆç”»æ›¸ã®å†è©•ä¾¡
2. Phase 1ã‹ã‚‰é †æ¬¡æ”¹ä¿®å®Ÿæ–½
3. å„Phaseå®Œäº†å¾Œã®æ¤œè¨¼

ä½œæˆè€…: Claude Sonnet 4.5
ä½œæˆæ—¥: 2025-11-08