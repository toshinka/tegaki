================================================================================
ãƒ–ãƒ©ã‚¦ã‚¶ãŠçµµã‹ããƒ„ãƒ¼ãƒ« v8.13 - SDFæ¶ˆã—ã‚´ãƒ å®Ÿè£…èª¿æŸ»
ãƒ•ãƒ­ãƒ¼ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ãƒ»ã‚·ãƒ³ãƒœãƒ«ç´¢å¼•è¾å…¸ + æ®µéšçš„æ”¹ä¿®è¨ˆç”»æ›¸
================================================================================

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ç¬¬1éƒ¨: ç¾çŠ¶åˆ†æ - ãƒ•ãƒ­ãƒ¼ç´¢å¼•è¾å…¸
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â–  1. åº§æ¨™å¤‰æ›ãƒ•ãƒ­ãƒ¼ (æç”»ãƒ»æ¶ˆã—ã‚´ãƒ å…±é€š)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ drawing-engine.js
  â””â”€ onPointerDown/Move/Up()
      â””â”€ CoordinateSystem.screenClientToCanvas(clientX, clientY)  [DPIè£œæ­£]
          â””â”€ cameraSystem.canvasToWorld(canvasX, canvasY)  [worldContaineré€†è¡Œåˆ—]
              â””â”€ CoordinateSystem.worldToLocal(worldX, worldY, targetLayer)  [è¦ªãƒã‚§ãƒ¼ãƒ³é¡æŸ»]
                  â””â”€ stroke-recorder.js
                      â””â”€ startStroke(localX, localY, pressure) âœ…
                          addPoint(localX, localY, pressure) âœ…

âš ï¸ å•é¡Œ: åº§æ¨™å¤‰æ›ã¯æ­£å¸¸ã ãŒã€æ¶ˆã—ã‚´ãƒ ãƒ¢ãƒ¼ãƒ‰åˆ¤å®šãŒä¸æ˜ç­


â–  2. SDF/MSDF ãƒšãƒ³æç”»ãƒ•ãƒ­ãƒ¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ stroke-recorder.js
  â””â”€ endStroke()
      â””â”€ EventBus.emit('stroke:complete', strokeData) ğŸ”€

ğŸ“ stroke-renderer.js
  â””â”€ EventBus.on('stroke:complete')
      â””â”€ renderStroke(strokeData)
          â”œâ”€ modeåˆ¤å®š: 'pen' | 'eraser' ğŸ”
          â”œâ”€ [PEN MODE]
          â”‚   â”œâ”€ curve-interpolator.js::interpolate() â†’ è£œé–“ç‚¹ç”Ÿæˆ
          â”‚   â”œâ”€ sdf-mesh-builder.js::buildMesh() â†’ ã‚¸ã‚ªãƒ¡ãƒˆãƒªæ§‹ç¯‰
          â”‚   â””â”€ sdf-brush-shader.js::createMaterial()
          â”‚       â””â”€ Fragment Shader: SDFå††æç”» + ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚¹
          â”‚
          â””â”€ [ERASER MODE] âŒğŸ”§
              â””â”€ å®Ÿè£…ä¸å®Œå…¨ / ãƒã‚¹ã‚¯æ–¹å¼ãŒæ©Ÿèƒ½ã—ã¦ã„ãªã„

ğŸ“ webgpu-drawing-layer.js
  â””â”€ PixiJS Containerç®¡ç†
      â””â”€ layer.addChild(sdfMesh) âœ…


â–  3. WebGPU Compute Pipeline (Distance Fieldç”Ÿæˆ)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ webgpu-compute-sdf.js
  â””â”€ computeSDF(points) â†’ GPUãƒãƒƒãƒ•ã‚¡
      â””â”€ shaders/sdf-compute.wgsl
          â””â”€ @compute ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—å‡¦ç† âœ…

ğŸ“ webgpu-compute-msdf.js
  â””â”€ computeMSDF(points) â†’ Multi-channel SDF
      â””â”€ shaders/msdf-compute.wgsl âœ…

ğŸ“ webgpu-texture-bridge.js
  â””â”€ SDF â†’ PixiJS Texture å¤‰æ› âœ…


â–  4. æ¶ˆã—ã‚´ãƒ å®Ÿè£…ã®ç¾çŠ¶ã¨å•é¡Œç‚¹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” å•é¡Œã®æ‰€åœ¨
  â”œâ”€ sdf-brush-shader.js
  â”‚   â””â”€ Fragment Shader
  â”‚       â”œâ”€ PEN: gl_FragColor = vec4(color.rgb, alpha * sdfValue) âœ…
  â”‚       â””â”€ ERASER: âŒ ãƒã‚¹ã‚¯å¼å®Ÿè£…ãŒä¸æ˜
  â”‚
  â”œâ”€ stroke-renderer.js
  â”‚   â””â”€ mode === 'eraser' åˆ†å² ğŸ”§
  â”‚       â”œâ”€ BlendModeè¨­å®šãŒä¸é©åˆ‡ï¼Ÿ
  â”‚       â””â”€ ãƒã‚¹ã‚¯ç”¨ShaderãŒæœªä½œæˆï¼Ÿ
  â”‚
  â””â”€ PixiJS v8 äº’æ›æ€§å•é¡Œ âš ï¸
      â”œâ”€ Graphics.beginTextureFill() å»ƒæ­¢
      â”œâ”€ Mesh.shader ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹å¤‰æ›´
      â””â”€ RenderTexture â†’ RenderTarget ç§»è¡Œ

âŒ æœªå®Ÿè£…è¦ç´ 
  1. Eraserå°‚ç”¨Fragment Shader (ãƒã‚¹ã‚¯é©ç”¨)
  2. Destination Alphaæ“ä½œ (PixiJS v8å¯¾å¿œ)
  3. RenderTextureæ–¹å¼ã®æ¶ˆã—ã‚´ãƒ åˆæˆ


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ç¬¬2éƒ¨: æ”¹ä¿®æˆ¦ç•¥åˆ†æ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â–  æ–¹å¼A: Alpha Maskæ–¹å¼ (å¾“æ¥å‹ãƒ»ã‚·ãƒ³ãƒ—ãƒ«)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ¦‚è¦: Fragment Shaderã§destination alphaã‚’æ¸›ç®—

ãƒ¡ãƒªãƒƒãƒˆ:
  âœ… å®Ÿè£…ãŒå˜ç´”
  âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è‰¯å¥½
  âœ… PixiJS v8äº’æ›æ€§é«˜ã„

ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:
  âŒ ãƒãƒ†ãƒªã‚¢ãƒ«å±æ€§æ¶ˆã—ã‚´ãƒ ä¸å¯
  âŒ åŠé€æ˜ãƒšãƒ³æ¶ˆå»æ™‚ã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆ

å®Ÿè£…è¦ç´ :
  ğŸ“„ sdf-eraser-shader.js (æ–°è¦)
      â””â”€ Fragment: gl_FragColor.a = existingAlpha * (1.0 - sdfValue)
  ğŸ”§ stroke-renderer.js
      â””â”€ mode === 'eraser' â†’ createEraserMaterial()


â–  æ–¹å¼B: Material-Awareæ–¹å¼ (é«˜æ©Ÿèƒ½)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ¦‚è¦: ãƒãƒ†ãƒªã‚¢ãƒ«å±æ€§ã‚’ãƒãƒ£ãƒ³ãƒãƒ«åˆ†é›¢ç®¡ç†

ãƒ¡ãƒªãƒƒãƒˆ:
  âœ… color/roughness/metallic å€‹åˆ¥æ¶ˆå»å¯èƒ½
  âœ… ãƒ—ãƒ­å‘ã‘æ©Ÿèƒ½
  âœ… å°†æ¥ã®PBRæç”»å¯¾å¿œ

ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:
  âŒ å®Ÿè£…è¤‡é›‘åº¦é«˜ã„
  âŒ ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡å¢—åŠ 
  âŒ PixiJSæ¨™æº–æ©Ÿèƒ½å¤–

å®Ÿè£…è¦ç´ :
  ğŸ“„ material-buffer-system.js (æ–°è¦)
      â””â”€ R: color, G: roughness, B: metallic, A: alpha
  ğŸ“„ material-eraser-shader.js (æ–°è¦)
      â””â”€ uniform eraserMask { colorMask, roughMask, metalMask }
  ğŸ”§ webgpu-drawing-layer.js
      â””â”€ ãƒãƒ«ãƒã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¯¾å¿œ


â–  æ¨å¥¨æ–¹å¼: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰å®Ÿè£…
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Phase 1: Alpha Maskå®Ÿè£… (åŸºæœ¬æ¶ˆã—ã‚´ãƒ )
Phase 2: Material-Awareæ‹¡å¼µ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½)

ç†ç”±:
  - æ–¹å¼Aã§åŸºæœ¬æ©Ÿèƒ½ç¢ºä¿
  - æ–¹å¼Bã¯è¨­å®šUIã‹ã‚‰æœ‰åŠ¹åŒ–
  - æ®µéšçš„å®Ÿè£…ã§ãƒªã‚¹ã‚¯åˆ†æ•£


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ç¬¬3éƒ¨: æ®µéšçš„æ”¹ä¿®è¨ˆç”»æ›¸
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

================================================================================
Phase 0: äº‹å‰èª¿æŸ»ãƒ»æ¤œè¨¼ (æ‰€è¦æ™‚é–“: 30åˆ†)
================================================================================
ç›®çš„: PixiJS v8ã®BlendMode/Shaderä»•æ§˜ç¢ºèª

ã€èª¿æŸ»é …ç›®ã€‘
  1. PIXI.BlendModes.ERASE å‹•ä½œç¢ºèª
  2. RenderTexture â†’ RenderTarget ç§»è¡ŒçŠ¶æ³
  3. Filter vs Shader æ€§èƒ½æ¯”è¼ƒ

ã€å‚ç…§ãƒ•ã‚¡ã‚¤ãƒ«ã€‘
  ğŸ“„ webgpu-drawing-layer.js (PixiJSåˆæœŸåŒ–éƒ¨åˆ†)
  ğŸ“„ sdf-brush-shader.js (æ—¢å­˜Shaderæ§‹é€ )

ã€æ¤œè¨¼ã‚³ãƒ¼ãƒ‰ã€‘
  // PixiJS v8 BlendModeç¢ºèª
  const testMesh = new PIXI.Mesh(...);
  testMesh.blendMode = PIXI.BLEND_MODES.ERASE; // å‹•ä½œç¢ºèª
  
  // RenderTargetä½¿ç”¨ç¢ºèª
  const rt = PIXI.RenderTexture.create({width, height});
  renderer.render(container, {renderTexture: rt}); // v8æ§‹æ–‡ç¢ºèª

ã€æˆæœç‰©ã€‘
  æ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆ.txt (æ¬¡Phaseåˆ¤æ–­ææ–™)


================================================================================
Phase 1: Alpha Maskæ¶ˆã—ã‚´ãƒ å®Ÿè£… (æ‰€è¦æ™‚é–“: 2æ™‚é–“)
================================================================================
ç›®çš„: åŸºæœ¬æ¶ˆã—ã‚´ãƒ æ©Ÿèƒ½å®Œæˆ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1-1: Eraser Shaderä½œæˆ                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ã€æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã€‘
  ğŸ“„ system/drawing/sdf-eraser-shader.js

ã€å®Ÿè£…å†…å®¹ã€‘
  class SDFEraserShader {
    static vertex = `
      attribute vec2 aPosition;
      attribute vec2 aUV;
      uniform mat3 translationMatrix;
      uniform mat3 projectionMatrix;
      varying vec2 vUV;
      
      void main() {
        vUV = aUV;
        gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aPosition, 1.0)).xy, 0.0, 1.0);
      }
    `;
    
    static fragment = `
      precision highp float;
      varying vec2 vUV;
      uniform sampler2D uSDF;
      uniform float uRadius;
      uniform float uHardness;
      
      void main() {
        float dist = texture2D(uSDF, vUV).r;
        float sdf = 1.0 - smoothstep(uRadius * uHardness, uRadius, dist);
        
        // Destination Alphaæ¸›ç®—
        gl_FragColor = vec4(0.0, 0.0, 0.0, sdf);
      }
    `;
    
    static create(radius, hardness) {
      return PIXI.Shader.from(this.vertex, this.fragment, {
        uRadius: radius,
        uHardness: hardness
      });
    }
  }

ã€å‚ç…§ã€‘
  ğŸ“„ sdf-brush-shader.js (æ§‹é€ å‚è€ƒ)
  ğŸ“„ webgpu-compute-sdf.js (SDFç”Ÿæˆ)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1-2: stroke-renderer.js æ”¹ä¿®                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ã€æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«ã€‘
  ğŸ”§ system/drawing/stroke-renderer.js

ã€æ”¹ä¿®ç®‡æ‰€ã€‘
  renderStroke(strokeData) {
    const mode = strokeData.mode || 'pen'; // brush-settings.jsã‹ã‚‰å–å¾—
    
    if (mode === 'eraser') {
      return this._renderEraserStroke(strokeData);
    }
    return this._renderPenStroke(strokeData);
  }
  
  _renderEraserStroke(strokeData) {
    const interpolated = this.curveInterpolator.interpolate(strokeData.points);
    const geometry = this.sdfMeshBuilder.buildMesh(interpolated);
    
    // Eraser Shaderé©ç”¨
    const shader = SDFEraserShader.create(
      strokeData.size,
      strokeData.hardness || 0.8
    );
    
    const mesh = new PIXI.Mesh(geometry, shader);
    mesh.blendMode = PIXI.BLEND_MODES.ERASE; // PixiJS v8ç¢ºèªå¿…è¦
    
    this.currentLayer.addChild(mesh);
  }

ã€å‚ç…§ãƒ¡ã‚½ãƒƒãƒ‰ã€‘
  - curve-interpolator.js::interpolate()
  - sdf-mesh-builder.js::buildMesh()
  - brush-settings.js::getCurrentMode()


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1-3: drawing-engine.js ãƒ¢ãƒ¼ãƒ‰é€£æº                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ã€æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«ã€‘
  ğŸ”§ system/drawing/drawing-engine.js

ã€æ”¹ä¿®ç®‡æ‰€ã€‘
  onPointerDown(e) {
    // åº§æ¨™å¤‰æ›å‡¦ç† (æ—¢å­˜)
    const localCoords = this._transformToLocal(e);
    
    // ãƒ¢ãƒ¼ãƒ‰å–å¾—è¿½åŠ 
    const mode = window.brushSettings?.mode || 'pen';
    
    this.strokeRecorder.startStroke(
      localCoords.x,
      localCoords.y,
      e.pressure || 0.5,
      { mode } // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è¿½åŠ 
    );
  }

ã€å‚ç…§ã€‘
  ğŸ“„ brush-settings.js (ãƒ¢ãƒ¼ãƒ‰å–å¾—)
  ğŸ“„ pointer-handler.js (ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1-4: çµ±åˆãƒ†ã‚¹ãƒˆ                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ã€ãƒ†ã‚¹ãƒˆé …ç›®ã€‘
  1. ãƒšãƒ³æç”» â†’ æ¶ˆã—ã‚´ãƒ ã§æ¶ˆå» â†’ ã‚¢ãƒ«ãƒ•ã‚¡æ¸›å°‘ç¢ºèª
  2. åŠé€æ˜ãƒšãƒ³æ¶ˆå»æ™‚ã®ã‚¨ãƒƒã‚¸å“è³ª
  3. ã‚ºãƒ¼ãƒ /å›è»¢æ™‚ã®æ¶ˆã—ã‚´ãƒ å‹•ä½œ
  4. Undo/Redoå‹•ä½œç¢ºèª

ã€ç¢ºèªãƒ•ã‚¡ã‚¤ãƒ«ã€‘
  ğŸ“„ history.js (å±¥æ­´ç®¡ç†)
  ğŸ“„ camera-system.js (åº§æ¨™å¤‰æ›)


================================================================================
Phase 2: Material-Awareæ¶ˆã—ã‚´ãƒ æ‹¡å¼µ (æ‰€è¦æ™‚é–“: 4æ™‚é–“)
================================================================================
ç›®çš„: ãƒãƒ†ãƒªã‚¢ãƒ«å±æ€§å€‹åˆ¥æ¶ˆå»æ©Ÿèƒ½

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2-1: Material Buffer Systemæ§‹ç¯‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ã€æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã€‘
  ğŸ“„ system/drawing/material-buffer-system.js

ã€å®Ÿè£…å†…å®¹ã€‘
  class MaterialBufferSystem {
    constructor(width, height) {
      // RGBA = Color + Roughness + Metallic + Alpha
      this.materialTexture = PIXI.RenderTexture.create({
        width, height,
        format: PIXI.FORMATS.RGBA,
        type: PIXI.TYPES.UNSIGNED_BYTE
      });
    }
    
    writeStroke(strokeMesh, materialProps) {
      // color: materialProps.color
      // roughness: materialProps.roughness (0-1)
      // metallic: materialProps.metallic (0-1)
      // alpha: stroke alpha
    }
    
    eraseMaterial(eraserMesh, maskSettings) {
      // colorMask, roughMask, metalMask é©ç”¨
    }
  }

ã€å‚ç…§ã€‘
  ğŸ“„ webgpu-texture-bridge.js (ãƒ†ã‚¯ã‚¹ãƒãƒ£ç®¡ç†)
  ğŸ“„ sdf-brush-shader.js (æ—¢å­˜æç”»)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2-2: Material Eraser Shaderä½œæˆ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ã€æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã€‘
  ğŸ“„ system/drawing/material-eraser-shader.js

ã€Fragment Shaderã€‘
  precision highp float;
  varying vec2 vUV;
  uniform sampler2D uMaterialBuffer;
  uniform sampler2D uSDF;
  uniform vec3 uEraserMask; // (colorMask, roughMask, metalMask)
  
  void main() {
    vec4 material = texture2D(uMaterialBuffer, vUV);
    float sdf = texture2D(uSDF, vUV).r;
    float eraseFactor = smoothstep(0.4, 0.6, sdf);
    
    // ãƒãƒ£ãƒ³ãƒãƒ«åˆ¥ãƒã‚¹ã‚¯é©ç”¨
    material.r *= (1.0 - eraseFactor * uEraserMask.x); // Color
    material.g *= (1.0 - eraseFactor * uEraserMask.y); // Roughness
    material.b *= (1.0 - eraseFactor * uEraserMask.z); // Metallic
    material.a *= (1.0 - eraseFactor); // Alphaå¸¸æ™‚
    
    gl_FragColor = material;
  }


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2-3: UIè¨­å®šè¿½åŠ                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ã€æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«ã€‘
  ğŸ”§ ui/settings-popup.js
  ğŸ”§ system/brush-settings.js

ã€è¿½åŠ UIã€‘
  <div class="eraser-mode-select">
    <label>æ¶ˆã—ã‚´ãƒ ãƒ¢ãƒ¼ãƒ‰:</label>
    <select id="eraserMode">
      <option value="alpha">é€šå¸¸ (Alpha)</option>
      <option value="material">ãƒãƒ†ãƒªã‚¢ãƒ«å±æ€§</option>
    </select>
  </div>
  
  <div id="materialMaskSettings" style="display:none;">
    <label>è‰²æ¶ˆå»: <input type="range" id="colorMask" min="0" max="1" step="0.1"></label>
    <label>ç²—ã•æ¶ˆå»: <input type="range" id="roughMask" min="0" max="1" step="0.1"></label>
    <label>é‡‘å±æ¶ˆå»: <input type="range" id="metalMask" min="0" max="1" step="0.1"></label>
  </div>

ã€EventBusé€£æºã€‘
  EventBus.on('settings:eraserModeChanged', (mode) => {
    if (mode === 'material') {
      materialBufferSystem.enable();
    }
  });


================================================================================
Phase 3: æœ€é©åŒ–ãƒ»ä»•ä¸Šã’ (æ‰€è¦æ™‚é–“: 2æ™‚é–“)
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3-1: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ã€æœ€é©åŒ–é …ç›®ã€‘
  1. SDF Computeå›æ•°å‰Šæ¸› (ã‚­ãƒ£ãƒƒã‚·ãƒ¥å®Ÿè£…)
  2. Meshçµ±åˆ (ãƒãƒƒãƒæç”»)
  3. RenderTextureå†åˆ©ç”¨

ã€æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«ã€‘
  ğŸ”§ webgpu-compute-sdf.js (ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¿½åŠ )
  ğŸ”§ stroke-renderer.js (ãƒãƒƒãƒãƒ³ã‚°)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3-2: ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹å¯¾å¿œ                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ã€å¯¾å¿œé …ç›®ã€‘
  1. è¶…é«˜é€Ÿã‚¹ãƒˆãƒ­ãƒ¼ã‚¯æ™‚ã®æ¶ˆã—ã‚´ãƒ æŠœã‘é˜²æ­¢
  2. ãƒ¬ã‚¤ãƒ¤ãƒ¼çµåˆæ™‚ã®ãƒãƒ†ãƒªã‚¢ãƒ«ä¿æŒ
  3. ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ™‚ã®ã‚¢ãƒ«ãƒ•ã‚¡ãƒ—ãƒªãƒãƒ«ãƒãƒ—ãƒ©ã‚¤å‡¦ç†

ã€å‚ç…§ãƒ•ã‚¡ã‚¤ãƒ«ã€‘
  ğŸ“„ curve-interpolator.js (è£œé–“å¯†åº¦èª¿æ•´)
  ğŸ“„ layer-system.js (ãƒ¬ã‚¤ãƒ¤ãƒ¼çµåˆ)
  ğŸ“„ png-exporter.js (ã‚¢ãƒ«ãƒ•ã‚¡å‡¦ç†)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3-3: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ã€æ›´æ–°å¯¾è±¡ã€‘
  config.js (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šè¿½åŠ )
  README.md (æ¶ˆã—ã‚´ãƒ æ©Ÿèƒ½èª¬æ˜)
  ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ (å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³è¿½è¨˜)


================================================================================
Phase 4: WebGPUå®Œå…¨ç§»è¡Œ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ»æ‰€è¦æ™‚é–“: 6æ™‚é–“)
================================================================================
â€» ç¾çŠ¶ã¯PixiJS Shaderä½¿ç”¨ã€WebGPU Computeã¯è·é›¢å ´ç”Ÿæˆã®ã¿

ã€ç§»è¡Œå†…å®¹ã€‘
  1. Fragment Shader â†’ WebGPU Render Pipelineç§»è¡Œ
  2. PixiJS Mesh â†’ WebGPU Vertex Bufferç›´æ¥åˆ¶å¾¡
  3. Material Buffer â†’ WebGPU Storage BufferåŒ–

ã€æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã€‘
  ğŸ“„ system/drawing/webgpu/webgpu-eraser-pipeline.js
  ğŸ“„ system/drawing/webgpu/shaders/eraser-render.wgsl

ã€å‚ç…§ã€‘
  ğŸ“„ webgpu-drawing-layer.js (æ—¢å­˜WebGPUçµ±åˆ)
  ğŸ“„ webgpu-capabilities.js (æ©Ÿèƒ½æ¤œå‡º)


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ä»˜éŒ²: ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â–  å•é¡Œ: æ¶ˆã—ã‚´ãƒ ãŒæ©Ÿèƒ½ã—ãªã„
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ç¢ºèªé …ç›®:
  1. PIXI.BLEND_MODES.ERASE ãŒ undefined
     â†’ PixiJS v8ã§BlendModeå®šç¾©ç¢ºèª
     â†’ æ‰‹å‹•ã§gl.blendFuncè¨­å®š
  
  2. RenderTexture ãŒ null
     â†’ RenderTarget ã¸ã®ç§»è¡Œç¢ºèª
     â†’ webgpu-drawing-layer.js ã®åˆæœŸåŒ–ç¢ºèª
  
  3. Shader ãŒ compile error
     â†’ ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ç¢ºèª
     â†’ precision highp float; å®£è¨€ç¢ºèª


â–  å•é¡Œ: åŠé€æ˜ãƒšãƒ³ã®æ¶ˆå»ãŒãŠã‹ã—ã„
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
åŸå› : Premultiplied Alphaå•é¡Œ
å¯¾ç­–:
  Fragment Shaderå†…ã§éãƒ—ãƒªãƒãƒ«ãƒãƒ—ãƒ©ã‚¤åŒ–:
  
  vec4 color = texture2D(uTexture, vUV);
  if (color.a > 0.0) {
    color.rgb /= color.a; // Unpremultiply
  }
  color.a *= eraseFactor;
  gl_FragColor = vec4(color.rgb * color.a, color.a); // Premultiply


â–  å•é¡Œ: ã‚ºãƒ¼ãƒ æ™‚ã«æ¶ˆã—ã‚´ãƒ ã‚µã‚¤ã‚ºãŒå¤‰ã‚ã‚‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
åŸå› : Worldåº§æ¨™ã§ã‚µã‚¤ã‚ºè¨ˆç®—ã—ã¦ã„ã‚‹
å¯¾ç­–:
  drawing-engine.js ã§ Localåº§æ¨™å¤‰æ›å¾Œã«ã‚µã‚¤ã‚ºè£œæ­£:
  
  const scale = this.cameraSystem.getZoom();
  const adjustedSize = strokeSize / scale;


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ”¹ä¿®å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Phase 1:
  [ ] sdf-eraser-shader.js ä½œæˆå®Œäº†
  [ ] stroke-renderer.js ã«eraserStrokeåˆ†å²è¿½åŠ 
  [ ] drawing-engine.js ã«modeé€£æºè¿½åŠ 
  [ ] åŸºæœ¬æ¶ˆã—ã‚´ãƒ å‹•ä½œç¢ºèª
  [ ] Undo/Redoå‹•ä½œç¢ºèª

Phase 2:
  [ ] material-buffer-system.js ä½œæˆå®Œäº†
  [ ] material-eraser-shader.js ä½œæˆå®Œäº†
  [ ] settings-popup.js ã«UIè¿½åŠ 
  [ ] ãƒãƒ†ãƒªã‚¢ãƒ«å±æ€§æ¶ˆå»å‹•ä½œç¢ºèª

Phase 3:
  [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹60fpsç¶­æŒç¢ºèª
  [ ] ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹å…¨ãƒ†ã‚¹ãƒˆé€šé
  [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°å®Œäº†

Phase 4 (ã‚ªãƒ—ã‚·ãƒ§ãƒ³):
  [ ] WebGPU Pipelineç§»è¡Œå®Œäº†
  [ ] ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œç¢ºèª


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ¨å¥¨å®Ÿè£…é †åº: Phase 1 â†’ Phase 3 â†’ Phase 2 â†’ Phase 4
ç†ç”±: åŸºæœ¬æ©Ÿèƒ½ç¢ºä¿å¾Œã«é«˜æ©Ÿèƒ½æ‹¡å¼µã€WebGPUç§»è¡Œã¯æœ€å¾Œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”