 âœ… config.js (Phase 1: ãƒšãƒ³é«˜ç²¾åº¦åŒ–è¨­å®šè¿½åŠ ç‰ˆ) loaded
    ğŸ†• Phase 1: ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šè¿½åŠ 
    ğŸ†• Phase 1: devicePixelRatioå¯¾å¿œè¨­å®šè¿½åŠ 
batch-api.js:382 âœ… batch-api.js (Phase 6: Historyçµ±åˆç‰ˆ) loaded
event-bus.js:143 âœ… system/event-bus.js Phase 2: å„ªå…ˆåº¦æ©Ÿèƒ½è¿½åŠ ç‰ˆ loaded
popup-manager.js:357 âœ… popup-manager.js (quick-accessé™¤å¤–å¯¾å¿œç‰ˆ) loaded
drawing-clipboard.js:603 âœ… drawing-clipboard.js Phase4æ”¹ä¿®ç‰ˆ+ç¢ºå®šã‚¤ãƒ™ãƒ³ãƒˆ loaded
drawing-clipboard.js:604    - âœ… CTRL+V behavior: overwrite active layer
drawing-clipboard.js:605    - âœ… Commit events: paste:commit, operation:commit
drawing-clipboard.js:606    - âœ… Thumbnail auto-update on paste
history.js:185 âœ… history.js (Phase 1: asyncå¯¾å¿œå®Œäº†ç‰ˆ) loaded
animation-system.js:1428 âœ… animation-system.js (Phase 4.1: CUTè‡ªå‹•æ¡ç•ªå¯¾å¿œç‰ˆ) loaded
brush-settings.js:183 âœ… brush-settings.js (APIçµ±ä¸€ç‰ˆ) loaded
brush-settings.js:184    - âœ… getOpacity() / setOpacity() è¿½åŠ 
brush-settings.js:185    - âœ… brush:opacity-changed ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­è¿½åŠ 
export-manager.js:259 âœ… export-manager.js loaded
png-exporter.js:85 âœ… png-exporter.js (å˜ä¸€ãƒ•ãƒ¬ãƒ¼ãƒ å°‚ç”¨ãƒ»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾å¿œ) loaded
apng-exporter.js:236 âœ… apng-exporter.js (PixiJS v8.13å®Œå…¨å¯¾å¿œç‰ˆ) loaded
gif-exporter.js:300 âœ… gif-exporter.js (PixiJS v8.13å®Œå…¨å¯¾å¿œç‰ˆ) loaded
dom-builder.js:494 âœ… dom-builder.js (IDé‡è¤‡è§£æ¶ˆç‰ˆ) loaded
dom-builder.js:495    - #pen-settings â†’ #legacy-pen-settings ã«å¤‰æ›´
dom-builder.js:496    - pen-size-slider â†’ legacy-pen-size-slider ã«å¤‰æ›´
dom-builder.js:497    - quick-access-popup.jsã¨ã®IDç«¶åˆã‚’å®Œå…¨è§£æ¶ˆ
slider-utils.js:197 âœ… ui/slider-utils.js loaded
slider-utils.js:198    - è²¬å‹™: ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼UIã®çµ±ä¸€å®Ÿè£…
slider-utils.js:199    - DRYåŸå‰‡: settings-popup.js ã¨ ui-panels.js ã§å…±æœ‰
slider-utils.js:200    - API: createSlider() / createSimpleSlider()
resize-popup.js:531 âœ… resize-popup.js (ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼å‚ç…§ä¿®æ­£ç‰ˆ) loaded
timeline-ui.js:969 âœ… timeline-ui.js (Frameè¡¨è¨˜ãƒ»UIæ”¹å–„ç‰ˆ) loaded
album-popup.js:477 âœ… album-popup.js (PopupManagerå¯¾å¿œç‰ˆ + displayä¿®æ­£) loaded
settings-popup.js:583 âœ… settings-popup.js (å³å¿œæ€§å®Œå…¨ä¿®æ­£ç‰ˆ) loaded
settings-popup.js:584    - CSS transitionå®Œå…¨é™¤å»ï¼ˆ!importantä»˜ãï¼‰
settings-popup.js:585    - DOMæ›´æ–°ã‚’åŒæœŸçš„ã«å³åº§å®Ÿè¡Œ
settings-popup.js:586    - quick-access/resize-popupã¨å®Œå…¨åŒç­‰ã®å‹•ä½œ
quick-access-popup.js:538 âœ… quick-access-popup.js (èƒŒæ™¯ãƒ‰ãƒ©ãƒƒã‚° + é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ç‰ˆ) loaded
quick-access-popup.js:539    - èƒŒæ™¯ãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹•å¯èƒ½ï¼ˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼/ãƒœã‚¿ãƒ³ä»¥å¤–ï¼‰
quick-access-popup.js:540    - å³ä¸ŠÃ—ãƒœã‚¿ãƒ³ã§é–‰ã˜ã‚‹
quick-access-popup.js:541    - ç”»é¢å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ãªã„ï¼ˆå¸¸æ™‚é–‹ãã£ã±ãªã—å¯èƒ½ï¼‰
export-popup.js:429 âœ… export-popup.js (PopupManagerå¯¾å¿œç‰ˆ) loaded
ui-panels.js:396 âœ… ui-panels.js (å®Œå…¨æ”¹ä¿®ç‰ˆ) loaded
core-runtime.js:841 âœ… core-runtime.js (ãƒ„ãƒ¼ãƒ«åˆ‡ã‚Šæ›¿ãˆå¼·åŒ–ç‰ˆ) loaded
core-initializer.js:307 âœ… core-initializer.js (Phase 1ä¿®æ­£ç‰ˆ) loaded
drawing-clipboard.js:19 DrawingClipboard: Initializing...
drawing-clipboard.js:26 âœ… DrawingClipboard initialized (Phase4æ”¹ä¿®ç‰ˆ + ç¢ºå®šã‚¤ãƒ™ãƒ³ãƒˆ)
core-initializer.js:148 âœ… window.BrushSettings å…¬é–‹å®Œäº†
core-initializer.js:151 âœ… ã‚°ãƒ­ãƒ¼ãƒãƒ«å‚ç…§ç¢ºèª:
core-initializer.js:152    window.drawingEngine: true
core-initializer.js:153    window.layerManager: true
core-initializer.js:154    window.cameraSystem: true
popup-manager.js:16 âœ… PopupManager initialized
popup-manager.js:42 ğŸ“‹ Popup "settings" registered (priority: 1)
popup-manager.js:42 ğŸ“‹ Popup "quickAccess" registered (priority: 2)
popup-manager.js:42 ğŸ“‹ Popup "album" registered (priority: 3)
popup-manager.js:42 ğŸ“‹ Popup "resize" registered (priority: 4)
popup-manager.js:42 ğŸ“‹ Popup "export" registered (priority: 5)
popup-manager.js:102 ğŸ”§ Initializing all popups...
popup-manager.js:87 âœ… Popup "settings" initialized successfully
popup-manager.js:87 âœ… Popup "quickAccess" initialized successfully
popup-manager.js:87 âœ… Popup "album" initialized successfully
popup-manager.js:87 âœ… Popup "resize" initialized successfully
popup-manager.js:66 â³ Popup "export" waiting for: TEGAKI_EXPORT_MANAGER
popup-manager.js:118 ğŸ“Š Popup initialization: 4 ready, 1 deferred
popup-manager.js:87 âœ… Popup "export" initialized successfully
popup-manager.js:153 âœ… All deferred popups initialized
// Phase2æ©Ÿèƒ½ç¢ºèª
const de = window.drawingEngine || window.coreEngine?.drawingEngine;
const ls = window.layerSystem || window.coreEngine?.layerSystem;
undefined
// 1. æ¶ˆã—ã‚´ãƒ ãƒ„ãƒ¼ãƒ«é¸æŠ
window.TegakiEventBus?.emit('tool:select', { tool: 'eraser' });
console.log('Current Tool:', de?.currentTool); // 'eraser'
VM389:3 Current Tool: eraser
undefined
// 2. GPU BlendModeç¢ºèª
console.log('Eraser Renderer:', de?.eraserRenderer);
console.log('BLEND_MODES.ERASE:', PIXI.BLEND_MODES.ERASE); // 26
VM393:2 Eraser Renderer: EraserMaskRendererÂ {app: ju, renderer: kv}
VM393:3 Uncaught TypeError: Cannot read properties of undefined (reading 'ERASE')
    at <anonymous>:3:52
(anonymous) @ VM393:3
// 3. ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ç¢ºèª
console.log('Snapshot Cache:', de?.eraserSnapshotCache);
console.log('Cache Size:', de?.eraserSnapshotCache.size);
VM397:2 Snapshot Cache: Map(0)Â {size: 0}
VM397:3 Cache Size: 0
undefined
// 4. ãƒã‚¹ã‚¯çŠ¶æ…‹ç¢ºèª
ls?.getLayers().forEach((layer, i) => {
    console.log(`Layer ${i}:`, {
        hasMask: layer.layerData?.hasMask(),
        maskTexture: !!layer.layerData?.maskTexture,
        maskSprite: !!layer.layerData?.maskSprite,
        textureSize: layer.layerData?.maskTexture ? 
            `${layer.layerData.maskTexture.width}x${layer.layerData.maskTexture.height}` : 'N/A'
    });
});
VM401:4 Uncaught TypeError: layer.layerData?.hasMask is not a function
    at <anonymous>:4:35
    at Array.forEach (<anonymous>)
    at <anonymous>:2:17
(anonymous) @ VM401:4
(anonymous) @ VM401:2
// 5. GPUæœ€é©åŒ–ãƒ†ã‚¹ãƒˆ
const testErase = () => {
    const layer = ls.getActiveLayer();
    if (!layer?.layerData?.hasMask()) {
        console.log('âŒ No mask on active layer');
        return;
    }
    
    const testPoints = [
        {x: 100, y: 100},
        {x: 110, y: 110},
        {x: 120, y: 120}
    ];
    
    console.time('GPU Erase');
    const ok = de.eraserRenderer.renderEraserToMask(
        layer.layerData, 
        testPoints, 
        25
    );
    console.timeEnd('GPU Erase');
    console.log('Erase Result:', ok);
};
testErase();
VM405:4 Uncaught TypeError: layer?.layerData?.hasMask is not a function
    at testErase (<anonymous>:4:28)
    at <anonymous>:24:1
testErase @ VM405:4
(anonymous) @ VM405:24
// 6. ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆé€Ÿåº¦ãƒ†ã‚¹ãƒˆ
const testSnapshot = () => {
    const layer = ls.getActiveLayer();
    if (!layer?.layerData?.hasMask()) {
        console.log('âŒ No mask on active layer');
        return;
    }
    
    console.time('GPU Snapshot');
    const snapshot = de.eraserRenderer.captureMaskSnapshot(layer.layerData);
    console.timeEnd('GPU Snapshot');
    console.log('Snapshot:', snapshot);
    
    // å¾©å…ƒãƒ†ã‚¹ãƒˆ
    console.time('GPU Restore');
    de.eraserRenderer.restoreMaskSnapshot(layer.layerData, snapshot).then(ok => {
        console.timeEnd('GPU Restore');
        console.log('Restore Result:', ok);
        
        // å¾Œå§‹æœ«
        de.eraserRenderer.destroySnapshot(snapshot);
    });
};
testSnapshot();
VM409:4 Uncaught TypeError: layer?.layerData?.hasMask is not a function
    at testSnapshot (<anonymous>:4:28)
    at <anonymous>:24:1
testSnapshot @ VM409:4
(anonymous) @ VM409:24
// 7. Undo/Redoé€Ÿåº¦ãƒ†ã‚¹ãƒˆ
const testUndoRedo = async () => {
    console.time('Undo Performance');
    await window.History.undo();
    console.timeEnd('Undo Performance');
    
    console.time('Redo Performance');
    await window.History.redo();
    console.timeEnd('Redo Performance');
};
undefined
// 8. ãƒ¡ãƒ¢ãƒªä½¿ç”¨çŠ¶æ³
const checkMemory = () => {
    if (performance.memory) {
        const used = (performance.memory.usedJSHeapSize / 1048576).toFixed(2);
        const total = (performance.memory.totalJSHeapSize / 1048576).toFixed(2);
        console.log(`Memory: ${used}MB / ${total}MB`);
    }
    
    console.log('Snapshot Cache Entries:', 
        Array.from(de.eraserSnapshotCache.entries()).map(([id, cache]) => ({
            layerId: id,
            count: cache.length
        }))
    );
};
checkMemory();
VM417:6 Memory: 13.64MB / 14.50MB
VM417:9 Snapshot Cache Entries: []
undefined
// 9. FPSç›£è¦–ï¼ˆ60fpsç¶­æŒç¢ºèªï¼‰
let frameCount = 0;
let lastTime = performance.now();
const checkFPS = () => {
    frameCount++;
    const currentTime = performance.now();
    if (currentTime - lastTime >= 1000) {
        console.log(`FPS: ${frameCount}`);
        frameCount = 0;
        lastTime = currentTime;
    }
    requestAnimationFrame(checkFPS);
};
checkFPS();
undefined
VM421:8 FPS: 62
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
// 10. Phase2å®Œå…¨å‹•ä½œãƒ†ã‚¹ãƒˆ
const fullTest = async () => {
    console.log('=== Phase 2 å®Œå…¨å‹•ä½œãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
    
    // ãƒ„ãƒ¼ãƒ«åˆ‡æ›¿
    window.TegakiEventBus?.emit('tool:select', { tool: 'eraser' });
    await new Promise(r => setTimeout(r, 100));
    
    // æç”»â†’æ¶ˆå»â†’Undoâ†’Redo
    const layer = ls.getActiveLayer();
    if (!layer) {
        console.log('âŒ No active layer');
        return;
    }
    
    console.log('âœ… Active layer:', layer.layerData?.name);
    console.log('âœ… Has mask:', layer.layerData?.hasMask());
    console.log('âœ… Eraser renderer ready:', !!de.eraserRenderer);
    
    // æ¶ˆã—ã‚´ãƒ ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯
    const points = [];
    for (let i = 0; i < 20; i++) {
        points.push({x: 100 + i * 5, y: 100 + Math.sin(i) * 20});
    }
    
    console.time('Full Erase Stroke');
    const snapshot1 = de.eraserRenderer.captureMaskSnapshot(layer.layerData);
    de.eraserRenderer.renderEraserToMask(layer.layerData, points, 15);
    const snapshot2 = de.eraserRenderer.captureMaskSnapshot(layer.layerData);
    console.timeEnd('Full Erase Stroke');
    
    // Undo/Redoãƒ†ã‚¹ãƒˆ
    console.time('Undo');
    await de.eraserRenderer.restoreMaskSnapshot(layer.layerData, snapshot1);
    console.timeEnd('Undo');
    
    console.time('Redo');
    await de.eraserRenderer.restoreMaskSnapshot(layer.layerData, snapshot2);
    console.timeEnd('Redo');
    
    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    de.eraserRenderer.destroySnapshot(snapshot1);
    de.eraserRenderer.destroySnapshot(snapshot2);
    
    console.log('=== Phase 2 å®Œå…¨å‹•ä½œãƒ†ã‚¹ãƒˆå®Œäº† ===');
};
fullTest();
VM425:3 === Phase 2 å®Œå…¨å‹•ä½œãƒ†ã‚¹ãƒˆé–‹å§‹ ===
PromiseÂ {<pending>}
VM425:16 âœ… Active layer: ãƒ¬ã‚¤ãƒ¤ãƒ¼1
VM425:17 Uncaught (in promise) TypeError: layer.layerData?.hasMask is not a function
    at fullTest (<anonymous>:17:49)
fullTest @ VM425:17
await in fullTest
(anonymous) @ VM425:47
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
VM421:8 FPS: 60
// 11. BlendModeç¢ºèª
console.log('Available Blend Modes:', Object.keys(PIXI.BLEND_MODES)
    .filter(k => isNaN(k))
    .map(k => `${k}: ${PIXI.BLEND_MODES[k]}`));
VM429:2 Uncaught TypeError: Cannot convert undefined or null to object
    at Object.keys (<anonymous>)
    at <anonymous>:2:46
(anonymous) @ VM429:2
// 12. Phase2æ€§èƒ½ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
const benchmark = async () => {
    console.log('=== Phase 2 æ€§èƒ½ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ ===');
    const layer = ls.getActiveLayer();
    if (!layer?.layerData?.hasMask()) return;
    
    const testSizes = [10, 50, 100, 200];
    
    for (const pointCount of testSizes) {
        const points = Array.from({length: pointCount}, (_, i) => ({
            x: 100 + i * 2,
            y: 100 + Math.sin(i * 0.1) * 50
        }));
        
        console.time(`Erase ${pointCount} points`);
        de.eraserRenderer.renderEraserToMask(layer.layerData, points, 20);
        console.timeEnd(`Erase ${pointCount} points`);
    }
    
    console.log('=== ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Œäº† ===');
};
benchmark();
VM433:3 === Phase 2 æ€§èƒ½ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ ===
PromiseÂ {<rejected>: TypeError: layer?.layerData?.hasMask is not a function
    at benchmark (<anonymous>:5:28)
    at <â€¦}
VM433:5 Uncaught (in promise) TypeError: layer?.layerData?.hasMask is not a function
    at benchmark (<anonymous>:5:28)
    at <anonymous>:22:1
benchmark @ VM433:5
(anonymous) @ VM433:22



---
â€»ãƒªãƒ‰ã‚¥ã‚’ã™ã‚‹ã¨ä¸‹è¨˜ã‚¨ãƒ©ãƒ¼
---
GraphicsContextSystem.ts:164 Uncaught TypeError: Cannot read properties of null (reading 'uid')

