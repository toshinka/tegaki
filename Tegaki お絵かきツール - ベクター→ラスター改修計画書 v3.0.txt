================================================================================
Tegaki ãŠçµµã‹ããƒ„ãƒ¼ãƒ« - ãƒ™ã‚¯ã‚¿ãƒ¼â†’ãƒ©ã‚¹ã‚¿ãƒ¼æ”¹ä¿®è¨ˆç”»æ›¸ v3.0
================================================================================

ä½œæˆæ—¥: 2024-12-04
å¯¾è±¡: webgl2_rev30 å…¨ãƒ•ã‚¡ã‚¤ãƒ«
ç›®çš„: ãƒ™ã‚¯ã‚¿ãƒ¼æ–¹å¼ã‹ã‚‰ãƒ©ã‚¹ã‚¿ãƒ¼æ–¹å¼ã¸ã®å®Œå…¨ç§»è¡Œ

================================================================================
ç¬¬1ç« : ç¾çŠ¶åˆ†æ - ãƒ•ã‚¡ã‚¤ãƒ«è¾å…¸
================================================================================

ã€å‡¡ä¾‹ã€‘
âœ… = æ­£å¸¸å‹•ä½œãƒ»ä¿æŒ
ğŸ”§ = æ”¹ä¿®å¿…è¦
âŒ = å‰Šé™¤å¯¾è±¡
âš ï¸ = è¦èª¿æŸ»ãƒ»å®Ÿè£…ä¸å®Œå…¨
ğŸ“ = è¦ªãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä»–ã«ä¾å­˜ã•ã‚Œã‚‹ï¼‰
ğŸ“„ = å­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä»–ã«ä¾å­˜ã™ã‚‹ï¼‰
ğŸ”€ = ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼é–¢é€£

------------------------------------------------------------------------
1.1 ã‚³ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆåˆæœŸåŒ–ãƒ»è¨­å®šï¼‰
------------------------------------------------------------------------

ğŸ“ config.js
  âœ… ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šãƒ»ã‚­ãƒ¼ãƒãƒƒãƒ—å®šç¾©
  âœ… TEGAKI_CONFIG, TEGAKI_KEYMAP ã‚’æä¾›
  âœ… ãƒ–ãƒ©ã‚·è¨­å®šï¼ˆpen, eraser, fill, flowç­‰ï¼‰
  ğŸ”§ ãƒ©ã‚¹ã‚¿ãƒ¼ç”¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ å¿…è¦
     - brush.raster.stamp è¨­å®š
     - brush.raster.interpolation è¨­å®š
  ä¾å­˜: ãªã—
  è¢«ä¾å­˜: å…¨ãƒ•ã‚¡ã‚¤ãƒ«

ğŸ“ coordinate-system.js
  âœ… åº§æ¨™å¤‰æ›ã‚·ã‚¹ãƒ†ãƒ çµ±ä¸€ç®¡ç†
  âœ… Screenâ†’Canvasâ†’Worldâ†’Localå¤‰æ›
  âœ… worldToLocal() æ‰‹å‹•é€†ç®—å®Ÿè£…
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰
  ãƒ¡ã‚½ãƒƒãƒ‰:
    - screenClientToCanvas(clientX, clientY)
    - canvasToWorld(canvasX, canvasY)
    - worldToLocal(worldX, worldY, container)
    - screenClientToWorld(), screenClientToLocal()
  ä¾å­˜: config.js, event-bus.js, camera-system.js
  è¢«ä¾å­˜: drawing-engine.js, stroke-recorder.js

ğŸ“„ core-initializer.js
  âœ… ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼
  ğŸ”§ WebGL2åˆæœŸåŒ–éƒ¨åˆ†ã‚’ãƒ©ã‚¹ã‚¿ãƒ¼ç”¨ã«æ”¹ä¿®
  ä¾å­˜: å…¨ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«
  è¢«ä¾å­˜: index.html (DOMContentLoaded)

ğŸ“„ core-engine.js
  âœ… ã‚¨ãƒ³ã‚¸ãƒ³çµ±åˆç®¡ç†
  ğŸ”§ BrushCoreåˆæœŸåŒ–ã‚’ãƒ©ã‚¹ã‚¿ãƒ¼ç”¨ã«
  ä¾å­˜: layerManager, cameraSystem, history

ğŸ“„ core-runtime.js
  âœ… APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæä¾›
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰

------------------------------------------------------------------------
1.2 ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ 
------------------------------------------------------------------------

ğŸ“ system/event-bus.js
  âœ… ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰
  ã‚¤ãƒ™ãƒ³ãƒˆä¾‹:
    ğŸ”€ 'canvas:pointerdown', 'drawing:stroke-started'
    ğŸ”€ 'layer:path-added', 'thumbnail:layer-updated'
  ä¾å­˜: ãªã—
  è¢«ä¾å­˜: å…¨ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«

------------------------------------------------------------------------
1.3 ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ãƒ»ç®¡ç†
------------------------------------------------------------------------

ğŸ“ system/data-models.js
  âœ… ãƒ‡ãƒ¼ã‚¿æ§‹é€ å®šç¾©
  ğŸ”§ ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ãƒ‡ãƒ¼ã‚¿æ§‹é€ è¿½åŠ 
  ä¾å­˜: ãªã—

ğŸ“ system/batch-api.js
  âœ… ãƒãƒƒãƒå‡¦ç†API
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰

ğŸ“ system/state-manager.js
  âœ… ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç†
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰

ğŸ“ system/settings-manager.js
  âœ… è¨­å®šç®¡ç†
  ğŸ”§ ãƒ©ã‚¹ã‚¿ãƒ¼è¨­å®šé …ç›®è¿½åŠ 

ğŸ“ system/layer-system.js
  âœ… ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†
  ğŸ”§ ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’èª¿æ•´
     - pathsData â†’ rasterStrokes
  ä¾å­˜: event-bus, data-models
  è¢«ä¾å­˜: drawing-engine, brush-core

ğŸ“ system/history.js
  âœ… Undo/Redoç®¡ç†
  âœ… ä¿æŒï¼ˆè»½å¾®ãªèª¿æ•´ã®ã¿ï¼‰
  ä¾å­˜: event-bus

ğŸ“ system/camera-system.js
  âœ… ã‚«ãƒ¡ãƒ©ãƒ»ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆç®¡ç†
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰

ğŸ“ system/virtual-album.js
  âœ… ã‚¢ãƒ«ãƒãƒ æ©Ÿèƒ½
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰

ğŸ“ system/animation-system.js
  âœ… ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰

------------------------------------------------------------------------
1.4 æç”»ã‚·ã‚¹ãƒ†ãƒ  - åŸºç›¤ï¼ˆä¿æŒï¼‰
------------------------------------------------------------------------

ğŸ“ system/drawing/pointer-handler.js
  âœ… PointerEventçµ±ä¸€å‡¦ç†
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰
  ãƒ¡ã‚½ãƒƒãƒ‰:
    - attach(canvas, callbacks, options)
  ä¾å­˜: ãªã—
  è¢«ä¾å­˜: drawing-engine.js

ğŸ“ system/drawing/pressure-handler.js
  âœ… ç­†åœ§å‡¦ç†ãƒ»ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰
  ãƒ¡ã‚½ãƒƒãƒ‰:
    - process(pressure)
    - reset()
  ä¾å­˜: ãªã—
  è¢«ä¾å­˜: brush-core.js

ğŸ“ system/drawing/stroke-recorder.js
  âœ… Localåº§æ¨™ãƒã‚¤ãƒ³ãƒˆè¨˜éŒ²
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰
  ãƒ¡ã‚½ãƒƒãƒ‰:
    - startStroke(localX, localY, pressure, tiltX, tiltY, twist)
    - addPoint(localX, localY, pressure, tiltX, tiltY, twist)
    - endStroke()
    - getCurrentPoints()
  ä¾å­˜: ãªã—
  è¢«ä¾å­˜: brush-core.js

ğŸ“ system/drawing/brush-settings.js
  âœ… ãƒ–ãƒ©ã‚·è¨­å®šç®¡ç†
  âœ… ä¿æŒï¼ˆè»½å¾®ãªèª¿æ•´ã®ã¿ï¼‰
  ãƒ¡ã‚½ãƒƒãƒ‰:
    - getSettings()
    - setMode(mode)
    - getMode()
  ä¾å­˜: config.js
  è¢«ä¾å­˜: brush-core.js, stroke-renderer.js

------------------------------------------------------------------------
1.5 æç”»ã‚·ã‚¹ãƒ†ãƒ  - ãƒ™ã‚¯ã‚¿ãƒ¼æ–¹å¼ï¼ˆå‰Šé™¤å¯¾è±¡ï¼‰
------------------------------------------------------------------------

âŒ system/drawing/webgl2/gl-msdf-pipeline.js
  ç”¨é€”: MSDFç”Ÿæˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
  ç†ç”±: ãƒ©ã‚¹ã‚¿ãƒ¼æ–¹å¼ã§ã¯ä¸è¦

âŒ system/drawing/webgl2/gl-stroke-processor.js
  ç”¨é€”: ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ãƒãƒªã‚´ãƒ³ç”Ÿæˆ
  ç†ç”±: ãƒ©ã‚¹ã‚¿ãƒ¼æ–¹å¼ã§ã¯ä¸è¦

âŒ system/drawing/webgl2/shaders/seed-init.frag.glsl
âŒ system/drawing/webgl2/shaders/jfa-pass.frag.glsl
âŒ system/drawing/webgl2/shaders/encode.frag.glsl
  ç”¨é€”: JFA Distance Field è¨ˆç®—
  ç†ç”±: ãƒ©ã‚¹ã‚¿ãƒ¼æ–¹å¼ã§ã¯ä¸è¦

âŒ system/drawing/webgl2/shaders/render.vert.glsl
âŒ system/drawing/webgl2/shaders/render.frag.glsl
  ç”¨é€”: ãƒ™ã‚¯ã‚¿ãƒ¼æç”»ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼
  ç†ç”±: ãƒ©ã‚¹ã‚¿ãƒ¼ç”¨ã«ç½®ãæ›ãˆ

âŒ system/earcut-triangulator.js
  ç”¨é€”: ãƒãƒªã‚´ãƒ³ä¸‰è§’å½¢åˆ†å‰²
  ç†ç”±: ãƒ©ã‚¹ã‚¿ãƒ¼æ–¹å¼ã§ã¯ä¸è¦

âŒ system/drawing/sdf-brush-shader.js
  âš ï¸ å­˜åœ¨ä¸æ˜ï¼ˆindex.htmlã«è¨˜è¼‰ãªã—ï¼‰
  ç†ç”±: SDFé–¢é€£ã¯ä¸è¦

------------------------------------------------------------------------
1.6 æç”»ã‚·ã‚¹ãƒ†ãƒ  - æ”¹ä¿®å¯¾è±¡
------------------------------------------------------------------------

ğŸ“„ system/drawing/drawing-engine.js
  ç¾çŠ¶: PointerEvent â†’ Localåº§æ¨™å¤‰æ›ã€BrushCoreå‘¼ã³å‡ºã—
  Phase: B-2ï¼ˆå‚¾ãä¼é”å®Ÿè£…æ¸ˆã¿ï¼‰
  ğŸ”§ æ”¹ä¿®å†…å®¹:
     - BrushCoreå‘¼ã³å‡ºã—ã¯ãã®ã¾ã¾
     - åº§æ¨™å¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ä¿æŒ
  ãƒ¡ã‚½ãƒƒãƒ‰:
    - _handlePointerDown(info, e)
    - _handlePointerMove(info, e)
    - _handlePointerUp(info, e)
    - _screenToLocal(clientX, clientY)
  ä¾å­˜: brush-core, pointer-handler, coordinate-system
  è¢«ä¾å­˜: core-engine.js

ğŸ“„ system/drawing/brush-core.js
  ç¾çŠ¶: ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ç®¡ç†ã€StrokeRendererå‘¼ã³å‡ºã—
  Phase: C-2.1ï¼ˆHistoryç™»éŒ²ä¿®æ­£æ¸ˆã¿ï¼‰
  ğŸ”§ æ”¹ä¿®å†…å®¹:
     - strokeRenderer â†’ rasterBrushCore ã«å¤‰æ›´
     - Historyç™»éŒ²ãƒ­ã‚¸ãƒƒã‚¯ã¯ãã®ã¾ã¾
     - finalizeStroke() å†…éƒ¨å‡¦ç†ã‚’å¤‰æ›´
  ãƒ¡ã‚½ãƒƒãƒ‰:
    - startStroke(clientX, clientY, pressure, tiltX, tiltY, twist)
    - updateStroke(clientX, clientY, pressure, tiltX, tiltY, twist)
    - finalizeStroke()
    - cancelStroke()
  ä¾å­˜: coordinate-system, pressure-handler, stroke-recorder, stroke-renderer
  è¢«ä¾å­˜: drawing-engine.js

ğŸ“„ system/drawing/stroke-renderer.js
  ç¾çŠ¶: ãƒ™ã‚¯ã‚¿ãƒ¼ãƒ¡ãƒƒã‚·ãƒ¥ç”Ÿæˆãƒ»MSDFå‡¦ç†
  Phase: B-5ï¼ˆå‚¾ããƒ™ãƒ¼ã‚¹å¹…å¤‰èª¿ï¼‰
  ğŸ”§ æ”¹ä¿®å†…å®¹:
     âŒ å®Œå…¨å‰Šé™¤ã¾ãŸã¯åå‰å¤‰æ›´
     âœ… æ–°è¦ raster-brush-core.js ã«ç½®ãæ›ãˆ
  ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆå‰Šé™¤ï¼‰:
    - _renderWithPolygon()
    - _renderIncrementalSegment()
    - renderFinalStroke()
  ä¾å­˜: gl-stroke-processor, gl-msdf-pipeline, webgl2-drawing-layer
  è¢«ä¾å­˜: brush-core.js

------------------------------------------------------------------------
1.7 WebGL2ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†
------------------------------------------------------------------------

ğŸ“„ system/drawing/webgl2/gl-texture-bridge.js
  ç¾çŠ¶: Pixi.js Texture â†” WebGL Texture å¤‰æ›
  âœ… ä¿æŒï¼ˆãƒ©ã‚¹ã‚¿ãƒ¼ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†ã«ä½¿ç”¨ï¼‰
  ä¾å­˜: PixiJS
  è¢«ä¾å­˜: webgl2-drawing-layer

ğŸ“„ system/drawing/webgl2/webgl2-drawing-layer.js
  ç¾çŠ¶: WebGL2æç”»ãƒ¬ã‚¤ãƒ¤ãƒ¼çµ±åˆ
  Phase: 3.6
  ğŸ”§ å¤§å¹…æ”¹ä¿®
     - ãƒ™ã‚¯ã‚¿ãƒ¼åˆæˆ â†’ ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ†ã‚¯ã‚¹ãƒãƒ£åˆæˆ
     - ãƒ•ãƒ¬ãƒ¼ãƒ ãƒãƒƒãƒ•ã‚¡ç®¡ç†è¿½åŠ 
  ä¾å­˜: gl-texture-bridge
  è¢«ä¾å­˜: stroke-renderer

âŒ system/drawing/webgl2/gl-mask-layer.js
  ç”¨é€”: ãƒã‚¹ã‚¯å‡¦ç†
  âš ï¸ å®Ÿè£…ä¸å®Œå…¨ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆ: å°†æ¥è¿½åŠ äºˆå®šï¼‰
  ç†ç”±: æœªä½¿ç”¨

------------------------------------------------------------------------
1.8 ãã®ä»–æç”»é–¢é€£
------------------------------------------------------------------------

ğŸ“ system/drawing/fill-tool.js
  âœ… å¡—ã‚Šã¤ã¶ã—ãƒ„ãƒ¼ãƒ«
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰
  ä¾å­˜: event-bus, layer-system
  è¢«ä¾å­˜: brush-core

ğŸ“ system/drawing/blend-modes.js
  âœ… ãƒ–ãƒ¬ãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰å®šç¾©
  ğŸ”§ ãƒ©ã‚¹ã‚¿ãƒ¼ç”¨å®Ÿè£…ã«èª¿æ•´
  ä¾å­˜: ãªã—

ğŸ“ system/drawing/stroke-transformer.js
  âœ… ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯å¤‰å½¢å‡¦ç†
  ğŸ”§ ãƒ©ã‚¹ã‚¿ãƒ¼å¯¾å¿œã«èª¿æ•´

ğŸ“ system/drawing/thumbnail-system.js
  âœ… ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ
  ğŸ”§ gl.readPixels() ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´

ğŸ“ system/processing/vector-operations.js
  âš ï¸ ç”¨é€”ä¸æ˜ï¼ˆãƒ™ã‚¯ã‚¿ãƒ¼æ¼”ç®—ï¼Ÿï¼‰
  ğŸ” è¦èª¿æŸ»

ğŸ“ system/layer-transform.js
  âœ… ãƒ¬ã‚¤ãƒ¤ãƒ¼å¤‰å½¢å‡¦ç†
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰

ğŸ“ system/drawing-clipboard.js
  âœ… ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ç®¡ç†
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰

ğŸ“ system/checker-utils.js
  âœ… ãƒã‚§ãƒƒã‚«ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³èƒŒæ™¯
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰

------------------------------------------------------------------------
1.9 ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
------------------------------------------------------------------------

ğŸ“ system/export-manager.js
  âœ… ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆçµ±åˆç®¡ç†
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰

ğŸ“ system/quick-export-ui.js
  âœ… ã‚¯ã‚¤ãƒƒã‚¯ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆUI
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰

ğŸ“ system/exporters/png-exporter.js
ğŸ“ system/exporters/webp-exporter.js
ğŸ“ system/exporters/psd-exporter.js
ğŸ“ system/exporters/apng-exporter.js
ğŸ“ system/exporters/webm-exporter.js
ğŸ“ system/exporters/mp4-exporter.js
  âœ… å„å½¢å¼ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰

------------------------------------------------------------------------
1.10 UI
------------------------------------------------------------------------

ğŸ“ ui/dom-builder.js
ğŸ“ ui/slider-utils.js
ğŸ“ ui/keyboard-handler.js
ğŸ“ ui/resize-popup.js
ğŸ“ ui/layer-panel-renderer.js
ğŸ“ ui/status-display-renderer.js
ğŸ“ ui/timeline-thumbnail-utils.js
ğŸ“ ui/timeline-ui.js
ğŸ“ ui/album-popup.js
ğŸ“ ui/settings-popup.js
ğŸ“ ui/quick-access-popup.js
ğŸ“ ui/export-popup.js
ğŸ“ ui/ui-panels.js
  âœ… UIé–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰

------------------------------------------------------------------------
1.11 ãƒ‡ãƒãƒƒã‚°
------------------------------------------------------------------------

ğŸ“ system/debug-utils.js
  âœ… ãƒ‡ãƒãƒƒã‚°ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰

ğŸ“ system/popup-manager.js
  âœ… ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ç®¡ç†
  âœ… ä¿æŒï¼ˆå¤‰æ›´ãªã—ï¼‰

================================================================================
ç¬¬2ç« : å•é¡Œç‚¹ãƒ»èª²é¡Œ
================================================================================

2.1 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ä¸Šã®å•é¡Œ
------------------------------------------------------------------------

âš ï¸ ãƒ™ã‚¯ã‚¿ãƒ¼ä¾å­˜ã®å¼·å›ºãªçµåˆ
  - stroke-renderer.js ãŒ gl-stroke-processor ã«å¼·ä¾å­˜
  - brush-core.js ãŒ stroke-renderer å‰æã®å®Ÿè£…
  - Historyç™»éŒ²ãŒãƒ™ã‚¯ã‚¿ãƒ¼Graphicså‰æ

âš ï¸ Perfect-Freehandã¸ã®ä¾å­˜
  - gl-stroke-processor.js å†…ã§ä½¿ç”¨
  - ãƒãƒªã‚´ãƒ³ç”Ÿæˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ ¹å¹¹

âš ï¸ MSDF/JFAå‡¦ç†ã®è¤‡é›‘æ€§
  - gl-msdf-pipeline.js ã®å‰Šé™¤å½±éŸ¿ç¯„å›²ãŒä¸æ˜
  - shader-inline.js ãŒGLSLã‚³ãƒ¼ãƒ‰ä¿æŒ

2.2 æœªä½¿ç”¨ãƒ»å®Ÿè£…ä¸å®Œå…¨ãƒ•ã‚¡ã‚¤ãƒ«
------------------------------------------------------------------------

âŒ gl-mask-layer.js
  - ã‚³ãƒ¡ãƒ³ãƒˆã«ã€Œå°†æ¥è¿½åŠ äºˆå®šã€
  - å®Ÿéš›ã«ã¯ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„

âš ï¸ vector-operations.js
  - ç”¨é€”ä¸æ˜
  - ä»–ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã®å‚ç…§ãŒä¸æ˜ç¢º

âš ï¸ shader-inline.js
  - ãƒ™ã‚¯ã‚¿ãƒ¼ç”¨GLSLã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ä¿æŒ
  - file://å¯¾å¿œã®ãŸã‚
  - ãƒ©ã‚¹ã‚¿ãƒ¼åŒ–å¾Œã¯ä¸è¦ã®å¯èƒ½æ€§

2.3 åº§æ¨™ç³»ã®æ•´åˆæ€§
------------------------------------------------------------------------

âœ… åº§æ¨™å¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è‡ªä½“ã¯æ­£å¸¸
  - coordinate-system.js ã¯å•é¡Œãªã—
  - drawing-engine.js ã®å¤‰æ›å‡¦ç†ã‚‚æ­£å¸¸

âš ï¸ ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ä¸çµ±ä¸€
  - pathsData ã¨ paths ã®äºŒé‡ç®¡ç†
  - ãƒ™ã‚¯ã‚¿ãƒ¼å‰æã®æ§‹é€ 

================================================================================
ç¬¬3ç« : æ”¹ä¿®è¨ˆç”» - ãƒ•ã‚§ãƒ¼ã‚ºæ§‹æˆ
================================================================================

------------------------------------------------------------------------
Phase 1: æº–å‚™ãƒ»ç’°å¢ƒæ•´å‚™
------------------------------------------------------------------------

1.1 ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³æ›´æ–° âœ…å®Œäº†
  - v3.0ãƒ©ã‚¹ã‚¿ãƒ¼ç‰ˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ä½œæˆæ¸ˆã¿

1.2 ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»ãƒ–ãƒ©ãƒ³ãƒä½œæˆ
  - webgl2_rev30 â†’ webgl2_rev30_vector_backup
  - æ–°ãƒ–ãƒ©ãƒ³ãƒ: webgl2_rev31_raster

1.3 å‰Šé™¤ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆç¢ºå®š
  âŒ gl-msdf-pipeline.js
  âŒ gl-stroke-processor.js
  âŒ shaders/*.glsl (5ãƒ•ã‚¡ã‚¤ãƒ«)
  âŒ earcut-triangulator.js
  âŒ gl-mask-layer.js
  âŒ stroke-renderer.js (ã¾ãŸã¯æ”¹å)

------------------------------------------------------------------------
Phase 2: æ–°è¦ãƒ©ã‚¹ã‚¿ãƒ¼ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…
------------------------------------------------------------------------

2.1 ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ–ãƒ©ã‚·ã‚³ã‚¢ä½œæˆ
  ğŸ“„ æ–°è¦: system/drawing/raster/raster-brush-core.js
  å½¹å‰²: ãƒ–ãƒ©ã‚·ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ãƒ†ã‚¯ã‚¹ãƒãƒ£ã«æç”»
  ãƒ¡ã‚½ãƒƒãƒ‰:
    - initialize(gl)
    - startStroke(localX, localY, pressure, tiltX, tiltY, twist, settings)
    - addStrokePoint(localX, localY, pressure, tiltX, tiltY, twist)
    - finalizeStroke() â†’ Graphics
    - renderToFramebuffer(layerFBO, points, settings)
  å®Ÿè£…è¦ä»¶:
    - å‰å›ç‚¹ã¨ã®è£œé–“å‡¦ç†
    - ãƒ–ãƒ©ã‚·ã‚¹ã‚¿ãƒ³ãƒ—æç”»ï¼ˆå††å½¢ï¼‰
    - ç­†åœ§å¯¾å¿œï¼ˆã‚µã‚¤ã‚ºãƒ»ä¸é€æ˜åº¦ï¼‰
    - å‚¾ãå¯¾å¿œï¼ˆå›è»¢ãƒ»å¹…å¤‰èª¿ï¼‰

2.2 ãƒ–ãƒ©ã‚·ã‚¹ã‚¿ãƒ³ãƒ—ç”Ÿæˆ
  ğŸ“„ æ–°è¦: system/drawing/raster/brush-stamp.js
  å½¹å‰²: ãƒ–ãƒ©ã‚·ã‚¹ã‚¿ãƒ³ãƒ—ç”»åƒç”Ÿæˆ
  ãƒ¡ã‚½ãƒƒãƒ‰:
    - generateCircleStamp(radius, hardness)
    - generateTextureStamp(imageData)
    - applyAntialiasing(stamp)
  å®Ÿè£…è¦ä»¶:
    - ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã§å††å½¢ç”Ÿæˆ
    - ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚¹å‡¦ç†
    - ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚­ãƒ£ãƒƒã‚·ãƒ¥

2.3 è£œé–“ã‚·ã‚¹ãƒ†ãƒ 
  ğŸ“„ æ–°è¦: system/drawing/raster/brush-interpolator.js
  å½¹å‰²: ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆé–“ã®è£œé–“
  ãƒ¡ã‚½ãƒƒãƒ‰:
    - interpolate(p1, p2, steps)
    - calculateSteps(distance, speed)
  å®Ÿè£…è¦ä»¶:
    - è·é›¢ãƒ™ãƒ¼ã‚¹è£œé–“
    - é€Ÿåº¦é©å¿œè£œé–“
    - ç­†åœ§ãƒ»å‚¾ãè£œé–“

2.4 ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†
  ğŸ“„ æ–°è¦: system/drawing/raster/raster-layer.js
  å½¹å‰²: WebGL2ãƒ•ãƒ¬ãƒ¼ãƒ ãƒãƒƒãƒ•ã‚¡ãƒ™ãƒ¼ã‚¹ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†
  ãƒ¡ã‚½ãƒƒãƒ‰:
    - createLayer(width, height)
    - getFramebuffer(layerId)
    - getTexture(layerId)
    - composite(layers, targetFBO)
    - readPixels(layerId) â†’ Uint8Array
  å®Ÿè£…è¦ä»¶:
    - 1ãƒ¬ã‚¤ãƒ¤ãƒ¼ = 1 FBO + 1 RGBA texture
    - ãƒ–ãƒ¬ãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ
    - ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆï¼ˆgl.readPixelsï¼‰

------------------------------------------------------------------------
Phase 3: æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«æ”¹ä¿®
------------------------------------------------------------------------

3.1 config.js
  ğŸ”§ è¿½åŠ é …ç›®:
    brush.raster = {
      stamp: {
        type: 'circle',          // 'circle' | 'texture'
        hardness: 1.0,           // 0.0ï½1.0
        spacing: 0.1             // ã‚¹ã‚¿ãƒ³ãƒ—é–“éš”
      },
      interpolation: {
        enabled: true,
        distanceThreshold: 2.5,  // ãƒ”ã‚¯ã‚»ãƒ«
        maxSteps: 15,
        adaptiveSpeed: true
      },
      antialiasing: true
    }

3.2 brush-core.js
  ğŸ”§ æ”¹ä¿®å†…å®¹:
    - strokeRenderer â†’ rasterBrushCore ã«å·®ã—æ›¿ãˆ
    - startStroke(): rasterBrushCore.startStroke() å‘¼ã³å‡ºã—
    - updateStroke(): rasterBrushCore.addStrokePoint() å‘¼ã³å‡ºã—
    - finalizeStroke(): rasterBrushCore.finalizeStroke() å‘¼ã³å‡ºã—
    - Historyç™»éŒ²ãƒ­ã‚¸ãƒƒã‚¯ã¯ç¶­æŒ
  ä¾å­˜å¤‰æ›´:
    å‰Šé™¤: stroke-renderer.js
    è¿½åŠ : raster-brush-core.js

3.3 drawing-engine.js
  ğŸ”§ æ”¹ä¿®å†…å®¹:
    - BrushCoreå‘¼ã³å‡ºã—ã¯ãã®ã¾ã¾
    - åº§æ¨™å¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ç¶­æŒ
  å¤‰æ›´: ãªã—ï¼ˆBrushCoreå†…éƒ¨ã§å®Œçµï¼‰

3.4 webgl2-drawing-layer.js
  ğŸ”§ å¤§å¹…æ”¹ä¿®:
    - ãƒ™ã‚¯ã‚¿ãƒ¼åˆæˆå‡¦ç†ã‚’å‰Šé™¤
    - ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ†ã‚¯ã‚¹ãƒãƒ£åˆæˆã«å¤‰æ›´
    - ãƒ•ãƒ¬ãƒ¼ãƒ ãƒãƒƒãƒ•ã‚¡ç®¡ç†è¿½åŠ 
  æ–°è¦ãƒ¡ã‚½ãƒƒãƒ‰:
    - initializeFramebuffers(layerCount)
    - compositeRasterLayers(layers)
    - blitToPixi(texture)

3.5 layer-system.js
  ğŸ”§ è»½å¾®ãªæ”¹ä¿®:
    - layerData.pathsData â†’ layerData.rasterStrokes
    - layerDataæ§‹é€ å¤‰æ›´
      æ—§: { pathsData: [], paths: [] }
      æ–°: { rasterStrokes: [], framebuffer: FBO }

3.6 thumbnail-system.js
  ğŸ”§ æ”¹ä¿®å†…å®¹:
    - gl.readPixels() ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´
    - raster-layer.js ã® readPixels() ä½¿ç”¨

3.7 settings-manager.js
  ğŸ”§ è¿½åŠ è¨­å®šé …ç›®:
    - ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ–ãƒ©ã‚·è¨­å®š

3.8 blend-modes.js
  ğŸ”§ æ”¹ä¿®å†…å®¹:
    - ãƒ©ã‚¹ã‚¿ãƒ¼ç”¨ãƒ–ãƒ¬ãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰å®Ÿè£…
    - WebGL2 glBlendFunc è¨­å®š

------------------------------------------------------------------------
Phase 4: ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼å®Ÿè£…
------------------------------------------------------------------------

4.1 ãƒ–ãƒ©ã‚·ã‚¹ã‚¿ãƒ³ãƒ—ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼
  ğŸ“„ æ–°è¦: system/drawing/raster/shaders/brush-stamp.frag.glsl
  å½¹å‰²: å††å½¢ã‚¹ã‚¿ãƒ³ãƒ—ç”Ÿæˆ
  å…¥åŠ›: uv, center, radius, hardness
  å‡ºåŠ›: RGBAï¼ˆã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚¹ä»˜ãå††ï¼‰

4.2 åˆæˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼
  ğŸ“„ æ–°è¦: system/drawing/raster/shaders/composite.frag.glsl
  å½¹å‰²: ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ†ã‚¯ã‚¹ãƒãƒ£åˆæˆ
  å…¥åŠ›: è¤‡æ•°ãƒ†ã‚¯ã‚¹ãƒãƒ£, ãƒ–ãƒ¬ãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰
  å‡ºåŠ›: åˆæˆçµæœ

4.3 shader-inline.js
  ğŸ”§ æ”¹ä¿®å†…å®¹:
    - ãƒ™ã‚¯ã‚¿ãƒ¼ç”¨GLSLå‰Šé™¤
    - ãƒ©ã‚¹ã‚¿ãƒ¼ç”¨GLSLè¿½åŠ 

------------------------------------------------------------------------
Phase 5: çµ±åˆãƒ»ãƒ†ã‚¹ãƒˆ
------------------------------------------------------------------------

5.1 ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
  - Phase 1.3 ã®ãƒªã‚¹ãƒˆã«å¾“ã„å‰Šé™¤

5.2 index.htmlæ›´æ–°
  å‰Šé™¤:
    <script src="system/drawing/webgl2/gl-msdf-pipeline.js"></script>
    <script src="system/drawing/webgl2/gl-stroke-processor.js"></script>
    <script src="system/earcut-triangulator.js"></script>
    <script src="system/drawing/webgl2/gl-mask-layer.js"></script>
    <script src="system/drawing/stroke-renderer.js"></script>
  
  è¿½åŠ :
    <script src="system/drawing/raster/brush-stamp.js"></script>
    <script src="system/drawing/raster/brush-interpolator.js"></script>
    <script src="system/drawing/raster/raster-layer.js"></script>
    <script src="system/drawing/raster/raster-brush-core.js"></script>

5.3 åˆæœŸåŒ–é †åºèª¿æ•´
  core-initializer.js:
    - WebGL2åˆæœŸåŒ–
    - raster-layer åˆæœŸåŒ–
    - raster-brush-core åˆæœŸåŒ–
    - BrushCore åˆæœŸåŒ–

5.4 å‹•ä½œç¢ºèª
  - åŸºæœ¬æç”»: ãƒšãƒ³ãƒ»æ¶ˆã—ã‚´ãƒ 
  - ç­†åœ§å¯¾å¿œ
  - å‚¾ãå¯¾å¿œ
  - Undo/Redo
  - ãƒ¬ã‚¤ãƒ¤ãƒ¼æ“ä½œ
  - ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

------------------------------------------------------------------------
Phase 6: æœ€é©åŒ–ãƒ»ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
------------------------------------------------------------------------

6.1 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
  - ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  - æç”»ãƒãƒƒãƒãƒ³ã‚°
  - FBOå†åˆ©ç”¨

6.2 ãƒ¡ãƒ¢ãƒªç®¡ç†
  - ä¸è¦ãƒ†ã‚¯ã‚¹ãƒãƒ£è§£æ”¾
  - FBOå‰Šé™¤å‡¦ç†

6.3 ã‚³ãƒ¼ãƒ‰æ•´ç†
  - æœªä½¿ç”¨å¤‰æ•°å‰Šé™¤
  - ã‚³ãƒ¡ãƒ³ãƒˆæ•´ç†
  - ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°å‰Šé™¤

================================================================================
ç¬¬4ç« : ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ - æ”¹ä¿®å¾Œ
================================================================================

ã€æ–°è¦ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«ã€‘
  system/drawing/raster/raster-brush-core.js      (500è¡Œæƒ³å®š)
  system/drawing/raster/brush-stamp.js            (300è¡Œæƒ³å®š)
  system/drawing/raster/brush-interpolator.js     (200è¡Œæƒ³å®š)
  system/drawing/raster/raster-layer.js           (400è¡Œæƒ³å®š)
  system/drawing/raster/shaders/brush-stamp.frag.glsl
  system/drawing/raster/shaders/composite.frag.glsl

ã€å¤§å¹…æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«ã€‘
  system/drawing/brush-core.js                    (600è¡Œ â†’ 650è¡Œ)
  system/drawing/webgl2/webgl2-drawing-layer.js   (800è¡Œ â†’ 900è¡Œ)
  system/drawing/thumbnail-system.js              (300è¡Œ â†’ 350è¡Œ)

ã€è»½å¾®æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«ã€‘
  config.js                                       (+50è¡Œ)
  system/layer-system.js                          (+20è¡Œ)
  system/settings-manager.js                      (+30è¡Œ)
  system/drawing/blend-modes.js                   (+50è¡Œ)
  system/drawing/shader-inline.js                 (æ”¹ä¿®)
  core-initializer.js                             (+30è¡Œ)

ã€å‰Šé™¤ãƒ•ã‚¡ã‚¤ãƒ«ã€‘
  system/drawing/webgl2/gl-msdf-pipeline.js
  system/drawing/webgl2/gl-stroke-processor.js
  system/drawing/webgl2/shaders/seed-init.frag.glsl
  system/drawing/webgl2/shaders/jfa-pass.frag.glsl
  system/drawing/webgl2/shaders/encode.frag.glsl
  system/drawing/webgl2/shaders/render.vert.glsl
  system/drawing/webgl2/shaders/render.frag.glsl
  system/earcut-triangulator.js
  system/drawing/webgl2/gl-mask-layer.js
  system/drawing/stroke-renderer.js

ã€ä¿æŒãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå¤‰æ›´ãªã—ï¼‰ã€‘
  coordinate-system.js
  system/drawing/pointer-handler.js
  system/drawing/pressure-handler.js
  system/drawing/stroke-recorder.js
  system/drawing/brush-settings.js
  system/drawing/fill-tool.js
  system/camera-system.js
  system/history.js
  system/event-bus.js
  ãã®ä»–UIãƒ»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆé–¢é€£å…¨ã¦

================================================================================
ç¬¬5ç« : å®Ÿè£…å„ªå…ˆé †ä½
================================================================================

ã€æœ€å„ªå…ˆã€‘Phase 2.1, 2.2, 2.3
  - raster-brush-core.js
  - brush-stamp.js
  - brush-interpolator.js
  ç†ç”±: æç”»ã®æ ¹å¹¹

ã€é«˜å„ªå…ˆã€‘Phase 2.4, 3.2
  - raster-layer.js
  - brush-core.jsæ”¹ä¿®
  ç†ç”±: ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†ã¨BrushCoreçµ±åˆ

ã€ä¸­å„ªå…ˆã€‘Phase 3.4, 4.1, 4.2
  - webgl2-drawing-layer.jsæ”¹ä¿®
  - ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼å®Ÿè£…
  ç†ç”±: åˆæˆå‡¦ç†

ã€ä½å„ªå…ˆã€‘Phase 3.6, 3.7, 5.2
  - thumbnail-system.js
  - settings-manager.js
  - index.htmlæ›´æ–°
  ç†ç”±: è£œåŠ©æ©Ÿèƒ½

ã€æœ€ä½å„ªå…ˆã€‘Phase 6
  - æœ€é©åŒ–ãƒ»ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  ç†ç”±: å‹•ä½œç¢ºèªå¾Œ

================================================================================
ç¬¬6ç« : ãƒªã‚¹ã‚¯ãƒ»æ³¨æ„äº‹é …
================================================================================

6.1 æŠ€è¡“çš„ãƒªã‚¹ã‚¯
------------------------------------------------------------------------

âš ï¸ WebGL2ãƒ•ãƒ¬ãƒ¼ãƒ ãƒãƒƒãƒ•ã‚¡ã®äº’æ›æ€§
  - ãƒ–ãƒ©ã‚¦ã‚¶ä¾å­˜ã®æŒ™å‹•å·®ç•°
  - ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆåˆ¶ç´„

âš ï¸ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ–
  - ãƒ™ã‚¯ã‚¿ãƒ¼â†’ãƒ©ã‚¹ã‚¿ãƒ¼ã§ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡å¢—åŠ 
  - å¤§ããªã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºã§FBOç¢ºä¿å¤±æ•—ã®å¯èƒ½æ€§

âš ï¸ æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®äº’æ›æ€§
  - ãƒ™ã‚¯ã‚¿ãƒ¼å½¢å¼ã§ä¿å­˜æ¸ˆã¿ã®ãƒ‡ãƒ¼ã‚¿ãŒèª­ã‚ãªããªã‚‹

6.2 å®Ÿè£…ä¸Šã®æ³¨æ„
------------------------------------------------------------------------

ã€åº§æ¨™å¤‰æ›ã®å³å®ˆã€‘
  - drawing-engine.jsã®å¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ç¶­æŒ
  - brush-core.jsã§è¿½åŠ å¤‰æ›ã—ãªã„
  - raster-brush-core.jsã¯Localåº§æ¨™ã‚’å—ã‘å–ã‚‹

ã€Historyæ•´åˆæ€§ã€‘
  - brush-core.jsã®Historyç™»éŒ²ãƒ­ã‚¸ãƒƒã‚¯ç¶­æŒ
  - do()å†…ã§é…åˆ—è¿½åŠ ã—ãªã„ï¼ˆPhase C-2.1ã®ä¿®æ­£ç¶­æŒï¼‰

ã€ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼ã€‘
  - EventBusçµŒç”±ã®ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œã‚’ç¶­æŒ
  - 'drawing:stroke-started', 'layer:path-added'ç­‰

ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€‘
  - window.BrushCoreç¶­æŒ
  - window.rasterBrushCoreæ–°è¦è¿½åŠ 
  - window.strokeRendererå‰Šé™¤

ã€DPRå›ºå®šã€‘
  - resolution = 1 å›ºå®šç¶­æŒ

6.3 å¾Œæ–¹äº’æ›æ€§
------------------------------------------------------------------------

âŒ ãƒ™ã‚¯ã‚¿ãƒ¼å½¢å¼ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ä¸å¯
  - ç§»è¡Œãƒ„ãƒ¼ãƒ«ã®æä¾›ã¯æ¤œè¨å¤–
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å†æç”»ã‚’ä¿ƒã™

âš ï¸ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå½¢å¼
  - PNG/WebP/PSDç­‰ã¯å•é¡Œãªã—
  - å†…éƒ¨å½¢å¼ï¼ˆJSONï¼‰ã¯éäº’æ›

6.4 æ®µéšçš„ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ
------------------------------------------------------------------------

æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ:
  1. Phase 2å®Œäº†æ™‚ç‚¹ã§Î±ç‰ˆãƒªãƒªãƒ¼ã‚¹
  2. åŸºæœ¬æç”»ã®ã¿ãƒ†ã‚¹ãƒˆ
  3. Phase 3å®Œäº†æ™‚ç‚¹ã§Î²ç‰ˆãƒªãƒªãƒ¼ã‚¹
  4. å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
  5. Phase 5å®Œäº†æ™‚ç‚¹ã§æ­£å¼ãƒªãƒªãƒ¼ã‚¹

================================================================================
ç¬¬7ç« : æˆåŠŸåŸºæº–
================================================================================

7.1 å¿…é ˆè¦ä»¶ï¼ˆPhase 5.4ã§ç¢ºèªï¼‰
------------------------------------------------------------------------

âœ… åŸºæœ¬æç”»å‹•ä½œ
  - ãƒšãƒ³ã§ç·šãŒå¼•ã‘ã‚‹
  - æ¶ˆã—ã‚´ãƒ ã§æ¶ˆã›ã‚‹
  - å¡—ã‚Šã¤ã¶ã—ãŒå‹•ä½œã™ã‚‹

âœ… ç­†åœ§å¯¾å¿œ
  - ã‚µã‚¤ã‚ºãŒç­†åœ§ã§å¤‰ã‚ã‚‹
  - ä¸é€æ˜åº¦ãŒç­†åœ§ã§å¤‰ã‚ã‚‹

âœ… å‚¾ãå¯¾å¿œ
  - twist/tiltXY ãŒè¨˜éŒ²ã•ã‚Œã‚‹
  - å¹…å¤‰èª¿ãŒå‹•ä½œã™ã‚‹

âœ… ãƒ¬ã‚¤ãƒ¤ãƒ¼æ“ä½œ
  - ãƒ¬ã‚¤ãƒ¤ãƒ¼è¿½åŠ ãƒ»å‰Šé™¤
  - ãƒ¬ã‚¤ãƒ¤ãƒ¼é †åºå¤‰æ›´
  - ãƒ¬ã‚¤ãƒ¤ãƒ¼å¤‰å½¢

âœ… Undo/Redo
  - ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯å˜ä½ã§Undoã§ãã‚‹
  - RedoãŒæ­£å¸¸å‹•ä½œ

âœ… ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
  - PNG/WebPå‡ºåŠ›ãŒæ­£å¸¸

7.2 æ€§èƒ½è¦ä»¶
------------------------------------------------------------------------

âœ… ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆ
  - 120Hzå…¥åŠ›ã«è¿½å¾“ï¼ˆç›®æ¨™ï¼‰
  - æœ€ä½60fpsç¶­æŒ

âœ… ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
  - 400x400ã‚­ãƒ£ãƒ³ãƒã‚¹ã§50MBä»¥å†…
  - 10ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§200MBä»¥å†…

7.3 ã‚³ãƒ¼ãƒ‰å“è³ª
------------------------------------------------------------------------

âœ… ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³æº–æ‹ 
  - åº§æ¨™å¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³éµå®ˆ
  - å‘½åè¦å‰‡çµ±ä¸€
  - ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼çµ±ä¸€

âœ… ä¿å®ˆæ€§
  - ãƒ•ã‚¡ã‚¤ãƒ«è²¬å‹™æ˜ç¢º
  - ã‚³ãƒ¡ãƒ³ãƒˆå……å®Ÿ
  - ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°æ•´å‚™

================================================================================
ä»˜éŒ²A: GLSLã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ä»•æ§˜
================================================================================

A.1 brush-stamp.frag.glsl
------------------------------------------------------------------------

precision highp float;

uniform vec2 u_center;      // ã‚¹ã‚¿ãƒ³ãƒ—ä¸­å¿ƒ
uniform float u_radius;     // åŠå¾„
uniform float u_hardness;   // ã‚¨ãƒƒã‚¸ã®ç¡¬ã• (0.0ï½1.0)
uniform vec4 u_color;       // RGBA

in vec2 v_uv;
out vec4 fragColor;

void main() {
    vec2 diff = v_uv - u_center;
    float dist = length(diff);
    
    // ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚¹ä»˜ãå††
    float edge = u_radius * (1.0 - u_hardness * 0.5);
    float alpha = smoothstep(u_radius, edge, dist);
    
    fragColor = vec4(u_color.rgb, u_color.a * alpha);
}

A.2 composite.frag.glsl
------------------------------------------------------------------------

precision highp float;

uniform sampler2D u_layer1;
uniform sampler2D u_layer2;
uniform int u_blendMode;  // 0=normal, 1=multiply, 2=add, etc.
uniform float u_opacity;

in vec2 v_uv;
out vec4 fragColor;

void main() {
    vec4 base = texture(u_layer1, v_uv);
    vec4 blend = texture(u_layer2, v_uv);
    
    if (u_blendMode == 0) {
        // Normal
        fragColor = mix(base, blend, blend.a * u_opacity);
    } else if (u_blendMode == 1) {
        // Multiply
        fragColor = base * blend * u_opacity;
    } else if (u_blendMode == 2) {
        // Add
        fragColor = base + blend * u_opacity;
    }
    // ä»–ã®ãƒ–ãƒ¬ãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰è¿½åŠ 
}

================================================================================
ä»˜éŒ²B: ãƒ‡ãƒ¼ã‚¿æ§‹é€ å®šç¾©
================================================================================

B.1 ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯
------------------------------------------------------------------------

RasterStroke {
  id: string,                     // ä¸€æ„ID
  points: Point[],                // Localåº§æ¨™ãƒã‚¤ãƒ³ãƒˆé…åˆ—
  settings: BrushSettings,        // æç”»æ™‚ã®è¨­å®š
  framebufferData: {
    x: number,                    // FBOå†…ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆ
    y: number,
    width: number,
    height: number
  },
  createdAt: number,              // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
  tool: 'pen' | 'eraser'
}

Point {
  localX: number,
  localY: number,
  pressure: number,
  tiltX: number,
  tiltY: number,
  twist: number,
  time: number
}

B.2 ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆæ”¹ä¿®å¾Œï¼‰
------------------------------------------------------------------------

LayerData {
  id: string,
  name: string,
  visible: boolean,
  locked: boolean,
  opacity: number,
  blendMode: string,
  rasterStrokes: RasterStroke[],  // æ—§: pathsData
  framebuffer: WebGLFramebuffer,  // æ–°è¦
  texture: WebGLTexture,          // æ–°è¦
  width: number,
  height: number
}

================================================================================
ä»˜éŒ²C: å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
================================================================================

Phase 1: æº–å‚™
  [ ] ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³v3.0å®Œæˆ
  [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ–ãƒ©ãƒ³ãƒä½œæˆ
  [ ] å‰Šé™¤ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆç¢ºå®š

Phase 2: æ–°è¦å®Ÿè£…
  [ ] raster-brush-core.js å®Œæˆ
  [ ] brush-stamp.js å®Œæˆ
  [ ] brush-interpolator.js å®Œæˆ
  [ ] raster-layer.js å®Œæˆ

Phase 3: æ—¢å­˜æ”¹ä¿®
  [ ] config.js æ›´æ–°
  [ ] brush-core.js æ”¹ä¿®
  [ ] webgl2-drawing-layer.js æ”¹ä¿®
  [ ] layer-system.js æ”¹ä¿®
  [ ] thumbnail-system.js æ”¹ä¿®
  [ ] settings-manager.js æ›´æ–°
  [ ] blend-modes.js æ”¹ä¿®

Phase 4: ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼
  [ ] brush-stamp.frag.glsl å®Ÿè£…
  [ ] composite.frag.glsl å®Ÿè£…
  [ ] shader-inline.js æ›´æ–°

Phase 5: çµ±åˆ
  [ ] ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤å®Ÿè¡Œ
  [ ] index.html æ›´æ–°
  [ ] core-initializer.js æ›´æ–°
  [ ] åŸºæœ¬æç”»ãƒ†ã‚¹ãƒˆ
  [ ] ç­†åœ§ãƒ†ã‚¹ãƒˆ
  [ ] å‚¾ããƒ†ã‚¹ãƒˆ
  [ ] ãƒ¬ã‚¤ãƒ¤ãƒ¼æ“ä½œãƒ†ã‚¹ãƒˆ
  [ ] Undo/Redoãƒ†ã‚¹ãƒˆ
  [ ] ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆ

Phase 6: æœ€é©åŒ–
  [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬
  [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡è¨ˆæ¸¬
  [ ] ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚­ãƒ£ãƒƒã‚·ãƒ¥å®Ÿè£…
  [ ] ã‚³ãƒ¼ãƒ‰æ•´ç†

================================================================================
END OF DOCUMENT
================================================================================