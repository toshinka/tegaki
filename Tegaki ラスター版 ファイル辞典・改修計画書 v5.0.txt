================================================================================
Tegaki ãƒ©ã‚¹ã‚¿ãƒ¼ç‰ˆ ãƒ•ã‚¡ã‚¤ãƒ«è¾å…¸ãƒ»æ”¹ä¿®è¨ˆç”»æ›¸ v5.0
================================================================================

ä½œæˆæ—¥: 2024-12-11
åŸºæº–: webgl2_Raster_rev9
ç›®çš„: PixiJS/WebGL2ç«¶åˆå•é¡Œã®å®Œå…¨è§£æ±ºãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ•´ç†

================================================================================
ç¬¬1éƒ¨: é‡å¤§ãƒã‚°åˆ†æ
================================================================================

ã€ç¾è±¡ã€‘
ãƒšãƒ³æç”»æ™‚ã«ã‚­ãƒ£ãƒ³ãƒã‚¹ãŒæ¶ˆãˆã‚‹
ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼:
```
WebGL: INVALID_OPERATION: uniformMatrix3fv: location is not from the associated program (x150+)
WebGL: INVALID_OPERATION: drawElements: no valid shader program in use (x100+)
```

ã€æ ¹æœ¬åŸå› ã€‘
PixiJSã¨è‡ªä½œWebGL2ã‚³ãƒ¼ãƒ‰ãŒåŒä¸€GLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å…±æœ‰ã™ã‚‹éš›ã®
ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãƒ—ãƒ­ã‚°ãƒ©ãƒ åˆ‡ã‚Šæ›¿ãˆä¸å…¨ã«ã‚ˆã‚‹çŠ¶æ…‹æ©Ÿæ¢°ç ´å£Š

ã€ç™ºç”Ÿãƒ•ãƒ­ãƒ¼ã€‘
1. RasterBrushCore: WebGL2æç”»å®Ÿè¡Œ â†’ GLãƒ—ãƒ­ã‚°ãƒ©ãƒ Aä½¿ç”¨
2. PixiJS ticker: è‡ªå‹•ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° â†’ GLãƒ—ãƒ­ã‚°ãƒ©ãƒ Båˆ‡ã‚Šæ›¿ãˆ
3. RasterBrushCore: ç¶šãã®æç”» â†’ GLãƒ—ãƒ­ã‚°ãƒ©ãƒ Bã®locationä½¿ç”¨ã§ã‚¨ãƒ©ãƒ¼
4. GLçŠ¶æ…‹æ©Ÿæ¢°ç ´å£Š â†’ ä»¥é™ã®å…¨æç”»å¤±æ•—

ã€å½±éŸ¿ç¯„å›²ã€‘
- raster-brush-core.js: WebGL2æç”»å®Ÿè¡Œéƒ¨
- webgl2-drawing-layer.js: GLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†
- core-initializer.js: åˆæœŸåŒ–ãƒ•ãƒ­ãƒ¼
- PixiJS ticker: è‡ªå‹•ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ«ãƒ¼ãƒ—

================================================================================
ç¬¬2éƒ¨: å®Œå…¨ãƒ•ã‚¡ã‚¤ãƒ«è¾å…¸
================================================================================

------------------------------------------------------------------------
2.1 WebGL2æç”»ã‚·ã‚¹ãƒ†ãƒ ï¼ˆç«¶åˆã®éœ‡æºåœ°ï¼‰
------------------------------------------------------------------------

ğŸ“„ system/drawing/raster/raster-brush-core.js
Phase: C-0.6
è²¬å‹™: ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ–ãƒ©ã‚·ã®å®Ÿéš›ã®GPUæç”»å®Ÿè¡Œ
è¦ªä¾å­˜: brush-core.js, drawing-engine.js
å­ä¾å­˜: raster-layer.js, brush-stamp.js, brush-interpolator.js, gl-texture-bridge.js
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.RasterBrushCore, window.rasterBrushCore
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹: window.rasterBrushCore (singleton)
ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:
  âœ… initialize(gl) - GLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå—ã‘å–ã‚Š
  âœ… startStroke(localX, localY, pressure, ...) - ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯é–‹å§‹
  âœ… addStrokePoint(...) - ç‚¹è¿½åŠ ãƒ»è£œé–“ãƒ»æç”»å®Ÿè¡Œ
  âœ… finalizeStroke() - ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯å®Œäº†ãƒ»PIXI.Spriteç”Ÿæˆ
  ğŸ”§ renderToFramebuffer() - FBOç›´æ¥æç”»ï¼ˆPhase C-1å®Ÿè£…æ¸ˆã¿ï¼‰
  ğŸ”§ _drawBrushStamp() - ã‚¹ã‚¿ãƒ³ãƒ—æç”»ï¼ˆPhase C-1å®Ÿè£…æ¸ˆã¿ï¼‰
  âš ï¸ _stopPixiTicker() - Line 394: Pixi tickeråœæ­¢
  âš ï¸ _restartPixiTicker() - Line 817: Pixi tickerå†é–‹
  ğŸ”§ _resetPixiShaderSystem() - Line 809: PixiJSã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãƒªã‚»ãƒƒãƒˆï¼ˆä¸å®Œå…¨ï¼‰
ä¸»è¦ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£:
  âœ… gl - WebGL2RenderingContext
  âœ… rasterLayer - RasterLayerã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
  âœ… brushProgram - WebGL2ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãƒ—ãƒ­ã‚°ãƒ©ãƒ 
  âœ… currentStroke - ç¾åœ¨æç”»ä¸­ã®ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯æƒ…å ±
ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«:
  - drawing:stroke-started
  - drawing:stroke-completed
å•é¡Œç®‡æ‰€:
  ğŸš¨ Line 394: tickeråœæ­¢ã§ã‚‚è£ã§å‹•ä½œç¶šè¡Œã®å¯èƒ½æ€§
  ğŸš¨ Line 817: tickerå†é–‹æ™‚ã«GLã‚¹ãƒ†ãƒ¼ãƒˆå¾©å…ƒä¸å®Œå…¨
  ğŸš¨ Line 809: resetShaderSystemã ã‘ã§ã¯ä¸ååˆ†
  ğŸš¨ æç”»ãƒ«ãƒ¼ãƒ—ä¸­ã®GLçŠ¶æ…‹ä¿å­˜/å¾©å…ƒãŒä¸åœ¨

ğŸ“„ system/drawing/webgl2/webgl2-drawing-layer.js
Phase: C-0.1
è²¬å‹™: WebGL2çµ±åˆãƒ»ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆæˆ
è¦ªä¾å­˜: core-initializer.js
å­ä¾å­˜: raster-layer.js, gl-texture-bridge.js
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.WebGL2DrawingLayer, window.webgl2Layer
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹: window.webgl2Layer (singleton)
ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:
  âœ… initialize(canvas, options) - WebGL2ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä½œæˆ
  âœ… linkPixiApp(pixiApp) - PixiJSã‚¢ãƒ—ãƒªé€£æº
  âŒ compositeRasterLayers(layers) - ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆæˆï¼ˆç©ºå®Ÿè£…ï¼‰
ä¸»è¦ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£:
  âœ… canvas - WebGL2ã‚­ãƒ£ãƒ³ãƒã‚¹
  âœ… gl - WebGL2RenderingContextï¼ˆå…±æœ‰ï¼‰
  âœ… rasterLayer - RasterLayerã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å‚ç…§
  âš ï¸ pixiApp - PixiJS Applicationï¼ˆtickerç®¡ç†ï¼‰
å•é¡Œç®‡æ‰€:
  ğŸš¨ Line 301: linkPixiApp()ã§tickeré€£æºã™ã‚‹ãŒåˆ¶å¾¡ä¸èƒ½
  ğŸš¨ GLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå…±æœ‰ã®ç®¡ç†ä¸åœ¨
  ğŸš¨ PixiJSæç”»ã¨ã‚«ã‚¹ã‚¿ãƒ æç”»ã®æ’ä»–åˆ¶å¾¡ãªã—

ğŸ“„ system/drawing/raster/raster-layer.js
Phase: C-0.1
è²¬å‹™: WebGL2ãƒ•ãƒ¬ãƒ¼ãƒ ãƒãƒƒãƒ•ã‚¡ãƒ»ãƒ†ã‚¯ã‚¹ãƒãƒ£ç®¡ç†
è¦ªä¾å­˜: webgl2-drawing-layer.js, raster-brush-core.js
å­ä¾å­˜: ãªã—
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.RasterLayer, window.rasterLayer
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹: window.rasterLayer (singleton)
ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:
  âœ… initialize(gl) - å¤–éƒ¨GLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå—ã‘å–ã‚Š
  âœ… getOrCreateLayer(layerId, width, height) - FBO/ãƒ†ã‚¯ã‚¹ãƒãƒ£å–å¾—/ç”Ÿæˆ
  âœ… deleteLayer(layerId) - ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾
  âœ… getLayerTexture(layerId) - ãƒ†ã‚¯ã‚¹ãƒãƒ£å–å¾—
ä¸»è¦ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£:
  âœ… gl - WebGL2RenderingContext
  âœ… layers - Map<layerId, {fbo, texture, width, height}>
  âœ… maxTextureSize - GPUåˆ¶é™å€¤
å•é¡Œç®‡æ‰€:
  âœ… æ­£å¸¸å‹•ä½œï¼ˆå•é¡Œãªã—ï¼‰

ğŸ“„ system/drawing/webgl2/gl-texture-bridge.js
Phase: C-0.5
è²¬å‹™: WebGL Texture â†” PIXI.Texture å¤‰æ›
è¦ªä¾å­˜: webgl2-drawing-layer.js, raster-brush-core.js
å­ä¾å­˜: ãªã—
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.GLTextureBridge, window.glTextureBridge
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹: window.glTextureBridge (singleton)
ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:
  âœ… initialize(pixiApp) - PixiJS v8 APIå¯¾å¿œåˆæœŸåŒ–
  âœ… webglToPixi(glTexture, width, height) - GLâ†’Pixiå¤‰æ›
  âœ… pixiToWebgl(pixiTexture) - Pixiâ†’GLå¤‰æ›
ä¸»è¦ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£:
  âœ… pixiRenderer - PIXI.Renderer
  âœ… gl - WebGL2RenderingContext
å•é¡Œç®‡æ‰€:
  âš ï¸ Line 109-143: CanvasçµŒç”±å¤‰æ›ï¼ˆåŠ¹ç‡ä½ä¸‹ï¼‰
  ğŸ” ç›´æ¥GL texture wrapã®å¯èƒ½æ€§æ¤œè¨ä½™åœ°

ğŸ“„ system/drawing/shader-inline.js
Phase: C-1
è²¬å‹™: GLSLã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ¼ãƒ‰ä¿æŒ
è¦ªä¾å­˜: webgl2-drawing-layer.js, raster-brush-core.js
å­ä¾å­˜: ãªã—
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.GLSL_SHADERS
ä¸»è¦ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼:
  âœ… BRUSH_STAMP_VERTEX - ãƒ–ãƒ©ã‚·ã‚¹ã‚¿ãƒ³ãƒ—é ‚ç‚¹
  âœ… BRUSH_STAMP_FRAGMENT - ãƒ–ãƒ©ã‚·ã‚¹ã‚¿ãƒ³ãƒ—ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆ
  âœ… DISPLAY_VERTEX - è¡¨ç¤ºç”¨é ‚ç‚¹
  âœ… DISPLAY_FRAGMENT - è¡¨ç¤ºç”¨ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆ
å•é¡Œç®‡æ‰€:
  âœ… æ­£å¸¸å‹•ä½œï¼ˆå•é¡Œãªã—ï¼‰

------------------------------------------------------------------------
2.2 æç”»çµ±åˆã‚·ã‚¹ãƒ†ãƒ 
------------------------------------------------------------------------

ğŸ“„ system/drawing/brush-core.js
Phase: C-2.1
è²¬å‹™: ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ç®¡ç†ãƒ»Historyç™»éŒ²
è¦ªä¾å­˜: core-engine.js, drawing-engine.js
å­ä¾å­˜: raster-brush-core.js, pressure-handler.js, stroke-recorder.js, layer-system.js, history.js
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.BrushCore
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹: éå…¬é–‹ï¼ˆcore-engineå†…ï¼‰
ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:
  âœ… initialize(rasterBrushCore) - ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ–ãƒ©ã‚·è¨­å®š
  âœ… startStroke(clientX, clientY, pressure, ...) - ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯é–‹å§‹
  âœ… updateStroke(...) - ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯æ›´æ–°
  âœ… finalizeStroke() - å®Œäº†ãƒ»Historyç™»éŒ²
ä¸»è¦ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£:
  âœ… rasterBrushCore - RasterBrushCoreã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
  âœ… isDrawing - æç”»ä¸­ãƒ•ãƒ©ã‚°
  âœ… currentMode - 'pen'/'eraser'
å•é¡Œç®‡æ‰€:
  âœ… æ­£å¸¸å‹•ä½œï¼ˆå•é¡Œãªã—ï¼‰

ğŸ“„ system/drawing/drawing-engine.js
Phase: 3.3
è²¬å‹™: PointerEventå‡¦ç†ãƒ»åº§æ¨™å¤‰æ›çµ±åˆ
è¦ªä¾å­˜: core-engine.js
å­ä¾å­˜: brush-core.js, pointer-handler.js, coordinate-system.js
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.DrawingEngine
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹: éå…¬é–‹ï¼ˆcore-engineå†…ï¼‰
ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:
  âœ… setRasterBrushCore(rasterBrushCore) - ãƒ–ãƒ©ã‚·ã‚³ã‚¢è¨­å®š
  âœ… _handlePointerDown/Move/Up(info, e) - ãƒã‚¤ãƒ³ã‚¿ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
  âœ… _screenToLocal(clientX, clientY) - åº§æ¨™å¤‰æ›
ä¸»è¦ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£:
  âœ… brushCore - BrushCoreã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
  âœ… pointerHandler - PointerHandlerã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
  âœ… isDrawing - æç”»ä¸­ãƒ•ãƒ©ã‚°
å•é¡Œç®‡æ‰€:
  âœ… æ­£å¸¸å‹•ä½œï¼ˆå•é¡Œãªã—ï¼‰

ğŸ“„ system/drawing/stroke-recorder.js
Phase: 7
è²¬å‹™: Localåº§æ¨™ãƒã‚¤ãƒ³ãƒˆè¨˜éŒ²ãƒ»è£œé–“
è¦ªä¾å­˜: brush-core.js
å­ä¾å­˜: ãªã—
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.strokeRecorder
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹: window.strokeRecorder (singleton)
ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:
  âœ… startStroke(localX, localY, pressure, ...) - è¨˜éŒ²é–‹å§‹
  âœ… addPoint(...) - ç‚¹è¿½åŠ ãƒ»é€Ÿåº¦é©å¿œè£œé–“
  âœ… endStroke() - è¨˜éŒ²å®Œäº†ãƒ»strokeDataè¿”å´
ä¸»è¦ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£:
  âœ… points - è¨˜éŒ²ç‚¹é…åˆ—
  âœ… interpolationThreshold - 2.5px
  âœ… maxSubdivisions - 15
å•é¡Œç®‡æ‰€:
  âœ… æ­£å¸¸å‹•ä½œï¼ˆå•é¡Œãªã—ï¼‰

------------------------------------------------------------------------
2.3 è£œåŠ©ã‚·ã‚¹ãƒ†ãƒ 
------------------------------------------------------------------------

ğŸ“„ system/drawing/raster/brush-stamp.js
Phase: å®Œäº†
è²¬å‹™: ãƒ–ãƒ©ã‚·ã‚¹ã‚¿ãƒ³ãƒ—ç”Ÿæˆ
è¦ªä¾å­˜: raster-brush-core.js
å­ä¾å­˜: ãªã—
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.BrushStamp
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹: window.brushStamp (singleton)
ä½¿ç”¨çŠ¶æ³: âœ… ä½¿ç”¨ä¸­ï¼ˆPhase C-1ã§æ´»ç”¨ï¼‰
ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:
  âœ… generateCircleStamp(radius, hardness) - å††å½¢ã‚¹ã‚¿ãƒ³ãƒ—
  âœ… generateTextureStamp(imageData) - ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚¹ã‚¿ãƒ³ãƒ—
å•é¡Œç®‡æ‰€:
  âœ… æ­£å¸¸å‹•ä½œï¼ˆå•é¡Œãªã—ï¼‰

ğŸ“„ system/drawing/raster/brush-interpolator.js
Phase: å®Œäº†
è²¬å‹™: ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆè£œé–“
è¦ªä¾å­˜: raster-brush-core.js
å­ä¾å­˜: ãªã—
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.BrushInterpolator
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹: window.brushInterpolator (singleton)
ä½¿ç”¨çŠ¶æ³: âœ… ä½¿ç”¨ä¸­
ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:
  âœ… interpolate(p1, p2, steps) - ç·šå½¢è£œé–“
  âœ… calculateSteps(distance, speed) - è£œé–“æ•°è¨ˆç®—
å•é¡Œç®‡æ‰€:
  âš ï¸ ç·šå½¢è£œé–“ã®ã¿ï¼ˆãƒ™ã‚¸ã‚§/ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³æœªå®Ÿè£…ï¼‰

ğŸ“„ system/drawing/pointer-handler.js
Phase: 2
è²¬å‹™: PointerEventçµ±ä¸€å‡¦ç†
è¦ªä¾å­˜: drawing-engine.js
å­ä¾å­˜: ãªã—
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.PointerHandler
ä½¿ç”¨çŠ¶æ³: âœ… ä½¿ç”¨ä¸­
ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:
  âœ… attach(canvas, callbacks, options) - ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²
å•é¡Œç®‡æ‰€:
  âœ… æ­£å¸¸å‹•ä½œï¼ˆå•é¡Œãªã—ï¼‰

ğŸ“„ system/drawing/pressure-handler.js
Phase: 2.4.2
è²¬å‹™: ç­†åœ§å‡¦ç†ãƒ»æ­£è¦åŒ–
è¦ªä¾å­˜: brush-core.js
å­ä¾å­˜: settings-manager.js
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.PressureHandler
ä½¿ç”¨çŠ¶æ³: âœ… ä½¿ç”¨ä¸­
ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:
  âœ… process(rawPressure) - ç­†åœ§è£œæ­£
  âœ… reset() - ãƒªã‚»ãƒƒãƒˆ
å•é¡Œç®‡æ‰€:
  âœ… æ­£å¸¸å‹•ä½œï¼ˆå•é¡Œãªã—ï¼‰

ğŸ“„ system/drawing/brush-settings.js
Phase: B-6
è²¬å‹™: ãƒ–ãƒ©ã‚·è¨­å®šç®¡ç†
è¦ªä¾å­˜: brush-core.js, raster-brush-core.js
å­ä¾å­˜: config.js
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.brushSettings
ä½¿ç”¨çŠ¶æ³: âœ… ä½¿ç”¨ä¸­
ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:
  âœ… getSettings() - è¨­å®šå–å¾—
  âœ… setMode(mode) - ãƒ¢ãƒ¼ãƒ‰è¨­å®š
å•é¡Œç®‡æ‰€:
  âœ… æ­£å¸¸å‹•ä½œï¼ˆå•é¡Œãªã—ï¼‰

------------------------------------------------------------------------
2.4 æœªä½¿ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå‰Šé™¤å€™è£œï¼‰
------------------------------------------------------------------------

âŒ system/processing/vector-operations.js
Phase: 1å®Œå…¨ç‰ˆ
è²¬å‹™: ãƒ™ã‚¯ã‚¿ãƒ¼ãƒ¡ãƒƒã‚·ãƒ¥ç”Ÿæˆï¼ˆPerfectFreehandï¼‰
ä½¿ç”¨çŠ¶æ³: âŒ æœªä½¿ç”¨ï¼ˆãƒ©ã‚¹ã‚¿ãƒ¼æ–¹å¼ã§ã¯ä¸è¦ï¼‰
è¦ªä¾å­˜: ãªã—
å­ä¾å­˜: ãªã—
åˆ¤å®š: ğŸ—‘ï¸ å‰Šé™¤å¯èƒ½ï¼ˆPhase Fã§å†æ¤œè¨ï¼‰
ç†ç”±: ãƒ©ã‚¹ã‚¿ãƒ¼æ–¹å¼ã§ã¯ä¸è¦ãƒ»å°†æ¥ã®ãƒ™ã‚¯ã‚¿ãƒ¼æ–¹å¼å¾©æ´»æ™‚ã¾ã§ä¿ç•™

âŒ system/drawing/stroke-transformer.js
Phase: 3èª¿æ•´äºˆå®š
è²¬å‹™: ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯å¤‰å½¢å‡¦ç†
ä½¿ç”¨çŠ¶æ³: ğŸ” è¦èª¿æŸ»ï¼ˆå‚ç…§ç®‡æ‰€ä¸æ˜ï¼‰
è¦ªä¾å­˜: ä¸æ˜
å­ä¾å­˜: ä¸æ˜
åˆ¤å®š: ğŸ” ä½¿ç”¨ç®‡æ‰€èª¿æŸ»å¾Œåˆ¤æ–­
ç†ç”±: å®Ÿè£…ä¸å®Œå…¨ãƒ»è²¬å‹™ä¸æ˜ç¢º

------------------------------------------------------------------------
2.5 ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ 
------------------------------------------------------------------------

ğŸ“ core-initializer.js
Phase: C-0.4
è²¬å‹™: ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼
è¦ªä¾å­˜: index.html
å­ä¾å­˜: webgl2-drawing-layer.js, raster-layer.js, gl-texture-bridge.js, raster-brush-core.js, core-engine.js
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.CoreInitializer
ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:
  âœ… initializeWebGL2Raster(canvas, config) - WebGL2åˆæœŸåŒ–
  ğŸ”§ _initRasterSystem() - ãƒ©ã‚¹ã‚¿ãƒ¼ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰
åˆæœŸåŒ–ãƒ•ãƒ­ãƒ¼:
  1. WebGL2DrawingLayerä½œæˆ
  2. GLContextç™»éŒ²
  3. RasterLayeråˆæœŸåŒ–
  4. GLTextureBridgeåˆæœŸåŒ–
  5. RasterBrushCoreåˆæœŸåŒ–
  6. PixiJS appé€£æº
å•é¡Œç®‡æ‰€:
  ğŸš¨ Line 227-237: GLTextureBridgeåˆæœŸåŒ–å¾Œã®tickeråˆ¶å¾¡ä¸åœ¨
  ğŸš¨ PixiJS tickerè‡ªå‹•é–‹å§‹ã®é˜²æ­¢ç­–ä¸åœ¨

ğŸ“ core-engine.js
Phase: 3.3
è²¬å‹™: ã‚¨ãƒ³ã‚¸ãƒ³çµ±åˆç®¡ç†
è¦ªä¾å­˜: core-initializer.js
å­ä¾å­˜: brush-core.js, drawing-engine.js, layer-system.js, camera-system.js, history.js
ã‚°ãƒ­ãƒ¼ãƒãƒ«: window.CoreEngine
ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:
  âœ… initializeDrawingSystem(canvas) - æç”»ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
  âœ… _initializeBrushCore() - BrushCoreç”Ÿæˆ
å•é¡Œç®‡æ‰€:
  âœ… æ­£å¸¸å‹•ä½œï¼ˆå•é¡Œãªã—ï¼‰

ğŸ“ core-runtime.js
Phase: 6
è²¬å‹™: ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç®¡ç†ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆçµ±åˆ
è¦ªä¾å­˜: core-initializer.js
å­ä¾å­˜: event-bus.js
ã‚°ãƒ­ãƒ¼ãƒãƒ«: ãªã—
å•é¡Œç®‡æ‰€:
  âœ… æ­£å¸¸å‹•ä½œï¼ˆå•é¡Œãªã—ï¼‰

------------------------------------------------------------------------
2.6 ã‚·ã‚¹ãƒ†ãƒ ã‚µãƒ¼ãƒ“ã‚¹
------------------------------------------------------------------------

ğŸ“„ coordinate-system.js
Phase: å®Œæˆç‰ˆ
è²¬å‹™: åº§æ¨™å¤‰æ›çµ±ä¸€ç®¡ç†
ä½¿ç”¨çŠ¶æ³: âœ… ä½¿ç”¨ä¸­ï¼ˆdrawing-engineã‹ã‚‰ï¼‰
ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:
  âœ… screenClientToCanvas(clientX, clientY)
  âœ… canvasToWorld(canvasX, canvasY)
  âœ… worldToLocal(worldX, worldY, container)
å•é¡Œç®‡æ‰€:
  âœ… æ­£å¸¸å‹•ä½œï¼ˆå•é¡Œãªã—ï¼‰

ğŸ“„ system/event-bus.js
è²¬å‹™: ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†
ä½¿ç”¨çŠ¶æ³: âœ… å…¨ã‚·ã‚¹ãƒ†ãƒ ã§ä½¿ç”¨ä¸­
å•é¡Œç®‡æ‰€:
  âœ… æ­£å¸¸å‹•ä½œï¼ˆå•é¡Œãªã—ï¼‰

ğŸ“„ system/history.js
Phase: C-2.3
è²¬å‹™: Undo/Redoç®¡ç†
ä½¿ç”¨çŠ¶æ³: âœ… ä½¿ç”¨ä¸­
ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:
  âœ… push(command) - doå®Ÿè¡Œ+ç™»éŒ²
  âœ… register(command) - ç™»éŒ²ã®ã¿
  âœ… undo(), redo()
å•é¡Œç®‡æ‰€:
  âœ… æ­£å¸¸å‹•ä½œï¼ˆå•é¡Œãªã—ï¼‰

ğŸ“„ system/layer-system.js
Phase: 3
è²¬å‹™: ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†
ä½¿ç”¨çŠ¶æ³: âœ… ä½¿ç”¨ä¸­
å•é¡Œç®‡æ‰€:
  âœ… æ­£å¸¸å‹•ä½œï¼ˆå•é¡Œãªã—ï¼‰

ğŸ“„ system/camera-system.js
è²¬å‹™: worldContainer transformç®¡ç†
ä½¿ç”¨çŠ¶æ³: âœ… ä½¿ç”¨ä¸­
å•é¡Œç®‡æ‰€:
  âœ… æ­£å¸¸å‹•ä½œï¼ˆå•é¡Œãªã—ï¼‰

ğŸ“„ system/thumbnail-system.js
Phase: 3.5
è²¬å‹™: ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ
ä½¿ç”¨çŠ¶æ³: âœ… ä½¿ç”¨ä¸­
å•é¡Œç®‡æ‰€:
  âœ… æ­£å¸¸å‹•ä½œï¼ˆå•é¡Œãªã—ï¼‰

------------------------------------------------------------------------
2.7 UIãƒ»è¨­å®š
------------------------------------------------------------------------

å…¨UIãƒ•ã‚¡ã‚¤ãƒ«: âœ… æ­£å¸¸å‹•ä½œ
- ui/layer-panel-renderer.js
- ui/timeline-ui.js
- ui/settings-popup.js
- ui/quick-access-popup.js
- ui/album-popup.js
- ui/export-popup.js
- ui/ui-panels.js

config.js: âœ… æ­£å¸¸å‹•ä½œ
settings-manager.js: âœ… æ­£å¸¸å‹•ä½œ
state-manager.js: âœ… æ­£å¸¸å‹•ä½œ

================================================================================
ç¬¬3éƒ¨: ãƒ•ãƒ­ãƒ¼åˆ†æ
================================================================================

------------------------------------------------------------------------
3.1 ç¾åœ¨ã®æç”»ãƒ•ãƒ­ãƒ¼ï¼ˆå•é¡Œã‚ã‚Šï¼‰
------------------------------------------------------------------------

ã€ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯é–‹å§‹ã€‘
1. PointerEvent(down) â†’ DrawingEngine._handlePointerDown()
2. DrawingEngine._screenToLocal() â†’ Localåº§æ¨™å–å¾—
3. BrushCore.startStroke() â†’ StrokeRecorder.startStroke()
4. RasterBrushCore.startStroke()
   - Line 394: pixiApp.ticker.stop() ğŸš¨
   - WebGL2 FBOå–å¾—
   - åˆå›ã‚¹ã‚¿ãƒ³ãƒ—æç”»
5. EventBus: 'drawing:stroke-started' ç™ºç«

ã€ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯æ›´æ–°ã€‘
6. PointerEvent(move) â†’ DrawingEngine._handlePointerMove()
7. BrushCore.updateStroke() â†’ StrokeRecorder.addPoint()
8. RasterBrushCore.addStrokePoint()
   - è£œé–“è¨ˆç®—
   - å„ãƒã‚¤ãƒ³ãƒˆã§WebGL2æç”»å®Ÿè¡Œ ğŸš¨
   - ã“ã®é–“ã‚‚PixiJS tickerãŒè£ã§å‹•ä½œ ğŸš¨ğŸš¨
9. æç”»å¾Œ: pixiApp.renderer.render() æ‰‹å‹•å‘¼ã³å‡ºã—

ã€ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯å®Œäº†ã€‘
10. PointerEvent(up) â†’ DrawingEngine._handlePointerUp()
11. BrushCore.finalizeStroke()
12. RasterBrushCore.finalizeStroke()
    - Line 817: pixiApp.ticker.start() ğŸš¨
    - Line 809: renderer.shader.reset() ğŸš¨ï¼ˆä¸å®Œå…¨ï¼‰
    - GLTextureBridge: GL Texture â†’ PIXI.Sprite å¤‰æ›
13. History.push(command)
14. EventBus: 'drawing:stroke-completed' ç™ºç«

ã€å•é¡Œãƒ•ãƒ­ãƒ¼ã€‘
ğŸš¨ Step 4-5: ticker.stop()ã§ã‚‚å®Œå…¨åœæ­¢ã›ãš
ğŸš¨ Step 8: æç”»ä¸­ã«PixiJSãŒå‰²ã‚Šè¾¼ã¿ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
ğŸš¨ Step 12: tickerå†é–‹æ™‚ã®GLã‚¹ãƒ†ãƒ¼ãƒˆå¾©å…ƒä¸å®Œå…¨

------------------------------------------------------------------------
3.2 PixiJS Tickerã®å•é¡Œ
------------------------------------------------------------------------

ã€PixiJS Tickerã®ä»•çµ„ã¿ã€‘
- Applicationä½œæˆæ™‚ã«è‡ªå‹•é–‹å§‹
- requestAnimationFrame()ã§ãƒ«ãƒ¼ãƒ—
- ticker.stop()ã¯æ¬¡ãƒ•ãƒ¬ãƒ¼ãƒ ä»¥é™ã®åœæ­¢ï¼ˆå³åº§åœæ­¢ã§ãªã„ï¼‰
- tickerå†…ã§renderer.render()ã‚’è‡ªå‹•å®Ÿè¡Œ
- render()å†…ã§GLãƒ—ãƒ­ã‚°ãƒ©ãƒ åˆ‡ã‚Šæ›¿ãˆç™ºç”Ÿ

ã€ç¾çŠ¶ã®å•é¡Œã€‘
1. ticker.stop()ãŒå³åº§ã«åŠ¹ã‹ãªã„
   â†’ æ¬¡ã®rAF()ã¾ã§1ãƒ•ãƒ¬ãƒ¼ãƒ é…å»¶
   â†’ ãã®é–“ã«render()ãŒ1å›å®Ÿè¡Œã•ã‚Œã‚‹å¯èƒ½æ€§

2. ticker.stop()å¾Œã‚‚å†…éƒ¨çŠ¶æ…‹ãŒæ®‹ã‚‹
   â†’ GLã‚¹ãƒ†ãƒ¼ãƒˆãŒåŠç«¯ãªçŠ¶æ…‹

3. ticker.start()æ™‚ã®å¾©å…ƒä¸å®Œå…¨
   â†’ renderer.shader.reset()ã ã‘ã§ã¯ä¸ååˆ†
   â†’ GL uniformã®locationæƒ…å ±ãŒé™³è…åŒ–

ã€GLçŠ¶æ…‹æ©Ÿæ¢°ç ´å£Šã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã€‘
```
[æ­£å¸¸çŠ¶æ…‹]
GLContext.currentProgram = null

[RasterBrushCoreæç”»é–‹å§‹]
gl.useProgram(brushProgram)
GLContext.currentProgram = brushProgram
location_A = gl.getUniformLocation(brushProgram, "u_matrix")

[PixiJSå‰²ã‚Šè¾¼ã¿ï¼ˆtickeræœªå®Œå…¨åœæ­¢ï¼‰]
gl.useProgram(pixiProgram)
GLContext.currentProgram = pixiProgram
â†’ location_Aã¯ã‚‚ã†brushProgramã®ã‚‚ã®ã§ã¯ãªã„ï¼

[RasterBrushCoreæç”»ç¶šè¡Œ]
gl.uniformMatrix3fv(location_A, ...) 
â†’ ERROR: location is not from the associated program
â†’ GLçŠ¶æ…‹æ©Ÿæ¢°ç ´å£Š
â†’ ä»¥é™ã®å…¨æç”»å¤±æ•—
```

------------------------------------------------------------------------
3.3 æ­£ã—ã„æç”»ãƒ•ãƒ­ãƒ¼ï¼ˆç†æƒ³å½¢ï¼‰
------------------------------------------------------------------------

ã€ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯é–‹å§‹ã€‘
1-3. ï¼ˆåŒä¸Šï¼‰
4. RasterBrushCore.startStroke()
   âœ… pixiApp.ticker.remove(renderFunc) - å®Œå…¨å‰Šé™¤
   âœ… GLã‚¹ãƒ†ãƒ¼ãƒˆä¿å­˜
   âœ… WebGL2 FBOå–å¾—
   âœ… åˆå›ã‚¹ã‚¿ãƒ³ãƒ—æç”»
5. ï¼ˆåŒä¸Šï¼‰

ã€ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯æ›´æ–°ã€‘
6-7. ï¼ˆåŒä¸Šï¼‰
8. RasterBrushCore.addStrokePoint()
   âœ… è£œé–“è¨ˆç®—
   âœ… GLã‚¹ãƒ†ãƒ¼ãƒˆç¢ºèªãƒ»å¾©å…ƒ
   âœ… å„ãƒã‚¤ãƒ³ãƒˆã§WebGL2æç”»å®Ÿè¡Œ
   âœ… æç”»å®Œäº†å¾ŒGLã‚¹ãƒ†ãƒ¼ãƒˆå¾©å…ƒ
9. æ‰‹å‹•renderä¸è¦ï¼ˆtickerãŒåœæ­¢ä¸­ï¼‰

ã€ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯å®Œäº†ã€‘
10-11. ï¼ˆåŒä¸Šï¼‰
12. RasterBrushCore.finalizeStroke()
    âœ… GLã‚¹ãƒ†ãƒ¼ãƒˆå®Œå…¨å¾©å…ƒ
    âœ… gl.useProgram(null) - ãƒ—ãƒ­ã‚°ãƒ©ãƒ è§£é™¤
    âœ… PixiJSç”¨GLã‚¹ãƒ†ãƒ¼ãƒˆå¾©å…ƒ
    âœ… pixiApp.ticker.add(renderFunc) - å†ç™»éŒ²
    âœ… GLTextureBridgeå¤‰æ›
13-14. ï¼ˆåŒä¸Šï¼‰

================================================================================
ç¬¬4éƒ¨: æ”¹ä¿®è¨ˆç”»
================================================================================

------------------------------------------------------------------------
Phase Emergency: ç·Šæ€¥ä¿®æ­£ï¼ˆæœ€å„ªå…ˆãƒ»1-2æ™‚é–“ï¼‰
------------------------------------------------------------------------

ğŸš¨ E-1. PixiJS Tickerå®Œå…¨åˆ¶å¾¡ã®å®Ÿè£…
å¯¾è±¡: raster-brush-core.js
ç›®çš„: GLçŠ¶æ…‹æ©Ÿæ¢°ç ´å£Šã®æ ¹æœ¬åŸå› é™¤å»

ä¿®æ­£å†…å®¹:
1. _stopPixiTicker()ã®å®Œå…¨å†å®Ÿè£…
   - ticker.stop()ã§ã¯ãªãticker.remove(renderCallback)ä½¿ç”¨
   - renderCallbackã‚’ä¿æŒã—ã¦ãŠã
   - å³åº§ã«åœæ­¢åŠ¹æœç™ºæ®

2. _restartPixiTicker()ã®å®Œå…¨å†å®Ÿè£…
   - ticker.add(renderCallback)ã§å†ç™»éŒ²
   - GLã‚¹ãƒ†ãƒ¼ãƒˆå®Œå…¨å¾©å…ƒå¾Œã«å®Ÿè¡Œ

3. GLã‚¹ãƒ†ãƒ¼ãƒˆä¿å­˜/å¾©å…ƒæ©Ÿæ§‹ã®è¿½åŠ 
   ```javascript
   _saveGLState() {
     return {
       program: this.gl.getParameter(this.gl.CURRENT_PROGRAM),
       viewport: this.gl.getParameter(this.gl.VIEWPORT),
       blend: this.gl.getParameter(this.gl.BLEND),
       // ... ä»–ã®GLçŠ¶æ…‹
     };
   }
   
   _restoreGLState(state) {
     this.gl.useProgram(state.program);
     this.gl.viewport(...state.viewport);
     // ... å¾©å…ƒå‡¦ç†
   }
   ```

4. æç”»å‰å¾Œã®GLå®‰å…¨åŒ–
   ```javascript
   addStrokePoint(...) {
     const savedState = this._saveGLState();
     
     try {
       // WebGL2æç”»å‡¦ç†
       this.gl.useProgram(this.brushProgram);
       // ... æç”»
     } finally {
       this._restoreGLState(savedState);
     }
   }
   ```

æœŸå¾…åŠ¹æœ:
- GLçŠ¶æ…‹æ©Ÿæ¢°ç ´å£Šã®å®Œå…¨é˜²æ­¢
- æç”»ä¸­æ–­ã®å®Œå…¨é˜²æ­¢
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ¶ˆæ»…

------------------------------------------------------------------------

ğŸš¨ E-2. WebGL2DrawingLayerã®Tickerç®¡ç†å¼·åŒ–
å¯¾è±¡: webgl2-drawing-layer.js
ç›®çš„: PixiJSé€£æºã®å®Œå…¨åˆ¶å¾¡

ä¿®æ­£å†…å®¹:
1. linkPixiApp()ã®ä¿®æ­£
   - tickerè‡ªå‹•é–‹å§‹ã®æŠ‘åˆ¶
   - renderCallbackã®æ˜ç¤ºçš„ä¿æŒ
   - æ‰‹å‹•renderåˆ¶å¾¡ã¸ã®åˆ‡ã‚Šæ›¿ãˆ

2. æ–°ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ 
   ```javascript
   disablePixiAutoRender() {
     if (this.pixiApp?.ticker) {
       this.savedRenderCallback = this.pixiApp.ticker._head;
       this.pixiApp.ticker.stop();
       // å®Œå…¨ã«callbackå‰Šé™¤
     }
   }
   
   enablePixiAutoRender() {
     if (this.pixiApp?.ticker && this.savedRenderCallback) {
       this.pixiApp.ticker.add(this.savedRenderCallback);
       this.pixiApp.ticker.start();
     }
   }
   ```

æœŸå¾…åŠ¹æœ:
- PixiJSã¨ã®å®Œå…¨ãªæ’ä»–åˆ¶å¾¡
- æç”»ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®å®Œå…¨ç®¡ç†

------------------------------------------------------------------------

ğŸš¨ E-3. Core-Initializerã®åˆæœŸåŒ–ãƒ•ãƒ­ãƒ¼ä¿®æ­£
å¯¾è±¡: core-initializer.js
ç›®çš„: èµ·å‹•æ™‚ã‹ã‚‰tickeråˆ¶å¾¡ã‚’ç¢ºç«‹

ä¿®æ­£å†…å®¹:
1. PixiJS appä½œæˆæ™‚ã®è¨­å®š
   ```javascript
   const pixiApp = new PIXI.Application({
     autoStart: false, // tickerè‡ªå‹•é–‹å§‹ã‚’ç„¡åŠ¹åŒ–
     // ...
   });
   ```

2. åˆæœŸåŒ–å®Œäº†å¾Œã®æ˜ç¤ºçš„tickerç™»éŒ²
   ```javascript
   // WebGL2åˆæœŸåŒ–å®Œäº†å¾Œ
   webgl2Layer.enablePixiAutoRender();
   ```

æœŸå¾…åŠ¹æœ:
- èµ·å‹•æ™‚ã‹ã‚‰ã®å®‰å®šå‹•ä½œ
- åˆå›æç”»æ™‚ã®ã‚¨ãƒ©ãƒ¼é˜²æ­¢

------------------------------------------------------------------------
Phase A: æç”»å“è³ªå‘ä¸Šï¼ˆEå®Œäº†å¾Œãƒ»1-2æ—¥ï¼‰
------------------------------------------------------------------------

A-1. ç­†åœ§ã‚µã‚¤ã‚ºè¨ˆç®—ã®ä¿®æ­£
å¯¾è±¡: raster-brush-core.js:272
å†…å®¹: minPressureSizeè¨­å®šã®æ­£ã—ã„é©ç”¨

A-2. ãƒ–ãƒ©ã‚·ã‚¹ã‚¿ãƒ³ãƒ—ã®å®Œå…¨æ´»ç”¨
å¯¾è±¡: raster-brush-core.js, brush-stamp.js
å†…å®¹:
- generateCircleStamp()ã®å®Œå…¨å®Ÿè£…
- hardnessè¨­å®šã®é©ç”¨
- ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚¹å“è³ªå‘ä¸Š

A-3. è£œé–“ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®æ”¹å–„
å¯¾è±¡: brush-interpolator.js
å†…å®¹:
- ç·šå½¢è£œé–“ â†’ ãƒ™ã‚¸ã‚§æ›²ç·šè£œé–“
- ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³è£œé–“ã®å°å…¥
- é€Ÿåº¦é©å¿œè£œé–“ã®ç²¾åº¦å‘ä¸Š

A-4. ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ã®å®Ÿè£…
å¯¾è±¡: raster-brush-core.js
å†…å®¹:
- config.brush.flowè¨­å®šã®æ´»ç”¨
- opacityç´¯ç©è¨ˆç®—
- highSpeedCompensationå®Ÿè£…

------------------------------------------------------------------------
Phase B: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ•´ç†ï¼ˆAå®Œäº†å¾Œãƒ»2-3æ—¥ï¼‰
------------------------------------------------------------------------

B-1. æœªä½¿ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤
å‰Šé™¤å¯¾è±¡:
- âŒ system/processing/vector-operations.js
  åˆ¤å®š: ãƒ©ã‚¹ã‚¿ãƒ¼æ–¹å¼ã§ã¯ä¸è¦
  
- ğŸ” system/drawing/stroke-transformer.js
  åˆ¤å®š: ä½¿ç”¨ç®‡æ‰€èª¿æŸ»å¾Œæ±ºå®š

B-2. è¨­å®šçµ±ä¸€ã®å®Ÿæ–½
å¯¾è±¡: raster-brush-core.js, pressure-handler.js
å†…å®¹:
- config.jsã‹ã‚‰ã®è¨­å®šå–å¾—ã‚’ä¸€å…ƒåŒ–
- hardness, spacing, antialiasing ã®é©ç”¨
- ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰å€¤ã®å‰Šé™¤

B-3. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®ã‚¯ãƒªãƒ¼ãƒ³åŒ–
å¯¾è±¡: å…¨ãƒ•ã‚¡ã‚¤ãƒ«
å†…å®¹:
- ä¸è¦ãªconsole.logã®å‰Šé™¤
- ãƒ‡ãƒãƒƒã‚°ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰çµŒç”±ã«çµ±ä¸€
- Phase A-Bå®Ÿè£…æ™‚ã«ç¢ºèªä¸è¦ãªãƒ­ã‚°å‰Šé™¤

------------------------------------------------------------------------
Phase C: WebGL2å®Œå…¨å®Ÿè£…ï¼ˆBå®Œäº†å¾Œãƒ»1é€±é–“ï¼‰
------------------------------------------------------------------------

C-1. ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆæˆã®å®Ÿè£…
å¯¾è±¡: webgl2-drawing-layer.js
å†…å®¹:
- compositeRasterLayers()ã®å®Œå…¨å®Ÿè£…
- è¤‡æ•°ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ–ãƒ¬ãƒ³ãƒ‰å‡¦ç†
- æœ€çµ‚å‡ºåŠ›ã®æœ€é©åŒ–

C-2. é«˜åº¦ãªã‚·ã‚§ãƒ¼ãƒ€ãƒ¼æ©Ÿèƒ½
å¯¾è±¡: shader-inline.js, raster-brush-core.js
å†…å®¹:
- ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒ–ãƒ©ã‚·å¯¾å¿œ
- å›è»¢ãƒ»ã‚¹ã‚±ãƒ¼ãƒ«å¯¾å¿œ
- ã‚«ã‚¹ã‚¿ãƒ ãƒ–ãƒ©ã‚·å½¢çŠ¶å¯¾å¿œ

C-3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
å¯¾è±¡: raster-brush-core.js, raster-layer.js
å†…å®¹:
- ãƒãƒƒãƒæç”»ã®å®Ÿè£…
- FBOå†åˆ©ç”¨ã®æœ€é©åŒ–
- ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒ¡ãƒ¢ãƒªç®¡ç†ã®æ”¹å–„

------------------------------------------------------------------------
Phase D: UIæ”¹å–„ï¼ˆCå®Œäº†å¾Œãƒ»1-2æ—¥ï¼‰
------------------------------------------------------------------------

D-1. ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ‘ãƒãƒ«æ©™æ ã®åˆ¶å¾¡
å¯¾è±¡: layer-panel-renderer.js, timeline-ui.js
å†…å®¹: æ—¢å­˜ã®è¨ˆç”»æ›¸é€šã‚Šå®Ÿè£…

D-2. Historyæ¤œè¨¼
å¯¾è±¡: history.js, keyboard-handler.js
å†…å®¹: äºŒé‡ç™»éŒ²ã®æœ€çµ‚ç¢ºèª

================================================================================
ç¬¬5éƒ¨: å®Ÿè£…å„ªå…ˆé †ä½ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
================================================================================

ã€æœ€å„ªå…ˆã€‘Phase Emergencyï¼ˆ1-2æ™‚é–“ï¼‰
ç†ç”±: ç¾åœ¨æç”»ä¸èƒ½ãƒ»ã‚·ã‚¹ãƒ†ãƒ æ©Ÿèƒ½ä¸å…¨
å†…å®¹:
  E-1: PixiJS Tickerå®Œå…¨åˆ¶å¾¡ â†’ 1æ™‚é–“
  E-2: WebGL2DrawingLayerå¼·åŒ– â†’ 30åˆ†
  E-3: Core-Initializerä¿®æ­£ â†’ 30åˆ†
å®Œäº†æ¡ä»¶:
  âœ… ãƒšãƒ³æç”»æ™‚ã«ã‚­ãƒ£ãƒ³ãƒã‚¹ãŒæ¶ˆãˆãªã„
  âœ… WebGLã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºãªã„
  âœ… é€£ç¶šæç”»ãŒæ­£å¸¸å‹•ä½œ

ã€é«˜å„ªå…ˆã€‘Phase Aï¼ˆ1-2æ—¥ï¼‰
ç†ç”±: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å¤§å¹…æ”¹å–„
å‰æ: Phase Emergencyå®Œäº†
å®Œäº†æ¡ä»¶:
  âœ… ç­†åœ§è¨­å®šãŒæ­£ã—ãåæ˜ 
  âœ… ãƒ–ãƒ©ã‚·ãŒæ»‘ã‚‰ã‹ã«è¦‹ãˆã‚‹
  âœ… ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ãŒæ©Ÿèƒ½

ã€ä¸­å„ªå…ˆã€‘Phase Bï¼ˆ2-3æ—¥ï¼‰
ç†ç”±: ä¿å®ˆæ€§å‘ä¸Šãƒ»æŠ€è¡“çš„è² å‚µè§£æ¶ˆ
å‰æ: Phase Aå®Œäº†
å®Œäº†æ¡ä»¶:
  âœ… æœªä½¿ç”¨ã‚³ãƒ¼ãƒ‰å‰Šé™¤
  âœ… è¨­å®šå‚ç…§ã®çµ±ä¸€
  âœ… ã‚³ãƒ¼ãƒ‰ãŒã‚¯ãƒªãƒ¼ãƒ³

ã€ä½å„ªå…ˆã€‘Phase Cï¼ˆ1é€±é–“ï¼‰
ç†ç”±: å¤§è¦æ¨¡æ”¹ä¿®ãƒ»åŸºæœ¬æ©Ÿèƒ½ã¯å‹•ä½œä¸­
å‰æ: Phase Bå®Œäº†
å®Œäº†æ¡ä»¶:
  âœ… ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆæˆå®Ÿè£…
  âœ… é«˜åº¦ãªãƒ–ãƒ©ã‚·æ©Ÿèƒ½
  âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

ã€æœ€ä½å„ªå…ˆã€‘Phase Dï¼ˆ1-2æ—¥ï¼‰
ç†ç”±: UIæ”¹å–„ãƒ»æ©Ÿèƒ½çš„å•é¡Œãªã—
å‰æ: Phase Cå®Œäº†
å®Œäº†æ¡ä»¶:
  âœ… UIå‹•ä½œã®æ´—ç·´
  âœ… Historyå®Œå…¨æ¤œè¨¼

================================================================================
ç¬¬6éƒ¨: ãƒ†ã‚¹ãƒˆé …ç›®
================================================================================

Phase Emergencyå®Œäº†æ™‚:
â–¡ ãƒšãƒ³ã§ç·šãŒå¼•ã‘ã‚‹ï¼ˆåŸºæœ¬å‹•ä½œï¼‰
â–¡ é€£ç¶š10ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯æç”»ã—ã¦ã‚‚å•é¡Œãªã—
â–¡ WebGLã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºãªã„
â–¡ ã‚­ãƒ£ãƒ³ãƒã‚¹ãŒæ¶ˆãˆãªã„
â–¡ Undo/RedoãŒæ­£å¸¸å‹•ä½œ
â–¡ ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ‡ã‚Šæ›¿ãˆãŒæ­£å¸¸å‹•ä½œ

Phase Aå®Œäº†æ™‚:
â–¡ ç­†åœ§0.0è¨­å®šã§æ¥µç´°ç·šãŒæã‘ã‚‹
â–¡ ç­†åœ§1.0è¨­å®šã§å›ºå®šå¤ªã•ã«ãªã‚‹
â–¡ ãƒ–ãƒ©ã‚·ã‚¨ãƒƒã‚¸ãŒæ»‘ã‚‰ã‹
â–¡ é«˜é€Ÿã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ã§ã‚‚é€”åˆ‡ã‚Œãªã„
â–¡ ãƒ•ãƒ­ãƒ¼è¨­å®šã§é€æ˜æ„ŸãŒèª¿æ•´ã§ãã‚‹

Phase Bå®Œäº†æ™‚:
â–¡ ä¸è¦ãªã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ãŒå‡ºãªã„
â–¡ è¨­å®šå¤‰æ›´ãŒå³åº§ã«åæ˜ 
â–¡ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ãŒã‚¯ãƒªãƒ¼ãƒ³

Phase Cå®Œäº†æ™‚:
â–¡ è¤‡æ•°ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åˆæˆãŒæ­£å¸¸
â–¡ ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒ–ãƒ©ã‚·ãŒä½¿ãˆã‚‹
â–¡ å¤§ããªãƒ–ãƒ©ã‚·ã§ã‚‚60fpsç¶­æŒ

Phase Då®Œäº†æ™‚:
â–¡ UIãŒæ´—ç·´ã•ã‚Œã¦ã„ã‚‹
â–¡ Historyå‹•ä½œãŒå®Œç’§

================================================================================
ç¬¬7éƒ¨: ãƒ‡ãƒãƒƒã‚°æŒ‡é‡
================================================================================

ã€Phase Emergencyå®Ÿè£…æ™‚ã€‘
1. ãƒ–ãƒ©ã‚¦ã‚¶DevToolsã§WebGLã‚¨ãƒ©ãƒ¼ç›£è¦–
2. `window.rasterBrushCore`ã§GLçŠ¶æ…‹ç¢ºèª
3. `window.pixiApp.ticker.started`ã§tickerçŠ¶æ…‹ç¢ºèª
4. æç”»å‰å¾Œã§GLã‚¹ãƒ†ãƒ¼ãƒˆæ¯”è¼ƒ

ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰ã€‘
```javascript
// GLçŠ¶æ…‹ç¢ºèª
console.log('GL Program:', window.GLContext.gl.getParameter(
  window.GLContext.gl.CURRENT_PROGRAM
));

// TickerçŠ¶æ…‹ç¢ºèª
console.log('Ticker:', {
  started: window.pixiApp.ticker.started,
  count: window.pixiApp.ticker.count
});

// RasterBrushCoreçŠ¶æ…‹ç¢ºèª
console.log('RasterBrushCore:', {
  isDrawing: window.rasterBrushCore.isDrawing,
  currentStroke: window.rasterBrushCore.currentStroke
});
```

ã€æ®µéšçš„æ¤œè¨¼ã€‘
1. E-1å®Ÿè£… â†’ 1ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯æç”»ãƒ†ã‚¹ãƒˆ
2. E-2å®Ÿè£… â†’ é€£ç¶š3ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯æç”»ãƒ†ã‚¹ãƒˆ
3. E-3å®Ÿè£… â†’ ã‚¢ãƒ—ãƒªå†èµ·å‹•ãƒ†ã‚¹ãƒˆ
4. å…¨ä½“ â†’ 10ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯é€£ç¶šãƒ†ã‚¹ãƒˆ

ã€å•é¡ŒãŒç¶šãå ´åˆã€‘
- PixiJS tickerã‚’å®Œå…¨å‰Šé™¤ã—ã¦requestAnimationFrame()è‡ªä½œã‚’æ¤œè¨
- GLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å®Œå…¨åˆ†é›¢ï¼ˆåˆ¥ã‚­ãƒ£ãƒ³ãƒã‚¹ä½¿ç”¨ï¼‰
- PixiJSã‚’è¡¨ç¤ºå°‚ç”¨ã€WebGL2ã‚’æç”»å°‚ç”¨ã«å®Œå…¨åˆ†é›¢

================================================================================
ç¬¬8éƒ¨: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ”¹å–„ææ¡ˆï¼ˆå°†æ¥æ¤œè¨ï¼‰
================================================================================

ã€ææ¡ˆ1ã€‘GLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå®Œå…¨åˆ†é›¢
ç¾çŠ¶: PixiJSã¨WebGL2ãŒåŒä¸€GLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå…±æœ‰
å•é¡Œ: çŠ¶æ…‹æ©Ÿæ¢°ç«¶åˆã®ãƒªã‚¹ã‚¯
æ”¹å–„æ¡ˆ:
- æç”»ç”¨WebGL2ã‚­ãƒ£ãƒ³ãƒã‚¹ï¼ˆéè¡¨ç¤ºï¼‰
- è¡¨ç¤ºç”¨PixiJSã‚­ãƒ£ãƒ³ãƒã‚¹ï¼ˆè¡¨ç¤ºï¼‰
- æç”»å®Œäº†å¾Œã«Textureè»¢é€

ãƒ¡ãƒªãƒƒãƒˆ:
âœ… GLçŠ¶æ…‹ç«¶åˆã®å®Œå…¨å›é¿
âœ… å„ã‚·ã‚¹ãƒ†ãƒ ã®ç‹¬ç«‹æ€§å‘ä¸Š
âœ… ãƒ‡ãƒãƒƒã‚°ã®å®¹æ˜“åŒ–

ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:
âš ï¸ Textureè»¢é€ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰
âš ï¸ ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡å¢—åŠ 
âš ï¸ å®Ÿè£…ã‚³ã‚¹ãƒˆ

ã€ææ¡ˆ2ã€‘PixiJSå®Œå…¨å‰Šé™¤
ç¾çŠ¶: UIè¡¨ç¤ºã«PixiJSä½¿ç”¨
æ”¹å–„æ¡ˆ:
- ãƒ¬ã‚¤ãƒ¤ãƒ¼è¡¨ç¤º: CSS + Canvas2D
- WebGL2ã®ã¿ã§æç”»å®Ÿè¡Œ
- requestAnimationFrame()è‡ªä½œ

ãƒ¡ãƒªãƒƒãƒˆ:
âœ… ä¾å­˜é–¢ä¿‚ã®å˜ç´”åŒ–
âœ… ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå‰Šæ¸›
âœ… å®Œå…¨ãªåˆ¶å¾¡æ¨©

ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:
âš ï¸ å¤§è¦æ¨¡ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¿…è¦
âš ï¸ UIãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’è‡ªä½œå¿…è¦
âš ï¸ é–‹ç™ºã‚³ã‚¹ãƒˆå¤§

ã€ææ¡ˆ3ã€‘OffscreenCanvasæ´»ç”¨
ç¾çŠ¶: ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§æç”»
æ”¹å–„æ¡ˆ:
- Web Workerã§ãƒ–ãƒ©ã‚·æç”»
- OffscreenCanvasã§WebGL2å®Ÿè¡Œ
- ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã¯UIå°‚å¿µ

ãƒ¡ãƒªãƒƒãƒˆ:
âœ… UIã®å¿œç­”æ€§å‘ä¸Š
âœ… æç”»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š
âœ… ä¸¦åˆ—å‡¦ç†æ´»ç”¨

ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:
âš ï¸ ãƒ–ãƒ©ã‚¦ã‚¶ã‚µãƒãƒ¼ãƒˆè¦ç¢ºèª
âš ï¸ Workeré€šä¿¡ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰
âš ï¸ ãƒ‡ãƒãƒƒã‚°é›£åº¦ä¸Šæ˜‡

åˆ¤å®š: Phase Emergency-DãŒå®Œäº†ã—ã€å®‰å®šç¨¼åƒå¾Œã«æ¤œè¨

================================================================================
ç¬¬9éƒ¨: ã¾ã¨ã‚
================================================================================

ã€ç¾çŠ¶è©•ä¾¡ã€‘
å…¨ä½“é€²æ—: 65%
- åŸºæœ¬æ§‹é€ : âœ… å®Œæˆ
- æç”»ã‚·ã‚¹ãƒ†ãƒ : ğŸš¨ æ©Ÿèƒ½ä¸å…¨ï¼ˆPhase Emergencyã§ä¿®æ­£ï¼‰
- WebGL2å®Ÿè£…: âš ï¸ 70%å®Œæˆ
- UI: âœ… æ­£å¸¸å‹•ä½œ

ã€é‡å¤§å•é¡Œã€‘
ğŸš¨ PixiJSã¨WebGL2ã®GLçŠ¶æ…‹æ©Ÿæ¢°ç«¶åˆ
â†’ Phase Emergencyã§1-2æ™‚é–“ã§è§£æ±ºå¯èƒ½

ã€æŠ€è¡“çš„è² å‚µã€‘
âš ï¸ æœªä½¿ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã®æ®‹å­˜
âš ï¸ è¨­å®šå‚ç…§ã®ä¸çµ±ä¸€
âš ï¸ éå‰°ãªã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°
â†’ Phase Bã§è§£æ¶ˆ

ã€æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€‘
1. Phase Emergencyå®Ÿè£…ï¼ˆæœ€å„ªå…ˆãƒ»1-2æ™‚é–“ï¼‰
2. å‹•ä½œç¢ºèªï¼ˆ10ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯é€£ç¶šæç”»ãƒ†ã‚¹ãƒˆï¼‰
3. Phase Aå®Ÿè£…é–‹å§‹

ã€æˆåŠŸã®éµã€‘
âœ… GLã‚¹ãƒ†ãƒ¼ãƒˆä¿å­˜/å¾©å…ƒã®å®Œå…¨å®Ÿè£…
âœ… PixiJS tickeråˆ¶å¾¡ã®å®Œå…¨ç†è§£
âœ… æ®µéšçš„ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼ã®å¾¹åº•

================================================================================
END OF DOCUMENT
================================================================================