# ãƒ–ãƒ©ã‚¦ã‚¶ãŠçµµã‹ããƒ„ãƒ¼ãƒ« v8.13 - Canvas2Då»ƒæ­¢ãƒ»ã‚µãƒ ãƒã‚¤ãƒ«çµ±ä¸€æ”¹ä¿®è¨ˆç”»

## èƒŒæ™¯ã¨å•é¡Œç‚¹

ç¾çŠ¶ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹(v8.13_Drawing_55)ã§ã®ã‚µãƒ ãƒã‚¤ãƒ«å®Ÿè£…ï¼š
- layer-panel-renderer.js: generateLayerThumbnailCanvas() ã§ Canvas2D ã‚’ä½¿ç”¨
- timeline-thumbnail-utils.js: generateThumbnail() ã§ Canvas2D ã‚’ä½¿ç”¨
- Canvas2D ã¨ PixiJS ã® DPI/è‰²ç©ºé–“ã‚ºãƒ¬ã«ã‚ˆã‚Šã€ã‚µãƒ ãƒã‚¤ãƒ«ãŒå¤ã„æƒ…å ±ã‚’è¡¨ç¤º
- Vãƒ¢ãƒ¼ãƒ‰ç·¨é›†ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼å¤‰å½¢ï¼‰ãŒãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«ã«åæ˜ ã•ã‚Œãªã„
- Vã‚­ãƒ¼åè»¢ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãŒåŠ¹ã„ã¦ã„ãªã„

æ ¹æœ¬åŸå› ï¼š
- ã‚µãƒ ãƒã‚¤ãƒ«ç”ŸæˆãŒçµ±ä¸€ã•ã‚Œã¦ã„ãªã„ï¼ˆ2ã¤ã®åˆ¥å®Ÿè£…ï¼‰
- Canvas2D ã§ç”Ÿæˆã•ã‚ŒãŸã‚µãƒ ãƒã‚¤ãƒ«ãŒã€PixiJS å†…éƒ¨ã®åº§æ¨™ç³»ã¨åŒæœŸã—ã¦ã„ãªã„
- ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­ã¨æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ã‚ºãƒ¬

æ”¹ä¿®æ–¹é‡ï¼ˆv2.2ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³æº–æ‹ ï¼‰ï¼š
- Canvas2D å®Œå…¨å»ƒæ­¢
- PixiJS renderer.extract.imageBitmap() ã§çµ±ä¸€
- å°‚ç”¨ã® thumbnail-system.js ä½œæˆï¼ˆè²¬å‹™åˆ†é›¢ï¼‰
- EventBus ã‚¤ãƒ™ãƒ³ãƒˆçµ±åˆ

---

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã¨ç¾çŠ¶åˆ†æ

### ç¾åœ¨ã®å•é¡Œã‚³ãƒ¼ãƒ‰ä½ç½®

**layer-panel-renderer.js (69è¡Œï½ï¼šgenerateLayerThumbnailCanvas)**
```
âŒ Canvas2D ã‚’ä½¿ç”¨ï¼ˆctx.fillStyle, ctx.drawImageç­‰ï¼‰
âŒ å¤‰å½¢é©ç”¨ãƒ­ã‚¸ãƒƒã‚¯ãŒã‚ã‚‹ãŒã€å¤ã„æƒ…å ±ã‚’å‚ç…§
âŒ åº§æ¨™è¨ˆç®—ã§ç²¾åº¦ãƒ­ã‚¹
```

**timeline-thumbnail-utils.js (35è¡Œï½ï¼šgenerateThumbnail)**
```
âŒ Canvas2D ã‚’ä½¿ç”¨ï¼ˆthumbCtx.drawImage, putImageDataç­‰ï¼‰
âŒ renderer.extract.pixels ã‚’ä½¿ã†ãŒã€ãã®å¾Œ Canvas2D ã§å‡¦ç†
âŒ äºŒé‡å¤‰æ›ã«ã‚ˆã‚‹å“è³ªåŠ£åŒ–
```

**layer-system.jsï¼ˆæ—¢å­˜ãƒ»ç¶™ç¶šä½¿ç”¨ï¼‰**
```
âœ… requestThumbnailUpdate() ã§ dirty ãƒ•ãƒ©ã‚°ç®¡ç†
âœ… layer:transform-updated ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«
âš ï¸ ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ã®ãã£ã‹ã‘ã‚’çµ±ä¸€ã™ã‚‹å¿…è¦ã‚ã‚Š
```

**drawing-engine.jsï¼ˆæ—¢å­˜ãƒ»ç¶™ç¶šä½¿ç”¨ï¼‰**
```
âœ… åº§æ¨™ç³»ã®æ­£ç¢ºãªå¤‰æ›å®Ÿè£…
âœ… stroke:* ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«
âœ… currentToolï¼ˆpen/eraserï¼‰ç®¡ç†
âš ï¸ eraser ã®åè»¢ãƒ­ã‚¸ãƒƒã‚¯ãŒ layer:transform ã¨ã®é€£æºä¸è¶³
```

---

## Phase 1: çµ±ä¸€ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰

### ç›®çš„
Canvas2D ã‚’å»ƒæ­¢ã—ã€PixiJS å†…éƒ¨ API ã§çµ±ä¸€ã•ã‚ŒãŸã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆã‚’å®Ÿè£…

### æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«: thumbnail-system.js

**è²¬å‹™ï¼š**
- renderer.extract.imageBitmap() ã«ã‚ˆã‚‹é«˜ç²¾åº¦ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ
- ã‚µãƒ ãƒã‚¤ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†
- åº§æ¨™ç³»å®Œå…¨ä¸€è‡´ï¼ˆDPI/è‰²ç©ºé–“ï¼‰

**ä¾å­˜ï¼š**
- coordinate-system.jsï¼ˆåº§æ¨™ç³»å‚ç…§ã®ã¿ï¼‰
- event-bus.jsï¼ˆã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­ï¼‰

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰ï¼š**
```javascript
class ThumbnailSystem {
  constructor(app, coordinateSystem, config)
  
  init(eventBus)                           // åˆæœŸåŒ–ã€ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­
  
  generateLayerThumbnail(layer, width, height, dpi)
    â†’ Returns: ImageBitmap
    ç”¨é€”ï¼šãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«å€‹åˆ¥ã‚µãƒ ãƒã‚¤ãƒ«
    å‡¦ç†ï¼š
      1. layer ã‚’å¯¾è±¡ã« renderer.render({container: layer, target: rt})
      2. renderer.extract.imageBitmap(rt) ã§å–å¾—
      3. å¤‰å½¢æ¸ˆã¿ã®åº§æ¨™ç³»ãŒè‡ªå‹•åæ˜ 
  
  generateFrameThumbnail(frame, width, height)
    â†’ Returns: ImageBitmap
    ç”¨é€”ï¼šã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚µãƒ ãƒã‚¤ãƒ«
    å‡¦ç†ï¼š
      1. frame.container å…¨ä½“ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
      2. renderer.extract.imageBitmap() ã§å–å¾—
      3. ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ä¿æŒã§ãƒªã‚µã‚¤ã‚º
  
  invalidateLayerCache(layerIndex)         // æŒ‡å®šãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
  invalidateFrameCache(frameIndex)         // æŒ‡å®šãƒ•ãƒ¬ãƒ¼ãƒ ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
  clearAllCache()                          // å…¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
  
  _convertImageBitmapToDataURL(bitmap, canvas)
    â†’ Returns: DataURL (string)
    å‡¦ç†ï¼š
      1. canvas ã« bitmap ã‚’ drawImage
      2. canvas.toDataURL('image/png')
      3. bitmap ãƒªã‚½ãƒ¼ã‚¹ç ´æ£„
}
```

**åˆæœŸåŒ–é †åºï¼ˆcore-runtime.js ã§ç™»éŒ²ï¼‰ï¼š**
```
Phase 3: ThumbnailSystem.init(eventBus)
  â†“
  ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­ï¼š
  - 'layer:transform-updated'  â†’ invalidateLayerCache + updateRequest
  - 'layer:path-added'          â†’ invalidateLayerCache + updateRequest
  - 'layer:stroke-added'        â†’ invalidateLayerCache + updateRequest
  - 'layer:flip-horizontal'     â†’ invalidateLayerCache + updateRequest
  - 'layer:flip-vertical'       â†’ invalidateLayerCache + updateRequest
  - 'animation:frame-updated'   â†’ invalidateFrameCache + updateRequest
  - 'camera:resized'            â†’ clearAllCache + regenerateAll
```

### æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«: layer-panel-renderer.js

**å‰Šé™¤å¯¾è±¡ï¼š**
- generateLayerThumbnailCanvas() å…¨ä½“ï¼ˆ69è¡Œï½ï¼‰
- createThumbnail() å†…ã® Canvas2D ãƒ­ã‚¸ãƒƒã‚¯

**æ–°è¦å®Ÿè£…ï¼š**
```javascript
async createThumbnail(layer, index, animationSystem) {
  const thumbnail = document.createElement('div');
  thumbnail.className = 'layer-thumbnail';
  
  if (layer.layerData?.isBackground) {
    // èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯å¾“æ¥é€šã‚Šè‰²ãƒ‘ãƒƒãƒè¡¨ç¤º
    const swatch = document.createElement('div');
    swatch.style.backgroundColor = '#F0E0D6';
    thumbnail.appendChild(swatch);
    return thumbnail;
  }
  
  // ThumbnailSystem ã‹ã‚‰ ImageBitmap ã‚’å–å¾—
  const bitmap = await window.ThumbnailSystem.generateLayerThumbnail(
    layer,
    64,  // å¹…
    64   // é«˜ã•
  );
  
  if (bitmap) {
    const img = document.createElement('img');
    img.src = await window.ThumbnailSystem._convertImageBitmapToDataURL(bitmap, ...);
    img.alt = 'Layer thumbnail';
    img.style.objectFit = 'contain';
    thumbnail.appendChild(img);
  }
  
  return thumbnail;
}

_setupEventListeners() {
  // å¾“æ¥ã®ã‚¿ã‚¤ãƒãƒ¼ãƒ™ãƒ¼ã‚¹æ›´æ–°ã¯å‰Šé™¤
  // EventBus ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­ã«çµ±ä¸€
  
  this.eventBus.on('thumbnail:layer-updated', ({ layerIndex }) => {
    this.updateLayerThumbnail(layerIndex);
  });
  
  this.eventBus.on('thumbnail:regenerate-all', () => {
    this.updateAllThumbnails();
  });
}
```

**æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«è©³ç´°ï¼š**
- generateLayerThumbnailCanvas() ã®å‰Šé™¤ï¼ˆ69è¡Œï½150è¡Œï¼‰
- createThumbnail() ç°¡ç•¥åŒ–ï¼ˆCanvas2D è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯å‰Šé™¤ï¼‰
- updateAllThumbnails() ã§ã® async/await å¯¾å¿œ
- _setupEventListeners() ã®ã‚¤ãƒ™ãƒ³ãƒˆçµ±ä¸€

### æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«: timeline-thumbnail-utils.js

**å‰Šé™¤å¯¾è±¡ï¼š**
- generateThumbnail() å†…ã® Canvas2D ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆ35è¡Œï½100è¡Œï¼‰
- _cloneGraphics() ãŒ Graphics å†æ§‹ç¯‰ã‚’è¤‡é›‘åŒ–

**æ–°è¦å®Ÿè£…ï¼š**
```javascript
async generateThumbnail(frame) {
  const cacheKey = `frame_${frame.id}`;
  
  if (this.thumbnailCache.has(cacheKey)) {
    return this.thumbnailCache.get(cacheKey);
  }
  
  // ThumbnailSystem ã‹ã‚‰ ImageBitmap ã‚’å–å¾—
  const bitmap = await window.ThumbnailSystem.generateFrameThumbnail(
    frame,
    150,  // maxWidth
    150   // maxHeight
  );
  
  if (bitmap) {
    const dataURL = await window.ThumbnailSystem._convertImageBitmapToDataURL(bitmap, ...);
    this.thumbnailCache.set(cacheKey, dataURL);
    return dataURL;
  }
  
  return null;
}

_setupCameraTransformListener() {
  // å¾“æ¥ã®ã‚¿ã‚¤ãƒãƒ¼ãƒ™ãƒ¼ã‚¹ invalidate ã‚’å‰Šé™¤
  this.eventBus.on('thumbnail:regenerate-all', () => {
    this._invalidateCache();
    // éåŒæœŸã§å†ç”Ÿæˆ
    setTimeout(() => this.updateAllThumbnails(), 50);
  });
}
```

**æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«è©³ç´°ï¼š**
- generateThumbnail() å†…ã® renderTexture + pixels + Canvas2D ãƒ­ã‚¸ãƒƒã‚¯å‰Šé™¤
- _cloneGraphics() ã®å‰Šé™¤ï¼ˆGraphics ã‚¯ãƒ­ãƒ¼ãƒ³ä¸è¦ï¼‰
- ThumbnailSystem ã® async ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å¯¾å¿œ
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã®çµ±ä¸€

---

## Phase 2: ã‚¤ãƒ™ãƒ³ãƒˆçµ±åˆã¨æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼

### ç›®çš„
ãƒ¬ã‚¤ãƒ¤ãƒ¼å¤‰å½¢ãƒ»ãƒšãƒ³æç”»ãƒ»æ¶ˆã—ã‚´ãƒ æ“ä½œãŒã‚µãƒ ãƒã‚¤ãƒ«ã«å³åº§ã«åæ˜ ã•ã‚Œã‚‹ã“ã¨ã‚’ä¿è¨¼

### æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«: layer-system.js

**è¿½åŠ ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ãƒã‚¤ãƒ³ãƒˆï¼š**

```javascript
flipActiveLayer(direction) {
  // æ—¢å­˜ã®åè»¢ãƒ­ã‚¸ãƒƒã‚¯...
  
  // è¿½åŠ ï¼šã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼
  const activeIndex = this.activeLayerIndex;
  this.requestThumbnailUpdate(activeIndex);
  
  if (this.eventBus) {
    // layer:transform-updated ã¯æ—¢å­˜ã€ã•ã‚‰ã« flip å°‚ç”¨ã‚‚ç™ºç«
    this.eventBus.emit('layer:flip-' + direction);
    this.eventBus.emit('thumbnail:layer-updated', { 
      layerIndex: activeIndex,
      layerId: this.getActiveLayer().layerData.id
    });
  }
}

onTransformComplete() {
  // Vã‚­ãƒ¼å¤‰å½¢å®Œäº†æ™‚
  
  const layer = this.getActiveLayer();
  const layerIndex = this.activeLayerIndex;
  
  this.requestThumbnailUpdate(layerIndex);
  
  if (this.eventBus) {
    this.eventBus.emit('layer:transform-confirmed', {
      layerId: layer.layerData.id
    });
    
    // ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼ï¼ˆåŒæœŸï¼‰
    this.eventBus.emit('thumbnail:layer-updated', {
      layerIndex: layerIndex,
      layerId: layer.layerData.id
    });
  }
  
  if (this.animationSystem?.generateFrameThumbnail) {
    const frameIndex = this.animationSystem.getCurrentFrameIndex();
    setTimeout(() => {
      this.animationSystem.generateFrameThumbnail(frameIndex);
    }, 100);
  }
}

addPathToActiveLayer(path) {
  // æ—¢å­˜ã®ãƒ‘ã‚¹è¿½åŠ ãƒ­ã‚¸ãƒƒã‚¯...
  
  // è¿½åŠ ï¼šã‚¤ãƒ™ãƒ³ãƒˆçµ±ä¸€
  this.eventBus.emit('layer:stroke-added', {
    layerIndex: this.activeLayerIndex,
    layerId: this.getActiveLayer().layerData.id
  });
  
  // ã‚µãƒ ãƒã‚¤ãƒ«å³æ™‚æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼
  this.eventBus.emit('thumbnail:layer-updated', {
    layerIndex: this.activeLayerIndex,
    layerId: this.getActiveLayer().layerData.id
  });
}
```

### æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«: drawing-engine.js

**è¿½åŠ ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ãƒã‚¤ãƒ³ãƒˆï¼š**

```javascript
stopDrawing() {
  // æ—¢å­˜ã®ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ç¢ºå®šãƒ­ã‚¸ãƒƒã‚¯...
  
  if (this.currentLayer && strokeData.points.length > 0) {
    const layerIndex = this.layerSystem.getLayerIndex(this.currentLayer);
    
    if (this.eventBus) {
      // æ—¢å­˜ã‚¤ãƒ™ãƒ³ãƒˆ
      this.eventBus.emit('stroke:finalized', { /* ... */ });
      
      // è¿½åŠ ï¼šã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼ï¼ˆåº§æ¨™ç³»å®Œå…¨åŒæœŸï¼‰
      this.eventBus.emit('thumbnail:layer-updated', {
        layerIndex: layerIndex,
        layerId: this.currentLayer.layerData.id,
        tool: this.currentTool
      });
    }
  }
}

setTool(toolName) {
  this.currentTool = toolName;
  
  if (this.eventBus) {
    this.eventBus.emit('tool:changed', { tool: toolName });
    
    // æ¶ˆã—ã‚´ãƒ ãƒ„ãƒ¼ãƒ«åˆ‡æ›¿æ™‚ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°
    if (toolName === 'eraser') {
      const activeLayer = this.layerSystem?.getActiveLayer?.();
      if (activeLayer) {
        const layerIndex = this.layerSystem.getLayerIndex(activeLayer);
        this.eventBus.emit('thumbnail:layer-updated', {
          layerIndex: layerIndex,
          layerId: activeLayer.layerData.id,
          tool: toolName
        });
      }
    }
  }
}
```

### æ”¹ä¿®ãƒ•ã‚¡ã‚¤ãƒ«: layer-transform.js

**è¿½åŠ ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ãƒã‚¤ãƒ³ãƒˆï¼ˆæ—¢å­˜ã ãŒåŒæœŸã‚’å¼·åŒ–ï¼‰ï¼š**

```javascript
toggleMoveMode(layer) {
  // Vã‚­ãƒ¼æ™‚ã®æ—¢å­˜ãƒ­ã‚¸ãƒƒã‚¯...
  
  if (this.isVKeyPressed) {
    // çµ‚äº†æ™‚
    this.exitMoveMode(layer);
    
    if (this.eventBus) {
      // Vãƒ¢ãƒ¼ãƒ‰çµ‚äº†æ™‚ã®æœ€çµ‚æ›´æ–°
      this.eventBus.emit('thumbnail:layer-updated', {
        layerIndex: this.layerManager?.getLayerIndex(layer),
        layerId: layer.layerData?.id
      });
    }
  } else {
    // é–‹å§‹æ™‚
    this.enterMoveMode();
  }
}

updateTransform(layer, property, value) {
  // property: 'x', 'y', 'rotation', 'scaleX', 'scaleY'
  
  // æ—¢å­˜ã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯...
  
  if (this.eventBus && !this.isDragging) {
    // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã§ãªã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§æ›´æ–°ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ï¼‰
    this.eventBus.emit('thumbnail:layer-updated-live', {
      layerIndex: this.layerManager?.getLayerIndex(layer),
      layerId: layer.layerData?.id,
      property: property,
      value: value
    });
  }
}
```

### EventBus ã‚¤ãƒ™ãƒ³ãƒˆåçµ±ä¸€

**æ–°è¦ã‚¤ãƒ™ãƒ«å®šç¾©ï¼ˆEventBus ã§ã®ç™ºç«ï¼‰ï¼š**

| ã‚¤ãƒ™ãƒ³ãƒˆå | ç™ºè¡Œå…ƒ | ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ | ç”¨é€” |
|-----------|--------|-----------|------|
| `thumbnail:layer-updated` | layer-system, drawing-engine, layer-transform | `{ layerIndex, layerId, tool? }` | ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ãƒªã‚¯ã‚¨ã‚¹ãƒˆ |
| `thumbnail:frame-updated` | animation-system | `{ frameIndex, frameId }` | ãƒ•ãƒ¬ãƒ¼ãƒ ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ãƒªã‚¯ã‚¨ã‚¹ãƒˆ |
| `thumbnail:regenerate-all` | camera-system (resize) | ãªã— | å…¨ã‚µãƒ ãƒã‚¤ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ + å†ç”Ÿæˆ |
| `thumbnail:layer-updated-live` | layer-transform | `{ layerIndex, layerId, property, value }` | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ï¼ˆãƒ‰ãƒ©ãƒƒã‚°ä¸­ï¼‰ |

---

## Phase 3: åº§æ¨™ç³»ç²¾åº¦ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼

### ç›®çš„
Canvas2D å»ƒæ­¢å¾Œã€ã‚µãƒ ãƒã‚¤ãƒ«ãŒæ­£ç¢ºã«æç”»ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

### ãƒ†ã‚¹ãƒˆé …ç›®

**åŸºæœ¬åº§æ¨™ç³»ãƒ†ã‚¹ãƒˆï¼ˆæ—¢å­˜ãƒ†ã‚¹ãƒˆã€Phase 1-2å¾Œã®å†æ¤œè¨¼ï¼‰ï¼š**
1. âœ… åˆæœŸçŠ¶æ…‹ã§ãƒšãƒ³ä½ç½®ã¨æç”»ä½ç½®ãŒä¸€è‡´
2. âœ… ã‚ºãƒ¼ãƒ å¾Œã‚‚æç”»ä½ç½®ãŒæ­£ç¢ºï¼ˆrenderer.extract ã§ã¯ DPIè‡ªå‹•å¯¾å¿œï¼‰
3. âœ… ãƒ‘ãƒ³å¾Œã‚‚æç”»ä½ç½®ãŒæ­£ç¢º
4. âœ… ãƒ¬ã‚¤ãƒ¤ãƒ¼ç§»å‹•å¾Œã‚‚æç”»ä½ç½®ãŒæ­£ç¢º
5. âœ… Canvas resize å¾Œã‚‚æç”»ä½ç½®ãŒæ­£ç¢º
6. âœ… Retina/DPI ç’°å¢ƒã§æç”»ä½ç½®ãŒæ­£ç¢º

**ã‚µãƒ ãƒã‚¤ãƒ«çµ±ä¸€ãƒ†ã‚¹ãƒˆï¼ˆPhase 1-2æ–°è¦è¿½åŠ ï¼‰ï¼š**

7. ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚µãƒ ãƒã‚¤ãƒ«ãŒæœ€æ–°æƒ…å ±ã‚’è¡¨ç¤º
   - æ¡ä»¶ï¼šãƒšãƒ³æç”»ç›´å¾Œã€ã‚µãƒ ãƒã‚¤ãƒ«ãƒ‘ãƒãƒ«ç¢ºèª
   - æœŸå¾…ï¼šã‚µãƒ ãƒã‚¤ãƒ«ã«æ–°è¦ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ãŒå³åº§ã«è¡¨ç¤º
   - ç¢ºèªæ–¹æ³•ï¼šlayer-panel-renderer ã® updateLayerThumbnail() ã§å†å–å¾—

8. Vãƒ¢ãƒ¼ãƒ‰ç·¨é›†ãŒã‚µãƒ ãƒã‚¤ãƒ«ã«åæ˜ 
   - æ¡ä»¶ï¼šVã‚­ãƒ¼ â†’ ãƒ¬ã‚¤ãƒ¤ãƒ¼å›è»¢/ç§»å‹• â†’ ç¢ºèª
   - æœŸå¾…ï¼šå›è»¢è§’åº¦ãŒã‚µãƒ ãƒã‚¤ãƒ«ã«åæ˜ 
   - ç¢ºèªæ–¹æ³•ï¼šrenderer.extract ã§å›è»¢è¡Œåˆ—ãŒè‡ªå‹•é©ç”¨ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

9. ãƒ¬ã‚¤ãƒ¤ãƒ¼åè»¢ãŒã‚µãƒ ãƒã‚¤ãƒ«ã«åæ˜ 
   - æ¡ä»¶ï¼šãƒ¬ã‚¤ãƒ¤ãƒ¼é¸æŠ â†’ åè»¢ãƒœã‚¿ãƒ³æŠ¼ä¸‹
   - æœŸå¾…ï¼šã‚µãƒ ãƒã‚¤ãƒ«ãŒå·¦å³åè»¢è¡¨ç¤º
   - ç¢ºèªæ–¹æ³•ï¼šscaleX/scaleY ãŒå¤‰ã‚ã‚Šã€renderer.extract ã§è‡ªå‹•åæ˜ 

10. ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚µãƒ ãƒã‚¤ãƒ«ãŒæœ€æ–°æƒ…å ±ã‚’è¡¨ç¤º
    - æ¡ä»¶ï¼šãƒ•ãƒ¬ãƒ¼ãƒ è¿½åŠ  â†’ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒ‘ãƒãƒ«ç¢ºèª
    - æœŸå¾…ï¼šã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚µãƒ ãƒã‚¤ãƒ«ã«å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼å†…å®¹ãŒè¡¨ç¤º
    - ç¢ºèªæ–¹æ³•ï¼štimeline-thumbnail-utils ã® updateThumbnailForFrame() ã§å†å–å¾—

11. Canvas ãƒªã‚µã‚¤ã‚ºå¾Œã«ã‚µãƒ ãƒã‚¤ãƒ«æ­£ç¢º
    - æ¡ä»¶ï¼šã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºå¤‰æ›´ â†’ ã‚µãƒ ãƒã‚¤ãƒ«ãƒ‘ãƒãƒ«ç¢ºèª
    - æœŸå¾…ï¼šã‚µãƒ ãƒã‚¤ãƒ«å†…å®¹ãŒãƒªã‚µã‚¤ã‚ºã«è¿½å¾“ã€ã‚¹ã‚±ãƒ¼ãƒ«æ­£ç¢º
    - ç¢ºèªæ–¹æ³•ï¼šRenderTexture ã®è§£åƒåº¦ãŒæ­£ã—ãé©ç”¨ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

12. DPIç’°å¢ƒã§ã‚µãƒ ãƒã‚¤ãƒ«ãŒã¼ã‚„ã‘ãªã„
    - æ¡ä»¶ï¼šRetinaç’°å¢ƒã§æç”» â†’ ã‚µãƒ ãƒã‚¤ãƒ«ç¢ºèª
    - æœŸå¾…ï¼šã‚µãƒ ãƒã‚¤ãƒ«ãŒã‚·ãƒ£ãƒ¼ãƒ—ï¼ˆ1px ã‚ºãƒ¬ãªã—ï¼‰
    - ç¢ºèªæ–¹æ³•ï¼šrenderer.extract ãŒ devicePixelRatio ã‚’è‡ªå‹•å¯¾å¿œ

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ‰‹é †

```
Step 1: ãƒšãƒ³æç”» â†’ ã‚µãƒ ãƒã‚¤ãƒ«ç¢ºèª
  action: æ–°è¦ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆ â†’ ãƒšãƒ³ãƒ„ãƒ¼ãƒ« â†’ é»’ç·šæç”»
  verify: layer-panel-renderer ã®ã‚µãƒ ãƒã‚¤ãƒ«ã«é»’ç·šãŒè¦‹ãˆã‚‹

Step 2: Vã‚­ãƒ¼ãƒ¢ãƒ¼ãƒ‰ â†’ å›è»¢ â†’ ã‚­ãƒ£ãƒ³ã‚»ãƒ«(Esc) â†’ ã‚µãƒ ãƒã‚¤ãƒ«ç¢ºèª
  action: Vã‚­ãƒ¼ â†’ ãƒ‰ãƒ©ãƒƒã‚°ã§å›è»¢ â†’ Esc
  verify: ã‚µãƒ ãƒã‚¤ãƒ«ãŒå›è»¢è§’åº¦ã‚’ä¿æŒ

Step 3: ãƒ¬ã‚¤ãƒ¤ãƒ¼åè»¢
  action: ãƒ¬ã‚¤ãƒ¤ãƒ¼é¸æŠ â†’ åè»¢ãƒœã‚¿ãƒ³ï¼ˆUIï¼‰
  verify: ã‚µãƒ ãƒã‚¤ãƒ«ãŒå·¦å³åè»¢è¡¨ç¤º

Step 4: æ–°è¦ãƒ•ãƒ¬ãƒ¼ãƒ è¿½åŠ  â†’ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚µãƒ ãƒã‚¤ãƒ«ç¢ºèª
  action: ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ä¸Šã§ + ãƒœã‚¿ãƒ³ â†’ æ–°ãƒ•ãƒ¬ãƒ¼ãƒ ä½œæˆ
  verify: timeline-thumbnail-utils ãŒæ–°ãƒ•ãƒ¬ãƒ¼ãƒ ã®ã‚µãƒ ãƒã‚¤ãƒ«ã‚’ç”Ÿæˆ

Step 5: ã‚­ãƒ£ãƒ³ãƒã‚¹ãƒªã‚µã‚¤ã‚º
  action: ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºã€ã¾ãŸã¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºå¤‰æ›´
  verify: ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«ã¨ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã®ã‚µãƒ ãƒã‚¤ãƒ«ãŒè‡ªå‹•æ›´æ–°
```

### ç¢ºèªã‚³ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰

```javascript
// Global ãƒ‡ãƒãƒƒã‚° API
window.ThumbnailDebug = {
  // ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚µãƒ ãƒã‚¤ãƒ«å†ç”Ÿæˆï¼ˆå¼·åˆ¶ï¼‰
  async regenerateLayer(index) {
    const layers = window.layerManager?.getLayers?.();
    if (layers && layers[index]) {
      const bitmap = await window.ThumbnailSystem.generateLayerThumbnail(
        layers[index], 64, 64
      );
      console.log('âœ… Regenerated layer', index, bitmap);
    }
  },
  
  // ãƒ•ãƒ¬ãƒ¼ãƒ ã‚µãƒ ãƒã‚¤ãƒ«å†ç”Ÿæˆï¼ˆå¼·åˆ¶ï¼‰
  async regenerateFrame(index) {
    const frames = window.animationSystem?.animationData?.cuts;
    if (frames && frames[index]) {
      const bitmap = await window.ThumbnailSystem.generateFrameThumbnail(
        frames[index], 150, 150
      );
      console.log('âœ… Regenerated frame', index, bitmap);
    }
  },
  
  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç¢ºèª
  inspectCache() {
    console.log('Layer cache:', window.ThumbnailSystem.layerThumbnailCache.size);
    console.log('Frame cache:', window.ThumbnailSystem.frameThumbnailCache.size);
  },
  
  // ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­ç¢ºèª
  monitorEvents() {
    const bus = window.TegakiEventBus;
    const events = [
      'thumbnail:layer-updated',
      'thumbnail:frame-updated',
      'thumbnail:regenerate-all',
      'layer:transform-updated',
      'layer:stroke-added'
    ];
    events.forEach(evt => {
      bus.on(evt, (data) => {
        console.log(`ğŸ“¡ Event: ${evt}`, data);
      });
    });
  }
};

// ä½¿ç”¨ä¾‹ï¼š
// await ThumbnailDebug.regenerateLayer(0);
// ThumbnailDebug.inspectCache();
// ThumbnailDebug.monitorEvents();
```

---

## å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: thumbnail-system.js æ–°è¦ä½œæˆ
- [ ] ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆï¼ˆsystem/drawing/thumbnail-system.jsï¼‰
- [ ] å…¨ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…ï¼ˆgenerateLayerThumbnail, generateFrameThumbnailç­‰ï¼‰
- [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ï¼ˆLayerThumbnailCache, FrameThumbnailCacheï¼‰
- [ ] _convertImageBitmapToDataURL ã®å®Ÿè£…
- [ ] EventBus åˆæœŸåŒ–ã¨è³¼èª­ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [ ] DPI/è§£åƒåº¦å¯¾å¿œç¢ºèª

### Phase 1: layer-panel-renderer.js æ”¹ä¿®
- [ ] generateLayerThumbnailCanvas() å…¨å‰Šé™¤
- [ ] createThumbnail() ç°¡ç•¥åŒ–ï¼ˆasync å¯¾å¿œï¼‰
- [ ] _setupEventListeners() çµ±ä¸€
- [ ] updateAllThumbnails() ã§ async å¯¾å¿œ
- [ ] æ—§ Canvas2D è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯å‰Šé™¤ï¼ˆå¤‰å½¢è¨ˆç®—ã‚‚ä¸è¦ï¼‰

### Phase 1: timeline-thumbnail-utils.js æ”¹ä¿®
- [ ] generateThumbnail() å†…ã® Canvas2D ãƒ­ã‚¸ãƒƒã‚¯å‰Šé™¤
- [ ] _cloneGraphics() å‰Šé™¤ï¼ˆGraphics å†æ§‹ç¯‰ä¸è¦ï¼‰
- [ ] _setupCameraTransformListener() ã§ thumbnail:regenerate-all è³¼èª­
- [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥çµ±ä¸€ï¼ˆThumbnailSystem ã¨åŒæœŸï¼‰

### Phase 2: layer-system.js æ”¹ä¿®
- [ ] flipActiveLayer() å†…ã« thumbnail:layer-updated ç™ºç«è¿½åŠ 
- [ ] onTransformComplete() å†…ã« thumbnail:layer-updated ç™ºç«è¿½åŠ 
- [ ] addPathToActiveLayer() å†…ã« thumbnail:layer-updated ç™ºç«è¿½åŠ 
- [ ] EventBus ã‚¤ãƒ™ãƒ³ãƒˆåçµ±ä¸€ç¢ºèª

### Phase 2: drawing-engine.js æ”¹ä¿®
- [ ] stopDrawing() å†…ã« thumbnail:layer-updated ç™ºç«è¿½åŠ 
- [ ] setTool() å†…ã« thumbnail:layer-updated ç™ºç«è¿½åŠ ï¼ˆeraser æ™‚ï¼‰
- [ ] åº§æ¨™ç³»ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åã®æ˜ç¤ºåŒ–ï¼ˆlocalX, localYï¼‰

### Phase 2: layer-transform.js æ”¹ä¿®
- [ ] toggleMoveMode() ã« thumbnail:layer-updated ç™ºç«è¿½åŠ 
- [ ] updateTransform() ã« thumbnail:layer-updated-live ç™ºç«è¿½åŠ ï¼ˆéãƒ‰ãƒ©ãƒƒã‚°æ™‚ï¼‰
- [ ] Vã‚­ãƒ¼çµ‚äº†æ™‚ã®æœ€çµ‚ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°ç¢ºèª

### Phase 2: core-runtime.js æ”¹ä¿®
- [ ] Phase 3 åˆæœŸåŒ–ã« ThumbnailSystem.init() è¿½åŠ 
- [ ] åˆæœŸåŒ–é †åºç¢ºèªï¼ˆLayerSystem â†’ ThumbnailSystemï¼‰

### Phase 3: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- [ ] ãƒšãƒ³æç”»ãƒ†ã‚¹ãƒˆ â†’ ã‚µãƒ ãƒã‚¤ãƒ«ç¢ºèª
- [ ] Vãƒ¢ãƒ¼ãƒ‰å›è»¢ãƒ†ã‚¹ãƒˆ â†’ ã‚µãƒ ãƒã‚¤ãƒ«å›è»¢åæ˜ ç¢ºèª
- [ ] ãƒ¬ã‚¤ãƒ¤ãƒ¼åè»¢ãƒ†ã‚¹ãƒˆ â†’ ã‚µãƒ ãƒã‚¤ãƒ«åè»¢åæ˜ ç¢ºèª
- [ ] ãƒ•ãƒ¬ãƒ¼ãƒ è¿½åŠ ãƒ†ã‚¹ãƒˆ â†’ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚µãƒ ãƒã‚¤ãƒ«ç¢ºèª
- [ ] ã‚­ãƒ£ãƒ³ãƒã‚¹ãƒªã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆ â†’ ã‚µãƒ ãƒã‚¤ãƒ«è‡ªå‹•æ›´æ–°ç¢ºèª
- [ ] DPI ç’°å¢ƒãƒ†ã‚¹ãƒˆ â†’ ã‚·ãƒ£ãƒ¼ãƒ—ãƒã‚¹ç¢ºèª

---

## æ³¨æ„ç‚¹ãƒ»è½ã¨ã—ç©´

1. **async/await å¯¾å¿œ**
   - generateLayerThumbnail, generateFrameThumbnail ã¯ async
   - layer-panel-renderer, timeline-thumbnail-utils ã§ await å‡¦ç†å¿…é ˆ

2. **RenderTexture ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†**
   - renderer.extract å®Ÿè¡Œå¾Œã¯ renderTexture.destroy(true) ã§ç ´æ£„
   - ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯é˜²æ­¢

3. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼è¨­è¨ˆ**
   - layerId + width + height + DPI ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ç”Ÿæˆ
   - DPIå¤‰æ›´æ™‚ã¯è‡ªå‹•ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢å¿…é ˆ

4. **EventBus ã‚¤ãƒ™ãƒ³ãƒˆçµ±ä¸€**
   - æ—§ã‚¤ãƒ™ãƒ³ãƒˆåï¼ˆlayer:thumbnail-need-updateç­‰ï¼‰ã¯å‰Šé™¤
   - æ–°çµ±ä¸€åï¼ˆthumbnail:layer-updatedï¼‰ã«çµ±ä¸€
   - æ—¢å­˜è³¼èª­ (on) ãƒ­ã‚¸ãƒƒã‚¯ã§æ¼ã‚Œãªã—ç¢ºèª

5. **Canvas2D å®Œå…¨å»ƒæ­¢**
   - generateLayerThumbnailCanvas() å‰Šé™¤æ™‚ã« Canvas2D è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã‚‚å‰Šé™¤
   - å¤‰å½¢ï¼ˆrotation, scaleï¼‰è¨ˆç®—ã‚‚å‰Šé™¤ï¼ˆrenderer.extract ã§è‡ªå‹•å¯¾å¿œï¼‰

---

## ãƒ•ã‚¡ã‚¤ãƒ«æ”¹ä¿®ã‚µãƒãƒª

| ãƒ•ã‚¡ã‚¤ãƒ« | æ”¹ä¿®å†…å®¹ | è¡Œæ•° | æ–°è¦/æ”¹ä¿® |
|---------|--------|------|---------|
| system/drawing/thumbnail-system.js | çµ±ä¸€ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ å…¨å®Ÿè£… | 300-400 | æ–°è¦ |
| ui/layer-panel-renderer.js | Canvas2D å»ƒæ­¢ã€ThumbnailSystem çµ±åˆ | -80è¡Œ | æ”¹ä¿® |
| ui/timeline-thumbnail-utils.js | Canvas2D å»ƒæ­¢ã€ThumbnailSystem çµ±åˆ | -60è¡Œ | æ”¹ä¿® |
| system/layer-system.js | ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ãƒã‚¤ãƒ³ãƒˆè¿½åŠ ï¼ˆ3ç®‡æ‰€ï¼‰ | +15è¡Œ | æ”¹ä¿® |
| system/drawing/drawing-engine.js | ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ãƒã‚¤ãƒ³ãƒˆè¿½åŠ ï¼ˆ2ç®‡æ‰€ï¼‰ã€åº§æ¨™ç³»åæ˜ç¤º | +10è¡Œ | æ”¹ä¿® |
| system/layer-transform.js | ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ãƒã‚¤ãƒ³ãƒˆè¿½åŠ ï¼ˆ2ç®‡æ‰€ï¼‰ | +10è¡Œ | æ”¹ä¿® |
| core-runtime.js | Phase 3 åˆæœŸåŒ–è¿½åŠ  | +5è¡Œ | æ”¹ä¿® |

**ç·è¨ˆï¼šæ–°è¦ 300-400è¡Œã€æ”¹ä¿® å…¨ä½“ã§-150è¡Œï¼ˆãƒãƒƒãƒˆ +150è¡Œï¼‰**

---

## å¾Œç¶š Claude ã¸ã®æŒ‡ç¤º

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç”¨ã„ã¦ä»¥ä¸‹ã‚’å®Ÿæ–½ã—ã¦ãã ã•ã„ï¼š

1. **Phase 1 å®Ÿè£…**
   - thumbnail-system.js ã‚’æ–°è¦ä½œæˆï¼ˆrenderer.extract.imageBitmap å®Ÿè£…é‡è¦–ï¼‰
   - layer-panel-renderer, timeline-thumbnail-utils ã‹ã‚‰ Canvas2D ãƒ­ã‚¸ãƒƒã‚¯å‰Šé™¤
   - ThumbnailSystem ã¨ã®é€£æºç¢ºèª

2. **Phase 2 å®Ÿè£…**
   - ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ãƒã‚¤ãƒ³ãƒˆã‚’ãƒªã‚¹ãƒˆã«å¾“ã„è¿½åŠ 
   - EventBus ã‚¤ãƒ™ãƒ³ãƒˆåãŒçµ±ä¸€ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
   - core-runtime.js ã§åˆæœŸåŒ–é †åºç¢ºèª

3. **Phase 3 ãƒ†ã‚¹ãƒˆ**
   - ä¸Šè¨˜ãƒ†ã‚¹ãƒˆé …ç›®ã‚’å®Ÿè¡Œ
   - ThumbnailDebug ã‚³ãƒ³ã‚½ãƒ¼ãƒ« API ã§æ¤œè¨¼
   - å„ã‚¹ãƒ†ãƒƒãƒ—ã§ã€Œâœ… ã‚µãƒ ãƒã‚¤ãƒ«ç¢ºèªã€ã‚’å®Ÿæ–½